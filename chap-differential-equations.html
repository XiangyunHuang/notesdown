<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 14 章 微分方程 | R 语言学习笔记</title>
<meta name="author" content="黄湘云">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="第 14 章 微分方程 | R 语言学习笔记">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 14 章 微分方程 | R 语言学习笔记">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content="library(deSolve)     # ODE 常微分方程 library(scatterplot3d)  # 三维曲线图 library(shape) library(ReacTran)    # PDE 偏微分方程 library(PBSddesolve)   # DAE 延迟微分方程 library(nlme)       # 混合效应模型 # library(nlmeODE)...">
<meta property="og:description" content="library(deSolve)     # ODE 常微分方程 library(scatterplot3d)  # 三维曲线图 library(shape) library(ReacTran)    # PDE 偏微分方程 library(PBSddesolve)   # DAE 延迟微分方程 library(nlme)       # 混合效应模型 # library(nlmeODE)...">
<meta name="twitter:description" content="library(deSolve)     # ODE 常微分方程 library(scatterplot3d)  # 三维曲线图 library(shape) library(ReacTran)    # PDE 偏微分方程 library(PBSddesolve)   # DAE 延迟微分方程 library(nlme)       # 混合效应模型 # library(nlmeODE)...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R 语言学习笔记</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">统计计算</li>
<li><a class="" href="chap-statistical-computation.html">介绍</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">13</span> 数值优化</a></li>
<li><a class="active" href="chap-differential-equations.html"><span class="header-section-number">14</span> 微分方程</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/notesdown">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-differential-equations" class="section level1" number="14">
<h1>
<span class="header-section-number">第 14 章</span> 微分方程<a class="anchor" aria-label="anchor" href="#chap-differential-equations"><i class="fas fa-link"></i></a>
</h1>
<!-- 介绍洛伦兹方程、人口模型、寿险精算模型、混沌 -->
<div class="sourceCode" id="cb1952"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/">deSolve</a></span><span class="op">)</span>         <span class="co"># ODE 常微分方程</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scatterplot3d</span><span class="op">)</span>   <span class="co"># 三维曲线图</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ReacTran</span><span class="op">)</span>        <span class="co"># PDE 偏微分方程</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pbs-software/pbs-ddesolve">PBSddesolve</a></span><span class="op">)</span>     <span class="co"># DAE 延迟微分方程</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span>              <span class="co"># 混合效应模型</span>
<span class="co"># library(nlmeODE)         # ODE 应用于混合效应模型</span>
<span class="co"># library(Sim.DiffProc)    # SDE 随机微分方程 种群 ODE 建模</span>
<span class="co"># library(nlmixr)          # Population ODE modeling</span></code></pre></div>
<p><a href="https://blog.hamaluik.ca/posts/solving-systems-of-partial-differential-equations/">ode45 求解偏微分方程</a></p>
<p><strong>pracma</strong> 实现了 ode23, ode23s, ode45 等几个自适应的 Runge-Kutta 求解器，<strong>deSolve</strong> 包求解 ODE（常微分方程）, DAE（微分代数方程）, DDE（延迟微分方程，包含刚性和非刚性方程）和 PDE（偏微分方程），<strong>bvpSolve</strong>包求解 DAE/ODE 方程的边值问题。<strong>ReacTran</strong> <span class="citation"><a href="#ref-ReacTran2012" role="doc-biblioref">[40]</a></span> 可将偏微分方程转为常微分方程组，解决反应运输问题，在笛卡尔、极坐标、圆柱形和球形网格上离散偏微分方程。 <a href="https://github.com/LLNL/sundials">sundials</a> 提供一系列非线性方程、常微分方程、微分代数方程求解器，Satyaprakash Nayak 开发了相应的 <a href="https://github.com/sn248/sundialr"><strong>sundialr</strong></a> 包。</p>
<div id="sec-ordinary-differential-equations" class="section level2" number="14.1">
<h2>
<span class="header-section-number">14.1</span> 常微分方程<a class="anchor" aria-label="anchor" href="#sec-ordinary-differential-equations"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://en.wikipedia.org/wiki/Lorenz_system">洛伦兹系统</a>是一个常微分方程组，系统参数的默认值为 <span class="math inline">\((\sigma = 10, \rho = 28, \beta = 8/3)\)</span>，初值为 <span class="math inline">\((-13, -14, 47)\)</span>。</p>
<span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    \frac{\partial x}{\partial t} = \sigma (y - x) \\
    \frac{\partial y}{\partial t} = x(\rho -z) - y \\
    \frac{\partial x}{\partial t} = xy - \beta z
  \end{array} \right.
\end{equation*}\]</span>
<div class="sourceCode" id="cb1953"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/">deSolve</a></span><span class="op">)</span>
<span class="co"># 参数</span>
<span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="op">-</span><span class="fl">8</span> <span class="op">/</span> <span class="fl">3</span>, b <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, c <span class="op">=</span> <span class="fl">28</span><span class="op">)</span>
<span class="co"># 初值</span>
<span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co"># 时间间隔</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="co"># 定义方程组</span>
<span class="va">lorenz_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">state</span>, <span class="va">parameters</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">parameters</span><span class="op">)</span><span class="op">)</span>, <span class="op">{</span>
    <span class="va">dX</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Y</span> <span class="op">*</span> <span class="va">Z</span>
    <span class="va">dY</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="va">Y</span> <span class="op">-</span> <span class="va">Z</span><span class="op">)</span>
    <span class="va">dZ</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">X</span> <span class="op">*</span> <span class="va">Y</span> <span class="op">+</span> <span class="va">c</span> <span class="op">*</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Z</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dX</span>, <span class="va">dY</span>, <span class="va">dZ</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span>
  y <span class="op">=</span> <span class="va">state</span>, times <span class="op">=</span> <span class="va">times</span>,
  func <span class="op">=</span> <span class="va">lorenz_fun</span>, parms <span class="op">=</span> <span class="va">pars</span>
<span class="op">)</span></code></pre></div>
<p>调用 <strong>scatterplot3d</strong> 绘制三维曲线图，如图<a href="chap-differential-equations.html#fig:ode-lorenz">14.1</a> 所示</p>
<div class="sourceCode" id="cb1954"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scatterplot3d</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/scatterplot3d/man/scatterplot3d.html">scatterplot3d</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"X"</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"Y"</span><span class="op">]</span>, z <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"Z"</span><span class="op">]</span>,
  col.axis <span class="op">=</span> <span class="st">"black"</span>, type <span class="op">=</span> <span class="st">"l"</span>, color <span class="op">=</span> <span class="st">"gray"</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,
  col.grid <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="st">"Lorenz"</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ode-lorenz"></span>
<img src="differential-equations_files/figure-html/ode-lorenz-1.png" alt="洛伦兹曲线" width="528"><p class="caption">
图 14.1: 洛伦兹曲线
</p>
</div>
</div>
<div id="sec-partial-differential-equations" class="section level2" number="14.2">
<h2>
<span class="header-section-number">14.2</span> 偏微分方程<a class="anchor" aria-label="anchor" href="#sec-partial-differential-equations"><i class="fas fa-link"></i></a>
</h2>
<p>ReacTran 的几个关键函数介绍</p>
<p>一维热传导方程</p>
<span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    \frac{\partial y}{\partial t} = D \frac{\partial^2 y}{\partial x^2}
  \end{array} \right.
\end{equation*}\]</span>
<p>参数 <span class="math inline">\(D = 0.01\)</span>，边界条件 <span class="math inline">\(y_{t,x=0} = 0, y_{t, x = 1} = 1\)</span>，初始条件 <span class="math inline">\(y_{t=0,x} = \sin(\pi x)\)</span>。</p>
<div class="sourceCode" id="cb1955"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ReacTran</span><span class="op">)</span>

<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">xgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/setup.grid.1D.html">setup.grid.1D</a></span><span class="op">(</span>x.up <span class="op">=</span> <span class="fl">0</span>, x.down <span class="op">=</span> <span class="fl">1</span>, N <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">x.mid</span>
<span class="va">D.coeff</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>
<span class="va">Diffusion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Y</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/tran.1D.html">tran.1D</a></span><span class="op">(</span>
    C <span class="op">=</span> <span class="va">Y</span>, C.up <span class="op">=</span> <span class="fl">0</span>, C.down <span class="op">=</span> <span class="fl">1</span>,
    D <span class="op">=</span> <span class="va">D.coeff</span>, dx <span class="op">=</span> <span class="va">xgrid</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    dY <span class="op">=</span> <span class="va">tran</span><span class="op">$</span><span class="va">dC</span>, 
    flux.up <span class="op">=</span> <span class="va">tran</span><span class="op">$</span><span class="va">flux.up</span>,
    flux.down <span class="op">=</span> <span class="va">tran</span><span class="op">$</span><span class="va">flux.down</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="va">yini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.1D.html">ode.1D</a></span><span class="op">(</span>
  y <span class="op">=</span> <span class="va">yini</span>, times <span class="op">=</span> <span class="va">times</span>, func <span class="op">=</span> <span class="va">Diffusion</span>,
  parms <span class="op">=</span> <span class="cn">NULL</span>, dimens <span class="op">=</span> <span class="va">N</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1956"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span><span class="va">out</span>,
  grid <span class="op">=</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">x.mid</span>, xlab <span class="op">=</span> <span class="st">"times"</span>,
  ylab <span class="op">=</span> <span class="st">"Distance"</span>, main <span class="op">=</span> <span class="st">"PDE"</span>, add.contour <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:pde-1d"></span>
<img src="differential-equations_files/figure-html/pde-1d-1.png" alt="一维热传导方程的数值解热力图" width="528"><p class="caption">
图 14.2: 一维热传导方程的数值解热力图
</p>
</div>
<p>二维拉普拉斯方程</p>
<span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    \frac{\partial^2 u}{\partial^2 x} + \frac{\partial^2 u}{\partial y^2} = 0
  \end{array} \right.
\end{equation*}\]</span>
<p>边界条件</p>
<span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    u_{x=0,y} = u_{x=1,y} = 0 \\
    \frac{\partial u_{x, y=0}}{\partial y} = 0 \\
    \frac{\partial u_{x,y=1}}{\partial y} = \pi\sinh(\pi)\sin(\pi x)
  \end{array} \right.
\end{equation*}\]</span>
<p>它有解析解</p>
<p><span class="math display">\[
u(x,y) = \sin(\pi x)\cosh(\pi y)
\]</span></p>
<p>其中 <span class="math inline">\(x \in [0,1], y\in [0,1]\)</span></p>
<div class="sourceCode" id="cb1957"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html">cosh</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">fn</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb1958"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/image.html">image</a></span><span class="op">(</span><span class="va">z</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/contour.html">contour</a></span><span class="op">(</span><span class="va">z</span>, method <span class="op">=</span> <span class="st">"flattest"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:laplace-eq-image"></span>
<img src="differential-equations_files/figure-html/laplace-eq-image-1.png" alt="解析解的二维图像" width="528"><p class="caption">
图 14.3: 解析解的二维图像
</p>
</div>
<div class="sourceCode" id="cb1959"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/persp.html">persp</a></span><span class="op">(</span><span class="va">z</span>, 
  theta <span class="op">=</span> <span class="fl">30</span>, phi <span class="op">=</span> <span class="fl">20</span>, 
  r <span class="op">=</span> <span class="fl">50</span>, d <span class="op">=</span> <span class="fl">0.1</span>, expand <span class="op">=</span> <span class="fl">0.5</span>, ltheta <span class="op">=</span> <span class="fl">90</span>, lphi <span class="op">=</span> <span class="fl">180</span>,
  shade <span class="op">=</span> <span class="fl">0.1</span>, ticktype <span class="op">=</span> <span class="st">"detailed"</span>, nticks <span class="op">=</span> <span class="fl">5</span>, box <span class="op">=</span> <span class="cn">TRUE</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shape/man/drapecol.html">drapecol</a></span><span class="op">(</span><span class="va">z</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,
  border <span class="op">=</span> <span class="st">"transparent"</span>,
  xlab <span class="op">=</span> <span class="st">"X"</span>, ylab <span class="op">=</span> <span class="st">"Y"</span>, zlab <span class="op">=</span> <span class="st">"Z"</span>, 
  main <span class="op">=</span> <span class="st">""</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:laplace-eq-persp"></span>
<img src="differential-equations_files/figure-html/laplace-eq-persp-1.png" alt="解析解的三维透视图像" width="528"><p class="caption">
图 14.4: 解析解的三维透视图像
</p>
</div>
<p>求解 PDE</p>
<div class="sourceCode" id="cb1960"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dx</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>
<span class="va">xgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/setup.grid.1D.html">setup.grid.1D</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">100</span>, dx.1 <span class="op">=</span> <span class="va">dx</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">x.mid</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">N</span>

<span class="va">uini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">vini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">N</span><span class="op">)</span>
<span class="va">yini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">uini</span>, <span class="va">vini</span><span class="op">)</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">50</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">wave</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">u1</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">]</span>
  <span class="va">u2</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">]</span>
  <span class="va">du1</span> <span class="op">&lt;-</span> <span class="va">u2</span>
  <span class="va">du2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/tran.1D.html">tran.1D</a></span><span class="op">(</span>C <span class="op">=</span> <span class="va">u1</span>, C.up <span class="op">=</span> <span class="fl">0</span>, C.down <span class="op">=</span> <span class="fl">0</span>, D <span class="op">=</span> <span class="fl">1</span>, dx <span class="op">=</span> <span class="va">xgrid</span><span class="op">)</span><span class="op">$</span><span class="va">dC</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">du1</span>, <span class="va">du2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.1D.html">ode.1D</a></span><span class="op">(</span>
  func <span class="op">=</span> <span class="va">wave</span>, y <span class="op">=</span> <span class="va">yini</span>, times <span class="op">=</span> <span class="va">times</span>, parms <span class="op">=</span> <span class="cn">NULL</span>,
  nspec <span class="op">=</span> <span class="fl">2</span>, method <span class="op">=</span> <span class="st">"ode45"</span>, dimens <span class="op">=</span> <span class="va">N</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"u"</span>, <span class="st">"v"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="sec-delay-differential-equations" class="section level2" number="14.3">
<h2>
<span class="header-section-number">14.3</span> 延迟微分方程<a class="anchor" aria-label="anchor" href="#sec-delay-differential-equations"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb1961"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pbs-software/pbs-ddesolve">PBSddesolve</a></span><span class="op">)</span>    <span class="co"># DAE 延迟微分方程</span></code></pre></div>
<p><a href="https://github.com/pbs-software/pbs-ddesolve"><strong>PBSddesolve</strong></a> <span class="citation"><a href="#ref-PBSddesolve" role="doc-biblioref">[41]</a></span> <strong>PBSmodelling</strong> <strong>PBSmapping</strong></p>
<p><strong>nlmeODE</strong> 通过微分方程整合用于混合效应模型的 odesolve 和 nlme 包。</p>
</div>
<div id="sec-stochastic-differential-equations" class="section level2" number="14.4">
<h2>
<span class="header-section-number">14.4</span> 随机微分方程<a class="anchor" aria-label="anchor" href="#sec-stochastic-differential-equations"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/acguidoum/Sim.DiffProc">Sim.DiffProc</a></p>
<p><a href="https://uploads.cosx.org/2008/12/stochastic-differential-equation-with-r.pdf">随机微分方程入门：基于 R 语言的模拟和推断</a></p>
<div class="sourceCode" id="cb1962"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># library(Sim.DiffProc)</span></code></pre></div>
<p><a href="https://github.com/nlmixrdevelopment/nlmixr">nlmixr</a> 借助 <a href="https://github.com/nlmixrdevelopment/RxODE/">RxODE</a> 求解基于常微分方程的非线性混合效应模型</p>

</div>
</div>



<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-ReacTran2012" class="csl-entry">
<div class="csl-left-margin">[40] </div>
<div class="csl-right-inline">K. Soetaert and F. Meysman, <span>“Reactive transport in aquatic ecosystems: Rapid model prototyping in the open source software <span>R</span>,”</span> <em>Environmental Modelling &amp; Software</em>, vol. 32, pp. 49–60, 2012.</div>
</div>
<div id="ref-PBSddesolve" class="csl-entry">
<div class="csl-left-margin">[41] </div>
<div class="csl-right-inline">A. Couture-Beil, J. T. Schnute, R. Haigh, S. N. Wood, and B. J. Cairns, <em><span>PBSddesolve</span>: Solver for delay differential equations</em>. 2019.Available: <a href="https://CRAN.R-project.org/package=PBSddesolve">https://CRAN.R-project.org/package=PBSddesolve</a>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chap-numerical-optimization.html"><span class="header-section-number">13</span> 数值优化</a></div>
<div class="next"><a href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-differential-equations"><span class="header-section-number">14</span> 微分方程</a></li>
<li><a class="nav-link" href="#sec-ordinary-differential-equations"><span class="header-section-number">14.1</span> 常微分方程</a></li>
<li><a class="nav-link" href="#sec-partial-differential-equations"><span class="header-section-number">14.2</span> 偏微分方程</a></li>
<li><a class="nav-link" href="#sec-delay-differential-equations"><span class="header-section-number">14.3</span> 延迟微分方程</a></li>
<li><a class="nav-link" href="#sec-stochastic-differential-equations"><span class="header-section-number">14.4</span> 随机微分方程</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/notesdown/blob/devel/differential-equations.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/notesdown/edit/devel/differential-equations.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R 语言学习笔记</strong>" was written by 黄湘云. It was last built on 2023-02-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
