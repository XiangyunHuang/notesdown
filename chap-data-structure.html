<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 2 章 数据结构 | R 语言学习笔记</title>
<meta name="author" content="黄湘云">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="第 2 章 数据结构 | R 语言学习笔记">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 2 章 数据结构 | R 语言学习笔记">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content="网站 https://r-coder.com/ 主要介绍 Base R，特点是全面细致，排版精美 可用于绘图的数据对象，向量 vector 等，只涉及基础操作和绘图，关键在入门引导式的介绍，点到即止 数据类型：字符、数值：字符数据操作：按数据类型介绍各类数据操作，重复之处如前所述，数据处理的分类：按数据类型来，一共是 table matrix data.frame 和 vector The...">
<meta property="og:description" content="网站 https://r-coder.com/ 主要介绍 Base R，特点是全面细致，排版精美 可用于绘图的数据对象，向量 vector 等，只涉及基础操作和绘图，关键在入门引导式的介绍，点到即止 数据类型：字符、数值：字符数据操作：按数据类型介绍各类数据操作，重复之处如前所述，数据处理的分类：按数据类型来，一共是 table matrix data.frame 和 vector The...">
<meta name="twitter:description" content="网站 https://r-coder.com/ 主要介绍 Base R，特点是全面细致，排版精美 可用于绘图的数据对象，向量 vector 等，只涉及基础操作和绘图，关键在入门引导式的介绍，点到即止 数据类型：字符、数值：字符数据操作：按数据类型介绍各类数据操作，重复之处如前所述，数据处理的分类：按数据类型来，一共是 table matrix data.frame 和 vector The...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R 语言学习笔记</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="active" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">统计计算</li>
<li><a class="" href="chap-statistical-computation.html">介绍</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">13</span> 数值优化</a></li>
<li><a class="" href="chap-differential-equations.html"><span class="header-section-number">14</span> 微分方程</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/notesdown">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-data-structure" class="section level1" number="2">
<h1>
<span class="header-section-number">第 2 章</span> 数据结构<a class="anchor" aria-label="anchor" href="#chap-data-structure"><i class="fas fa-link"></i></a>
</h1>
<p>网站 <a href="https://r-coder.com/" class="uri">https://r-coder.com/</a> 主要介绍 Base R，特点是全面细致，排版精美</p>
<blockquote>
<p>可用于绘图的数据对象，向量 vector 等，只涉及基础操作和绘图，关键在入门引导式的介绍，点到即止</p>
</blockquote>
<p>数据类型：字符、数值：字符数据操作：按数据类型介绍各类数据操作，重复之处如前所述，数据处理的分类：按数据类型来，一共是 table matrix data.frame 和 vector</p>
<blockquote>
<p>The trouble with nonstandard evaluation is that it doesn’t follow standard
evaluation rules…</p>
<p>— Peter Dalgaard (about nonstandard evaluation in the <code><a href="https://rdrr.io/r/graphics/curve.html">curve()</a></code> function)
R-help (June 2011)</p>
</blockquote>
<!-- 详细介绍 data.frame 和 data.table，而不简略介绍 tibble 和 dplyr -->
<p>向量，列表，</p>
<p>数据框 data frame 在 R 里面可以用三种不同类型的数据对象来表达</p>
<blockquote>
<p>从历史脉络来看，为什么会出现三种不同的东西，它们之间的区别和联系是什么，能否用一张表来描述</p>
</blockquote>
<p>data.frame 设计的历史，首次包含在 R 里面是什么时候，R 是否一发布就包含了这个数据类型</p>
<p>The function <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> creates data frames, tightly coupled collections of variables which share many of the properties of matrices and of lists, used as the fundamental data structure by most of R’s modeling software.</p>
<p><strong>data.table</strong> 2006 年 4 月 15 日首次登陆 CRAN 发布 1.0 版本，差不多恰好 10 年后</p>
<p><strong>tibble</strong> 在 2016 年 3 月 23 日首次登陆 CRAN 发布 1.0 版本</p>
<p><code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>， <code>tibble()</code> 和 <code>data.table()</code> 的区别，去看函数的帮助文档</p>
<p>Provides a ‘tbl_df’ class (the ‘tibble’) that provides stricter checking and better formatting than the traditional data frame.</p>
<p><a href="https://github.com/r-lib/vctrs">vctrs</a> 和 <a href="https://github.com/r-lib/rlang">rlang</a> 包
R 内置的 <a href="https://cran.r-project.org/doc/manuals/r-release/R-lang.html">R Language Definition</a></p>
<div id="subsec:typeof" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> 类型<a class="anchor" aria-label="anchor" href="#subsec:typeof"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"abc"</span> <span class="co"># 数据对象</span>
<span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 数据类型</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mode.html">mode</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 存储模式</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mode.html">storage.mode</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 存储类型</span></code></pre></div>
<pre><code>## [1] "character"</code></pre>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:all-data-type">表 2.1: </span> 函数 <code><a href="https://rdrr.io/r/base/typeof.html">typeof()</a></code> 返回的数据类型 <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;表格中带 *** 标记的类型，用户不能轻易获得&lt;/p&gt;"><sup>6</sup></a>
</caption>
<thead><tr class="header">
<th align="left">符号</th>
<th align="left">含义</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>NULL</code></td>
<td align="left">空值</td>
</tr>
<tr class="even">
<td align="left"><code>symbol</code></td>
<td align="left">可变的名称/变量</td>
</tr>
<tr class="odd">
<td align="left"><code>pairlist</code></td>
<td align="left">pairlist 对象***</td>
</tr>
<tr class="even">
<td align="left"><code>closure</code></td>
<td align="left">函数闭包</td>
</tr>
<tr class="odd">
<td align="left"><code>environment</code></td>
<td align="left">环境</td>
</tr>
<tr class="even">
<td align="left"><code>promise</code></td>
<td align="left">实现惰性求值的对象</td>
</tr>
<tr class="odd">
<td align="left"><code>language</code></td>
<td align="left">R 语言构造</td>
</tr>
<tr class="even">
<td align="left"><code>special</code></td>
<td align="left">内部函数，不计算参数</td>
</tr>
<tr class="odd">
<td align="left"><code>builtin</code></td>
<td align="left">内部函数，计算参数</td>
</tr>
<tr class="even">
<td align="left"><code>char</code></td>
<td align="left">scalar 型字符对象***</td>
</tr>
<tr class="odd">
<td align="left"><code>logical</code></td>
<td align="left">逻辑向量</td>
</tr>
<tr class="even">
<td align="left"><code>integer</code></td>
<td align="left">整数向量</td>
</tr>
<tr class="odd">
<td align="left"><code>double</code></td>
<td align="left">实值向量</td>
</tr>
<tr class="even">
<td align="left"><code>complex</code></td>
<td align="left">复值向量</td>
</tr>
<tr class="odd">
<td align="left"><code>character</code></td>
<td align="left">字符向量</td>
</tr>
<tr class="even">
<td align="left"><code>...</code></td>
<td align="left">可变长度的参数***</td>
</tr>
<tr class="odd">
<td align="left"><code>any</code></td>
<td align="left">匹配任意类型</td>
</tr>
<tr class="even">
<td align="left"><code>expression</code></td>
<td align="left">表达式对象</td>
</tr>
<tr class="odd">
<td align="left"><code>list</code></td>
<td align="left">列表</td>
</tr>
<tr class="even">
<td align="left"><code>bytecode</code></td>
<td align="left">位代码***</td>
</tr>
<tr class="odd">
<td align="left"><code>externalptr</code></td>
<td align="left">外部指针对象</td>
</tr>
<tr class="even">
<td align="left"><code>weakref</code></td>
<td align="left">弱引用对象</td>
</tr>
<tr class="odd">
<td align="left"><code>raw</code></td>
<td align="left">位向量</td>
</tr>
<tr class="even">
<td align="left"><code>S4</code></td>
<td align="left">S4 对象</td>
</tr>
</tbody>
</table></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:basic-data-type">表 2.2: </span> R/Rcpp 提供的基本数据类型</caption>
<colgroup>
<col width="7%">
<col width="10%">
<col width="31%">
<col width="31%">
<col width="10%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th align="center">Value</th>
<th align="center">R vector</th>
<th align="center">Rcpp vector</th>
<th align="center">Rcpp matrix</th>
<th align="center">Rcpp scalar</th>
<th align="center">C++ scalar</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">Logical</td>
<td align="center"><code>logical</code></td>
<td align="center"><code>LogicalVector</code></td>
<td align="center"><code>LogicalMatrix</code></td>
<td align="center">-</td>
<td align="center"><code>bool</code></td>
</tr>
<tr class="even">
<td align="center">Integer</td>
<td align="center"><code>integer</code></td>
<td align="center"><code>IntegerVector</code></td>
<td align="center"><code>IntegerMatrix</code></td>
<td align="center">-</td>
<td align="center"><code>int</code></td>
</tr>
<tr class="odd">
<td align="center">Real</td>
<td align="center"><code>numeric</code></td>
<td align="center"><code>NumericVector</code></td>
<td align="center"><code>NumericMatrix</code></td>
<td align="center">-</td>
<td align="center"><code>double</code></td>
</tr>
<tr class="even">
<td align="center">Complex</td>
<td align="center"><code>complex</code></td>
<td align="center"><code>ComplexVector</code></td>
<td align="center"><code>ComplexMatrix</code></td>
<td align="center"><code>Rcomplex</code></td>
<td align="center"><code>complex</code></td>
</tr>
<tr class="odd">
<td align="center">String</td>
<td align="center"><code>character</code></td>
<td align="center">
<code>CharacterVector</code> (<code>StringVector</code>)</td>
<td align="center">
<code>CharacterMatrix</code> (<code>StringMatrix</code>)</td>
<td align="center"><code>String</code></td>
<td align="center"><code>string</code></td>
</tr>
<tr class="even">
<td align="center">Date</td>
<td align="center"><code>Date</code></td>
<td align="center"><code>DateVector</code></td>
<td align="center">-</td>
<td align="center"><code>Date</code></td>
<td align="center">-</td>
</tr>
<tr class="odd">
<td align="center">Datetime</td>
<td align="center"><code>POSIXct</code></td>
<td align="center"><code>DatetimeVector</code></td>
<td align="center">-</td>
<td align="center"><code>Datetime</code></td>
<td align="center"><code>time_t</code></td>
</tr>
</tbody>
</table></div>
</div>
<div id="sec-character" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> 字符<a class="anchor" aria-label="anchor" href="#sec-character"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="sec-vector" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> 向量<a class="anchor" aria-label="anchor" href="#sec-vector"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="sec-matrix" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> 矩阵<a class="anchor" aria-label="anchor" href="#sec-matrix"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="sec-array" class="section level2" number="2.5">
<h2>
<span class="header-section-number">2.5</span> 数组<a class="anchor" aria-label="anchor" href="#sec-array"><i class="fas fa-link"></i></a>
</h2>
<p>更多数组操作 <a href="https://github.com/r-lib/rray">rray</a></p>
</div>
<div id="sec-expression" class="section level2" number="2.6">
<h2>
<span class="header-section-number">2.6</span> 表达式<a class="anchor" aria-label="anchor" href="#sec-expression"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># %||% 中缀符</span>
<span class="co"># x 是空值或者长度为 0 则保留 y 否则保留 x</span>
<span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="va">y</span> <span class="kw">else</span> <span class="va">x</span></code></pre></div>
<pre><code>## function(x, y) if (is.null(x) || length(x) == 0) y else x</code></pre>
</div>
<div id="sec-list" class="section level2" number="2.7">
<h2>
<span class="header-section-number">2.7</span> 列表<a class="anchor" aria-label="anchor" href="#sec-list"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span>, b <span class="op">=</span> <span class="fl">2</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, e <span class="op">=</span> <span class="st">"hello"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## $a
## [1] 1
## 
## $b
## [1] 2
## 
## $c
## $c$d
## [1] 1 2 3
## 
## $c$e
## [1] "hello"</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">base</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print.simple.list</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>##      _    
## a    1    
## b    2    
## c.d1 1    
## c.d2 2    
## c.d3 3    
## c.e  hello</code></pre>
</div>
<div id="sec-date" class="section level2" number="2.8">
<h2>
<span class="header-section-number">2.8</span> 日期<a class="anchor" aria-label="anchor" href="#sec-date"><i class="fas fa-link"></i></a>
</h2>
<p>注意观察时间转化</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2023-02-01"</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2023-02-01 23:16:59 UTC"</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2023-02-01 23:16:59 UTC" "2023-02-01 00:00:00 UTC"</code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2023</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2023</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2023 2023</code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "POSIXct" "POSIXt"</code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2023-02-01"</code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2019-12-21"</span>, <span class="st">"2019/12/21"</span><span class="op">)</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="st">"2019-12-21"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2019</code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="st">"2019/12/21"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2019</code></pre>
<p>但是，下面这样会报错</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## Error in as.POSIXlt.character(x): character string is not in a standard unambiguous format</code></pre>
<p>正确的姿势是首先将表示日期的字符串格式统一</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"/"</span>, replacement <span class="op">=</span> <span class="st">"-"</span>, <span class="va">x</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2019 2019</code></pre>
<p>date-times 表示 POSIXct 和 POSIXlt 类型的日期对象</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">(</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2023-02-01 23:16:59 UTC"</code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "POSIXct" "POSIXt"</code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">second</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 取秒</span></code></pre></div>
<pre><code>## [1] 59</code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, format <span class="op">=</span> <span class="st">"%S"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "59"</code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">minute</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 取分</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, format <span class="op">=</span> <span class="st">"%M"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "16"</code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">hour</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 取时</span></code></pre></div>
<pre><code>## [1] 23</code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, format <span class="op">=</span> <span class="st">"%H"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "23"</code></pre>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">yday</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 此刻在一年的第几天</span></code></pre></div>
<pre><code>## [1] 32</code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">wday</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 此刻在一周的第几天，星期日是第1天，星期六是第7天</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">mday</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 此刻在当月第几天</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, format <span class="op">=</span> <span class="st">"%d"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "01"</code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">weekdays</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Wednesday"</code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">weekdays</a></span><span class="op">(</span><span class="va">x</span>, abbreviate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Wed"</code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">week</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 此刻在第几周</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">isoweek</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">month</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 此刻在第几月</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, format <span class="op">=</span> <span class="st">"%m"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "02"</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "February"</code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">months</a></span><span class="op">(</span><span class="va">x</span>, abbreviate <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Feb"</code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">quarter</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 此刻在第几季度</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html">quarters</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Q1"</code></pre>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html">year</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="co"># 取年</span></code></pre></div>
<pre><code>## [1] 2023</code></pre>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="va">x</span>, format <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2023"</code></pre>
<div class="rmdtip">
<p><code><a href="https://rdrr.io/r/base/format.html">format()</a></code> 是一个泛型函数，此刻命名空间有 102 方法。
<code><a href="https://rdrr.io/r/base/as.Date.html">format.Date()</a></code>， <code><a href="https://rdrr.io/r/base/difftime.html">format.difftime()</a></code>， <code><a href="https://rdrr.io/r/base/strptime.html">format.POSIXct()</a></code> 和 <code><a href="https://rdrr.io/r/base/strptime.html">format.POSIXlt()</a></code> 四个函数通过格式化不同类型的日期数据对象抽取指定部分。</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, <span class="va">x</span>, units <span class="op">=</span> <span class="st">"secs"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "0.06944418 secs"</code></pre>
<p>日期转化详见 <span class="citation"><a href="#ref-Brian_2001_date" role="doc-biblioref">[9]</a>, <a href="#ref-Gabor_2004_date" role="doc-biblioref">[10]</a></span></p>
</div>
<p>上个季度最后一天</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># https://d.cosx.org/d/421162/16</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"quarter"</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></code></pre></div>
<pre><code>## [1] "2019-12-31" "2020-03-31"</code></pre>
<p>本季度第一天</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"quarter"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-01-01" "2020-04-01"</code></pre>
<p>类似地，本月第一天和上月最后一天</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 本月第一天</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2020-02-01" "2020-05-01"</code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 上月最后一天</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></code></pre></div>
<pre><code>## [1] "2020-01-31" "2020-04-30"</code></pre>
<p><strong>timeDate</strong> 提供了很多日期计算函数，比如季初、季末、月初、月末等</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://geobosh.github.io/timeDateDoc/">timeDate</a></span><span class="op">)</span> 
<span class="co"># 季初</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu">timeFirstDayInQuarter</span><span class="op">(</span>charvec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span> 
<span class="co"># 季末</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu">timeLastDayInQuarter</span><span class="op">(</span>charvec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># 月初</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu">timeFirstDayInMonth</span><span class="op">(</span>charvec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span> 
<span class="co"># 月末</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu">timeLastDayInMonth</span><span class="op">(</span>charvec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2020-02-01"</span>, <span class="st">"2020-05-02"</span><span class="op">)</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<p><code><a href="https://rdrr.io/r/base/cut.POSIXt.html">cut.Date()</a></code> 是一个泛型函数，查看它的所有 S3 方法</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/methods.html">methods</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] cut.Date        cut.default     cut.dendrogram* cut.IDate*     
## [5] cut.POSIXt     
## see '?methods' for accessing help and source code</code></pre>
<p>格式化输出日期类型数据</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/formatc.html">formatC</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1e8</span>, <span class="fl">1e9</span><span class="op">)</span><span class="op">)</span>, digits <span class="op">=</span> <span class="fl">10</span>, big.mark <span class="op">=</span> <span class="st">","</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "497,399,259"</code></pre>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Sys.setlocale(locale = "C") # 如果是 Windows 系统，必须先设置，否则转化结果是 NA</span>
<span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"1990-January"</span>, <span class="fl">1</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%Y-%B-%d"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "1990-01-01"</code></pre>
<p>获取当日零点</p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXlt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>, <span class="st">"%Y-%m-%d %H:%M:%S"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "2023-02-01 00:00:00"</code></pre>
<p>从 POSIXt 数据对象中，抽取小时和分钟部分，返回字符串</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, format <span class="op">=</span> <span class="st">"%H:%M"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "23:16"</code></pre>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:table-of-date">表 2.3: </span> 日期表格</caption>
<colgroup>
<col width="4%">
<col width="35%">
<col width="4%">
<col width="54%">
</colgroup>
<thead><tr class="header">
<th>代码</th>
<th align="left">含义</th>
<th>代码</th>
<th align="left">含义</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>%a</code></td>
<td align="left">Abbreviated weekday</td>
<td><code>%A</code></td>
<td align="left">Full weekday</td>
</tr>
<tr class="even">
<td><code>%b</code></td>
<td align="left">Abbreviated month</td>
<td><code>%B</code></td>
<td align="left">Full month</td>
</tr>
<tr class="odd">
<td><code>%c</code></td>
<td align="left">Locale-specific date and time</td>
<td><code>%d</code></td>
<td align="left">Decimal date</td>
</tr>
<tr class="even">
<td><code>%H</code></td>
<td align="left">Decimal hours (24 hour)</td>
<td><code>%I</code></td>
<td align="left">Decimal hours (12 hour)</td>
</tr>
<tr class="odd">
<td><code>%j</code></td>
<td align="left">Decimal day of the year</td>
<td><code>%m</code></td>
<td align="left">Decimal month</td>
</tr>
<tr class="even">
<td><code>%M</code></td>
<td align="left">Decimal minute</td>
<td><code>%p</code></td>
<td align="left">Locale-specific AM/PM</td>
</tr>
<tr class="odd">
<td><code>%S</code></td>
<td align="left">Decimal second</td>
<td><code>%U</code></td>
<td align="left">Decimal week of the year (starting on Sunday)</td>
</tr>
<tr class="even">
<td><code>%w</code></td>
<td align="left">Decimal Weekday (0=Sunday)</td>
<td><code>%W</code></td>
<td align="left">Decimal week of the year (starting on Monday)</td>
</tr>
<tr class="odd">
<td><code>%x</code></td>
<td align="left">Locale-specific Date</td>
<td><code>%X</code></td>
<td align="left">Locale-specific Time</td>
</tr>
<tr class="even">
<td><code>%y</code></td>
<td align="left">2-digit year</td>
<td><code>%Y</code></td>
<td align="left">4-digit year</td>
</tr>
<tr class="odd">
<td><code>%z</code></td>
<td align="left">Offset from GMT</td>
<td><code>%Z</code></td>
<td align="left">Time zone (character)</td>
</tr>
</tbody>
</table></div>
<p>本节介绍了 R 本身提供的基础日期操作，第<a href="#chap-time-series-analysis"><strong>??</strong></a>章着重介绍一般的时间序列类型的数据对象及其操作。</p>
<p><a href="https://blog.revolutionanalytics.com/2011/07/the-r-files-jeff-ryan.html">Jeffrey A. Ryan</a> 开发的 <a href="https://github.com/joshuaulrich/xts">xts</a> 和 <a href="https://github.com/joshuaulrich/quantmod">quantmod</a> 包，Joshua M. Ulrich 开发的 <a href="https://r-forge.r-project.org/projects/zoo/">zoo</a> 是处理时间序列数据的主要工具</p>
<p>Jeffrey A. Ryan 在开设了一门免费课程教大家如何在 R 语言中使用 xts 和 zoo 包操作时间序列数据 <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://www.datacamp.com/courses/manipulating-time-series-data-in-r-with-xts-zoo" class="uri"&gt;https://www.datacamp.com/courses/manipulating-time-series-data-in-r-with-xts-zoo&lt;/a&gt;&lt;/p&gt;'><sup>7</sup></a></p>
<p>xts (eXtensible Time Series) 扩展的 zoo 对象</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">xts</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>,
    order.by <span class="op">=</span> <span class="fu">index</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,
    frequency <span class="op">=</span> <span class="cn">NULL</span>,
    unique <span class="op">=</span> <span class="cn">TRUE</span>,
    tzone <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"TZ"</span><span class="op">)</span>,
    <span class="va">...</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/">zoo</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/xts">xts</a></span><span class="op">)</span>
<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, ncol <span class="op">=</span> <span class="fl">2</span>,nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2018-01-01"</span>, <span class="st">"2019-12-12"</span><span class="op">)</span><span class="op">)</span>
<span class="co"># xts = matrix + index</span>
<span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span><span class="va">x</span>, order.by <span class="op">=</span> <span class="va">idx</span><span class="op">)</span></code></pre></div>
<pre><code>##            [,1] [,2]
## 2018-01-01    1    3
## 2019-12-12    2    4</code></pre>
<p>Date，POSIX times，timeDate，chron 等各种各样处理日期数据的对象</p>
</div>
<div id="sec-null" class="section level2" number="2.9">
<h2>
<span class="header-section-number">2.9</span> 空值<a class="anchor" aria-label="anchor" href="#sec-null"><i class="fas fa-link"></i></a>
</h2>
<p>移除<code><a href="https://rdrr.io/r/base/list.html">list()</a></code> 列表里的为 <code>NULL</code> 元素</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rm_null</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">l</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span><span class="op">(</span><span class="va">is.null</span><span class="op">)</span>, <span class="va">l</span><span class="op">)</span></code></pre></div>

</div>
</div>
<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-Brian_2001_date" class="csl-entry">
<div class="csl-left-margin">[9] </div>
<div class="csl-right-inline">B. D. Ripley and K. Hornik, <span>“Date-time classes,”</span> <em>R News</em>, vol. 1, no. 2, pp. 8–11, 2001,Available: <a href="https://cran.r-project.org/doc/Rnews/Rnews_2001-2.pdf">https://cran.r-project.org/doc/Rnews/Rnews_2001-2.pdf</a>
</div>
</div>
<div id="ref-Gabor_2004_date" class="csl-entry">
<div class="csl-left-margin">[10] </div>
<div class="csl-right-inline">G. Grothendieck and T. Petzoldt, <span>“<span>R</span> <span>H</span>elp <span>D</span>esk: <span>Date</span> and time classes in <span>R</span>,”</span> <em>R News</em>, vol. 4, no. 1, pp. 29–32, 2004,Available: <a href="https://www.r-project.org/doc/Rnews/Rnews_2004-1.pdf">https://www.r-project.org/doc/Rnews/Rnews_2004-1.pdf</a>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chap-data-wrangling.html">介绍</a></div>
<div class="next"><a href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-data-structure"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="nav-link" href="#subsec:typeof"><span class="header-section-number">2.1</span> 类型</a></li>
<li><a class="nav-link" href="#sec-character"><span class="header-section-number">2.2</span> 字符</a></li>
<li><a class="nav-link" href="#sec-vector"><span class="header-section-number">2.3</span> 向量</a></li>
<li><a class="nav-link" href="#sec-matrix"><span class="header-section-number">2.4</span> 矩阵</a></li>
<li><a class="nav-link" href="#sec-array"><span class="header-section-number">2.5</span> 数组</a></li>
<li><a class="nav-link" href="#sec-expression"><span class="header-section-number">2.6</span> 表达式</a></li>
<li><a class="nav-link" href="#sec-list"><span class="header-section-number">2.7</span> 列表</a></li>
<li><a class="nav-link" href="#sec-date"><span class="header-section-number">2.8</span> 日期</a></li>
<li><a class="nav-link" href="#sec-null"><span class="header-section-number">2.9</span> 空值</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/notesdown/blob/devel/data-structure.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/notesdown/edit/devel/data-structure.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R 语言学习笔记</strong>" was written by 黄湘云. It was last built on 2023-02-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
