<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 27 章 广义线性模型 | 现代应用统计与 R 语言</title>
<meta name="author" content="黄湘云">
<meta name="description" content="It’s not meant for sampling weights. It’s meant for precision weights. How best to include sampling weights in mixed models is a research problem at the moment, but you can rely on getting the...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="第 27 章 广义线性模型 | 现代应用统计与 R 语言">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="It’s not meant for sampling weights. It’s meant for precision weights. How best to include sampling weights in mixed models is a research problem at the moment, but you can rely on getting the...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 27 章 广义线性模型 | 现代应用统计与 R 语言">
<meta name="twitter:description" content="It’s not meant for sampling weights. It’s meant for precision weights. How best to include sampling weights in mixed models is a research problem at the moment, but you can rely on getting the...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><link href="libs/dygraphs/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs/dygraph-combined.js"></script><script src="libs/dygraphs/shapes.js"></script><script src="libs/moment/moment.js"></script><script src="libs/moment-timezone/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding/dygraphs.js"></script><script src="libs/Dygraph.Plugins.Unzoom/unzoom.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/es6shim/es6shim.js"></script><script src="libs/es7shim/es7shim.js"></script><script src="libs/graphre/graphre.js"></script><script src="libs/nomnoml/nomnoml.js"></script><script src="libs/nomnoml-binding/nomnoml.js"></script><script src="libs/d3-bundle/d3-bundle.min.js"></script><script src="libs/d3-lasso/d3-lasso.min.js"></script><script src="libs/save-svg-as-png/save-svg-as-png.min.js"></script><link href="libs/ggiraphjs/ggiraphjs.min.css" rel="stylesheet">
<script src="libs/ggiraphjs/ggiraphjs.min.js"></script><script src="libs/girafe-binding/girafe.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><script src="libs/jszip/jszip.min.js"></script><script src="libs/pdfmake/pdfmake.js"></script><script src="libs/pdfmake/vfs_fonts.js"></script><link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script><link href="libs/dt-ext-rowgroup/css/rowGroup.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-rowgroup/js/dataTables.rowGroup.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/echarts-world/world.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Modern Applied Statistics with R">现代应用统计与 R 语言</a>:
        <small class="text-muted">Modern Applied Statistics with R</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">动态文档</li>
<li><a class="" href="chap-dynamic-documents.html">介绍</a></li>
<li><a class="" href="chap-document-elements.html"><span class="header-section-number">13</span> 文档元素</a></li>
<li><a class="" href="chap-portable-document.html"><span class="header-section-number">14</span> 便携式文档</a></li>
<li><a class="" href="chap-web-documents.html"><span class="header-section-number">15</span> 网页文档</a></li>
<li><a class="" href="chap-office-document.html"><span class="header-section-number">16</span> 办公文档</a></li>
<li><a class="" href="chap-reproducible-workflows.html"><span class="header-section-number">17</span> 工作流</a></li>
<li><a class="" href="chap-advanced-documents.html"><span class="header-section-number">18</span> 高级文档</a></li>
<li class="book-part">数据产品</li>
<li><a class="" href="chap-data-product.html">介绍</a></li>
<li><a class="" href="chap-interactive-data-tables.html"><span class="header-section-number">19</span> 交互表格</a></li>
<li><a class="" href="chap-interactive-shiny-app.html"><span class="header-section-number">20</span> 交互报表</a></li>
<li class="book-part">统计基础</li>
<li><a class="" href="chap-statistical-foundations.html">介绍</a></li>
<li><a class="" href="chap-sampling-distributions.html"><span class="header-section-number">21</span> 抽样分布</a></li>
<li><a class="" href="chap-parameter-estimators.html"><span class="header-section-number">22</span> 参数估计</a></li>
<li><a class="" href="chap-hypothesis-test.html"><span class="header-section-number">23</span> 假设检验</a></li>
<li><a class="" href="chap-power-Analysis.html"><span class="header-section-number">24</span> 功效分析</a></li>
<li><a class="" href="chap-experimental-design.html"><span class="header-section-number">25</span> 试验设计</a></li>
<li class="book-part">统计模型</li>
<li><a class="" href="chap-statistical-models.html">介绍</a></li>
<li><a class="" href="chap-linear-models.html"><span class="header-section-number">26</span> 线性模型</a></li>
<li><a class="active" href="chap-generalized-linear-models.html"><span class="header-section-number">27</span> 广义线性模型</a></li>
<li class="book-part">数据建模</li>
<li><a class="" href="chap-data-modeling.html">介绍</a></li>
<li><a class="" href="chap-text-analysis.html"><span class="header-section-number">28</span> 文本分析</a></li>
<li><a class="" href="chap-survival-analysis.html"><span class="header-section-number">29</span> 生存分析</a></li>
<li><a class="" href="chap-time-series-analysis.html"><span class="header-section-number">30</span> 时序分析</a></li>
<li class="book-part">时空数据</li>
<li><a class="" href="chap-spatio-temporal-data.html">介绍</a></li>
<li><a class="" href="chap-spatial-analysis.html"><span class="header-section-number">31</span> 空间数据分析</a></li>
<li><a class="" href="chap-spatial-viz.html"><span class="header-section-number">32</span> 空间数据可视化</a></li>
<li><a class="" href="chap-case-study.html"><span class="header-section-number">33</span> 案例研究</a></li>
<li><a class="" href="chap-data-explorer.html"><span class="header-section-number">34</span> 数据探索</a></li>
<li class="book-part">机器学习</li>
<li><a class="" href="chap-machine-learning.html">介绍</a></li>
<li><a class="" href="chap-gradient-boosting-machine.html"><span class="header-section-number">35</span> 梯度提升机</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">36</span> 数值优化</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="chap-matrix-operations.html"><span class="header-section-number">B</span> 矩阵运算</a></li>
<li><a class="" href="chap-symbolic-computation.html"><span class="header-section-number">C</span> 符号计算</a></li>
<li><a class="" href="chap-mixed-programming.html"><span class="header-section-number">D</span> 混合编程</a></li>
<li><a class="" href="chap-object-oriented-programming.html"><span class="header-section-number">E</span> 面向对象编程</a></li>
<li><a class="" href="chap-file-operations.html"><span class="header-section-number">F</span> 文件操作</a></li>
<li><a class="" href="chap-other-softwares.html"><span class="header-section-number">G</span> 其它软件</a></li>
<li><a class="" href="chap-notations.html"><span class="header-section-number">H</span> 符号说明</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/masr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-generalized-linear-models" class="section level1" number="27">
<h1>
<span class="header-section-number">第 27 章</span> 广义线性模型<a class="anchor" aria-label="anchor" href="#chap-generalized-linear-models"><i class="fas fa-link"></i></a>
</h1>
<blockquote>
<p>It’s not meant for sampling weights. It’s meant for precision weights. How best to include sampling weights in mixed models is a research problem at the moment, but you can rely on getting the wrong answer if you just use the <code>weights =</code> argument.</p>
<p>— Thomas Lumley <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://stat.ethz.ch/pipermail/r-help/2012-January/301501.html" class="uri"&gt;https://stat.ethz.ch/pipermail/r-help/2012-January/301501.html&lt;/a&gt;&lt;/p&gt;'><sup>72</sup></a></p>
</blockquote>
<!-- 每个模型都给出 rstan/rstanarm 中的实现方式，或者另起一章在贝叶斯模型中 -->
<p>一般广义线性模型理论参考文献 An Introduction to Generalized Linear Models <span class="citation"><a href="#ref-Dobson_2018_Generalized" role="doc-biblioref">[62]</a></span> 和 Generalized Linear Models <span class="citation"><a href="#ref-McCullagh_1989_Generalized" role="doc-biblioref">[63]</a></span>，逻辑回归模型主要参考 Applied Logistic Regression <span class="citation"><a href="#ref-David_2000_Logistic" role="doc-biblioref">[64]</a></span> 和 Discrete Choice Methods with Simulation <span class="citation"><a href="#ref-Train_2009_mlogit" role="doc-biblioref">[65]</a></span>。</p>
<p>简单线性模型（Linear Models，简称 LM），<code><a href="https://rdrr.io/r/stats/lm.html">stats::lm()</a></code> 函数可以拟合线性模型，而一般线性模型（General Linear Models，简称 GLM）允许线性模型方差非齐性、存在相关关系，甚至可以扩展到线性混合效应模型，将线性回归模型，方差分析模型，协方差分析模型统一地看待，一般要采用广义最小二乘（Generalized Least Squares，简称 GLS）拟合， <code><a href="https://rdrr.io/pkg/nlme/man/gls.html">nlme::gls()</a></code> 函数实现广义最小二乘拟合线性模型，类似地，<code><a href="https://rdrr.io/pkg/nlme/man/gnls.html">nlme::gnls()</a></code> 函数实现广义最小二乘拟合非线性模型。<code>glm2::glm2()</code> 补充 <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code>，提供更加稳定的拟合方法，适应于 <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> 不收敛的情况，而 <code>fastglm::fastglm()</code> 主要是加快 <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> 求解效率，收敛效果也比 <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> 和 <code>glm2()</code> 好。</p>
<p><a href="https://CRAN.R-project.org/package=glmnet">glmnet</a> 包是处理广义线性模型的事实标准。 其官网见 <a href="https://glmnet.stanford.edu/" class="uri">https://glmnet.stanford.edu/</a>，而 <a href="https://github.com/hongooi73/glmnetUtils">glmnetUtils</a> 补充公式接口，适用于弹性网络回归，交叉验证筛选 <span class="math inline">\(\alpha\)</span> 参数等。 <a href="https://CRAN.R-project.org/package=glmpath">glmpath</a> 包实现 path-following 算法用于带 L1 正则项的广义线性模型和 Cox 比例风险模型。<a href="https://github.com/steve-the-bayesian/BOOM">Boom</a> 和 <strong>BoomSpikeSlab</strong> 包实现 MCMC 算法用于 Spike 和 Slab 回归，而 <strong>spikeslab</strong> 包进一步实现预测和变量选择 <span class="citation"><a href="#ref-spikeslab_2005_Ishwaran" role="doc-biblioref">[66]</a></span>。<a href="https://github.com/OHDSI/Cyclops">Cyclops</a> 包实现 Cyclic coordinate descent 算法 用于逻辑回归、泊松回归和生存分析，适用于大规模正则回归 large scale regularized regressions，达到百万级别的观测和特征变量，交叉验证自动选择超参数，独立变量稀疏表示，用剖面似然估计某个变量的置信区间。<a href="https://github.com/fbertran/plsRglm">plsRglm</a> 包实现偏最小二乘回归方法用于广义线性模型。<strong>biglm</strong>、<a href="https://cran.r-project.org/package=speedglm">speedglm</a> 和 <a href="https://CRAN.R-project.org/package=bigReg">bigReg</a> 用于处理大数据集的回归，求解限制内存的 GLM <a href="https://CRAN.R-project.org/package=biglmm">biglmm</a>。<a href="https://CRAN.R-project.org/package=cglm">cglm</a> 估计带聚类数据的条件 GLM 的回归系数和发散参数。<a href="https://CRAN.R-project.org/package=MGLM">MGLM</a> 拟合多个响应变量的广义线性回归模型（多重 GLM ）。<a href="https://CRAN.R-project.org/package=robmixglm">robmixglm</a> 响应变量扩展到混合分布的情形，实现稳健 GLM 回归估计。<a href="https://CRAN.R-project.org/package=ClusterBootstrap">ClusterBootstrap</a> 实现自主法估计带聚类数据的 GLM。<a href="https://CRAN.R-project.org/package=lcpm">lcpm</a> 和 <a href="https://CRAN.R-project.org/package=oglmx">oglmx</a> 处理有序输出的回归。
<a href="https://cran.r-project.org/package=gmnl">gmnl</a>、 <a href="https://CRAN.R-project.org/package=mlogit">mlogit</a> <span class="citation"><a href="#ref-Train_2009_mlogit" role="doc-biblioref">[65]</a></span> 和 <strong>mnlogit</strong> <span class="citation"><a href="#ref-mnlogit_2016_JSS" role="doc-biblioref">[67]</a></span> 处理多项逻辑回归。<a href="https://github.com/atahk/pscl">pscl</a> 包（Political Science Computational Laboratory）可以处理贝叶斯 IRT 模型，zero-inflated 零膨胀模型，广义线性模型的拟合优度度量。</p>
<!--
https://github.com/jolars/SLOPE 
Sorted L1 Penalized Estimation

L1 Lasso 回归的综述及其 R 包实现，未来可以写个 R 包整合一下

贝叶斯变量选择方法的综述 <http://www3.stat.sinica.edu.tw/statistica/oldpdf/A7n26.pdf>，17 种分类算法应用于信用评分 <https://www.datascience-zing.com/blog/implemetation-of-17-classification-algorithms-in-r-using-car-evaluation-data> 数据和代码 <https://github.com/surajvv12/17_Classification> 数据集来源于  [UCI Machine learning repository](https://archive.ics.uci.edu/ml)
-->
<div id="sec-glm-introduction" class="section level2" number="27.1">
<h2>
<span class="header-section-number">27.1</span> 介绍<a class="anchor" aria-label="anchor" href="#sec-glm-introduction"><i class="fas fa-link"></i></a>
</h2>
<p>模型结构，模型种类，参数估计办法，相当于综述</p>
<p>响应变量分别服从二项分布、多项分布、对数正态分布、泊松分布、伽马分布</p>
</div>
<div id="sec-glm-theory" class="section level2" number="27.2">
<h2>
<span class="header-section-number">27.2</span> 理论基础<a class="anchor" aria-label="anchor" href="#sec-glm-theory"><i class="fas fa-link"></i></a>
</h2>
<p>分两个段落分别介绍指数族和 GLM</p>
<p><span class="math display">\[
f(y;\theta,\phi) = \exp[(a(y) b(\theta) + c(\theta))/f(\phi) + d(y,\phi)]
\]</span></p>
<p>泊松分布 (with <span class="math inline">\(\lambda \to \theta\)</span>, <span class="math inline">\(x \to y\)</span>) (<span class="math inline">\(\phi=1\)</span>):</p>
<p><span class="math display">\[\begin{equation}
\begin{split}
f(y,\theta) &amp; = \exp(-\theta) \theta^y/(y!) \\
            &amp; = \exp\left( \underbrace{y}_{a(y)} 
                           \underbrace{\log \theta}_{b(\theta)} + 
                           \underbrace{(-\theta)}_{c(\theta)} + 
                           \underbrace{(- \log(y!))}_{d(y)} \right)
\end{split}
\end{equation}\]</span></p>
<!-- 如果能以非常直观的几何展示方式表现高深的高维模型和算法理论，将是非常有意义的 -->
<div id="subsec-glm-ridge" class="section level3" number="27.2.1">
<h3>
<span class="header-section-number">27.2.1</span> 岭回归<a class="anchor" aria-label="anchor" href="#subsec-glm-ridge"><i class="fas fa-link"></i></a>
</h3>
<p>Geometry and properties of generalized ridge regression in high dimensions <a href="http://web.ccs.miami.edu/~hishwaran/papers/IR.conmath2014.pdf" class="uri">http://web.ccs.miami.edu/~hishwaran/papers/IR.conmath2014.pdf</a></p>
<p>这篇文章借助三维几何图形展示高维情形下的广义岭回归</p>
</div>
<div id="subsec-glm-lasso" class="section level3" number="27.2.2">
<h3>
<span class="header-section-number">27.2.2</span> Lasso<a class="anchor" aria-label="anchor" href="#subsec-glm-lasso"><i class="fas fa-link"></i></a>
</h3>
<p>glmnet: Lasso and Elastic-Net Regularized Generalized Linear Models <a href="https://glmnet.stanford.edu" class="uri">https://glmnet.stanford.edu</a></p>
</div>
<div id="subset:glm-best-subset" class="section level3" number="27.2.3">
<h3>
<span class="header-section-number">27.2.3</span> 最优子集回归<a class="anchor" aria-label="anchor" href="#subset:glm-best-subset"><i class="fas fa-link"></i></a>
</h3>
<p>bestglm: Best Subset GLM and Regression Utilities</p>
</div>
<div id="subsec-glm-pls" class="section level3" number="27.2.4">
<h3>
<span class="header-section-number">27.2.4</span> 偏最小二乘回归<a class="anchor" aria-label="anchor" href="#subsec-glm-pls"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://github.com/bhmevik/pls">pls</a> 包 <span class="citation"><a href="#ref-JSS_2007_pls" role="doc-biblioref">[68]</a></span> 实现了偏最小二乘回归（partial least squares regression， PLS）和主成分回归 （principal component regression， PCR），详见主页 <a href="https://mevik.net/work/software/pls.html" class="uri">https://mevik.net/work/software/pls.html</a>
帮助文档的质量较高，是比较完整全面的。</p>
<ul>
<li>several algorithms: the traditional orthogonal scores (NIPALS) PLS algorithm, kernel PLS, wide kernel PLS, Simpls and PCR through svd</li>
<li>supports multi-response models (aka PLS2)</li>
<li>flexible cross-validation</li>
<li>Jackknife variance estimates of regression coefficients</li>
<li>extensive and flexible plots: scores, loadings, predictions, coefficients, (R)MSEP, R², correlation loadings</li>
<li>formula interface, modelled after lm(), with methods for predict, print, summary, plot, update, etc.</li>
<li>extraction functions for coefficients, scores and loadings</li>
<li>MSEP, RMSEP and R² estimates</li>
<li>multiplicative scatter correction (MSC)</li>
</ul>
</div>
</div>
<div id="sec-alcohol" class="section level2" number="27.3">
<h2>
<span class="header-section-number">27.3</span> 吸烟喝酒和食道癌的关系<a class="anchor" aria-label="anchor" href="#sec-alcohol"><i class="fas fa-link"></i></a>
</h2>
<p>存在有序分类数据</p>
<p>酒精的作用 effects of alcohol, tobacco and interaction, age-adjusted
数据集描述见 <code><a href="https://rdrr.io/r/datasets/esoph.html">help(esoph)</a></code></p>
<div class="sourceCode" id="cb2152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">esoph</span><span class="op">)</span></code></pre></div>
<pre><code>##   agegp     alcgp    tobgp ncases ncontrols
## 1 25-34 0-39g/day 0-9g/day      0        40
## 2 25-34 0-39g/day    10-19      0        10
## 3 25-34 0-39g/day    20-29      0         6
## 4 25-34 0-39g/day      30+      0         5
## 5 25-34     40-79 0-9g/day      0        27
## 6 25-34     40-79    10-19      0         7</code></pre>
<div class="sourceCode" id="cb2154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">esoph</span><span class="op">)</span></code></pre></div>
<pre><code>## 'data.frame':    88 obs. of  5 variables:
##  $ agegp    : Ord.factor w/ 6 levels "25-34"&lt;"35-44"&lt;..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ alcgp    : Ord.factor w/ 4 levels "0-39g/day"&lt;"40-79"&lt;..: 1 1 1 1 2 2 2 2 3 3 ...
##  $ tobgp    : Ord.factor w/ 4 levels "0-9g/day"&lt;"10-19"&lt;..: 1 2 3 4 1 2 3 4 1 2 ...
##  $ ncases   : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ ncontrols: num  40 10 6 5 27 7 4 7 2 1 ...</code></pre>
<div class="sourceCode" id="cb2156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">esoph</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">agegp</span>, y <span class="op">=</span> <span class="va">ncases</span> <span class="op">/</span> <span class="op">(</span><span class="va">ncases</span> <span class="op">+</span> <span class="va">ncontrols</span><span class="op">)</span>, color <span class="op">=</span> <span class="va">agegp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">esoph</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">alcgp</span>, y <span class="op">=</span> <span class="va">ncases</span> <span class="op">/</span> <span class="va">ncontrols</span>, color <span class="op">=</span> <span class="va">alcgp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">p3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">esoph</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tobgp</span>, y <span class="op">=</span> <span class="va">ncases</span> <span class="op">/</span> <span class="va">ncontrols</span>, color <span class="op">=</span> <span class="va">tobgp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">bottom_row</span> <span class="op">&lt;-</span> <span class="fu">plot_grid</span><span class="op">(</span><span class="va">p2</span>, <span class="va">p3</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'B'</span>, <span class="st">'C'</span><span class="op">)</span>, label_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 12 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 12 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 12 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb2161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">plot_grid</span><span class="op">(</span><span class="va">p1</span>, <span class="va">bottom_row</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'A'</span>, <span class="st">''</span><span class="op">)</span>, label_size <span class="op">=</span> <span class="fl">12</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:esoph-data"></span>
<img src="generalized-linear-models_files/figure-html/esoph-data-1.png" alt="吸烟喝酒和食道癌的关系" width="672"><p class="caption">
图 27.1: 吸烟喝酒和食道癌的关系
</p>
</div>
<div class="sourceCode" id="cb2162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_esoph_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">ncases</span>, <span class="va">ncontrols</span><span class="op">)</span> <span class="op">~</span> <span class="va">agegp</span> <span class="op">+</span> <span class="va">tobgp</span> <span class="op">*</span> <span class="va">alcgp</span>,
  data <span class="op">=</span> <span class="va">esoph</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rcpp.org">Rcpp</a></span><span class="op">)</span>
<span class="va">fit_esoph_brm</span> <span class="op">&lt;-</span> <span class="fu">brms</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">ncases</span> <span class="op">|</span> <span class="fu">trials</span><span class="op">(</span><span class="va">ncases</span> <span class="op">+</span> <span class="va">ncontrols</span><span class="op">)</span> <span class="op">~</span> <span class="va">agegp</span> <span class="op">+</span> <span class="va">tobgp</span> <span class="op">*</span> <span class="va">alcgp</span>,
  data <span class="op">=</span> <span class="va">esoph</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>, refresh <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="sec-infert" class="section level2" number="27.4">
<h2>
<span class="header-section-number">27.4</span> 自然流产和人工流产后的不育<a class="anchor" aria-label="anchor" href="#sec-infert"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/r/datasets/infert.html">help(infert)</a></code></p>
<div class="sourceCode" id="cb2164"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">infert</span><span class="op">)</span></code></pre></div>
<pre><code>##   education age parity induced case spontaneous stratum pooled.stratum
## 1    0-5yrs  26      6       1    1           2       1              3
## 2    0-5yrs  42      1       1    1           0       2              1
## 3    0-5yrs  39      6       2    1           0       3              4
## 4    0-5yrs  34      4       2    1           0       4              2
## 5   6-11yrs  35      3       1    1           1       5             32
## 6   6-11yrs  36      4       2    1           1       6             36</code></pre>
<div class="sourceCode" id="cb2166"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">infert</span><span class="op">)</span></code></pre></div>
<pre><code>## 'data.frame':    248 obs. of  8 variables:
##  $ education     : Factor w/ 3 levels "0-5yrs","6-11yrs",..: 1 1 1 1 2 2 2 2 2 2 ...
##  $ age           : num  26 42 39 34 35 36 23 32 21 28 ...
##  $ parity        : num  6 1 6 4 3 4 1 2 1 2 ...
##  $ induced       : num  1 1 2 2 1 2 0 0 0 0 ...
##  $ case          : num  1 1 1 1 1 1 1 1 1 1 ...
##  $ spontaneous   : num  2 0 0 0 1 1 0 0 1 0 ...
##  $ stratum       : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ pooled.stratum: num  3 1 4 2 32 36 6 22 5 19 ...</code></pre>
<p>存在无序分类变量</p>
<div class="sourceCode" id="cb2168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">infert_glm_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">case</span> <span class="op">~</span> <span class="va">spontaneous</span> <span class="op">+</span> <span class="va">induced</span>,
  data <span class="op">=</span> <span class="va">infert</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">infert_glm_1</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = case ~ spontaneous + induced, family = binomial(), 
##     data = infert)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6678  -0.8360  -0.5772   0.9030   1.9362  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.7079     0.2677  -6.380 1.78e-10 ***
## spontaneous   1.1972     0.2116   5.657 1.54e-08 ***
## induced       0.4181     0.2056   2.033    0.042 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 316.17  on 247  degrees of freedom
## Residual deviance: 279.61  on 245  degrees of freedom
## AIC: 285.61
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>考虑其他潜在的因素</p>
<div class="sourceCode" id="cb2170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">infert_glm_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">case</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">parity</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">spontaneous</span> <span class="op">+</span> <span class="va">induced</span>,
  data <span class="op">=</span> <span class="va">infert</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">infert_glm_2</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = case ~ age + parity + education + spontaneous + 
##     induced, family = binomial(), data = infert)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.7603  -0.8162  -0.4956   0.8349   2.6536  
## 
## Coefficients:
##                  Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)      -1.14924    1.41220  -0.814   0.4158    
## age               0.03958    0.03120   1.269   0.2046    
## parity           -0.82828    0.19649  -4.215 2.49e-05 ***
## education6-11yrs -1.04424    0.79255  -1.318   0.1876    
## education12+ yrs -1.40321    0.83416  -1.682   0.0925 .  
## spontaneous       2.04591    0.31016   6.596 4.21e-11 ***
## induced           1.28876    0.30146   4.275 1.91e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 316.17  on 247  degrees of freedom
## Residual deviance: 257.80  on 241  degrees of freedom
## AIC: 271.8
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p>实际上应该使用条件逻辑回归， 调用 <strong>survival</strong> 包</p>
<div class="sourceCode" id="cb2172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival">survival</a></span><span class="op">)</span>
<span class="va">infert_glm_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/clogit.html">clogit</a></span><span class="op">(</span><span class="va">case</span> <span class="op">~</span> <span class="va">spontaneous</span> <span class="op">+</span> <span class="va">induced</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/strata.html">strata</a></span><span class="op">(</span><span class="va">stratum</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">infert</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">infert_glm_3</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## coxph(formula = Surv(rep(1, 248L), case) ~ spontaneous + induced + 
##     strata(stratum), data = infert, method = "exact")
## 
##   n= 248, number of events= 83 
## 
##               coef exp(coef) se(coef)     z Pr(&gt;|z|)    
## spontaneous 1.9859    7.2854   0.3524 5.635 1.75e-08 ***
## induced     1.4090    4.0919   0.3607 3.906 9.38e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
##             exp(coef) exp(-coef) lower .95 upper .95
## spontaneous     7.285     0.1373     3.651    14.536
## induced         4.092     0.2444     2.018     8.298
## 
## Concordance= 0.776  (se = 0.044 )
## Likelihood ratio test= 53.15  on 2 df,   p=3e-12
## Wald test            = 31.84  on 2 df,   p=1e-07
## Score (logrank) test = 48.44  on 2 df,   p=3e-11</code></pre>
</div>
<div id="sec-australia-bacteria" class="section level2" number="27.5">
<h2>
<span class="header-section-number">27.5</span> 细菌数据集<a class="anchor" aria-label="anchor" href="#sec-australia-bacteria"><i class="fas fa-link"></i></a>
</h2>
<p>流感嗜血杆菌的细菌与中耳炎患儿</p>
<div class="sourceCode" id="cb2174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">bacteria</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2175"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 惩罚拟似然</span>
<span class="va">fit_glmmpql</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glmmPQL.html">glmmPQL</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">week</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span>,
  random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>,
  family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">bacteria</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glmmpql</span><span class="op">)</span></code></pre></div>
<pre><code>## Linear mixed-effects model fit by maximum likelihood
##   Data: bacteria 
##   AIC BIC logLik
##    NA  NA     NA
## 
## Random effects:
##  Formula: ~1 | ID
##         (Intercept)  Residual
## StdDev:    1.410637 0.7800511
## 
## Variance function:
##  Structure: fixed weights
##  Formula: ~invwt 
## Fixed effects:  y ~ trt + I(week &gt; 2) 
##                     Value Std.Error  DF   t-value p-value
## (Intercept)      3.412014 0.5185033 169  6.580506  0.0000
## trtdrug         -1.247355 0.6440635  47 -1.936696  0.0588
## trtdrug+        -0.754327 0.6453978  47 -1.168779  0.2484
## I(week &gt; 2)TRUE -1.607257 0.3583379 169 -4.485311  0.0000
##  Correlation: 
##                 (Intr) trtdrg trtdr+
## trtdrug         -0.598              
## trtdrug+        -0.571  0.460       
## I(week &gt; 2)TRUE -0.537  0.047 -0.001
## 
## Standardized Within-Group Residuals:
##        Min         Q1        Med         Q3        Max 
## -5.1985361  0.1572336  0.3513075  0.4949482  1.7448845 
## 
## Number of Observations: 220
## Number of Groups: 50</code></pre>
<div class="sourceCode" id="cb2177"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 拉普拉斯近似</span>
<span class="va">fit_glmer</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">week</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,
  family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">bacteria</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glmer</span><span class="op">)</span></code></pre></div>
<pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: binomial  ( logit )
## Formula: y ~ trt + I(week &gt; 2) + (1 | ID)
##    Data: bacteria
## 
##      AIC      BIC   logLik deviance df.resid 
##    202.3    219.2    -96.1    192.3      215 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -4.5615  0.1359  0.3022  0.4217  1.1276 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  ID     (Intercept) 1.543    1.242   
## Number of obs: 220, groups:  ID, 50
## 
## Fixed effects:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       3.5479     0.6958   5.099 3.41e-07 ***
## trtdrug          -1.3667     0.6770  -2.019 0.043516 *  
## trtdrug+         -0.7826     0.6831  -1.146 0.251926    
## I(week &gt; 2)TRUE  -1.5985     0.4759  -3.359 0.000783 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) trtdrg trtdr+
## trtdrug     -0.593              
## trtdrug+    -0.537  0.487       
## I(wk&gt;2)TRUE -0.656  0.126  0.064</code></pre>
</div>
<div id="sec-birthwt" class="section level2" number="27.6">
<h2>
<span class="header-section-number">27.6</span> 研究婴儿出生体重低的相关危险因素<a class="anchor" aria-label="anchor" href="#sec-birthwt"><i class="fas fa-link"></i></a>
</h2>
<!-- 多项逻辑回归模型 Multinomial-Logistic-Regression-Models -->
<p>在线性回归的基础上，响应变量是离散的类别，且无序 <span class="citation"><a href="#ref-mnlogit_2016_JSS" role="doc-biblioref">[67]</a></span></p>
<p>birthwt 数据是 1986 年在马萨诸塞州斯普林菲尔德的 Baystate 医疗中心收集的，用于研究婴儿出生体重低的相关危险因素</p>
<div class="sourceCode" id="cb2179"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 加载数据</span>
<span class="co"># library(MASS)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">birthwt</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span>
<span class="co"># 查看 birthwt 数据集 `help(birthwt)`</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">birthwt</span><span class="op">)</span></code></pre></div>
<pre><code>##    low age lwt race smoke ptl ht ui ftv  bwt
## 85   0  19 182    2     0   0  0  1   0 2523
## 86   0  33 155    3     0   0  0  0   3 2551
## 87   0  20 105    1     1   0  0  0   1 2557
## 88   0  21 108    1     1   0  0  1   2 2594
## 89   0  18 107    1     1   0  0  1   0 2600
## 91   0  21 124    3     0   0  0  0   0 2622</code></pre>
<div class="sourceCode" id="cb2181"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">birthwt</span><span class="op">)</span></code></pre></div>
<pre><code>## 'data.frame':    189 obs. of  10 variables:
##  $ low  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ age  : int  19 33 20 21 18 21 22 17 29 26 ...
##  $ lwt  : int  182 155 105 108 107 124 118 103 123 113 ...
##  $ race : int  2 3 1 1 1 3 1 3 1 1 ...
##  $ smoke: int  0 0 1 1 1 0 0 0 1 1 ...
##  $ ptl  : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ ht   : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ ui   : int  1 0 0 1 1 0 0 0 0 0 ...
##  $ ftv  : int  0 3 1 2 0 0 1 1 1 0 ...
##  $ bwt  : int  2523 2551 2557 2594 2600 2622 2637 2637 2663 2665 ...</code></pre>
<p><code>low</code> 表示婴儿出生体重小于 2.5kg，<code>age</code> 表示母亲的年龄（年），<code>lwt</code> 母亲最后一次月经期间的体重(磅)，<code>race</code> 母亲的种族(1 =白人，2 =黑人，3 =其他)。，<code>smoke</code> 怀孕期间的吸烟状况，<code>ptl</code> 以前早产的次数，<code>ht</code> 高血压病史，<code>ui</code> 子宫过敏，<code>ftv</code> 妊娠头三个月的医生就诊次数，<code>bwt</code> 出生体重（克）</p>
<div class="sourceCode" id="cb2183"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">birthwt</span>, <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">lwt</span>, <span class="va">ui</span>, <span class="va">var</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##        0        1 
## 940.8472 783.7196</code></pre>
<div class="sourceCode" id="cb2185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">lwt</span> <span class="op">~</span> <span class="va">ui</span>, data <span class="op">=</span> <span class="va">birthwt</span>, var.equal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Two Sample t-test
## 
## data:  lwt by ui
## t = 2.1138, df = 187, p-value = 0.03586
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##   0.8753389 25.3544748
## sample estimates:
## mean in group 0 mean in group 1 
##        131.7578        118.6429</code></pre>
<div class="sourceCode" id="cb2187"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">lwt</span> <span class="op">~</span> <span class="va">ui</span>, data <span class="op">=</span> <span class="va">birthwt</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  lwt by ui
## t = 2.2547, df = 39.163, p-value = 0.02982
## alternative hypothesis: true difference in means between group 0 and group 1 is not equal to 0
## 95 percent confidence interval:
##   1.351128 24.878685
## sample estimates:
## mean in group 0 mean in group 1 
##        131.7578        118.6429</code></pre>
<div class="sourceCode" id="cb2189"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># birthwt$ui &lt;- as.factor(birthwt$ui)</span>
<span class="co"># library(lattice)</span>
<span class="co"># bwplot(lwt ~ ui, data = birthwt, pch = "|")</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">lwt</span> <span class="op">~</span> <span class="va">ui</span>, data <span class="op">=</span> <span class="va">birthwt</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="generalized-linear-models_files/figure-html/unnamed-chunk-11-1.png" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 重新编码，数据预处理，方便代入模型</span>
<span class="va">bwt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">birthwt</span>, <span class="op">{</span>
  <span class="va">race</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">race</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"black"</span>, <span class="st">"other"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">ptd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ptl</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>
  <span class="va">ftv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ftv</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">ftv</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"2+"</span> <span class="co"># 除了前两个水平外，其余的都编码为 2+</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">low</span><span class="op">)</span>, <span class="va">age</span>, <span class="va">lwt</span>, <span class="va">race</span>, smoke <span class="op">=</span> <span class="op">(</span><span class="va">smoke</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>,
    <span class="va">ptd</span>, ht <span class="op">=</span> <span class="op">(</span><span class="va">ht</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, ui <span class="op">=</span> <span class="op">(</span><span class="va">ui</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span>, <span class="va">ftv</span>
  <span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2191"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 查看编码后的数据</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bwt</span><span class="op">)</span></code></pre></div>
<pre><code>##   low age lwt  race smoke   ptd    ht    ui ftv
## 1   0  19 182 black FALSE FALSE FALSE  TRUE   0
## 2   0  33 155 other FALSE FALSE FALSE FALSE  2+
## 3   0  20 105 white  TRUE FALSE FALSE FALSE   1
## 4   0  21 108 white  TRUE FALSE FALSE  TRUE  2+
## 5   0  18 107 white  TRUE FALSE FALSE  TRUE   0
## 6   0  21 124 other FALSE FALSE FALSE FALSE   0</code></pre>
<div class="sourceCode" id="cb2193"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">bwt</span><span class="op">)</span></code></pre></div>
<pre><code>## 'data.frame':    189 obs. of  9 variables:
##  $ low  : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
##  $ age  : int  19 33 20 21 18 21 22 17 29 26 ...
##  $ lwt  : int  182 155 105 108 107 124 118 103 123 113 ...
##  $ race : Factor w/ 3 levels "white","black",..: 2 3 1 1 1 3 1 3 1 1 ...
##  $ smoke: logi  FALSE FALSE TRUE TRUE TRUE FALSE ...
##  $ ptd  : Factor w/ 2 levels "FALSE","TRUE": 1 1 1 1 1 1 1 1 1 1 ...
##  $ ht   : logi  FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ ui   : logi  TRUE FALSE FALSE TRUE TRUE FALSE ...
##  $ ftv  : Factor w/ 3 levels "0","1","2+": 1 3 2 3 1 1 2 2 2 1 ...</code></pre>
<p>广义线性模型拟合，二项逻辑回归，响应变量为婴儿出生的体重，以2.5kg为界，它被编码成二分类变量 0或1</p>
<div class="sourceCode" id="cb2195"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contr.treatment"</span>, <span class="st">"contr.poly"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">low</span> <span class="op">~</span> <span class="va">.</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">bwt</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:  glm(formula = low ~ ., family = binomial, data = bwt)
## 
## Coefficients:
## (Intercept)          age          lwt    raceblack    raceother    smokeTRUE  
##     0.82302     -0.03723     -0.01565      1.19241      0.74068      0.75553  
##     ptdTRUE       htTRUE       uiTRUE         ftv1        ftv2+  
##     1.34376      1.91317      0.68020     -0.43638      0.17901  
## 
## Degrees of Freedom: 188 Total (i.e. Null);  178 Residual
## Null Deviance:       234.7 
## Residual Deviance: 195.5     AIC: 217.5</code></pre>
<p>多项逻辑回归</p>
<div class="sourceCode" id="cb2197"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span>
<span class="op">(</span><span class="va">bwt.mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html">multinom</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">low</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">bwt</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # weights:  12 (11 variable)
## initial  value 131.004817 
## iter  10 value 98.029803
## final  value 97.737759 
## converged</code></pre>
<pre><code>## Call:
## multinom(formula = low ~ ., data = bwt)
## 
## Coefficients:
## (Intercept)         age         lwt   raceblack   raceother   smokeTRUE 
##  0.82320102 -0.03723828 -0.01565359  1.19240391  0.74065606  0.75550487 
##     ptdTRUE      htTRUE      uiTRUE        ftv1       ftv2+ 
##  1.34375901  1.91320116  0.68020207 -0.43638470  0.17900392 
## 
## Residual Deviance: 195.4755 
## AIC: 217.4755</code></pre>
<div class="sourceCode" id="cb2200"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bwt.mu</span><span class="op">)</span></code></pre></div>
<pre><code>## Call:
## multinom(formula = low ~ ., data = bwt)
## 
## Coefficients:
##                  Values  Std. Err.
## (Intercept)  0.82320102 1.24476766
## age         -0.03723828 0.03870437
## lwt         -0.01565359 0.00708079
## raceblack    1.19240391 0.53598076
## raceother    0.74065606 0.46176615
## smokeTRUE    0.75550487 0.42503626
## ptdTRUE      1.34375901 0.48063449
## htTRUE       1.91320116 0.72076133
## uiTRUE       0.68020207 0.46434974
## ftv1        -0.43638470 0.47941107
## ftv2+        0.17900392 0.45639129
## 
## Residual Deviance: 195.4755 
## AIC: 217.4755</code></pre>
<p>计算 Z 分数和 P 值</p>
<div class="sourceCode" id="cb2202"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bwt.mu</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">bwt.mu</span><span class="op">)</span><span class="op">$</span><span class="va">standard.errors</span>
<span class="va">z</span></code></pre></div>
<pre><code>## (Intercept)         age         lwt   raceblack   raceother   smokeTRUE 
##   0.6613291  -0.9621210  -2.2107121   2.2247140   1.6039635   1.7775069 
##     ptdTRUE      htTRUE      uiTRUE        ftv1       ftv2+ 
##   2.7958023   2.6544170   1.4648486  -0.9102516   0.3922159</code></pre>
<div class="sourceCode" id="cb2204"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>
<span class="va">p</span></code></pre></div>
<pre><code>## (Intercept)         age         lwt   raceblack   raceother   smokeTRUE 
## 0.508401310 0.335988847 0.027055777 0.026100443 0.108722092 0.075484881 
##     ptdTRUE      htTRUE      uiTRUE        ftv1       ftv2+ 
## 0.005177106 0.007944557 0.142962228 0.362689827 0.694898695</code></pre>
<blockquote>
<p>模型解释</p>
</blockquote>
</div>
<div id="sec-housing" class="section level2" number="27.7">
<h2>
<span class="header-section-number">27.7</span> 哥本哈根住房状况调查<a class="anchor" aria-label="anchor" href="#sec-housing"><i class="fas fa-link"></i></a>
</h2>
<!-- 有序逻辑回归模型 Ordinal-Logistic-Regression-Models -->
<p>响应变量是离散类别，且存在强弱，等级，大小之分</p>
<p>调用函数 <code><a href="https://rdrr.io/pkg/MASS/man/polr.html">MASS::polr()</a></code></p>
<p>数据集 housing 哥本哈根住房状况调查中的次数分布表，<code>Sat</code> 住户对目前居住环境的满意程度，是一个有序的因子变量，<code>Infl</code> 住户对物业管理的感知影响程度，<code>Type</code> 租赁住宿类型，如塔楼、中庭、公寓、露台，<code>Cont</code> 联系居民可与其他居民联系(低、高)，<code>Freq</code> 每个类中的居民人数，调查的人数</p>
<div class="sourceCode" id="cb2206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"housing"</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span>
<span class="co"># 查看数据 help(housing)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">housing</span><span class="op">)</span></code></pre></div>
<pre><code>##      Sat   Infl  Type Cont Freq
## 1    Low    Low Tower  Low   21
## 2 Medium    Low Tower  Low   21
## 3   High    Low Tower  Low   28
## 4    Low Medium Tower  Low   34
## 5 Medium Medium Tower  Low   22
## 6   High Medium Tower  Low   36</code></pre>
<div class="sourceCode" id="cb2208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">housing</span><span class="op">)</span></code></pre></div>
<pre><code>## 'data.frame':    72 obs. of  5 variables:
##  $ Sat : Ord.factor w/ 3 levels "Low"&lt;"Medium"&lt;..: 1 2 3 1 2 3 1 2 3 1 ...
##  $ Infl: Factor w/ 3 levels "Low","Medium",..: 1 1 1 2 2 2 3 3 3 1 ...
##  $ Type: Factor w/ 4 levels "Tower","Apartment",..: 1 1 1 1 1 1 1 1 1 2 ...
##  $ Cont: Factor w/ 2 levels "Low","High": 1 1 1 1 1 1 1 1 1 1 ...
##  $ Freq: int  21 21 28 34 22 36 10 11 36 61 ...</code></pre>
<p>居民对居住环境满意度 Sat 三个等级的有序回归</p>
<div class="sourceCode" id="cb2210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>contrasts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"contr.treatment"</span>, <span class="st">"contr.poly"</span><span class="op">)</span><span class="op">)</span>
<span class="va">house.plr</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/polr.html">polr</a></span><span class="op">(</span><span class="va">Sat</span> <span class="op">~</span> <span class="va">Infl</span> <span class="op">+</span> <span class="va">Type</span> <span class="op">+</span> <span class="va">Cont</span>, weights <span class="op">=</span> <span class="va">Freq</span>, data <span class="op">=</span> <span class="va">housing</span><span class="op">)</span>
<span class="va">house.plr</span></code></pre></div>
<pre><code>## Call:
## MASS::polr(formula = Sat ~ Infl + Type + Cont, data = housing, 
##     weights = Freq)
## 
## Coefficients:
##    InflMedium      InflHigh TypeApartment    TypeAtrium   TypeTerrace 
##     0.5663937     1.2888191    -0.5723501    -0.3661866    -1.0910149 
##      ContHigh 
##     0.3602841 
## 
## Intercepts:
##  Low|Medium Medium|High 
##  -0.4961353   0.6907083 
## 
## Residual Deviance: 3479.149 
## AIC: 3495.149</code></pre>
<p>再计算一下 P 值，置信区间</p>
<div class="sourceCode" id="cb2212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">house.plr</span><span class="op">)</span><span class="op">)</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">ctable</span><span class="op">[</span>, <span class="st">"t value"</span><span class="op">]</span><span class="op">)</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">*</span> <span class="fl">2</span>
<span class="va">ctable</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">ctable</span>, <span class="st">"p value"</span> <span class="op">=</span> <span class="va">p</span><span class="op">)</span>
<span class="co"># confidence intervals 计算置信区间</span>
<span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/confint.html">confint</a></span><span class="op">(</span><span class="va">house.plr</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">house.plr</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##    InflMedium      InflHigh TypeApartment    TypeAtrium   TypeTerrace 
##     1.7619017     3.6284990     0.5641979     0.6933734     0.3358754 
##      ContHigh 
##     1.4337368</code></pre>
<div class="sourceCode" id="cb2214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## OR and CI</span>
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span>OR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">house.plr</span><span class="op">)</span>, <span class="va">ci</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##                      OR     2.5 %    97.5 %
## InflMedium    1.7619017 1.4356845 2.1639915
## InflHigh      3.6284990 2.8319659 4.6626461
## TypeApartment 0.5641979 0.4462124 0.7121941
## TypeAtrium    0.6933734 0.5114084 0.9398410
## TypeTerrace   0.3358754 0.2492277 0.4514276
## ContHigh      1.4337368 1.1892931 1.7296674</code></pre>
<blockquote>
<p>模型解释</p>
</blockquote>
<p>参考文档 <code><a href="https://rdrr.io/pkg/MASS/man/housing.html">help(housing)</a></code> 包含泊松回归、多项回归、比例风险模型，以及 <a href="https://www.analyticsvidhya.com/blog/2016/02/multinomial-ordinal-logistic-regression/" class="uri">https://www.analyticsvidhya.com/blog/2016/02/multinomial-ordinal-logistic-regression/</a></p>
<blockquote>
<p>好好看文档 <code><a href="https://rdrr.io/pkg/MASS/man/housing.html">help(housing)</a></code> 和对应的参考书籍，把原理弄清楚</p>
</blockquote>
<blockquote>
<p>有序因子变量是如何实现编码的</p>
</blockquote>
</div>
<div id="sec-epileptics-counts" class="section level2" number="27.8">
<h2>
<span class="header-section-number">27.8</span> 癫痫病发作次数<a class="anchor" aria-label="anchor" href="#sec-epileptics-counts"><i class="fas fa-link"></i></a>
</h2>
<p>纵向数据 <span class="citation"><a href="#ref-Peter_1990_epil" role="doc-biblioref">[69]</a></span>，考虑了过度发散 overdispersion 异方差 heteroscedasticity 观测不独立</p>
<p>数据集 epil 记录癫痫发作的次数及病人的特征，下面是数据建模分析过程</p>
<div class="sourceCode" id="cb2216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">epil</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span>
<span class="va">fit_glm_epil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">lbase</span> <span class="op">*</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">lage</span> <span class="op">+</span> <span class="va">V4</span>,
  family <span class="op">=</span> <span class="va">poisson</span>,
  data <span class="op">=</span> <span class="va">epil</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glm_epil</span><span class="op">)</span>

<span class="va">fit_glmm_epil</span><span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glmmPQL.html">glmmPQL</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">lbase</span> <span class="op">*</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">lage</span> <span class="op">+</span> <span class="va">V4</span>,
  random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span>,
  family <span class="op">=</span> <span class="va">poisson</span>, data <span class="op">=</span> <span class="va">epil</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glmm_epil</span><span class="op">)</span>

<span class="va">fit_glmm_lme4</span> <span class="op">&lt;-</span> <span class="fu">lme4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/glmer.html">glmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">lbase</span> <span class="op">*</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">lage</span> <span class="op">+</span> <span class="va">V4</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>,
  family <span class="op">=</span> <span class="va">poisson</span>, data <span class="op">=</span> <span class="va">epil</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glmm_lme4</span><span class="op">)</span>


<span class="va">fit_glmm_glmmtmb</span> <span class="op">&lt;-</span> <span class="fu">glmmTMB</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/glmmTMB/man/glmmTMB.html">glmmTMB</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">lbase</span> <span class="op">*</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">lage</span> <span class="op">+</span> <span class="va">V4</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>,
  data <span class="op">=</span> <span class="va">epil</span>, family <span class="op">=</span> <span class="va">poisson</span>, REML <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span> <span class="co"># REML 估计</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glmm_glmmtmb</span><span class="op">)</span>


<span class="co"># https://github.com/drizopoulos/GLMMadaptive</span>
<span class="va">fit_glmm_glmmadaptive</span> <span class="op">&lt;-</span> <span class="fu">GLMMadaptive</span><span class="fu">::</span><span class="fu">mixed_model</span><span class="op">(</span>
  fixed <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">lbase</span> <span class="op">*</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">lage</span> <span class="op">+</span> <span class="va">V4</span>,
  random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span>, data <span class="op">=</span> <span class="va">epil</span>,
  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_glmm_glmmadaptive</span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-generalized-log-linear-model" class="section level2" number="27.9">
<h2>
<span class="header-section-number">27.9</span> 对数线性模型<a class="anchor" aria-label="anchor" href="#sec-generalized-log-linear-model"><i class="fas fa-link"></i></a>
</h2>
<p>当响应变量 <span class="math inline">\(Y\)</span> 服从对数正态分布的时候，广义线性模型具化为对数线性模型，<strong>gllm</strong> 包 <span class="citation"><a href="#ref-gllm" role="doc-biblioref">[70]</a></span></p>
</div>
<div id="sec-generalized-possion-linear-model" class="section level2" number="27.10">
<h2>
<span class="header-section-number">27.10</span> 泊松回归模型<a class="anchor" aria-label="anchor" href="#sec-generalized-possion-linear-model"><i class="fas fa-link"></i></a>
</h2>
<p>加载数据</p>
<div class="sourceCode" id="cb2217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">beall.webworms</span>, package <span class="op">=</span> <span class="st">"agridat"</span><span class="op">)</span></code></pre></div>
<p>查看数据</p>
<div class="sourceCode" id="cb2218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">beall.webworms</span><span class="op">)</span></code></pre></div>
<pre><code>##   row col y block trt spray lead
## 1   1   1 1    B1  T1     N    N
## 2   2   1 0    B1  T1     N    N
## 3   3   1 1    B1  T1     N    N
## 4   4   1 3    B1  T1     N    N
## 5   5   1 6    B1  T1     N    N
## 6   6   1 0    B2  T1     N    N</code></pre>
<p>描述响应变量的分布</p>
<div class="sourceCode" id="cb2220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">beall.webworms</span><span class="op">$</span><span class="va">y</span>, main <span class="op">=</span> <span class="st">"Histogram of Worm Count"</span>, xlab <span class="op">=</span> <span class="st">"Number of Worms"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="generalized-linear-models_files/figure-html/unnamed-chunk-22-1.png" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">beall.webworms</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="generalized-linear-models_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></div>
<p>抖动图</p>
<div class="sourceCode" id="cb2222"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">beall.webworms</span>, xlab <span class="op">=</span> <span class="st">"Types of Worms"</span>, ylab <span class="op">=</span> <span class="st">"Worm Count"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="generalized-linear-models_files/figure-html/unnamed-chunk-24-1.png" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">beall.webworms</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">trt</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Types of Worms"</span>, y <span class="op">=</span> <span class="st">"Worm Count"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="generalized-linear-models_files/figure-html/unnamed-chunk-25-1.png" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pois.mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">beall.webworms</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pois.mod</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ trt, family = "poisson", data = beall.webworms)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6733  -1.0046  -0.9081   0.6141   4.2771  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.33647    0.04688   7.177 7.12e-13 ***
## trtT2       -1.02043    0.09108 -11.204  &lt; 2e-16 ***
## trtT3       -0.49628    0.07621  -6.512 7.41e-11 ***
## trtT4       -1.22246    0.09829 -12.438  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 1955.9  on 1299  degrees of freedom
## Residual deviance: 1720.4  on 1296  degrees of freedom
## AIC: 3125.5
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>模型系数 T2 的解释，这里 GLM 使用了对数联系函数(log link function) ，因此 -1.02 是对数变换后的值，T2的系数实际是 0.3605949 ，实际意义是相对于T1，T2 类型的蠕虫数量是 T1 的 0.3605949 倍</p>
<p>The first valuable information is related to the residuals of the model, which should be symmetrical as for any normal linear model. From this output we can see that minimum and maximum, as well as the first and third quartiles, are similar, so this assumption is confirmed. Then we can see that the variable trt (i.e. treatment factor) is highly significant for the model, with very low p-values. The statistical test in this case is not a t-test, as in the output of the function lm, but a Wald Test (<a href="http://www.blackwellpublishing.com/specialarticles/jcn_10_774.pdf">Wald Test</a>). This test computes the probability that the coefficient is 0, if the p is significant it means the chances the coefficient is zero are very low so the variable should be included in the model since it has an effect on y.</p>
<p>Another important information is the deviance, particularly the residual deviance. As a general rule, this value should be lower or in line than the residuals degrees of freedom for the model to be good. In this case the fact that the residual deviance is high (even though not dramatically) may suggests the explanatory power of the model is low. We will see below how to obtain p-value for the significance of the model.</p>
<div class="sourceCode" id="cb2226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">pois.mod</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="generalized-linear-models_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">pois.mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##          1          2 
##  0.3364722 -0.6839588</code></pre>
<p>模型的P值</p>
<div class="sourceCode" id="cb2229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/deviance.html">deviance</a></span><span class="op">(</span><span class="va">pois.mod</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/df.residual.html">df.residual</a></span><span class="op">(</span><span class="va">pois.mod</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1.709743e-14</code></pre>
<p>模型选择</p>
<div class="sourceCode" id="cb2231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pois.mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">block</span> <span class="op">+</span> <span class="va">spray</span> <span class="op">*</span> <span class="va">lead</span>, data <span class="op">=</span> <span class="va">beall.webworms</span>, family <span class="op">=</span> <span class="st">"poisson"</span><span class="op">)</span></code></pre></div>
<p>两模型的 AIC 比较</p>
<div class="sourceCode" id="cb2232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html">AIC</a></span><span class="op">(</span><span class="va">pois.mod</span>, <span class="va">pois.mod2</span><span class="op">)</span></code></pre></div>
<pre><code>##           df      AIC
## pois.mod   4 3125.478
## pois.mod2 16 3027.438</code></pre>
<p>假设响应变量 Y 服从泊松分布，意味着随机变量 Y 的期望和方差相等</p>
<div class="sourceCode" id="cb2234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">beall.webworms</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.7923077</code></pre>
<div class="sourceCode" id="cb2236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">var</a></span><span class="op">(</span><span class="va">beall.webworms</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1.290164</code></pre>
<p>实际上方差比均值大，这种情况称之为过度发散 (overdispersed)，分布应该修正为拟（似然）泊松分布</p>
<div class="sourceCode" id="cb2238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pois.mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">beall.webworms</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"quasipoisson"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pois.mod3</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = y ~ trt, family = c("quasipoisson"), data = beall.webworms)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.6733  -1.0046  -0.9081   0.6141   4.2771  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.33647    0.05457   6.166 9.32e-10 ***
## trtT2       -1.02043    0.10601  -9.626  &lt; 2e-16 ***
## trtT3       -0.49628    0.08870  -5.595 2.69e-08 ***
## trtT4       -1.22246    0.11440 -10.686  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for quasipoisson family taken to be 1.35472)
## 
##     Null deviance: 1955.9  on 1299  degrees of freedom
## Residual deviance: 1720.4  on 1296  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 6</code></pre>
<p>计算得知发散参数(dispersion parameter) 是 1.35472，可见数据Y并不是发散得离谱，泊松分布可能仍然是对这个数据的合理假设</p>
<p>AER 包是书籍 Applied Econometrics with R 的配套材料 <span class="citation"><a href="#ref-AER_2008_Kleiber" role="doc-biblioref">[71]</a></span>，可用于直接检验发散参数是否大于1</p>
<div class="sourceCode" id="cb2240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># AER::dispersiontest(pois.mod, alternative="greater")</span></code></pre></div>
<p>如果数据真的过度离散，就应该使用负二项分布作为响应变量的拟合分布，拟合它就采用 MASS 包 <span class="citation"><a href="#ref-MASS_2002_Venables" role="doc-biblioref">[72]</a></span> 提供的 <code>glm.nb</code>函数</p>
<div class="sourceCode" id="cb2241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">NB.mod1</span> <span class="op">&lt;-</span> <span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/glm.nb.html">glm.nb</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">trt</span>, data <span class="op">=</span> <span class="va">beall.webworms</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">NB.mod1</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## MASS::glm.nb(formula = y ~ trt, data = beall.webworms, init.theta = 2.004130573, 
##     link = log)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.4572  -0.9488  -0.8660   0.5340   2.7698  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  0.33647    0.06110   5.507 3.65e-08 ***
## trtT2       -1.02043    0.10661  -9.572  &lt; 2e-16 ***
## trtT3       -0.49628    0.09423  -5.267 1.39e-07 ***
## trtT4       -1.22246    0.11283 -10.834  &lt; 2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for Negative Binomial(2.0041) family taken to be 1)
## 
##     Null deviance: 1442.7  on 1299  degrees of freedom
## Residual deviance: 1275.3  on 1296  degrees of freedom
## AIC: 3053
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  2.004 
##           Std. Err.:  0.325 
## 
##  2 x log-likelihood:  -3042.969</code></pre>
<p>两个模型的方差分析</p>
<div class="sourceCode" id="cb2243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">pois.mod</span>, <span class="va">pois.mod2</span>, test <span class="op">=</span> <span class="st">"Chisq"</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: y ~ trt
## Model 2: y ~ block + spray * lead
##   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    
## 1      1296     1720.4                          
## 2      1284     1598.4 12   122.04 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>从方差分析比较的结果来看，P值告诉我们，两模型是显著不同的，由上面对两模型的 AIC 计算结果来看，模型 pois.mod2 比模型 pois.mod 要好，模型的 AIC 值越小，表明拟合得越准确。</p>

</div>
</div>



<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-Dobson_2018_Generalized" class="csl-entry">
<div class="csl-left-margin">[62] </div>
<div class="csl-right-inline">A. J. Dobson and A. G. Barnett, <em>An introduction to generalized linear models</em>, Fourth. Boca Raton, Florida: Chapman; Hall/CRC, 2018.Available: <a href="https://www.crcpress.com/p/book/9781138741515">https://www.crcpress.com/p/book/9781138741515</a>
</div>
</div>
<div id="ref-McCullagh_1989_Generalized" class="csl-entry">
<div class="csl-left-margin">[63] </div>
<div class="csl-right-inline">P. McCullagh and J. Nelder, <em>Generalized linear models</em>, Second. London: Chapman; Hall/CRC, 1989.Available: <a href="https://www.crcpress.com/p/book/9780412317606">https://www.crcpress.com/p/book/9780412317606</a>
</div>
</div>
<div id="ref-David_2000_Logistic" class="csl-entry">
<div class="csl-left-margin">[64] </div>
<div class="csl-right-inline">D. W. Hosmer and S. Lemeshow, <em>Applied logistic regression</em>, Second. New York, NY: John Wiley &amp; Sons, 2000.</div>
</div>
<div id="ref-Train_2009_mlogit" class="csl-entry">
<div class="csl-left-margin">[65] </div>
<div class="csl-right-inline">K. E. Train, <em>Discrete choice methods with simulation</em>, Second. New York, NY: Cambridge University Press, 2009.</div>
</div>
<div id="ref-spikeslab_2005_Ishwaran" class="csl-entry">
<div class="csl-left-margin">[66] </div>
<div class="csl-right-inline">H. Ishwaran and J. S. Rao, <span>“Spike and slab variable selection: Frequentist and bayesian strategies,”</span> <em>Ann. Statist.</em>, vol. 33, no. 2, pp. 730–773, 2005,Available: <a href="http://arXiv.org/abs/math/0505633v1">http://arXiv.org/abs/math/0505633v1</a>
</div>
</div>
<div id="ref-mnlogit_2016_JSS" class="csl-entry">
<div class="csl-left-margin">[67] </div>
<div class="csl-right-inline">A. Hasan, Z. Wang, and A. S. Mahani, <span>“Fast estimation of multinomial logit models: <span>R</span> package <span class="nocase">mnlogit</span>,”</span> <em>Journal of Statistical Software</em>, vol. 75, no. 3, pp. 1–24, 2016, doi: <a href="https://doi.org/10.18637/jss.v075.i03">10.18637/jss.v075.i03</a>.</div>
</div>
<div id="ref-JSS_2007_pls" class="csl-entry">
<div class="csl-left-margin">[68] </div>
<div class="csl-right-inline">B.-H. Mevik and R. Wehrens, <span>“The <span class="nocase">pls</span> package: Principal component and partial least squares regression in r,”</span> <em>Journal of Statistical Software</em>, vol. 18, no. 2, pp. 1–23, 2007, doi: <a href="https://doi.org/10.18637/jss.v018.i02">10.18637/jss.v018.i02</a>.</div>
</div>
<div id="ref-Peter_1990_epil" class="csl-entry">
<div class="csl-left-margin">[69] </div>
<div class="csl-right-inline">P. F. Thall and S. C. Vail, <span>“Some covariance models for longitudinal count data with overdispersion,”</span> <em>Biometrics</em>, vol. 46, no. 3, pp. 657–671, 1990,Available: <a href="https://www.jstor.org/stable/2532086">https://www.jstor.org/stable/2532086</a>
</div>
</div>
<div id="ref-gllm" class="csl-entry">
<div class="csl-left-margin">[70] </div>
<div class="csl-right-inline">M. A. Espeland and S. L. Hui, <span>“A general approach to analyzing epidemiologic data that contain misclassification errors,”</span> <em>Biometrics</em>, vol. 43, no. 4, pp. 1001–1012, 1987,Available: <a href="https://www.jstor.org/stable/2531553">https://www.jstor.org/stable/2531553</a>
</div>
</div>
<div id="ref-AER_2008_Kleiber" class="csl-entry">
<div class="csl-left-margin">[71] </div>
<div class="csl-right-inline">C. Kleiber and A. Zeileis, <em>Applied econometrics with <span>R</span></em>. New York: Springer-Verlag, 2008.Available: <a href="https://CRAN.R-project.org/package=AER">https://CRAN.R-project.org/package=AER</a>
</div>
</div>
<div id="ref-MASS_2002_Venables" class="csl-entry">
<div class="csl-left-margin">[72] </div>
<div class="csl-right-inline">W. N. Venables and B. D. Ripley, <em>Modern applied statistics with <span>S</span></em>, Fourth. New York, NY: Springer-Verlag, 2002.Available: <a href="http://www.stats.ox.ac.uk/pub/MASS4">http://www.stats.ox.ac.uk/pub/MASS4</a>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chap-linear-models.html"><span class="header-section-number">26</span> 线性模型</a></div>
<div class="next"><a href="chap-data-modeling.html">介绍</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-generalized-linear-models"><span class="header-section-number">27</span> 广义线性模型</a></li>
<li><a class="nav-link" href="#sec-glm-introduction"><span class="header-section-number">27.1</span> 介绍</a></li>
<li>
<a class="nav-link" href="#sec-glm-theory"><span class="header-section-number">27.2</span> 理论基础</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#subsec-glm-ridge"><span class="header-section-number">27.2.1</span> 岭回归</a></li>
<li><a class="nav-link" href="#subsec-glm-lasso"><span class="header-section-number">27.2.2</span> Lasso</a></li>
<li><a class="nav-link" href="#subset:glm-best-subset"><span class="header-section-number">27.2.3</span> 最优子集回归</a></li>
<li><a class="nav-link" href="#subsec-glm-pls"><span class="header-section-number">27.2.4</span> 偏最小二乘回归</a></li>
</ul>
</li>
<li><a class="nav-link" href="#sec-alcohol"><span class="header-section-number">27.3</span> 吸烟喝酒和食道癌的关系</a></li>
<li><a class="nav-link" href="#sec-infert"><span class="header-section-number">27.4</span> 自然流产和人工流产后的不育</a></li>
<li><a class="nav-link" href="#sec-australia-bacteria"><span class="header-section-number">27.5</span> 细菌数据集</a></li>
<li><a class="nav-link" href="#sec-birthwt"><span class="header-section-number">27.6</span> 研究婴儿出生体重低的相关危险因素</a></li>
<li><a class="nav-link" href="#sec-housing"><span class="header-section-number">27.7</span> 哥本哈根住房状况调查</a></li>
<li><a class="nav-link" href="#sec-epileptics-counts"><span class="header-section-number">27.8</span> 癫痫病发作次数</a></li>
<li><a class="nav-link" href="#sec-generalized-log-linear-model"><span class="header-section-number">27.9</span> 对数线性模型</a></li>
<li><a class="nav-link" href="#sec-generalized-possion-linear-model"><span class="header-section-number">27.10</span> 泊松回归模型</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/masr/blob/devel/generalized-linear-models.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/masr/edit/devel/generalized-linear-models.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>现代应用统计与 R 语言</strong>: Modern Applied Statistics with R" was written by 黄湘云. It was last built on 2022-04-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
