<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 26 章 线性模型 | 现代应用统计与 R 语言</title>
<meta name="author" content="黄湘云">
<meta name="description" content="There’s probably some examples, but there are some examples of people using solve(t(X) %*% W %*% X) %*% W %*% Y to compute regression coefficients, too. — Thomas Lumley 68  26.1 方差分析  I was...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="第 26 章 线性模型 | 现代应用统计与 R 语言">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="There’s probably some examples, but there are some examples of people using solve(t(X) %*% W %*% X) %*% W %*% Y to compute regression coefficients, too. — Thomas Lumley 68  26.1 方差分析  I was...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 26 章 线性模型 | 现代应用统计与 R 语言">
<meta name="twitter:description" content="There’s probably some examples, but there are some examples of people using solve(t(X) %*% W %*% X) %*% W %*% Y to compute regression coefficients, too. — Thomas Lumley 68  26.1 方差分析  I was...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs/header-attrs.js"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/proj4js/proj4.js"></script><link href="libs/highcharts/css/motion.css" rel="stylesheet">
<script src="libs/highcharts/highcharts.js"></script><script src="libs/highcharts/highcharts-3d.js"></script><script src="libs/highcharts/highcharts-more.js"></script><script src="libs/highcharts/modules/stock.js"></script><script src="libs/highcharts/modules/map.js"></script><script src="libs/highcharts/modules/annotations.js"></script><script src="libs/highcharts/modules/data.js"></script><script src="libs/highcharts/modules/drilldown.js"></script><script src="libs/highcharts/modules/item-series.js"></script><script src="libs/highcharts/modules/offline-exporting.js"></script><script src="libs/highcharts/modules/overlapping-datalabels.js"></script><script src="libs/highcharts/modules/exporting.js"></script><script src="libs/highcharts/modules/export-data.js"></script><script src="libs/highcharts/modules/funnel.js"></script><script src="libs/highcharts/modules/heatmap.js"></script><script src="libs/highcharts/modules/treemap.js"></script><script src="libs/highcharts/modules/sankey.js"></script><script src="libs/highcharts/modules/dependency-wheel.js"></script><script src="libs/highcharts/modules/organization.js"></script><script src="libs/highcharts/modules/solid-gauge.js"></script><script src="libs/highcharts/modules/streamgraph.js"></script><script src="libs/highcharts/modules/sunburst.js"></script><script src="libs/highcharts/modules/vector.js"></script><script src="libs/highcharts/modules/wordcloud.js"></script><script src="libs/highcharts/modules/xrange.js"></script><script src="libs/highcharts/modules/tilemap.js"></script><script src="libs/highcharts/modules/venn.js"></script><script src="libs/highcharts/modules/gantt.js"></script><script src="libs/highcharts/modules/timeline.js"></script><script src="libs/highcharts/modules/parallel-coordinates.js"></script><script src="libs/highcharts/modules/bullet.js"></script><script src="libs/highcharts/modules/coloraxis.js"></script><script src="libs/highcharts/modules/dumbbell.js"></script><script src="libs/highcharts/modules/lollipop.js"></script><script src="libs/highcharts/modules/series-label.js"></script><script src="libs/highcharts/plugins/motion.js"></script><script src="libs/highcharts/custom/reset.js"></script><script src="libs/highcharts/modules/boost.js"></script><script src="libs/highchart-binding/highchart.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><link href="libs/dygraphs/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs/dygraph-combined.js"></script><script src="libs/dygraphs/shapes.js"></script><script src="libs/moment/moment.js"></script><script src="libs/moment-timezone/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding/dygraphs.js"></script><script src="libs/Dygraph.Plugins.Unzoom/unzoom.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/es6shim/es6shim.js"></script><script src="libs/es7shim/es7shim.js"></script><script src="libs/graphre/graphre.js"></script><script src="libs/nomnoml/nomnoml.js"></script><script src="libs/nomnoml-binding/nomnoml.js"></script><script src="libs/d3-bundle/d3-bundle.min.js"></script><script src="libs/d3-lasso/d3-lasso.min.js"></script><script src="libs/save-svg-as-png/save-svg-as-png.min.js"></script><link href="libs/ggiraphjs/ggiraphjs.min.css" rel="stylesheet">
<script src="libs/ggiraphjs/ggiraphjs.min.js"></script><script src="libs/girafe-binding/girafe.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><script src="libs/jszip/jszip.min.js"></script><script src="libs/pdfmake/pdfmake.js"></script><script src="libs/pdfmake/vfs_fonts.js"></script><link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.flash.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script><link href="libs/dt-ext-rowgroup/css/rowGroup.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-rowgroup/js/dataTables.rowGroup.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/echarts-world/world.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Modern Applied Statistics with R">现代应用统计与 R 语言</a>:
        <small class="text-muted">Modern Applied Statistics with R</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">动态文档</li>
<li><a class="" href="chap-dynamic-documents.html">介绍</a></li>
<li><a class="" href="chap-document-elements.html"><span class="header-section-number">13</span> 文档元素</a></li>
<li><a class="" href="chap-portable-document.html"><span class="header-section-number">14</span> 便携式文档</a></li>
<li><a class="" href="chap-web-documents.html"><span class="header-section-number">15</span> 网页文档</a></li>
<li><a class="" href="chap-office-document.html"><span class="header-section-number">16</span> 办公文档</a></li>
<li><a class="" href="chap-reproducible-workflows.html"><span class="header-section-number">17</span> 工作流</a></li>
<li><a class="" href="chap-advanced-documents.html"><span class="header-section-number">18</span> 高级文档</a></li>
<li class="book-part">数据产品</li>
<li><a class="" href="chap-data-product.html">介绍</a></li>
<li><a class="" href="chap-interactive-data-tables.html"><span class="header-section-number">19</span> 交互表格</a></li>
<li><a class="" href="chap-interactive-shiny-app.html"><span class="header-section-number">20</span> 交互报表</a></li>
<li class="book-part">统计基础</li>
<li><a class="" href="chap-statistical-foundations.html">介绍</a></li>
<li><a class="" href="chap-sampling-distributions.html"><span class="header-section-number">21</span> 抽样分布</a></li>
<li><a class="" href="chap-parameter-estimators.html"><span class="header-section-number">22</span> 参数估计</a></li>
<li><a class="" href="chap-hypothesis-test.html"><span class="header-section-number">23</span> 假设检验</a></li>
<li><a class="" href="chap-power-Analysis.html"><span class="header-section-number">24</span> 功效分析</a></li>
<li><a class="" href="chap-experimental-design.html"><span class="header-section-number">25</span> 试验设计</a></li>
<li class="book-part">统计模型</li>
<li><a class="" href="chap-statistical-models.html">介绍</a></li>
<li><a class="active" href="chap-linear-models.html"><span class="header-section-number">26</span> 线性模型</a></li>
<li><a class="" href="chap-generalized-linear-models.html"><span class="header-section-number">27</span> 广义线性模型</a></li>
<li><a class="" href="chap-bayesian-models.html"><span class="header-section-number">28</span> 贝叶斯模型</a></li>
<li class="book-part">数据建模</li>
<li><a class="" href="chap-data-modeling.html">介绍</a></li>
<li><a class="" href="chap-text-analysis.html"><span class="header-section-number">29</span> 文本分析</a></li>
<li><a class="" href="chap-survival-analysis.html"><span class="header-section-number">30</span> 生存分析</a></li>
<li><a class="" href="chap-time-series-analysis.html"><span class="header-section-number">31</span> 时序分析</a></li>
<li class="book-part">时空数据</li>
<li><a class="" href="chap-spatio-temporal-data.html">介绍</a></li>
<li><a class="" href="chap-spatial-analysis.html"><span class="header-section-number">32</span> 空间数据分析</a></li>
<li><a class="" href="chap-spatial-modeling.html"><span class="header-section-number">33</span> 空间数据建模</a></li>
<li><a class="" href="chap-spatial-viz.html"><span class="header-section-number">34</span> 空间数据可视化</a></li>
<li><a class="" href="chap-case-study.html"><span class="header-section-number">35</span> 案例研究</a></li>
<li><a class="" href="chap-data-explorer.html"><span class="header-section-number">36</span> 数据探索</a></li>
<li class="book-part">机器学习</li>
<li><a class="" href="chap-machine-learning.html">介绍</a></li>
<li><a class="" href="chap-gradient-boosting-machine.html"><span class="header-section-number">37</span> 梯度提升机</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">38</span> 数值优化</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="chap-matrix-operations.html"><span class="header-section-number">B</span> 矩阵运算</a></li>
<li><a class="" href="chap-symbolic-computation.html"><span class="header-section-number">C</span> 符号计算</a></li>
<li><a class="" href="chap-mixed-programming.html"><span class="header-section-number">D</span> 混合编程</a></li>
<li><a class="" href="chap-object-oriented-programming.html"><span class="header-section-number">E</span> 面向对象编程</a></li>
<li><a class="" href="chap-file-operations.html"><span class="header-section-number">F</span> 文件操作</a></li>
<li><a class="" href="chap-other-softwares.html"><span class="header-section-number">G</span> 其它软件</a></li>
<li><a class="" href="chap-notations.html"><span class="header-section-number">H</span> 符号说明</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/masr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-linear-models" class="section level1" number="26">
<h1>
<span class="header-section-number">第 26 章</span> 线性模型<a class="anchor" aria-label="anchor" href="#chap-linear-models"><i class="fas fa-link"></i></a>
</h1>
<blockquote>
<p>There’s probably some examples, but there are some examples of people using <code>solve(t(X) %*% W %*% X) %*% W %*% Y</code> to compute regression coefficients, too.</p>
<p>— Thomas Lumley <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://stat.ethz.ch/pipermail/r-help/2006-March/101596.html" class="uri"&gt;https://stat.ethz.ch/pipermail/r-help/2006-March/101596.html&lt;/a&gt;&lt;/p&gt;'><sup>68</sup></a></p>
</blockquote>
<div id="sec-anova" class="section level2" number="26.1">
<h2>
<span class="header-section-number">26.1</span> 方差分析<a class="anchor" aria-label="anchor" href="#sec-anova"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>I was profoundly disappointed when I saw that S-PLUS 4.5 now provides “Type III” sums of squares as a routine option for the summary method for aov objects. I note that it is not yet available for multistratum models, although this has all the hallmarks of an oversight (that is, a bug) rather than common sense seeing the light of day. When the decision was being taken of whether to include this feature, “because the FDA requires it” a few of my colleagues and I were consulted and our reply was unhesitatingly a clear and unequivocal “No”, but it seems the FDA and SAS speak louder and we were clearly outvoted.</p>
<p>— Bill Venables <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;来源于 &lt;a href="https://www.stats.ox.ac.uk/pub/MASS3/Exegeses.pdf"&gt;Exegeses on Linear Models&lt;/a&gt;&lt;/p&gt;'><sup>69</sup></a></p>
</blockquote>
<blockquote>
<p>方差分析、 A/B Test 和多重比较多用于互联网数据
lme 的特例</p>
</blockquote>
</div>
<div id="sec-one-way-anova" class="section level2" number="26.2">
<h2>
<span class="header-section-number">26.2</span> 单因素方差分析<a class="anchor" aria-label="anchor" href="#sec-one-way-anova"><i class="fas fa-link"></i></a>
</h2>
<p>chickwts 不同的喂食方式对体重的影响</p>
<div class="sourceCode" id="cb2104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">feed</span>, data <span class="op">=</span> <span class="va">chickwts</span>, col <span class="op">=</span> <span class="st">"lightgray"</span>,
    varwidth <span class="op">=</span> <span class="cn">TRUE</span>, notch <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="st">"chickwt data"</span>,
    ylab <span class="op">=</span> <span class="st">"Weight at six weeks (gm)"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning in (function (z, notch = FALSE, width = NULL, varwidth = FALSE, : some
## notches went outside hinges ('box'): maybe set notch=FALSE</code></pre>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-2-1.png" width="2100" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fm1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">~</span> <span class="va">feed</span>, data <span class="op">=</span> <span class="va">chickwts</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: weight
##           Df Sum Sq Mean Sq F value    Pr(&gt;F)    
## feed       5 231129   46226  15.365 5.936e-10 ***
## Residuals 65 195556    3009                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb2108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">opar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, oma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1.1</span>, <span class="fl">0</span><span class="op">)</span>,
            mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>, <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fm1</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-2-2.png" width="2100" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span><span class="va">opar</span><span class="op">)</span></code></pre></div>
<p>sleep</p>
<div class="sourceCode" id="cb2110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Student's paired t-test 成对样本的 t 检验</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">sleep</span>,
     <span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">extra</span><span class="op">[</span><span class="va">group</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>,
            <span class="va">extra</span><span class="op">[</span><span class="va">group</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  extra[group == 1] and extra[group == 2]
## t = -4.0621, df = 9, p-value = 0.002833
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -2.4598858 -0.7001142
## sample estimates:
## mean of the differences 
##                   -1.58</code></pre>
<div class="sourceCode" id="cb2112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## The sleep *prolongations*</span>
<span class="va">sleep1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">sleep</span>, <span class="va">extra</span><span class="op">[</span><span class="va">group</span> <span class="op">==</span> <span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">extra</span><span class="op">[</span><span class="va">group</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">sleep1</span><span class="op">)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    0.00    1.05    1.30    1.58    1.70    4.60</code></pre>
<div class="sourceCode" id="cb2114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/stripchart.html">stripchart</a></span><span class="op">(</span><span class="va">sleep1</span>, method <span class="op">=</span> <span class="st">"stack"</span>, xlab <span class="op">=</span> <span class="st">"hours"</span>,
           main <span class="op">=</span> <span class="st">"Sleep prolongation (n = 10)"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">sleep1</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>, add <span class="op">=</span> <span class="cn">TRUE</span>,
        at <span class="op">=</span> <span class="fl">.6</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>boxwex <span class="op">=</span> <span class="fl">0.5</span>, staplewex <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-4-1.png" width="2100" style="display: block; margin: auto;"></div>
<p>另一个关于测量光速的例子，带分类变量的</p>
<div class="sourceCode" id="cb2115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">michelson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">transform</a></span><span class="op">(</span><span class="va">morley</span>,
                       Expt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Expt</span><span class="op">)</span>, Run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Run</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Expt</span> <span class="op">+</span> <span class="va">Run</span>, data <span class="op">=</span> <span class="va">michelson</span><span class="op">)</span>  <span class="co"># 5 x 20 balanced (two-way)</span></code></pre></div>
<pre><code>##     Run
## Expt 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20
##    1 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1
##    2 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1
##    3 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1
##    4 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1
##    5 1 1 1 1 1 1 1 1 1  1  1  1  1  1  1  1  1  1  1  1</code></pre>
<div class="sourceCode" id="cb2117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">Speed</span> <span class="op">~</span> <span class="va">Expt</span>, data <span class="op">=</span> <span class="va">michelson</span>,
     main <span class="op">=</span> <span class="st">"Speed of Light Data"</span>, xlab <span class="op">=</span> <span class="st">"Experiment No."</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-6-1.png" width="2100" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">Speed</span> <span class="op">~</span> <span class="va">Run</span> <span class="op">+</span> <span class="va">Expt</span>, data <span class="op">=</span> <span class="va">michelson</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## Run         19 113344    5965   1.105 0.36321   
## Expt         4  94514   23629   4.378 0.00307 **
## Residuals   76 410166    5397                   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb2120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fm0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/update.dev.pkg.html">update</a></span><span class="op">(</span><span class="va">fm</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">Run</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fm0</span>, <span class="va">fm</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: Speed ~ Expt
## Model 2: Speed ~ Run + Expt
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1     95 523510                           
## 2     76 410166 19    113344 1.1053 0.3632</code></pre>
<p>ToothGrowth 维生素 C 对牙齿增长的关系</p>
<div class="sourceCode" id="cb2122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/coplot.html">coplot</a></span><span class="op">(</span><span class="va">len</span> <span class="op">~</span> <span class="va">dose</span> <span class="op">|</span> <span class="va">supp</span>, data <span class="op">=</span> <span class="va">ToothGrowth</span>, panel <span class="op">=</span> <span class="va">panel.smooth</span>,
       xlab <span class="op">=</span> <span class="st">"ToothGrowth data: length vs dose, given type of supplement"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-9-1.png" width="2100" style="display: block; margin: auto;"></div>
</div>
<div id="sec-two-way-anova" class="section level2" number="26.3">
<h2>
<span class="header-section-number">26.3</span> 双因素方差分析<a class="anchor" aria-label="anchor" href="#sec-two-way-anova"><i class="fas fa-link"></i></a>
</h2>
<p><code><a href="https://rdrr.io/r/stats/lm.html">?lm</a></code> mlm</p>
</div>
<div id="sec-manova" class="section level2" number="26.4">
<h2>
<span class="header-section-number">26.4</span> 多因素方差分析<a class="anchor" aria-label="anchor" href="#sec-manova"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/smn74/MANOVA.RM">MANOVA.RM</a> 和 <a href="https://github.com/olangsrud/ffmanova">ffmanova</a> 包处理多因素方差分析</p>
</div>
<div id="sec-kernal-smooth" class="section level2" number="26.5">
<h2>
<span class="header-section-number">26.5</span> 核学习<a class="anchor" aria-label="anchor" href="#sec-kernal-smooth"><i class="fas fa-link"></i></a>
</h2>
<p>基于核的机器学习算法 <a href="https://CRAN.R-project.org/package=kernlab">kernlab</a></p>
<p>David Meyer 基于 <a href="https://www.csie.ntu.edu.tw/~cjlin/libsvm/">libsvm</a> 开发了 <a href="https://r-forge.r-project.org/projects/e1071">e1071</a> 包，基于核方法实现了非线性回归分类算法</p>
<blockquote>
<p>线性模型、逻辑回归模型、多项逻辑回归模型、神经网络、朴素贝叶斯、分类回归树等模型和算法借助 Shiny 整合在一起 <a href="https://radiant-rstats.github.io/docs/" class="uri">https://radiant-rstats.github.io/docs/</a> 和 <a href="http://radiant-rstats.github.io/radiant.model/" class="uri">http://radiant-rstats.github.io/radiant.model/</a></p>
</blockquote>
</div>
<div id="sec-unify-machine-learning" class="section level2" number="26.6">
<h2>
<span class="header-section-number">26.6</span> 通用机器学习<a class="anchor" aria-label="anchor" href="#sec-unify-machine-learning"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:predict-functions">表 26.1: </span> R 包之间的不一致性，计算预测分类的概率的语法</caption>
<thead><tr class="header">
<th align="left">函数</th>
<th align="left">R 包</th>
<th align="left">代码</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>lda</code></td>
<td align="left"><code>MASS</code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/predict.html">predict(obj)</a></code></td>
</tr>
<tr class="even">
<td align="left"><code>glm</code></td>
<td align="left"><code>stats</code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/predict.html">predict(obj, type = "response")</a></code></td>
</tr>
<tr class="odd">
<td align="left"><code>gbm</code></td>
<td align="left"><code>gbm</code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/predict.html">predict(obj, type = "response", n.trees)</a></code></td>
</tr>
<tr class="even">
<td align="left"><code>mda</code></td>
<td align="left"><code>mda</code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/predict.html">predict(obj, type = "posterior")</a></code></td>
</tr>
<tr class="odd">
<td align="left"><code>rpart</code></td>
<td align="left"><code>rpart</code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/predict.html">predict(obj, type = "prob")</a></code></td>
</tr>
<tr class="even">
<td align="left"><code>Weka</code></td>
<td align="left"><code>RWeka</code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/predict.html">predict(obj, type = "probability")</a></code></td>
</tr>
<tr class="odd">
<td align="left"><code>logitboost</code></td>
<td align="left"><code>LogitBoost</code></td>
<td align="left"><code><a href="https://rdrr.io/r/stats/predict.html">predict(obj, type = "raw", nIter)</a></code></td>
</tr>
<tr class="even">
<td align="left"><code>pamr.train</code></td>
<td align="left"><code>pamr</code></td>
<td align="left"><code>pamr.predict(obj, type = "posterior")</code></td>
</tr>
</tbody>
</table></div>
<!-- 以这些数据样本为线索介绍数理统计概念 -->
</div>
<div id="sec-linear-model-theory" class="section level2" number="26.7">
<h2>
<span class="header-section-number">26.7</span> 理论基础<a class="anchor" aria-label="anchor" href="#sec-linear-model-theory"><i class="fas fa-link"></i></a>
</h2>
<p><span class="math display">\[\begin{align}
Y &amp;= X \beta + \epsilon \\
X^{\top}Y &amp;= X^{\top}X\beta \\
\hat{\beta} &amp;= (X^{\top}X)^{-1}X^{\top}Y \\
\hat{Y} &amp;= X(X^{\top}X)^{-1}X^{\top}Y \\
\hat{\sigma^2} &amp;= \frac{\|Y - \hat{Y}\|_2}{n - rk(X)} \\
  &amp; = \frac{\|(I - X(X^{\top}X)^{-1}X^{\top})Y\|_2}{n - rk(X)}\\
  &amp; = \frac{Y^{\top}(I - X(X^{\top}X)^{-1}X^{\top})Y}{n - rk(X)}
\end{align}\]</span></p>
</div>
<div id="sec-multivariate-multiple-linear-regression" class="section level2" number="26.8">
<h2>
<span class="header-section-number">26.8</span> 多重多元线性回归<a class="anchor" aria-label="anchor" href="#sec-multivariate-multiple-linear-regression"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>参考 John Fox 和 Sanford Weisberg 的著作<span class="citation"><a href="#ref-car_2019_Fox" role="doc-biblioref">[65]</a></span> 附录<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://socialsciences.mcmaster.ca/jfox/Books/Companion/appendices.html" class="uri"&gt;https://socialsciences.mcmaster.ca/jfox/Books/Companion/appendices.html&lt;/a&gt;&lt;/p&gt;'><sup>70</sup></a></p>
</blockquote>
<p>多个响应变量和协变量<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://data.library.virginia.edu/getting-started-with-multivariate-multiple-regression/" class="uri"&gt;https://data.library.virginia.edu/getting-started-with-multivariate-multiple-regression/&lt;/a&gt;&lt;/p&gt;'><sup>71</sup></a></p>
<p>多重多元线性回归 multiply linear regression <code>lm</code> R 版本 3.6 以上 <a href="https://bugs.r-project.org/bugzilla3/show_bug.cgi?id=17407">PR#17407</a></p>
<div class="sourceCode" id="cb2123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_mtcars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="va">qsec</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">mtcars</span>, offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">wt</span>, <span class="va">wt</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_mtcars</span><span class="op">)</span></code></pre></div>
<pre><code>## Response mpg :
## 
## Call:
## lm(formula = mpg ~ 1, data = mtcars, offset = cbind(wt, wt * 
##     2))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -11.897  -4.947  -1.316   2.984  15.192 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   16.873      1.219   13.85  8.1e-15 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 6.893 on 31 degrees of freedom
## 
## 
## Response qsec :
## 
## Call:
## lm(formula = qsec ~ 1, data = mtcars, offset = cbind(wt, wt * 
##     2))
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -4.6842 -2.0793 -0.1693  2.2693  5.1857 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11.4142     0.5076   22.49   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 2.871 on 31 degrees of freedom</code></pre>
</div>
<div id="sec-regression-diagnostics" class="section level2" number="26.9">
<h2>
<span class="header-section-number">26.9</span> 回归诊断<a class="anchor" aria-label="anchor" href="#sec-regression-diagnostics"><i class="fas fa-link"></i></a>
</h2>
<p>包括线性模型和广义线性模型</p>
<p>Regression Deletion Diagnostics <code><a href="https://rdrr.io/r/stats/influence.measures.html">?influence.measures</a></code></p>
<div class="sourceCode" id="cb2125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"anscombe"</span><span class="op">)</span>

<span class="va">form</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">'y%d ~ x%d'</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">form</span>, <span class="va">lm</span>, data <span class="op">=</span> <span class="va">anscombe</span><span class="op">)</span>

<span class="va">plot_lm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">annotate_texts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"nonlinearity"</span>, <span class="st">"outlier"</span>, <span class="st">"influential point"</span><span class="op">)</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">anscombe</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_.html">aes_string</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="va">i</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"y"</span>, <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">bold</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html">substitute</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">bold</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">b</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>b <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span>,
      title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/bquote.html">bquote</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">bold</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">==</span> <span class="fu">.</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>, x <span class="op">=</span> <span class="fl">12</span>, y <span class="op">=</span> <span class="fl">11</span>, label <span class="op">=</span> <span class="va">annotate_texts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>

<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/funprog.html">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="va">plot_lm</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:anscombe"></span>
<img src="linear-models_files/figure-html/anscombe-1.png" alt="线性模型可能在欺骗你" width="2100"><p class="caption">
图 26.1: 线性模型可能在欺骗你
</p>
</div>
</div>
<div id="sec-states" class="section level2" number="26.10">
<h2>
<span class="header-section-number">26.10</span> 1977 年美国人口普查<a class="anchor" aria-label="anchor" href="#sec-states"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb2126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">state_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">state.x77</span>, row.names <span class="op">=</span> <span class="va">state.abb</span><span class="op">)</span>
<span class="va">fit_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Life.Exp</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">state_data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_state</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Life.Exp ~ ., data = state_data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.48895 -0.51232 -0.02747  0.57002  1.49447 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  7.094e+01  1.748e+00  40.586  &lt; 2e-16 ***
## Population   5.180e-05  2.919e-05   1.775   0.0832 .  
## Income      -2.180e-05  2.444e-04  -0.089   0.9293    
## Illiteracy   3.382e-02  3.663e-01   0.092   0.9269    
## Murder      -3.011e-01  4.662e-02  -6.459 8.68e-08 ***
## HS.Grad      4.893e-02  2.332e-02   2.098   0.0420 *  
## Frost       -5.735e-03  3.143e-03  -1.825   0.0752 .  
## Area        -7.383e-08  1.668e-06  -0.044   0.9649    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.7448 on 42 degrees of freedom
## Multiple R-squared:  0.7362, Adjusted R-squared:  0.6922 
## F-statistic: 16.74 on 7 and 42 DF,  p-value: 2.534e-10</code></pre>
<div class="sourceCode" id="cb2128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># step(fit_state)</span></code></pre></div>
</div>
<div id="sec-rock" class="section level2" number="26.11">
<h2>
<span class="header-section-number">26.11</span> 石油岩石样品的测量<a class="anchor" aria-label="anchor" href="#sec-rock"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb2129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">rock</span><span class="op">)</span></code></pre></div>
<!-- 变量都是数值型的，回归方法，变量标准化与不标准化的区别 -->
<p>多元线性回归</p>
</div>
<div id="sec-swiss" class="section level2" number="26.12">
<h2>
<span class="header-section-number">26.12</span> 1888 年瑞士生育率分析<a class="anchor" aria-label="anchor" href="#sec-swiss"><i class="fas fa-link"></i></a>
</h2>
<p>1888 年，瑞士开始进入一个人口转变的阶段，从发展中国家的高出生率开始下滑。数据集 swiss 记录了 1888 年瑞士 47 个说法语的省份的生育率和社会经济指标数据，下面是数据集的部分</p>
<pre><code>##              Fertility Agriculture Examination Education Catholic
## Courtelary        80.2        17.0          15        12     9.96
## Delemont          83.1        45.1           6         9    84.84
## Franches-Mnt      92.5        39.7           5         5    93.40
## Moutier           85.8        36.5          12         7    33.77
## Neuveville        76.9        43.5          17        15     5.16
....</code></pre>
<p>Fertility（生育率，采用常见的标准生育率统计口径）、Agriculture（男性从事农业生产的比例）、Examination（应征者在军队考试中获得最高等级的比例）、Education（应征者有小学以上教育水平的比例）、Catholic（信仰天主教的比例）、Infant.Mortality（婴儿死亡率，仅考虑出生一年内死亡），各个指标都统一标准化为百分比的形式。其中，Examination 和 Education 是 1887 年、1888 年和 1889 年的平均值。瑞士 182 个地区 1888 年及其它年份的数据可从<a href="https://opr.princeton.edu/archive/pefp/switz.aspx">网站</a>获得。</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:swiss"></span>
<img src="linear-models_files/figure-html/swiss-1.png" alt="1888 年瑞士生育率和社会经济指标的关系" width="2400"><p class="caption">
图 26.2: 1888 年瑞士生育率和社会经济指标的关系
</p>
</div>
<div class="sourceCode" id="cb2131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_swiss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Fertility</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">swiss</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2132"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit_swiss</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Fertility ~ . - 1, data = swiss)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -16.8358  -6.3606  -0.5603   6.0585  23.3203 
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(&gt;|t|)    
## Agriculture       0.11100    0.07424   1.495  0.14233    
## Examination       0.44406    0.31435   1.413  0.16514    
## Education        -0.70674    0.25009  -2.826  0.00719 ** 
## Catholic          0.11707    0.04860   2.409  0.02046 *  
## Infant.Mortality  2.98366    0.31683   9.417 6.53e-12 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 9.893 on 42 degrees of freedom
## Multiple R-squared:  0.9828, Adjusted R-squared:  0.9807 
## F-statistic: 478.8 on 5 and 42 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb2134"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">fit_swiss</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Fertility
##                  Df Sum Sq Mean Sq   F value    Pr(&gt;F)    
## Agriculture       1 204039  204039 2084.6865 &lt; 2.2e-16 ***
## Examination       1  16781   16781  171.4556 &lt; 2.2e-16 ***
## Education         1     24      24    0.2454    0.6229    
## Catholic          1   4782    4782   48.8556 1.504e-08 ***
## Infant.Mortality  1   8680    8680   88.6858 6.528e-12 ***
## Residuals        42   4111      98                        
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<p>Cook 距离 <code><a href="https://rdrr.io/r/stats/plot.lm.html">?plot.lm</a></code></p>
<div class="sourceCode" id="cb2136"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit_swiss</span>, which <span class="op">=</span> <span class="fl">4</span>, sub.caption <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/fit-swiss-cook-1.png" width="2100" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">fit_swiss</span>, which <span class="op">=</span> <span class="fl">5</span>, sub.caption <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/fit-swiss-leverage-1.png" width="2100" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2138"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">swiss</span><span class="op">[</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html">names</a></span><span class="op">(</span><span class="va">swiss</span><span class="op">)</span>, <span class="st">"Fertility"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">swiss</span><span class="op">[</span>, <span class="st">"Fertility"</span><span class="op">]</span><span class="op">)</span>
<span class="co"># beta 的估计</span>
<span class="op">(</span><span class="va">beta_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">X</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##                        [,1]
## Agriculture       0.1110005
## Examination       0.4440591
## Education        -0.7067362
## Catholic          0.1170662
## Infant.Mortality  2.9836617</code></pre>
<div class="sourceCode" id="cb2140"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Y 的预测 MSE 残差平方和 </span>
<span class="va">sigma2_hat</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span> <span class="op">%*%</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">X</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">Y</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/qr-methods.html">qr</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">$</span><span class="va">rank</span><span class="op">)</span>
<span class="co"># RMSE</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">sigma2_hat</span><span class="op">)</span></code></pre></div>
<pre><code>##          [,1]
## [1,] 9.893187</code></pre>
<!-- https://github.com/graysonwhite/gglm 基于 ggplot2 的回归结果绘图 -->
</div>
<div id="sec-life-cycle-savings" class="section level2" number="26.13">
<h2>
<span class="header-section-number">26.13</span> Intercountry Life-Cycle Savings Data 1960-1970<a class="anchor" aria-label="anchor" href="#sec-life-cycle-savings"><i class="fas fa-link"></i></a>
</h2>
<!-- 线性模型 -->
<div class="sourceCode" id="cb2142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"LifeCycleSavings"</span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-longley" class="section level2" number="26.14">
<h2>
<span class="header-section-number">26.14</span> Longley’s Economic Regression Data 1947-1962<a class="anchor" aria-label="anchor" href="#sec-longley"><i class="fas fa-link"></i></a>
</h2>
<!-- 多重共线性问题 1947-1962 -->
<div class="sourceCode" id="cb2143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"longley"</span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-Formaldehyde" class="section level2" number="26.15">
<h2>
<span class="header-section-number">26.15</span> 甲醛的测定<a class="anchor" aria-label="anchor" href="#sec-Formaldehyde"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb2144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Formaldehyde</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carb</span>, y <span class="op">=</span> <span class="va">optden</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-16-1.png" width="2100" style="display: block; margin: auto;"></div>
</div>
<div id="sec-morley" class="section level2" number="26.16">
<h2>
<span class="header-section-number">26.16</span> 迈克尔逊光速数据分析<a class="anchor" aria-label="anchor" href="#sec-morley"><i class="fas fa-link"></i></a>
</h2>
<!-- 重复测量数据：试验设计的巧妙 -->
<p>1879 年迈克尔逊光速测量数据，记录了五次实验，每次试验测量 20 次光速，得到表格 <a href="chap-linear-models.html#tab:morley-data">26.2</a></p>
<div class="sourceCode" id="cb2145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">morley</span>, v.names <span class="op">=</span> <span class="st">"Speed"</span>, idvar <span class="op">=</span> <span class="st">"Expt"</span>,
  timevar <span class="op">=</span> <span class="st">"Run"</span>, direction <span class="op">=</span> <span class="st">"wide"</span>, sep <span class="op">=</span> <span class="st">""</span>
<span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">.</span>,
    caption <span class="op">=</span> <span class="st">"迈克尔逊光速数据"</span>,
    row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"(Speed)"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,
    align <span class="op">=</span> <span class="st">"c"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:morley-data">表 26.2: </span>迈克尔逊光速数据</caption>
<thead><tr class="header">
<th align="center">Expt</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th align="center">7</th>
<th align="center">8</th>
<th align="center">9</th>
<th align="center">10</th>
<th align="center">11</th>
<th align="center">12</th>
<th align="center">13</th>
<th align="center">14</th>
<th align="center">15</th>
<th align="center">16</th>
<th align="center">17</th>
<th align="center">18</th>
<th align="center">19</th>
<th align="center">20</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">850</td>
<td align="center">740</td>
<td align="center">900</td>
<td align="center">1070</td>
<td align="center">930</td>
<td align="center">850</td>
<td align="center">950</td>
<td align="center">980</td>
<td align="center">980</td>
<td align="center">880</td>
<td align="center">1000</td>
<td align="center">980</td>
<td align="center">930</td>
<td align="center">650</td>
<td align="center">760</td>
<td align="center">810</td>
<td align="center">1000</td>
<td align="center">1000</td>
<td align="center">960</td>
<td align="center">960</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">960</td>
<td align="center">940</td>
<td align="center">960</td>
<td align="center">940</td>
<td align="center">880</td>
<td align="center">800</td>
<td align="center">850</td>
<td align="center">880</td>
<td align="center">900</td>
<td align="center">840</td>
<td align="center">830</td>
<td align="center">790</td>
<td align="center">810</td>
<td align="center">880</td>
<td align="center">880</td>
<td align="center">830</td>
<td align="center">800</td>
<td align="center">790</td>
<td align="center">760</td>
<td align="center">800</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">880</td>
<td align="center">880</td>
<td align="center">880</td>
<td align="center">860</td>
<td align="center">720</td>
<td align="center">720</td>
<td align="center">620</td>
<td align="center">860</td>
<td align="center">970</td>
<td align="center">950</td>
<td align="center">880</td>
<td align="center">910</td>
<td align="center">850</td>
<td align="center">870</td>
<td align="center">840</td>
<td align="center">840</td>
<td align="center">850</td>
<td align="center">840</td>
<td align="center">840</td>
<td align="center">840</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">890</td>
<td align="center">810</td>
<td align="center">810</td>
<td align="center">820</td>
<td align="center">800</td>
<td align="center">770</td>
<td align="center">760</td>
<td align="center">740</td>
<td align="center">750</td>
<td align="center">760</td>
<td align="center">910</td>
<td align="center">920</td>
<td align="center">890</td>
<td align="center">860</td>
<td align="center">880</td>
<td align="center">720</td>
<td align="center">840</td>
<td align="center">850</td>
<td align="center">850</td>
<td align="center">780</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">890</td>
<td align="center">840</td>
<td align="center">780</td>
<td align="center">810</td>
<td align="center">760</td>
<td align="center">810</td>
<td align="center">790</td>
<td align="center">810</td>
<td align="center">820</td>
<td align="center">850</td>
<td align="center">870</td>
<td align="center">870</td>
<td align="center">810</td>
<td align="center">740</td>
<td align="center">810</td>
<td align="center">940</td>
<td align="center">950</td>
<td align="center">800</td>
<td align="center">810</td>
<td align="center">870</td>
</tr>
</tbody>
</table></div>
<p>数据集 morley 中光速 Speed 已经编码过了，原始观测速度减去了 299000 (km/sec)，为了展示方便</p>
<div class="sourceCode" id="cb2146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">morley</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Expt</span>, y <span class="op">=</span> <span class="va">Speed</span>, group <span class="op">=</span> <span class="va">Expt</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Expt"</span>, y <span class="op">=</span> <span class="st">"Speed (km/sec)"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:morley"></span>
<img src="linear-models_files/figure-html/morley-1.png" alt="1879 年迈克尔逊光速实验数据" width="2100"><p class="caption">
图 26.3: 1879 年迈克尔逊光速实验数据
</p>
</div>
</div>
<div id="sec-chickwts" class="section level2" number="26.17">
<h2>
<span class="header-section-number">26.17</span> 不同喂食方式对小鸡体重的影响 I<a class="anchor" aria-label="anchor" href="#sec-chickwts"><i class="fas fa-link"></i></a>
</h2>
<!-- 6 种喂食方式对小鸡体重的影响 -->
<div class="sourceCode" id="cb2147"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">chickwts</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">feed</span>, y <span class="op">=</span> <span class="va">weight</span>, color <span class="op">=</span> <span class="va">feed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chickwts"></span>
<img src="linear-models_files/figure-html/chickwts-1.png" alt="不同喂食方式对小鸡的影响" width="2100"><p class="caption">
图 26.4: 不同喂食方式对小鸡的影响
</p>
</div>
</div>
<div id="sec-ChickWeight" class="section level2" number="26.18">
<h2>
<span class="header-section-number">26.18</span> 不同喂食方式对小鸡体重的影响 II<a class="anchor" aria-label="anchor" href="#sec-ChickWeight"><i class="fas fa-link"></i></a>
</h2>
<!-- 4 种喂食方式，喂食方式会对小鸡体重有影响，每个小鸡本身对喂食方式的接受、吸收程度不一样、它们本身的素质不一样（个体差异），要考察喂食的方式的影响，应该剔除掉个体差异，才是喂食方式的真正的影响 -->
<div class="sourceCode" id="cb2148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ChickWeight</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">weight</span>, group <span class="op">=</span> <span class="va">Chick</span>, color <span class="op">=</span> <span class="va">Diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Diet</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-17-1.png" width="2100" style="display: block; margin: auto;"></div>
<p>添加趋势线</p>
<div class="sourceCode" id="cb2149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ChickWeight</span>, 
       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">weight</span>, group <span class="op">=</span> <span class="va">Diet</span>, colour <span class="op">=</span> <span class="va">Diet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Diet</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_summary.html">stat_summary</a></span><span class="op">(</span>fun <span class="op">=</span> <span class="st">"mean"</span>, geom <span class="op">=</span> <span class="st">"line"</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Chick Weight over Time by Diet"</span>,
    x <span class="op">=</span> <span class="st">"Time (days)"</span>,
    y <span class="op">=</span> <span class="st">"Weight (grams)"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-18-1.png" width="2100" style="display: block; margin: auto;"></div>
</div>
<div id="sec-DNase" class="section level2" number="26.19">
<h2>
<span class="header-section-number">26.19</span> 酶的酶联免疫吸附测定<a class="anchor" aria-label="anchor" href="#sec-DNase"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb2150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DNase</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">conc</span>,y<span class="op">=</span> <span class="va">density</span>, color <span class="op">=</span> <span class="va">Run</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-19-1.png" width="2100" style="display: block; margin: auto;"></div>
</div>
<div id="sec-BirthWeight" class="section level2" number="26.20">
<h2>
<span class="header-section-number">26.20</span> 婴儿的体重随年龄的变化情况<a class="anchor" aria-label="anchor" href="#sec-BirthWeight"><i class="fas fa-link"></i></a>
</h2>
<p>BirthWeight 数据集记录了婴儿的体重随年龄的变化情况，年龄以周为单位计，体重以克为单位计</p>
<p><img src="linear-models_files/figure-html/Birth-Weight-1.png" width="2100" style="display: block; margin: auto;"><img src="linear-models_files/figure-html/Birth-Weight-2.png" width="2100" style="display: block; margin: auto;"></p>
<p>性别和年龄两个变量，分别是离散型的分类变量和连续型的变量</p>
<div class="sourceCode" id="cb2151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 带截距项和不带截距项</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">birthw</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span><span class="op">)</span>, correlation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = birthw ~ sex + age)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -257.49 -125.28  -58.44  169.00  303.98 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1610.28     786.08  -2.049   0.0532 .  
## sexF         -163.04      72.81  -2.239   0.0361 *  
## age           120.89      20.46   5.908 7.28e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 177.1 on 21 degrees of freedom
## Multiple R-squared:   0.64,  Adjusted R-squared:  0.6057 
## F-statistic: 18.67 on 2 and 21 DF,  p-value: 2.194e-05
## 
## Correlation of Coefficients:
##      (Intercept) sexF 
## sexF  0.07            
## age  -1.00       -0.12</code></pre>
<div class="sourceCode" id="cb2153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">l1</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: birthw
##           Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
## sex        1   76163   76163  2.4279    0.1341    
## age        1 1094940 1094940 34.9040 7.284e-06 ***
## Residuals 21  658771   31370                      
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
<div class="sourceCode" id="cb2155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 与带交互项的模型比较</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">li</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">birthw</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span><span class="op">)</span>, correlation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = birthw ~ sex + sex:age)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -246.69 -138.11  -39.13  176.57  274.28 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1268.67    1114.64  -1.138 0.268492    
## sexF         -872.99    1611.33  -0.542 0.593952    
## sexM:age      111.98      29.05   3.855 0.000986 ***
## sexF:age      130.40      30.00   4.347 0.000313 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 180.6 on 20 degrees of freedom
## Multiple R-squared:  0.6435, Adjusted R-squared:   0.59 
## F-statistic: 12.03 on 3 and 20 DF,  p-value: 0.000101
## 
## Correlation of Coefficients:
##          (Intercept) sexF  sexM:age
## sexF     -0.69                     
## sexM:age -1.00        0.69         
## sexF:age  0.00       -0.72  0.00</code></pre>
<div class="sourceCode" id="cb2157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">li</span>, <span class="va">l1</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: birthw ~ sex + sex:age
## Model 2: birthw ~ sex + age
##   Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
## 1     20 652425                           
## 2     21 658771 -1   -6346.2 0.1945 0.6639</code></pre>
<div class="sourceCode" id="cb2159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 类似，只是使用 glm 命令来拟合而已</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">zi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">birthw</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = birthw ~ sex + age, family = gaussian())
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -257.49  -125.28   -58.44   169.00   303.98  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1610.28     786.08  -2.049   0.0532 .  
## sexF         -163.04      72.81  -2.239   0.0361 *  
## age           120.89      20.46   5.908 7.28e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 31370.04)
## 
##     Null deviance: 1829873  on 23  degrees of freedom
## Residual deviance:  658771  on 21  degrees of freedom
## AIC: 321.39
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<div class="sourceCode" id="cb2161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">zi</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model: gaussian, link: identity
## 
## Response: birthw
## 
## Terms added sequentially (first to last)
## 
## 
##      Df Deviance Resid. Df Resid. Dev
## NULL                    23    1829873
## sex   1    76163        22    1753711
## age   1  1094940        21     658771</code></pre>
<div class="sourceCode" id="cb2163"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summary(z.o4 &lt;- update(zi, subset = -4))</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">zz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/update.dev.pkg.html">update</a></span><span class="op">(</span><span class="va">zi</span>, <span class="va">birthw</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = birthw ~ sex + age + sex:age, family = gaussian())
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -246.69  -138.11   -39.13   176.57   274.28  
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1268.67    1114.64  -1.138 0.268492    
## sexF         -872.99    1611.33  -0.542 0.593952    
## age           111.98      29.05   3.855 0.000986 ***
## sexF:age       18.42      41.76   0.441 0.663893    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for gaussian family taken to be 32621.23)
## 
##     Null deviance: 1829873  on 23  degrees of freedom
## Residual deviance:  652425  on 20  degrees of freedom
## AIC: 323.16
## 
## Number of Fisher Scoring iterations: 2</code></pre>
<div class="sourceCode" id="cb2165"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">zi</span>, <span class="va">zz</span><span class="op">)</span></code></pre></div>
<pre><code>## Analysis of Deviance Table
## 
## Model 1: birthw ~ sex + age
## Model 2: birthw ~ sex + age + sex:age
##   Resid. Df Resid. Dev Df Deviance
## 1        21     658771            
## 2        20     652425  1   6346.2</code></pre>
</div>
<div id="sec-loblolly" class="section level2" number="26.21">
<h2>
<span class="header-section-number">26.21</span> 火炬松树的生长情况<a class="anchor" aria-label="anchor" href="#sec-loblolly"><i class="fas fa-link"></i></a>
</h2>
<p>表 <a href="chap-linear-models.html#tab:loblolly-data">26.3</a> 记录了 14 颗火炬树种子的生长情况</p>
<div class="sourceCode" id="cb2167"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span><span class="va">Loblolly</span>, idvar <span class="op">=</span> <span class="st">"Seed"</span>, timevar <span class="op">=</span> <span class="st">"age"</span>,
        v.names <span class="op">=</span> <span class="st">"height"</span>, direction <span class="op">=</span> <span class="st">"wide"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">.</span>,
    caption <span class="op">=</span> <span class="st">"火炬松树的高度（英尺）随时间（年）的变化"</span>,
    row.names <span class="op">=</span> <span class="cn">FALSE</span>, col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"(height)"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span>,
    align <span class="op">=</span> <span class="st">"c"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:loblolly-data">表 26.3: </span>火炬松树的高度（英尺）随时间（年）的变化</caption>
<thead><tr class="header">
<th align="center">Seed</th>
<th align="center">3</th>
<th align="center">5</th>
<th align="center">10</th>
<th align="center">15</th>
<th align="center">20</th>
<th align="center">25</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">301</td>
<td align="center">4.51</td>
<td align="center">10.89</td>
<td align="center">28.72</td>
<td align="center">41.74</td>
<td align="center">52.70</td>
<td align="center">60.92</td>
</tr>
<tr class="even">
<td align="center">303</td>
<td align="center">4.55</td>
<td align="center">10.92</td>
<td align="center">29.07</td>
<td align="center">42.83</td>
<td align="center">53.88</td>
<td align="center">63.39</td>
</tr>
<tr class="odd">
<td align="center">305</td>
<td align="center">4.79</td>
<td align="center">11.37</td>
<td align="center">30.21</td>
<td align="center">44.40</td>
<td align="center">55.82</td>
<td align="center">64.10</td>
</tr>
<tr class="even">
<td align="center">307</td>
<td align="center">3.91</td>
<td align="center">9.48</td>
<td align="center">25.66</td>
<td align="center">39.07</td>
<td align="center">50.78</td>
<td align="center">59.07</td>
</tr>
<tr class="odd">
<td align="center">309</td>
<td align="center">4.81</td>
<td align="center">11.20</td>
<td align="center">28.66</td>
<td align="center">41.66</td>
<td align="center">53.31</td>
<td align="center">63.05</td>
</tr>
<tr class="even">
<td align="center">311</td>
<td align="center">3.88</td>
<td align="center">9.40</td>
<td align="center">25.99</td>
<td align="center">39.55</td>
<td align="center">51.46</td>
<td align="center">59.64</td>
</tr>
<tr class="odd">
<td align="center">315</td>
<td align="center">4.32</td>
<td align="center">10.43</td>
<td align="center">27.16</td>
<td align="center">40.85</td>
<td align="center">51.33</td>
<td align="center">60.07</td>
</tr>
<tr class="even">
<td align="center">319</td>
<td align="center">4.57</td>
<td align="center">10.57</td>
<td align="center">27.90</td>
<td align="center">41.13</td>
<td align="center">52.43</td>
<td align="center">60.69</td>
</tr>
<tr class="odd">
<td align="center">321</td>
<td align="center">3.77</td>
<td align="center">9.03</td>
<td align="center">25.45</td>
<td align="center">38.98</td>
<td align="center">49.76</td>
<td align="center">60.28</td>
</tr>
<tr class="even">
<td align="center">323</td>
<td align="center">4.33</td>
<td align="center">10.79</td>
<td align="center">28.97</td>
<td align="center">42.44</td>
<td align="center">53.17</td>
<td align="center">61.62</td>
</tr>
<tr class="odd">
<td align="center">325</td>
<td align="center">4.38</td>
<td align="center">10.48</td>
<td align="center">27.93</td>
<td align="center">40.20</td>
<td align="center">50.06</td>
<td align="center">58.49</td>
</tr>
<tr class="even">
<td align="center">327</td>
<td align="center">4.12</td>
<td align="center">9.92</td>
<td align="center">26.54</td>
<td align="center">37.82</td>
<td align="center">48.43</td>
<td align="center">56.81</td>
</tr>
<tr class="odd">
<td align="center">329</td>
<td align="center">3.93</td>
<td align="center">9.34</td>
<td align="center">26.08</td>
<td align="center">37.79</td>
<td align="center">48.31</td>
<td align="center">56.43</td>
</tr>
<tr class="even">
<td align="center">331</td>
<td align="center">3.46</td>
<td align="center">9.05</td>
<td align="center">25.85</td>
<td align="center">39.15</td>
<td align="center">49.12</td>
<td align="center">59.49</td>
</tr>
</tbody>
</table></div>
<p>图 <a href="chap-linear-models.html#fig:loblolly-tree">26.5</a> 火炬树种子基本决定了树的长势，不同种子预示最后的高度，并且在生长期也是很稳定地生长</p>
<div class="sourceCode" id="cb2168"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Loblolly</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">height</span>, color <span class="op">=</span> <span class="va">Seed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"age (yr)"</span>, y <span class="op">=</span> <span class="st">"height (ft)"</span><span class="op">)</span>
<span class="va">p</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:loblolly-tree"></span>
<img src="linear-models_files/figure-html/loblolly-tree-1.png" alt="不同火炬树的生长情况" width="2100"><p class="caption">
图 26.5: 不同火炬树的生长情况
</p>
</div>
<div class="sourceCode" id="cb2169"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span>
<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://gganimate.com/reference/transition_reveal.html">transition_reveal</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-20-1.gif" style="display: block; margin: auto;"></div>
</div>
<div id="sec-Puromycin" class="section level2" number="26.22">
<h2>
<span class="header-section-number">26.22</span> 酶促反应的反应速率<a class="anchor" aria-label="anchor" href="#sec-Puromycin"><i class="fas fa-link"></i></a>
</h2>
<p>Puromycin 酶促反应的反应速度，模型拟合 <code><a href="https://rdrr.io/r/stats/SSmicmen.html">?SSmicmen</a></code></p>
<div class="sourceCode" id="cb2170"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Puromycin</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">conc</span>, y <span class="op">=</span> <span class="va">rate</span>, color <span class="op">=</span> <span class="va">state</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Substrate concentration (ppm)"</span>,
    y <span class="op">=</span> <span class="st">"Reaction velocity (counts/min/min)"</span>,
    title <span class="op">=</span> <span class="st">"Puromycin data and fitted Michaelis-Menten curves"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-21-1.png" width="2100" style="display: block; margin: auto;"></div>
</div>
<div id="sec-Theoph" class="section level2" number="26.23">
<h2>
<span class="header-section-number">26.23</span> 茶碱的药代动力学<a class="anchor" aria-label="anchor" href="#sec-Theoph"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb2171"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Theoph</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">conc</span>, color <span class="op">=</span> <span class="va">Subject</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="va">Wt</span> <span class="op">~</span> <span class="va">Dose</span>, ncol <span class="op">=</span> <span class="fl">3</span>, labeller <span class="op">=</span> <span class="st">"label_both"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Time since drug administration (hr)"</span>,
    y <span class="op">=</span> <span class="st">"Theophylline concentration (mg/L)"</span>,
    title <span class="op">=</span> <span class="st">"Observed concentrations and fitted model"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-22-1.png" width="2100" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2172"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Theoph</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/transform.data.table.html">transform</a></span><span class="op">(</span><span class="va">.</span>, wt_dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">Wt</span>, <span class="va">Dose</span>, sep <span class="op">=</span> <span class="st">"~"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">conc</span>, color <span class="op">=</span> <span class="va">wt_dose</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Time since drug administration (hr)"</span>,
    y <span class="op">=</span> <span class="st">"Theophylline concentration (mg/L)"</span>,
    title <span class="op">=</span> <span class="st">"Observed concentrations and fitted model"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-23-1.png" width="2100" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb2173"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">Theoph</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">conc</span>, color <span class="op">=</span> <span class="va">Subject</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Time since drug administration (hr)"</span>,
    y <span class="op">=</span> <span class="st">"Theophylline concentration (mg/L)"</span>,
    title <span class="op">=</span> <span class="st">"Observed concentrations and fitted model"</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="linear-models_files/figure-html/unnamed-chunk-24-1.png" width="2100" style="display: block; margin: auto;"></div>
</div>
<div id="sec-linear-model-summary" class="section level2" number="26.24">
<h2>
<span class="header-section-number">26.24</span> 本章总结<a class="anchor" aria-label="anchor" href="#sec-linear-model-summary"><i class="fas fa-link"></i></a>
</h2>
<p>模型永远没完，总是需要自己去构造符合自己需求的模型及其实现，只有自己能够实现，才能在海洋中遨游</p>
<blockquote>
<p>This is a bit like asking how should I tweak my sailboat so I can explore the ocean floor.</p>
<p>— Roger Koenker <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://stat.ethz.ch/pipermail/r-help/2013-May/354311.html" class="uri"&gt;https://stat.ethz.ch/pipermail/r-help/2013-May/354311.html&lt;/a&gt;&lt;/p&gt;'><sup>72</sup></a></p>
</blockquote>
</div>
<div id="sec-linear-model-sessioninfo" class="section level2" number="26.25">
<h2>
<span class="header-section-number">26.25</span> 运行环境<a class="anchor" aria-label="anchor" href="#sec-linear-model-sessioninfo"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb2174"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.1.1 (2021-08-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.3 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] patchwork_1.1.1 gganimate_1.0.7 ggplot2_3.3.5   magrittr_2.0.1 
## 
## loaded via a namespace (and not attached):
##  [1] progress_1.2.2    tidyselect_1.1.1  xfun_0.26         bslib_0.3.1      
##  [5] purrr_0.3.4       lattice_0.20-45   splines_4.1.1     colorspace_2.0-2 
##  [9] vctrs_0.3.8       generics_0.1.0    htmltools_0.5.2   viridisLite_0.4.0
## [13] mgcv_1.8-38       yaml_2.2.1        utf8_1.2.2        rlang_0.4.11     
## [17] jquerylib_0.1.4   pillar_1.6.3      glue_1.4.2        withr_2.4.2      
## [21] DBI_1.1.1         tweenr_1.0.2      lifecycle_1.0.1   stringr_1.4.0    
## [25] munsell_0.5.0     gtable_0.3.0      evaluate_0.14     labeling_0.4.2   
## [29] knitr_1.36        fastmap_1.1.0     curl_4.3.2        fansi_0.5.0      
## [33] gifski_1.4.3-1    highr_0.9         Rcpp_1.0.7        scales_1.1.1     
## [37] jsonlite_1.7.2    farver_2.1.0      fs_1.5.0          hms_1.1.1        
## [41] digest_0.6.28     stringi_1.7.5     bookdown_0.24     dplyr_1.0.7      
## [45] grid_4.1.1        tools_4.1.1       sass_0.4.0        tibble_3.1.5     
## [49] crayon_1.4.1      pkgconfig_2.0.3   downlit_0.2.1     Matrix_1.3-4     
## [53] ellipsis_0.3.2    xml2_1.3.2        prettyunits_1.1.1 assertthat_0.2.1 
## [57] rmarkdown_2.11    R6_2.5.1          nlme_3.1-153      compiler_4.1.1</code></pre>

</div>
</div>
<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-car_2019_Fox" class="csl-entry">
<div class="csl-left-margin">[65] </div>
<div class="csl-right-inline">J. Fox and S. Weisberg, <em>An <span>R</span> companion to applied regression</em>, Third. Thousand Oaks <span>CA</span>: Sage, 2019.Available: <a href="https://socialsciences.mcmaster.ca/jfox/Books/Companion/">https://socialsciences.mcmaster.ca/jfox/Books/Companion/</a>
</div>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chap-statistical-models.html">介绍</a></div>
<div class="next"><a href="chap-generalized-linear-models.html"><span class="header-section-number">27</span> 广义线性模型</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-linear-models"><span class="header-section-number">26</span> 线性模型</a></li>
<li><a class="nav-link" href="#sec-anova"><span class="header-section-number">26.1</span> 方差分析</a></li>
<li><a class="nav-link" href="#sec-one-way-anova"><span class="header-section-number">26.2</span> 单因素方差分析</a></li>
<li><a class="nav-link" href="#sec-two-way-anova"><span class="header-section-number">26.3</span> 双因素方差分析</a></li>
<li><a class="nav-link" href="#sec-manova"><span class="header-section-number">26.4</span> 多因素方差分析</a></li>
<li><a class="nav-link" href="#sec-kernal-smooth"><span class="header-section-number">26.5</span> 核学习</a></li>
<li><a class="nav-link" href="#sec-unify-machine-learning"><span class="header-section-number">26.6</span> 通用机器学习</a></li>
<li><a class="nav-link" href="#sec-linear-model-theory"><span class="header-section-number">26.7</span> 理论基础</a></li>
<li><a class="nav-link" href="#sec-multivariate-multiple-linear-regression"><span class="header-section-number">26.8</span> 多重多元线性回归</a></li>
<li><a class="nav-link" href="#sec-regression-diagnostics"><span class="header-section-number">26.9</span> 回归诊断</a></li>
<li><a class="nav-link" href="#sec-states"><span class="header-section-number">26.10</span> 1977 年美国人口普查</a></li>
<li><a class="nav-link" href="#sec-rock"><span class="header-section-number">26.11</span> 石油岩石样品的测量</a></li>
<li><a class="nav-link" href="#sec-swiss"><span class="header-section-number">26.12</span> 1888 年瑞士生育率分析</a></li>
<li><a class="nav-link" href="#sec-life-cycle-savings"><span class="header-section-number">26.13</span> Intercountry Life-Cycle Savings Data 1960-1970</a></li>
<li><a class="nav-link" href="#sec-longley"><span class="header-section-number">26.14</span> Longley’s Economic Regression Data 1947-1962</a></li>
<li><a class="nav-link" href="#sec-Formaldehyde"><span class="header-section-number">26.15</span> 甲醛的测定</a></li>
<li><a class="nav-link" href="#sec-morley"><span class="header-section-number">26.16</span> 迈克尔逊光速数据分析</a></li>
<li><a class="nav-link" href="#sec-chickwts"><span class="header-section-number">26.17</span> 不同喂食方式对小鸡体重的影响 I</a></li>
<li><a class="nav-link" href="#sec-ChickWeight"><span class="header-section-number">26.18</span> 不同喂食方式对小鸡体重的影响 II</a></li>
<li><a class="nav-link" href="#sec-DNase"><span class="header-section-number">26.19</span> 酶的酶联免疫吸附测定</a></li>
<li><a class="nav-link" href="#sec-BirthWeight"><span class="header-section-number">26.20</span> 婴儿的体重随年龄的变化情况</a></li>
<li><a class="nav-link" href="#sec-loblolly"><span class="header-section-number">26.21</span> 火炬松树的生长情况</a></li>
<li><a class="nav-link" href="#sec-Puromycin"><span class="header-section-number">26.22</span> 酶促反应的反应速率</a></li>
<li><a class="nav-link" href="#sec-Theoph"><span class="header-section-number">26.23</span> 茶碱的药代动力学</a></li>
<li><a class="nav-link" href="#sec-linear-model-summary"><span class="header-section-number">26.24</span> 本章总结</a></li>
<li><a class="nav-link" href="#sec-linear-model-sessioninfo"><span class="header-section-number">26.25</span> 运行环境</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/masr/blob/devel/linear-models.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/masr/edit/devel/linear-models.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>现代应用统计与 R 语言</strong>: Modern Applied Statistics with R" was written by 黄湘云. It was last built on 2021-10-20.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
