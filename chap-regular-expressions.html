<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 5 章 正则表达式 | R 语言学习笔记</title>
<meta name="author" content="黄湘云">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="第 5 章 正则表达式 | R 语言学习笔记">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 5 章 正则表达式 | R 语言学习笔记">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content='Douglas Bates: If you really want to be cautious you could use an octal representation like sep="\\007" to get a character that is very unlikely to occur in a factor level. Ed L. Cashin: I...'>
<meta property="og:description" content='Douglas Bates: If you really want to be cautious you could use an octal representation like sep="\\007" to get a character that is very unlikely to occur in a factor level. Ed L. Cashin: I...'>
<meta name="twitter:description" content='Douglas Bates: If you really want to be cautious you could use an octal representation like sep="\\007" to get a character that is very unlikely to occur in a factor level. Ed L. Cashin: I...'>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R 语言学习笔记</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="active" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">统计计算</li>
<li><a class="" href="chap-statistical-computation.html">介绍</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">13</span> 数值优化</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/notesdown">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-regular-expressions" class="section level1" number="5">
<h1>
<span class="header-section-number">第 5 章</span> 正则表达式<a class="anchor" aria-label="anchor" href="#chap-regular-expressions"><i class="fas fa-link"></i></a>
</h1>
<blockquote>
<p>Douglas Bates: If you really want to be cautious you could use an octal
representation like <code>sep="\\007"</code> to get a character that is very unlikely to
occur in a factor level.</p>
<p>Ed L. Cashin: I definitely want to be cautious. Instead of the bell character
I think I’ll use the field separator character, <code>"\\034"</code>, just because this is
the first time I’ve been able to use it for it’s intended purpose! ;)</p>
<p>Douglas Bates: Yes, but with <code>"\\034"</code> you don’t get to make obscure James Bond
references :-)</p>
<p>— Douglas Bates and Ed L. Cashin
R-help (April 2004)</p>
</blockquote>
<p>维基百科关于 <a href="https://www.wikiwand.com/en/Regular_expression">正则表达式的描述</a>， <a href="https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md">学习正则表达式</a></p>
<div class="sourceCode" id="cb599"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 毒鸡汤用来做文本分析</span>
<span class="co"># https://github.com/egotong/nows/blob/master/soul.sql</span></code></pre></div>
<p>R 内置的三种匹配模式</p>
<ol style="list-style-type: decimal">
<li>
<code>fixed = TRUE</code>: 字面意思匹配 exact matching.</li>
<li>
<code>perl = TRUE</code>: 使用 Perl 正则表达式.</li>
<li>
<code>fixed = FALSE, perl = FALSE</code>: 使用 POSIX 1003.2 extended 正则表达式 (默认设置).</li>
</ol>
<p>不要拘泥于一种解决方案，比如清理数据中正则表达式有 Base R 提供的一套，stringr 又一套，提高效率的工具 RStudio 插件 <a href="https://github.com/gadenbuie/regexplain">regexplain</a> 和辅助创建正则表达式 <a href="https://github.com/VerbalExpressions/RVerbalExpressions">RVerbalExpressions</a> 包。</p>
<p>有几个名词需要单独拎出来解释的</p>
<ul>
<li>literal character strings 字面字符串</li>
<li>metacharacters 元字符</li>
<li>extended regular expressions 在下文中约定翻译为默认正则表达式</li>
<li>character class 字符集 <code>[abc]</code>
</li>
<li>Perl-like regular expressions Perl 风格的正则表达式</li>
</ul>
<p>以下所述，都不考虑函数中参数 <code>perl=TRUE</code> 的情况，R 语言中提供了扩展的（默认的）和 Perl 风格 的两套正则表达式。作为入门，我们这里只关注前者，启用 Perl 正则表达式只需在函数如 <code>grep</code> 中将选项 <code>perl = TRUE</code> 即可，并将后者统一命名为 Perl 正则表达式<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;推荐的学习正则表达式的路径可以见统计之都论坛 &lt;a href="https://d.cosx.org/d/420410" class="uri"&gt;https://d.cosx.org/d/420410&lt;/a&gt;&lt;/p&gt;'><sup>18</sup></a>。</p>
<p>正则表达式 (<strong>reg</strong>ular <strong>exp</strong>ression，简称 regexp)， 函数 <code>regexpr</code> 和 <code>gregexpr</code> 的名称就好理解了，在控制台输入 <code><a href="https://stringr.tidyverse.org/reference/modifiers.html">?regex</a></code> 查看 R 支持的正则表达式，这个文档看上百八十回也不过分。R 内支持正则表达式的函数有 <code>grep</code>、<code>grepl</code>、<code>sub</code>、<code>gsub</code>、<code>regexpr</code>、<code>gregexpr</code> 、 <code>regexec</code> 和 <code>strsplit</code>。函数 <code>apropos</code>，<code>browseEnv</code>，<code>help.search</code>，<code>list.files</code> 和 <code>ls</code> 是通过函数 <code>grep</code> 来使用正则表达式的，它们全都使用 extended regular expressions</p>
<div class="sourceCode" id="cb600"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">x</span>, ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, perl <span class="op">=</span> <span class="cn">FALSE</span>, value <span class="op">=</span> <span class="cn">FALSE</span>,
     fixed <span class="op">=</span> <span class="cn">FALSE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span>, invert <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>匹配模式 pattern 的内容 可以用函数 <code>cat</code> 打印出来，注意反斜杠进入 R 字符串中时，需要用两个，反斜杠 <code>\</code> 本身是转义符，否则会报错。</p>
<div class="sourceCode" id="cb601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\\"</span><span class="op">)</span> <span class="co"># \ 反斜杠是转义字符</span></code></pre></div>
<pre><code>## \</code></pre>
<div class="sourceCode" id="cb603"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\\."</span><span class="op">)</span></code></pre></div>
<pre><code>## \.</code></pre>
<div class="sourceCode" id="cb605"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\\\n"</span><span class="op">)</span> <span class="co"># 注意 \n 表示换行</span></code></pre></div>
<pre><code>## \</code></pre>
<div id="character-constants" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> 字符常量<a class="anchor" aria-label="anchor" href="#character-constants"><i class="fas fa-link"></i></a>
</h2>
<p>单引号 <code>'</code> 双引号 <code>"</code> 和反引号 ` 三种类型的引用 (quotes) 是 R 语法的一部分<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/Quotes.html" class="uri"&gt;https://stat.ethz.ch/R-manual/R-devel/library/base/html/Quotes.html&lt;/a&gt;&lt;/p&gt;'><sup>19</sup></a>，此外反斜杠 <code>\</code> 用来转义下面的字符</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:character-constants">表 5.1: </span> 字符常量表</caption>
<thead><tr class="header">
<th align="left">字符常量</th>
<th align="left">含义</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>\n</code></td>
<td align="left">换行 newline</td>
</tr>
<tr class="even">
<td align="left"><code>\r</code></td>
<td align="left">回车 carriage return</td>
</tr>
<tr class="odd">
<td align="left"><code>\t</code></td>
<td align="left">制表符 tab</td>
</tr>
<tr class="even">
<td align="left"><code>\b</code></td>
<td align="left">退格 backspace</td>
</tr>
<tr class="odd">
<td align="left"><code>\a</code></td>
<td align="left">警报（铃）alert (bell)</td>
</tr>
<tr class="even">
<td align="left"><code>\f</code></td>
<td align="left">换页 form feed</td>
</tr>
<tr class="odd">
<td align="left"><code>\v</code></td>
<td align="left">垂直制表符 vertical tab</td>
</tr>
<tr class="even">
<td align="left"><code>\\</code></td>
<td align="left">反斜杠 backslash <code>\</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>\'</code></td>
<td align="left">单引号 ASCII apostrophe <code>'</code>
</td>
</tr>
<tr class="even">
<td align="left"><code>\"</code></td>
<td align="left">双引号 ASCII quotation mark <code>"</code>
</td>
</tr>
<tr class="odd">
<td align="left"><code>\`</code></td>
<td align="left">反引号或沉音符 ASCII grave accent (backtick) `</td>
</tr>
<tr class="even">
<td align="left"><code>\nnn</code></td>
<td align="left">八进制 character with given octal code (1, 2 or 3 digits)</td>
</tr>
<tr class="odd">
<td align="left"><code>\xnn</code></td>
<td align="left">十六进制 character with given hex code (1 or 2 hex digits)</td>
</tr>
<tr class="even">
<td align="left"><code>\unnnn</code></td>
<td align="left">Unicode character with given code (1–4 hex digits)</td>
</tr>
<tr class="odd">
<td align="left"><code>\Unnnnnnnn</code></td>
<td align="left">Unicode character with given code (1–8 hex digits)</td>
</tr>
</tbody>
</table></div>
</div>
<div id="environments" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> 软件环境<a class="anchor" aria-label="anchor" href="#environments"><i class="fas fa-link"></i></a>
</h2>
<p>R 内置的正则表达式实现是基于 PCRE ICU TRE iconv 等第三方库，搞清楚自己使用的版本信息是重要的，一些字符集的解释与区域环境有关，如 <code>[:alnum:]</code> 和 <code>[:alpha:]</code>等，所以获取当前的区域设置也很重要</p>
<div class="sourceCode" id="cb607"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find a suitable coding for the current locale</span>
<span class="fu"><a href="https://rdrr.io/r/utils/localeToCharset.html">localeToCharset</a></span><span class="op">(</span>locale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/locales.html">Sys.getlocale</a></span><span class="op">(</span><span class="st">"LC_CTYPE"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "UTF-8"     "ISO8859-1"</code></pre>
<div class="sourceCode" id="cb609"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 软件版本信息</span>
<span class="fu"><a href="https://rdrr.io/r/base/extSoftVersion.html">extSoftVersion</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##                                              zlib 
##                                          "1.2.11" 
##                                             bzlib 
##                              "1.0.8, 13-Jul-2019" 
##                                                xz 
##                                           "5.2.4" 
##                                              PCRE 
##                                "10.39 2021-10-29" 
##                                               ICU 
##                                            "66.1" 
##                                               TRE 
##                         "TRE 0.8.0 R_fixes (BSD)" 
##                                             iconv 
##                                      "glibc 2.31" 
##                                          readline 
##                                             "8.0" 
##                                              BLAS 
## "/usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0"</code></pre>
<div class="sourceCode" id="cb611"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 区域及其编码信息</span>
<span class="fu"><a href="https://rdrr.io/r/base/l10n_info.html">l10n_info</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $MBCS
## [1] TRUE
## 
## $`UTF-8`
## [1] TRUE
## 
## $`Latin-1`
## [1] FALSE
## 
## $codeset
## [1] "UTF-8"</code></pre>
<div class="sourceCode" id="cb613"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 表示数字、货币的细节</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.localeconv.html">Sys.localeconv</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##     decimal_point     thousands_sep          grouping   int_curr_symbol 
##               "."                ""                ""            "USD " 
##   currency_symbol mon_decimal_point mon_thousands_sep      mon_grouping 
##               "$"               "."               ","        "\003\003" 
##     positive_sign     negative_sign   int_frac_digits       frac_digits 
##                ""               "-"               "2"               "2" 
##     p_cs_precedes    p_sep_by_space     n_cs_precedes    n_sep_by_space 
##               "1"               "0"               "1"               "0" 
##       p_sign_posn       n_sign_posn 
##               "1"               "1"</code></pre>
<div class="sourceCode" id="cb615"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># PCRE 启用的配置选项</span>
<span class="fu"><a href="https://rdrr.io/r/base/pcre_config.html">pcre_config</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##              UTF-8 Unicode properties                JIT              stack 
##               TRUE               TRUE               TRUE              FALSE</code></pre>
<div class="sourceCode" id="cb617"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 比较全的字符信息</span>
<span class="fu">stringi</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/stringi/man/stri_info.html">stri_info</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## $Unicode.version
## [1] "13.0"
## 
## $ICU.version
## [1] "66.1"
## 
## $Locale
## $Locale$Language
## [1] "en"
## 
## $Locale$Country
## [1] "US"
## 
## $Locale$Variant
## [1] ""
## 
## $Locale$Name
## [1] "en_US"
## 
## 
## $Charset.internal
## [1] "UTF-8"  "UTF-16"
## 
## $Charset.native
## $Charset.native$Name.friendly
## [1] "UTF-8"
## 
## $Charset.native$Name.ICU
## [1] "UTF-8"
## 
## $Charset.native$Name.UTR22
## [1] NA
## 
## $Charset.native$Name.IBM
## [1] "ibm-1208"
## 
## $Charset.native$Name.WINDOWS
## [1] "windows-65001"
## 
## $Charset.native$Name.JAVA
## [1] "UTF-8"
## 
## $Charset.native$Name.IANA
## [1] "UTF-8"
## 
## $Charset.native$Name.MIME
## [1] "UTF-8"
## 
## $Charset.native$ASCII.subset
## [1] TRUE
## 
## $Charset.native$Unicode.1to1
## [1] NA
## 
## $Charset.native$CharSize.8bit
## [1] FALSE
## 
## $Charset.native$CharSize.min
## [1] 1
## 
## $Charset.native$CharSize.max
## [1] 3
## 
## 
## $ICU.system
## [1] TRUE
## 
## $ICU.UTF8
## [1] TRUE</code></pre>
<p>需要临时改变区域环境设置，配合特殊的画图和文本输出要求。</p>
<div class="sourceCode" id="cb619"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 获取当前默认的区域设置</span>
<span class="fu"><a href="https://rdrr.io/r/base/locales.html">Sys.getlocale</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">foo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/locales.html">Sys.getlocale</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># 恢复默认的区域设置</span>
<span class="fu"><a href="https://rdrr.io/r/base/locales.html">Sys.setlocale</a></span><span class="op">(</span><span class="st">"LC_ALL"</span>, locale <span class="op">=</span> <span class="va">foo</span><span class="op">)</span></code></pre></div>
</div>
<div id="foundations" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> 基本概念<a class="anchor" aria-label="anchor" href="#foundations"><i class="fas fa-link"></i></a>
</h2>
<p>正则表达式的构造方式类似算术表达式，通过各种操作组合子（更小的）表达式，整个表达式匹配一个或多个字符<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;code&gt;useBytes = TRUE&lt;/code&gt; 表示把字符看作字节。字符、字节和比特的关系是，一个字节 byte 八个比特 bit，一个英文字符 character 用一个字节表示，而一个中、日、韩文字符需要两个字节表示&lt;/p&gt;"><sup>20</sup></a>。大多数字符，包括所有的字母和数字，是匹配自身的正则表达式。元字符 <code>. \ | ( ) [ { ^ $ * + ?</code> 需要转义才能表达其自身的含义，转义的方式是在元字符前面添加反斜杠，如要表达点号 <code>.</code> 需要使用 <code>\.</code>。要注意，它们是否有特殊意义取决于所在的内容。</p>
<p>一个字符集 (character class) 是用一对中括号<code>[]</code>括起来的字符列表，用来匹配列表中的任意单个字符，除非列表中的第一个字符是 <code>^</code>，它用来匹配不在这个列表中的字符。 <code>[0123456789]</code> 用来匹配任意单个数字，<code>[^abc]</code> 用来匹配除字符 <code>a,b,c</code> 以外的任意字符。字符范围 (character ranges) 可以通过第一个和最后一个字符指定， 中间用连字符 (hyphen) 连接， 由于这种解释依赖于区域和具体实现，所以指定字符范围的使用方式最好避免。唯一可移植（便携，通用）的方式是作为字符集，在列表中列出所有的 ASCII 字母，
<code>[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz]</code>.</p>
<p>预定义的一些字符类，它们的解释依赖于当前的语言区域，下面是 POSIX locale 环境下的解释</p>
<ul>
<li><p><code>[:alnum:]</code> 表示 <code>[:alpha:]</code> 和 <code>[:digit:]</code>，含义是 <code>[0-9A-Za-z]</code>，但是前者与区域和字符集无关，后者依赖于当前的区域设置和字符编码。要注意在这些字符集名 class names 中，中括号 <code>[]</code> 是符号名的一部分，是必须要包含的。在字符集中，大多数元字符失去它们特殊的意义。</p></li>
<li><p><code>[:alpha:]</code> 表示 <code>[:lower:]</code> 和 <code>[:upper:]</code></p></li>
<li><p><code>[:blank:]</code> 表示 空格 space 制表符 tab</p></li>
<li><p><code>[:cntrl:]</code> 表示控制符，在 ASCII 字符集里里，这些字符有八进制代码，从 000 到 037，和 177(DEL)。</p></li>
<li><p><code>[:digit:]</code> 表示数字 0,1,2,3,4,5,6,7,8,9</p></li>
<li><p><code>[:graph:]</code> 表示 <code>[:alnum:]</code> 和 <code>[:punct:]</code>.</p></li>
<li><p><code>[:lower:]</code> 表示当前区域下的小写字母</p></li>
<li><p><code>[:print:]</code> 表示可打印的字符 <code>[:alnum:]</code>, <code>[:punct:]</code> 和空格.</p></li>
<li>
<p><code>[:punct:]</code> 表示标点字符</p>
<pre><code>! " # $ % &amp; ' ( ) * + , - . / : ; &lt; = &gt; ? @ [ \ ] ^ _ ` { | } ~`</code></pre>
</li>
<li><p><code>[:space:]</code> 表示空格字符： 水平制表符 tab， 换行符 newline，垂直制表符 vertical tab，换页符 form feed，回车符 carriage return，空格符 space</p></li>
<li><p><code>[:xdigit:]</code> 表示 16 进制数字 0 1 2 3 4 5 6 7 8 9 A B C D E F a b c d e f.</p></li>
</ul>
<p>要包含字面的 <code>]</code> 就把它放在列表的开头，类似地，要包含字面 <code>^</code>，除了开头可以放在任意位置。要包含字面 <code>-</code> 把它放在开头或者结尾。只有 <code>^ - \ ]</code> 在字符集内是有特殊的含义</p>
<p>点号 <code>.</code> 匹配任意单个字符，<code>\w</code> 匹配一个词 word 字符(是<code>[[:alnum:]_]</code>的同义词，一个扩展) ，而 <code>\W</code> 是 <code>\w</code> 取反，意味着 <code>[^[:alnum:]_]</code>。 <code>\d</code>, <code>\s</code>, <code>\D</code> 和 <code>\S</code> 表示数字和空格类和它们的取反</p>
<p>脱字符 caret <code>^</code> 和美元符号 <code>$</code> 是元字符，分别匹配一行的开头和结尾。符号 <code>\&lt;</code> 和 <code>\&gt;</code> 分别匹配一个词的开头和结尾的空字符串。<code>\b</code> 匹配词边缘的空字符串，<code>\B</code> 匹配不在词边缘的空字符串。 词 word 的解释依赖于区域和实现。</p>
</div>
<div id="match" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> 字符串匹配<a class="anchor" aria-label="anchor" href="#match"><i class="fas fa-link"></i></a>
</h2>
<p>默认的匹配方式是贪婪的，会使用尽可能多的匹配次数，这个可以变为最小的匹配次数，通过在其之后添加 <code>?</code>，一个正则表达式可能跟着重复量词，下面的限定符都是限定在它前面的正则表达式</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:repetition-quantifiers">表 5.2: </span> 贪婪匹配限定符</caption>
<thead><tr class="header">
<th align="left">符号</th>
<th align="left">描述</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>?</code></td>
<td align="left">匹配至多 1 次</td>
</tr>
<tr class="even">
<td align="left"><code>*</code></td>
<td align="left">匹配 0 次或多次</td>
</tr>
<tr class="odd">
<td align="left"><code>+</code></td>
<td align="left">匹配至少 1 次</td>
</tr>
<tr class="even">
<td align="left"><code>{n}</code></td>
<td align="left">匹配 n 次</td>
</tr>
<tr class="odd">
<td align="left"><code>{n,}</code></td>
<td align="left">匹配至少 n 次</td>
</tr>
<tr class="even">
<td align="left"><code>{n,m}</code></td>
<td align="left">匹配至少 n 次，至多 m 次</td>
</tr>
</tbody>
</table></div>
</div>
<div id="concatenation" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> 级联表达式<a class="anchor" aria-label="anchor" href="#concatenation"><i class="fas fa-link"></i></a>
</h2>
<blockquote>
<p>Regular expressions may be concatenated; the resulting regular expression matches any string formed by concatenating the substrings that match the concatenated subexpressions.</p>
</blockquote>
<p>正则表达式可以是级联 concatenation 的，是不是在讲一个正则表达式里面嵌套一个正则表达式？</p>
<p>两个正则表达式可以通过中缀符号 <code>|</code> 联合，用两个子表达式的任意一个去匹配字符串，例如 <code>abba | cde</code> 要么匹配字符串 <code>abba</code> 要么匹配字符串 <code>cde</code>，要注意在字符集内，即 <code>abba|cde</code>，二选一的匹配不凑效，因为中缀符 <code>|</code> 有它的字面意思。</p>
<p>重复匹配 Repetition 的优先级高于级联，级联高于 <code>|</code> 。 整个子表达式可以括号括起来覆盖这些优先级规则。</p>
</div>
<div id="backreference" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> 反向引用<a class="anchor" aria-label="anchor" href="#backreference"><i class="fas fa-link"></i></a>
</h2>
<p>反向引用 <code>\N</code> 这里 N 可取 1,2,…,9 匹配被之前第 N 个括起来的子表达式匹配的子字符串，例子见 COS 论坛 <a href="https://d.cosx.org/d/420570/5" class="uri">https://d.cosx.org/d/420570/5</a></p>
</div>
<div id="regexp-named-capture" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> 命名捕捉<a class="anchor" aria-label="anchor" href="#regexp-named-capture"><i class="fas fa-link"></i></a>
</h2>
<p>模式 <code>(?:...)</code> 包住的字符就是括号分组，但是不做反向查找。模式 <code>(?&lt;=...)</code> 和 <code>(?&lt;!...)</code> 都是反向查找，它们不允许跟限制符，在 <code>...</code> 也不允许出现 <code>\C</code>。表 <a href="chap-regular-expressions.html#tab:group-lookaround">5.3</a> 展示四个反向引用</p>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:group-lookaround">表 5.3: </span> 环顾四周查找</caption>
<thead><tr class="header">
<th align="center">符号</th>
<th align="center">描述</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code>?=</code></td>
<td align="center">正向肯定查找</td>
</tr>
<tr class="even">
<td align="center"><code>?!</code></td>
<td align="center">正向否定查找</td>
</tr>
<tr class="odd">
<td align="center"><code>?&lt;=</code></td>
<td align="center">反向肯定查找</td>
</tr>
<tr class="even">
<td align="center"><code>?&lt;!</code></td>
<td align="center">反向否定查找</td>
</tr>
</tbody>
</table></div>
<p>函数 <code>regexpr</code> 和 <code>gregexpr</code> 支持命名捕捉 (named capture). 如果一个组被命名了，如 <code>(?&lt;first&gt;[A-Z][a-z]+)</code> 那么，匹配的位置是按名字返回。</p>
<p>下面举个例子说明，从字符串向量 <code>notables</code> 中获得了三组匹配 <code>name.rex</code> 是一段正则表达式，描述的模式是人名</p>
<div class="sourceCode" id="cb621"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## named capture</span>
<span class="va">notables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"  Ben Franklin and Jefferson Davis"</span>,
              <span class="st">"\tMillard Fillmore"</span><span class="op">)</span>
<span class="co"># name groups 'first' and 'last'</span>
<span class="va">name.rex</span> <span class="op">&lt;-</span> <span class="st">"(?&lt;first&gt;[[:upper:]][[:lower:]]+) (?&lt;last&gt;[[:upper:]][[:lower:]]+)"</span>
<span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="va">name.rex</span>, <span class="va">notables</span>, perl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">parsed</span></code></pre></div>
<pre><code>## [1] 3 2
## attr(,"match.length")
## [1] 12 16
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## attr(,"capture.start")
##      first last
## [1,]     3    7
## [2,]     2   10
## attr(,"capture.length")
##      first last
## [1,]     3    8
## [2,]     7    8
## attr(,"capture.names")
## [1] "first" "last"</code></pre>
<p><code>notables</code> 是一个长度为2的字符串向量，所以获得两组匹配，捕捉到匹配开始的位置 <code>capture.start</code> 和匹配的长度 <code>capture.length</code> 都是两组，按列来看，字符 B 出现在字符串 <code>Ben Franklin and Jefferson Davis</code> 的第三个位置，匹配的长度 Ben 是三个字符，长度是 3，如图 <a href="chap-regular-expressions.html#fig:name-capture">5.1</a> 所示，需要注意的是一定要设置 <code>perl = TRUE</code> 才能使用命名捕捉功能，函数 <code>sub</code> 不支持命名反向引用 Named backreferences</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:name-capture"></span>
<img src="screenshots/regexp-name-capture.png" alt="命名捕捉" width="676"><p class="caption">
图 5.1: 命名捕捉
</p>
</div>
<p>Atomic grouping 原子分组, possessive qualifiers 占有限定 and conditional 条件 and recursive 递归等模式超出介绍的范围，不在此处详述，感兴趣的读者可参考，此外，插播一条漫画 <a href="chap-regular-expressions.html#fig:regex-xkcd">5.2</a></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:regex-xkcd"></span>
<a href="https://imgs.xkcd.com/comics/regular_expressions.png" target="_blank"><img src="screenshots/regexp-comics.png" alt="正则表达式漫画" width="300"></a>
<p class="caption">
图 5.2: 正则表达式漫画
</p>
</div>
<p>正则表达式的直观解释 <a href="https://github.com/gadenbuie/regexplain" class="uri">https://github.com/gadenbuie/regexplain</a></p>
</div>
<div id="comment" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> 表达式注释<a class="anchor" aria-label="anchor" href="#comment"><i class="fas fa-link"></i></a>
</h2>
<p>The sequence <code>(?#</code> marks the start of a comment which continues up to the next closing parenthesis. Nested parentheses are not permitted. The characters that make up a comment play no part at all in the pattern matching.</p>
<p>If the extended option is set, an unescaped <code>#</code> character outside a character class introduces a comment that continues up to the next newline character in the pattern.</p>
<p>批量转换驼峰式命名</p>
<div class="sourceCode" id="cb623"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">old_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="st">"."</span>, pattern <span class="op">=</span> <span class="st">"^[A-Z].*.Rmd$"</span><span class="op">)</span>
<span class="va">new_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"rmd"</span>, <span class="st">"Rmd"</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">old_name</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/files.html">file.rename</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">old_name</span>, to <span class="op">=</span> <span class="va">new_name</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">html_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="st">"https://movie.douban.com/top250"</span><span class="op">)</span>
<span class="va">doc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">html_lines</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">title_lines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">'class="title"'</span>, <span class="va">html_lines</span>, value <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>
<span class="va">titles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*&gt;(.*?)&lt;.*"</span>, <span class="st">"\\1"</span>, <span class="va">title_lines</span>, perl <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">".*&gt;(.*?)&lt;.*"</span>, <span class="st">"\\1"</span>, <span class="st">'&lt;span class="title"&gt;肖生克的救赎&lt;/span&gt;'</span>, perl <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></code></pre></div>
<p>解析术之 XPath</p>
<div class="sourceCode" id="cb625"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://xml2.r-lib.org/">xml2</a></span><span class="op">)</span>
<span class="va">dom</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span>
<span class="va">title_nodes</span> <span class="op">=</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/xml_find_all.html">xml_find_all</a></span><span class="op">(</span><span class="va">dom</span>, <span class="st">'.//span[@class="title"]'</span><span class="op">)</span>
<span class="fu"><a href="http://xml2.r-lib.org/reference/xml_text.html">xml_text</a></span><span class="op">(</span><span class="va">title_nodes</span><span class="op">)</span></code></pre></div>
<p>解析术之 CSS Selector</p>
<div class="sourceCode" id="cb626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span>
<span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">doc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
<span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="st">'.title'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># class="title"的标签</span>
<span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html">html_text</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></div>
<div class="next"><a href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-regular-expressions"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="nav-link" href="#character-constants"><span class="header-section-number">5.1</span> 字符常量</a></li>
<li><a class="nav-link" href="#environments"><span class="header-section-number">5.2</span> 软件环境</a></li>
<li><a class="nav-link" href="#foundations"><span class="header-section-number">5.3</span> 基本概念</a></li>
<li><a class="nav-link" href="#match"><span class="header-section-number">5.4</span> 字符串匹配</a></li>
<li><a class="nav-link" href="#concatenation"><span class="header-section-number">5.5</span> 级联表达式</a></li>
<li><a class="nav-link" href="#backreference"><span class="header-section-number">5.6</span> 反向引用</a></li>
<li><a class="nav-link" href="#regexp-named-capture"><span class="header-section-number">5.7</span> 命名捕捉</a></li>
<li><a class="nav-link" href="#comment"><span class="header-section-number">5.8</span> 表达式注释</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/notesdown/blob/devel/regular-expressions.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/notesdown/edit/devel/regular-expressions.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R 语言学习笔记</strong>" was written by 黄湘云. It was last built on 2022-06-10.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
