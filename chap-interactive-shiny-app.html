<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 20 章 交互报表 | 现代应用统计与 R 语言</title>
<meta name="author" content="黄湘云">
<meta name="description" content="学习 shiny 应用开发，建议多看看 Learn Shiny。 了解 shiny server ，推荐从 Shiny Server Professional Administrator’s Guide 开始。了解 shiny 相关的生态，建议从 shiny 资源列表 https://github.com/grabear/awesome-rshiny 和 shiny 扩展合集...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="第 20 章 交互报表 | 现代应用统计与 R 语言">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="学习 shiny 应用开发，建议多看看 Learn Shiny。 了解 shiny server ，推荐从 Shiny Server Professional Administrator’s Guide 开始。了解 shiny 相关的生态，建议从 shiny 资源列表 https://github.com/grabear/awesome-rshiny 和 shiny 扩展合集...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 20 章 交互报表 | 现代应用统计与 R 语言">
<meta name="twitter:description" content="学习 shiny 应用开发，建议多看看 Learn Shiny。 了解 shiny server ，推荐从 Shiny Server Professional Administrator’s Guide 开始。了解 shiny 相关的生态，建议从 shiny 资源列表 https://github.com/grabear/awesome-rshiny 和 shiny 扩展合集...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs/header-attrs.js"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><link href="libs/dygraphs/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs/dygraph-combined.js"></script><script src="libs/dygraphs/shapes.js"></script><script src="libs/moment/moment.js"></script><script src="libs/moment-timezone/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding/dygraphs.js"></script><script src="libs/Dygraph.Plugins.Unzoom/unzoom.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/es6shim/es6shim.js"></script><script src="libs/es7shim/es7shim.js"></script><script src="libs/graphre/graphre.js"></script><script src="libs/nomnoml/nomnoml.js"></script><script src="libs/nomnoml-binding/nomnoml.js"></script><script src="libs/d3-bundle/d3-bundle.min.js"></script><script src="libs/d3-lasso/d3-lasso.min.js"></script><script src="libs/save-svg-as-png/save-svg-as-png.min.js"></script><link href="libs/ggiraphjs/ggiraphjs.min.css" rel="stylesheet">
<script src="libs/ggiraphjs/ggiraphjs.min.js"></script><script src="libs/girafe-binding/girafe.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><script src="libs/jszip/jszip.min.js"></script><script src="libs/pdfmake/pdfmake.js"></script><script src="libs/pdfmake/vfs_fonts.js"></script><link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script><link href="libs/dt-ext-rowgroup/css/rowGroup.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-rowgroup/js/dataTables.rowGroup.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/echarts-world/world.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Modern Applied Statistics with R">现代应用统计与 R 语言</a>:
        <small class="text-muted">Modern Applied Statistics with R</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">动态文档</li>
<li><a class="" href="chap-dynamic-documents.html">介绍</a></li>
<li><a class="" href="chap-document-elements.html"><span class="header-section-number">13</span> 文档元素</a></li>
<li><a class="" href="chap-portable-document.html"><span class="header-section-number">14</span> 便携式文档</a></li>
<li><a class="" href="chap-web-documents.html"><span class="header-section-number">15</span> 网页文档</a></li>
<li><a class="" href="chap-office-document.html"><span class="header-section-number">16</span> 办公文档</a></li>
<li><a class="" href="chap-reproducible-workflows.html"><span class="header-section-number">17</span> 工作流</a></li>
<li><a class="" href="chap-advanced-documents.html"><span class="header-section-number">18</span> 高级文档</a></li>
<li class="book-part">数据产品</li>
<li><a class="" href="chap-data-product.html">介绍</a></li>
<li><a class="" href="chap-interactive-data-tables.html"><span class="header-section-number">19</span> 交互表格</a></li>
<li><a class="active" href="chap-interactive-shiny-app.html"><span class="header-section-number">20</span> 交互报表</a></li>
<li class="book-part">统计基础</li>
<li><a class="" href="chap-statistical-foundations.html">介绍</a></li>
<li><a class="" href="chap-sampling-distributions.html"><span class="header-section-number">21</span> 抽样分布</a></li>
<li><a class="" href="chap-parameter-estimators.html"><span class="header-section-number">22</span> 参数估计</a></li>
<li><a class="" href="chap-hypothesis-test.html"><span class="header-section-number">23</span> 假设检验</a></li>
<li><a class="" href="chap-power-Analysis.html"><span class="header-section-number">24</span> 功效分析</a></li>
<li><a class="" href="chap-experimental-design.html"><span class="header-section-number">25</span> 试验设计</a></li>
<li class="book-part">统计模型</li>
<li><a class="" href="chap-statistical-models.html">介绍</a></li>
<li><a class="" href="chap-linear-models.html"><span class="header-section-number">26</span> 线性模型</a></li>
<li><a class="" href="chap-generalized-linear-models.html"><span class="header-section-number">27</span> 广义线性模型</a></li>
<li><a class="" href="chap-bayesian-models.html"><span class="header-section-number">28</span> 贝叶斯模型</a></li>
<li class="book-part">数据建模</li>
<li><a class="" href="chap-data-modeling.html">介绍</a></li>
<li><a class="" href="chap-text-analysis.html"><span class="header-section-number">29</span> 文本分析</a></li>
<li><a class="" href="chap-survival-analysis.html"><span class="header-section-number">30</span> 生存分析</a></li>
<li><a class="" href="chap-time-series-analysis.html"><span class="header-section-number">31</span> 时序分析</a></li>
<li class="book-part">时空数据</li>
<li><a class="" href="chap-spatio-temporal-data.html">介绍</a></li>
<li><a class="" href="chap-spatial-analysis.html"><span class="header-section-number">32</span> 空间数据分析</a></li>
<li><a class="" href="chap-spatial-modeling.html"><span class="header-section-number">33</span> 空间数据建模</a></li>
<li><a class="" href="chap-spatial-viz.html"><span class="header-section-number">34</span> 空间数据可视化</a></li>
<li><a class="" href="chap-case-study.html"><span class="header-section-number">35</span> 案例研究</a></li>
<li><a class="" href="chap-data-explorer.html"><span class="header-section-number">36</span> 数据探索</a></li>
<li class="book-part">机器学习</li>
<li><a class="" href="chap-machine-learning.html">介绍</a></li>
<li><a class="" href="chap-gradient-boosting-machine.html"><span class="header-section-number">37</span> 梯度提升机</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">38</span> 数值优化</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="chap-matrix-operations.html"><span class="header-section-number">B</span> 矩阵运算</a></li>
<li><a class="" href="chap-symbolic-computation.html"><span class="header-section-number">C</span> 符号计算</a></li>
<li><a class="" href="chap-mixed-programming.html"><span class="header-section-number">D</span> 混合编程</a></li>
<li><a class="" href="chap-object-oriented-programming.html"><span class="header-section-number">E</span> 面向对象编程</a></li>
<li><a class="" href="chap-file-operations.html"><span class="header-section-number">F</span> 文件操作</a></li>
<li><a class="" href="chap-other-softwares.html"><span class="header-section-number">G</span> 其它软件</a></li>
<li><a class="" href="chap-notations.html"><span class="header-section-number">H</span> 符号说明</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/masr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-interactive-shiny-app" class="section level1" number="20">
<h1>
<span class="header-section-number">第 20 章</span> 交互报表<a class="anchor" aria-label="anchor" href="#chap-interactive-shiny-app"><i class="fas fa-link"></i></a>
</h1>
<p>学习 shiny 应用开发，建议多看看 <a href="https://shiny.rstudio.com/tutorial/">Learn Shiny</a>。
了解 shiny server ，推荐从 <a href="https://docs.rstudio.com/shiny-server/">Shiny Server Professional Administrator’s Guide</a> 开始。了解 shiny 相关的生态，建议从 shiny 资源列表 <a href="https://github.com/grabear/awesome-rshiny" class="uri">https://github.com/grabear/awesome-rshiny</a> 和 shiny 扩展合集 <a href="https://github.com/nanxstats/awesome-shiny-extensions" class="uri">https://github.com/nanxstats/awesome-shiny-extensions</a> 开始，希望读者能从中打造属于自己的最佳实践。</p>
<p>RStudio 首席技术官 CTO Joe Cheng 在 2019年 RStudio 大会上介绍 <a href="https://resources.rstudio.com/rstudio-conf-2019/shiny-in-production-principles-practices-and-tools-joe-cheng">企业级 shiny 应用 原理、实践和工具</a> 可以作为 shiny 从新技术到生产力的蜕变节点。支持高并发的异步编程，比如 Heather Nolis 和 Dr. Jacqueline Nolis 的报告介绍了日百万访问量下的 shiny 应用如何搭建<a href="references.html#fn58" class="footnote-ref" id="fnref58"><sup>58</sup></a>。 Colin Fay, Sébastien Rochette, Vincent Guyader, Cervan Girard 的书 <a href="https://engineering-shiny.org/">Engineering Production-Grade Shiny Apps</a>、David Granjon 的书<a href="https://unleash-shiny.rinterface.com/">Outstanding User Interfaces with Shiny</a> 和 Hadley Wickham 的书 <a href="https://mastering-shiny.org/">Mastering Shiny</a> 的问世宣告 shiny 的成熟稳定，以及生态的形成，在此之前 shiny 一直不被看好。shiny 生态意味着一个完整的工业级的应用圈，满足安全性、稳定性、高效性、维护性、扩展性的要求。</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shiny-ecosystem"></span>
<img src="screenshots/shiny-app.png" alt="Shiny 生态系统" width="1546"><p class="caption">
图 20.1: Shiny 生态系统
</p>
</div>
<p>iSEE is winner of the Most Technically Impressive award of the 2019 Shiny Contest. 源码地址 <a href="https://github.com/iSEE/isee-shiny-contest" class="uri">https://github.com/iSEE/isee-shiny-contest</a></p>
<p>Six Years of Shiny in Research - Collaborative Development of Web Tools in R <span class="citation"><a href="#ref-RJ-2021-004" role="doc-biblioref">[29]</a></span></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shiny-org"></span>
<img src="diagrams/shiny-org.png" alt="开发 Shiny 应用扩展的组织" width="75%"><p class="caption">
图 20.2: 开发 Shiny 应用扩展的组织
</p>
</div>
<p>以 RStudio 为核心，开发 Shiny 应用扩展的社区组织有 <a href="https://github.com/rstudio">RStudio</a>、<a href="https://github.com/Appsilon">Appsilon</a>、<a href="https://github.com/RinteRface">RinteRface</a>、<a href="https://github.com/ThinkR-open">ThinkR-open</a>、<a href="https://github.com/dreamRs">dreamRs</a> 和<a href="https://github.com/datastorm-open">datastorm-open</a></p>
<div id="sec-dev-workflow" class="section level2" number="20.1">
<h2>
<span class="header-section-number">20.1</span> 开发流程<a class="anchor" aria-label="anchor" href="#sec-dev-workflow"><i class="fas fa-link"></i></a>
</h2>
<p>报表开发从数据仓库的 DWD 层开始，可能一些业务原因，我们需要从 ODS 层甚至从点击流的日志数据开始，经过数据清洗、提取、聚合成为支撑BI报表最底层的基础表，存储在 Hive 中，然后对这一系列的基础表根据BI展示的需要进行第二层聚合形成中间表，这两层数据根据业务情况做增量更新或者全量更新，并将中间表同步到 MySQL 仓库中，全量更新的情况，往往更新数据比较大，建议用 sqoop 做数据的同步。创建第二层的中间表稍有些灵活性，原则是在中间表之上对应的数据操作和可视化是容易实现且效率较高的，否则应该构造第三层的中间表，绝不能将大规模的数据集直接导入 R 中进行分析和可视化，拖慢前端展示的速度，占用过多的服务器资源。</p>
</div>
<div id="sec-dev-tools" class="section level2" number="20.2">
<h2>
<span class="header-section-number">20.2</span> 开发工具<a class="anchor" aria-label="anchor" href="#sec-dev-tools"><i class="fas fa-link"></i></a>
</h2>
<p>除了在第 <a href="chap-interactive-shiny-app.html#sec-dev-workflow">20.1</a> 节介绍的和数据库紧密相关的工具外，我们还需要 Git 做代码管理， Azkaban 做任务调度 （或者其它工具做任务调度器），RStudio IDE 做开发工具（或者 VS Code 等）， Shiny Server 做报表支撑，做报表管理。具体到 shiny 页面开发，我们需要：</p>
<ul>
<li>RMySQL 做数据库连接，推荐 odbc 这个包，它支持连接相当广泛的数据库。</li>
<li>data.table 或者 dplyr 做数据操作，推荐和管道操作 magrittr 一起使用，增加代码可读性。</li>
<li>plotly 或者 highcharter 做数据可视化，reactable 和 DT 做数据呈现，也可以 <a href="https://github.com/tidyverse/ggplot2">ggplot2</a> 和 <a href="https://github.com/ropensci/plotly">plotly</a> 的 <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html">ggplotly()</a></code> 函数共同实现静态图到动态图的交互可视化。</li>
<li>
<a href="https://rstudio.github.io/shiny">shiny</a> 及其扩展工具做页面设计，比如 shinythemes 可以统一配色，<a href="https://github.com/nik01010/dashboardthemes">dashboardthemes</a> 提供更加深度的主题，<a href="https://github.com/rstudio/shinytableau">shinytableau</a> 提供仿 <a href="https://www.tableau.com/">Tableau</a> 的 dashboard 框架。<a href="https://github.com/rstudio/sass">sass</a> 在 CSS 样式层面重定义网站风格，比如<a href="https://resources.rstudio.com/rstudio-conf-2020/styling-shiny-apps-with-sass-and-bootstrap-4-joe-cheng">借助 sass 修改 Bootstrap 4</a>， shiny 的布局其实就是魔改了 Bootstrap 库。</li>
<li>针对特定应用场景的其它交互可视化工具包，比如 <a href="https://github.com/rstudio/leaflet">leaflet</a> 可以将地图嵌入 Shiny 应用，
<a href="https://github.com/rstudio/dygraphs">dygraphs</a> 可以将时间序列塞进去。</li>
<li>其它加强 shiny 页面的小功能，比如 <a href="https://github.com/merlinoa/shinyFeedback">shinyFeedback</a> 提供用户输入的反馈，<a href="https://github.com/rstudio/miniUI">miniUI</a> 专为小屏幕设计，<a href="https://github.com/RinteRface/shinyMobile">shinyMobile</a> 在 IOS 和安卓手机上访问 shiny 应用，大大加强 miniUI 的功能，<a href="https://github.com/dreamRs/shinyWidgets">shinyWidgets</a> 提供自定义 widget 的功能，<a href="https://github.com/datastorm-open/shinymanager">shinymanager</a> 支持单个 shiny 应用的权限管理，<a href="https://github.com/JohnCoene/firebase">firebase</a> 提供访问权限设置 <a href="https://firebase.john-coene.com/" class="uri">https://firebase.john-coene.com/</a>。</li>
<li>
<a href="https://github.com/rstudio/shiny-server">shiny-server</a> 以网络服务的方式支持 shiny 应用，是企业级 shiny 应用的核心， <a href="https://github.com/openanalytics/shinyproxy">shinyproxy</a> 提供企业级部署 shiny 应用的开源解决方案，<a href="https://github.com/clevr-dev/ShinyStudio">ShinyStudio</a> 打造基于容器架构的协作开发环境的开源解决方案，<a href="https://github.com/ThinkR-open/golem">golem</a> 构建企业级 shiny 应用的框架，<a href="https://github.com/RinteRface">RinteRface</a> 开发的系列 R 包也试图打造一套完整的解决方案，并配有速查小抄 <a href="https://github.com/RinteRface/cheatsheets">cheatsheets</a>
</li>
<li>
<a href="https://github.com/radiant-rstats/radiant">radiant</a> 探索性分析解决方案</li>
</ul>
<p><a href="https://github.com/paulc91/shinyauthr">shinyauthr</a> 应用授权</p>
<div class="sourceCode" id="cb1874"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-foundations" class="section level2" number="20.3">
<h2>
<span class="header-section-number">20.3</span> 基础知识<a class="anchor" aria-label="anchor" href="#sec-foundations"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://xiangyun.shinyapps.io/masr-cars/">1920s 汽车数据分析和建模</a></p>
</div>
<div id="sec-shiny-elements" class="section level2" number="20.4">
<h2>
<span class="header-section-number">20.4</span> 基础组件<a class="anchor" aria-label="anchor" href="#sec-shiny-elements"><i class="fas fa-link"></i></a>
</h2>
<div id="subsec-bookmark" class="section level3" number="20.4.1">
<h3>
<span class="header-section-number">20.4.1</span> 书签<a class="anchor" aria-label="anchor" href="#subsec-bookmark"><i class="fas fa-link"></i></a>
</h3>
<p>链接可以指向页面状态</p>
<div class="sourceCode" id="cb1875"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"Number of observations"</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">faithful</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/bookmarkButton.html">bookmarkButton</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">faithful</span><span class="op">$</span><span class="va">eruptions</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">n</span><span class="op">)</span><span class="op">]</span>, breaks <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/enableBookmarking.html">enableBookmarking</a></span><span class="op">(</span>store <span class="op">=</span> <span class="st">"url"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
<div id="subsec-shiny-tables" class="section level3" number="20.4.2">
<h3>
<span class="header-section-number">20.4.2</span> 表格<a class="anchor" aria-label="anchor" href="#subsec-shiny-tables"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://github.com/glin/reactable">reactable</a> 基于 JS 库 <a href="https://github.com/tannerlinsley/react-table">React Table</a> 提供交互式表格渲染，和 shiny 无缝集成，是替代 DT 的不二选择，在 app.R 用 reactable 包的 <code><a href="https://glin.github.io/reactable/reference/reactable-shiny.html">reactableOutput()</a></code> 和 <code><a href="https://glin.github.io/reactable/reference/reactable-shiny.html">renderReactable()</a></code> 函数替代 shiny 里面的 <code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html">dataTableOutput()</a></code> 和 <code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html">renderDataTable()</a></code>。 再也不用忍受 DT 和 shiny 的函数冲突了，且其覆盖测试达到 99%。</p>
<div class="sourceCode" id="cb1876"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></code></pre></div>
<p><a href="https://github.com/rstudio/gt">gt</a> 高度自定义 gt 表格样式，支持 shiny 集成， <a href="https://github.com/Rdatatable/data.table">data.table</a> 提供高效的数据操作，<a href="https://github.com/renkun-ken/formattable">formattable</a> 支持自定义格子。</p>
<p>kableExtra 包</p>
<div class="sourceCode" id="cb1877"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  title <span class="op">=</span> <span class="st">"mtcars datasets"</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"mtcars 数据集"</span><span class="op">)</span>,

  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarLayout</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">sidebarPanel</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="st">"mpg 范围"</span>,
        min <span class="op">=</span> <span class="fl">11</span>, max <span class="op">=</span> <span class="fl">33</span>, value <span class="op">=</span> <span class="fl">15</span>
      <span class="op">)</span>
    <span class="op">)</span>,

    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sidebarLayout.html">mainPanel</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderTable.html">tableOutput</a></span><span class="op">(</span><span class="st">"mtcars_kable"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="co">## 设置列序 https://stackoverflow.com/questions/19619666/change-column-position-of-data-table</span>
<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">mtcars_kable</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># 转化数据类型</span>
    <span class="va">mtcars_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span>
    <span class="co"># 添加新的列</span>
    <span class="va">mtcars_dt</span><span class="op">[</span>, <span class="va">car</span> <span class="op">:=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span><span class="op">]</span><span class="op">[</span><span class="va">mpg</span> <span class="op">&lt;=</span> <span class="va">input</span><span class="op">$</span><span class="va">mpg</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setcolorder.html">setcolorder</a></span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"car"</span>, <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setops.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="st">"car"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="st">"html"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span><span class="st">"striped"</span>, full_width <span class="op">=</span> <span class="cn">F</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
      <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html">add_header_above</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">"Group 1"</span> <span class="op">=</span> <span class="fl">5</span>, <span class="st">"Group 2"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="co"># 执行程序</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>reactable 包</p>
<div class="sourceCode" id="cb1878"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glin.github.io/reactable/">reactable</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://glin.github.io/reactable/reference/reactable-shiny.html">reactableOutput</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/reactable-shiny.html">renderReactable</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://glin.github.io/reactable/reference/reactable.html">reactable</a></span><span class="op">(</span><span class="va">iris</span>,
      filterable <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># 过滤</span>
      searchable <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># 搜索</span>
      showPageSizeOptions <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># 页面大小</span>
      pageSizeOptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span><span class="op">)</span>, <span class="co"># 页面大小可选项</span>
      defaultPageSize <span class="op">=</span> <span class="fl">10</span>, <span class="co"># 默认显示10行</span>
      highlight <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># 高亮选择</span>
      striped <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># 隔行高亮</span>
      fullWidth <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># 默认不要全宽填充，适应数据框的宽度</span>
      defaultSorted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        Sepal.Length <span class="op">=</span> <span class="st">"asc"</span>, <span class="co"># 由小到大排序</span>
        Petal.Length <span class="op">=</span> <span class="st">"desc"</span> <span class="co"># 由大到小</span>
      <span class="op">)</span>,
      columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        Sepal.Width <span class="op">=</span> <span class="fu"><a href="https://glin.github.io/reactable/reference/colDef.html">colDef</a></span><span class="op">(</span>style <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span> <span class="op">{</span> <span class="co"># Sepal.Width 添加颜色标记</span>
          <span class="kw">if</span> <span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">3.5</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"#008000"</span>
          <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">value</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"#e00000"</span>
          <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
            <span class="va">color</span> <span class="op">&lt;-</span> <span class="st">"#777"</span>
          <span class="op">}</span>
          <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">color</span>, fontWeight <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span> <span class="co"># 字体加粗</span>
        <span class="op">}</span><span class="op">)</span>

      <span class="op">)</span>
    <span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>下面介绍 DT</p>
<div class="sourceCode" id="cb1879"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="co"># ui.R 前端</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyUI.html">shinyUI</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="co"># 应用的标题名称</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/titlePanel.html">titlePanel</a></span><span class="op">(</span><span class="st">"鸢尾花数据集"</span><span class="op">)</span>,
  <span class="co"># 边栏</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span>
      <span class="fl">12</span>,
      <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">dataTableOutput</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span><span class="op">)</span>

<span class="co"># server.R 服务端</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyServer.html">shinyServer</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">table</span> <span class="op">&lt;-</span> <span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">`colnames&lt;-`</span><span class="op">(</span><span class="va">.</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\."</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
    <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">renderDataTable</a></span><span class="op">(</span><span class="va">.</span>,
      options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        pageLength <span class="op">=</span> <span class="fl">5</span>, <span class="co"># 每页显示5行</span>
        initComplete <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="st">"function(settings, json) {alert('Done.');}"</span><span class="op">)</span>
      <span class="op">)</span>, server <span class="op">=</span> <span class="cn">F</span>
    <span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="rmdnote">
<p>加载 shiny 包后再加载 DT 包，函数 <code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html">dataTableOutput()</a></code> 和<code><a href="https://rdrr.io/pkg/shiny/man/renderDataTable.html">renderDataTable()</a></code> 显示冲突，因为两个 R 包都有这两个函数。在创建 shiny 应用的过程中，如果我们需要呈现动态表格，就需要使用 DT 包的 <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">DT::dataTableOutput()</a></code> 和 <code><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">DT::renderDataTable()</a></code> 否则会报错，详见 <a href="https://github.com/rstudio/shiny/issues/2653" class="uri">https://github.com/rstudio/shiny/issues/2653</a>，DT 包官方文档 <a href="https://rstudio.github.io/DT/" class="uri">https://rstudio.github.io/DT/</a>。</p>
</div>
<div class="rmdtip">
<p>在 server.R 里我们对数据集 iris 做了重命列名的操作，如果不使用管道操作，通常是下面这样操作。</p>
<div class="sourceCode" id="cb1880"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"\\."</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>换成管道操作，函数 <code><a href="https://rdrr.io/r/base/colnames.html">colnames()</a></code> 要换成 <code>colnames&lt;-</code>，这其实类似于 <code>1 + 2</code> 换成 <code>+</code>(1, 2)，保持函数在左边，参数值在右边的一致性。</p>
</div>
<p>设置页面默认显示的行数和列的宽度</p>
<div class="sourceCode" id="cb1881"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># https://stackoverflow.com/questions/45509501/set-names-of-values-in-lengthmenu-page-length-menu-in-r-dt-datatable</span>
<span class="co"># 相关例子见 https://github.com/rstudio/shiny-examples/tree/master/018-datatable-options</span>
<span class="co"># DT 选项 https://rstudio.github.io/DT/options.html</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">dataTableOutput</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">renderDataTable</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">iris</span>, options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      language <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"//cdn.datatables.net/plug-ins/1.10.11/i18n/Chinese.json"</span><span class="op">)</span>,
      pageLength <span class="op">=</span> <span class="fl">24</span>, <span class="co"># 设置页面默认显示的行数</span>
      lengthMenu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">24</span>, <span class="fl">48</span>, <span class="fl">72</span>, <span class="fl">96</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
        <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"24"</span>, <span class="st">"48"</span>, <span class="st">"72"</span>, <span class="st">"96"</span>, <span class="st">"All"</span><span class="op">)</span>
      <span class="op">)</span>,
      paging <span class="op">=</span> <span class="cn">T</span>,
      <span class="co"># 设置第一列和第三列的宽度 https://rstudio.github.io/DT/options.html</span>
      autoWidth <span class="op">=</span> <span class="cn">TRUE</span>, columnDefs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">'400px'</span>, targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>按指定格式显示数据</p>
<div class="sourceCode" id="cb1882"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># data &lt;- data.frame(x = c(100.0011, 80.0011, -90.0011, -110.0011, -70))</span>
<span class="co">#</span>
<span class="co"># library(shiny)</span>
<span class="co"># runApp(list(</span>
<span class="co">#   ui = fluidPage(dataTableOutput("num")),</span>
<span class="co">#   server = function(input, output) {</span>
<span class="co">#     output$num = renderDataTable(format(round(data, 3), nsmall = 3))</span>
<span class="co">#   }</span>
<span class="co"># ))</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/DT">DT</a></span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">100.0011</span>, <span class="fl">80.0011</span>, <span class="op">-</span><span class="fl">90.0011</span>, <span class="op">-</span><span class="fl">110.0067</span>, <span class="op">-</span><span class="fl">70</span><span class="op">)</span><span class="op">)</span>

<span class="va">rowCallback</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span>
  <span class="st">"function(row, data, index){"</span>,
  <span class="st">"  var N = data.length;"</span>,
  <span class="st">"  for(var j=1; j&lt;data.length; j++){"</span>,
  <span class="st">"    $('td:eq('+j+')',row)"</span>,
  <span class="st">"      .html(parseFloat(data[j]).toFixed(3));"</span>, <span class="co"># 四舍五入保留 3 位小数</span>
  <span class="st">"  }"</span>,
  <span class="st">"}"</span>
<span class="op">)</span>

<span class="co"># https://github.com/rstudio/shiny/issues/2277</span>
<span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">dat</span>,
  options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    rowCallback <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/DT/man/DT-imports.html">JS</a></span><span class="op">(</span><span class="va">rowCallback</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
<div id="sec-advanced-topics" class="section level2" number="20.5">
<h2>
<span class="header-section-number">20.5</span> 高级主题<a class="anchor" aria-label="anchor" href="#sec-advanced-topics"><i class="fas fa-link"></i></a>
</h2>
<p>异步编程，并发访问</p>
<div class="sourceCode" id="cb1883"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## shiny 异步编程</span>
<span class="co">## 解决问题，多人同时访问 Shiny 应用的情况下，必须等另一个人完成访问的情况下才能继续访问</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org">future</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/promises/">promises</a></span><span class="op">)</span>

<span class="fu"><a href="https://future.futureverse.org/reference/plan.html">plan</a></span><span class="op">(</span><span class="va">multiprocess</span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h2</a></span><span class="op">(</span><span class="st">"测试异步下载"</span><span class="op">)</span>,
  <span class="va">tags</span><span class="op">$</span><span class="fu">ol</span><span class="op">(</span>
    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Verify that plot appears below"</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Verify that pressing Download results in 5 second delay, then rock.csv being downloaded"</span><span class="op">)</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="st">"Check 'Throw on download?' checkbox and verify that pressing Download results in 5 second delay, then error, as well as stack traces in console"</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">hr</a></span><span class="op">(</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/checkboxInput.html">checkboxInput</a></span><span class="op">(</span><span class="st">"throw"</span>, <span class="st">"Throw on download?"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadButton.html">downloadButton</a></span><span class="op">(</span><span class="st">"download"</span>, <span class="st">"下载 (等待5秒)"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">download</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/downloadHandler.html">downloadHandler</a></span><span class="op">(</span><span class="st">"rock.csv"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">file</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://future.futureverse.org/reference/future.html">future</a></span><span class="op">(</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.sleep.html">Sys.sleep</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">}</span><span class="op">)</span> <span class="op"><a href="https://rstudio.github.io/promises//reference/pipes.html">%...&gt;%</a></span>
      <span class="op">{</span>
        <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">throw</span><span class="op">)</span> <span class="op">{</span>
          <span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"boom"</span><span class="op">)</span>
        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
          <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">rock</span>, <span class="va">file</span><span class="op">)</span>
        <span class="op">}</span>
      <span class="op">}</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="va">output</span><span class="op">$</span><span class="va">plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cars</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-shiny-deployment" class="section level2" number="20.6">
<h2>
<span class="header-section-number">20.6</span> 部署应用<a class="anchor" aria-label="anchor" href="#sec-shiny-deployment"><i class="fas fa-link"></i></a>
</h2>
</div>
<div id="sec-shiny-principles" class="section level2" number="20.7">
<h2>
<span class="header-section-number">20.7</span> 最佳实践<a class="anchor" aria-label="anchor" href="#sec-shiny-principles"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://blog.rstudio.com/2020/07/21/4-tips-to-make-your-shiny-dashboard-faster/">提升 shiny 仪表盘访问性能的4个建议</a></p>
</div>
<div id="sec-shiny-dashboard" class="section level2" number="20.8">
<h2>
<span class="header-section-number">20.8</span> 仪表盘<a class="anchor" aria-label="anchor" href="#sec-shiny-dashboard"><i class="fas fa-link"></i></a>
</h2>
<p>dashboard 翻译过来叫仪表盘，就是驾驶仓的那个玩意，形象地表达作为掌舵者应该关注的对象。R 包 shiny 出现后，仪表盘的制作显得非常容易，也很快形成了一个生态，比如 <a href="https://rstudio.github.io/shinydashboard">shinydashboard</a>、 <a href="https://github.com/rstudio/flexdashboard">flexdashboard</a> 等，此外 <a href="https://github.com/RinteRface/bs4Dash">bs4Dash</a> 基于 Bootstrap 4 的仪表盘，目前 shiny 和 rmarkdown 都在向 Bootstrap 4 升级，这是未来的方向。 <a href="https://github.com/RinteRface/shinydashboardPlus">shinydashboardPlus</a> 主要目的在于扩展 <strong>shinydashboard</strong> 包</p>
<p>shinydashboard 包</p>
<div class="sourceCode" id="cb1884"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## app.R ##</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">dashboardPage</span><span class="op">(</span>
    <span class="fu">dashboardHeader</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Basic dashboard"</span><span class="op">)</span>,
    <span class="co">## Sidebar content</span>
    <span class="fu">dashboardSidebar</span><span class="op">(</span>
        <span class="fu">sidebarMenu</span><span class="op">(</span>
            <span class="fu">menuItem</span><span class="op">(</span><span class="st">"Dashboard"</span>, tabName <span class="op">=</span> <span class="st">"dashboard"</span>, icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"dashboard"</span><span class="op">)</span><span class="op">)</span>,
            <span class="fu">menuItem</span><span class="op">(</span><span class="st">"Widgets"</span>, tabName <span class="op">=</span> <span class="st">"widgets"</span>, icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"th"</span><span class="op">)</span><span class="op">)</span>
        <span class="op">)</span>
    <span class="op">)</span>,
    <span class="co">## Body content</span>
    <span class="fu">dashboardBody</span><span class="op">(</span>
        <span class="fu">tabItems</span><span class="op">(</span>
            <span class="co"># First tab content</span>
            <span class="fu">tabItem</span><span class="op">(</span>tabName <span class="op">=</span> <span class="st">"dashboard"</span>,
                    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span>
                        <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"plot1"</span>, height <span class="op">=</span> <span class="fl">250</span><span class="op">)</span><span class="op">)</span>,

                        <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span>
                            title <span class="op">=</span> <span class="st">"Controls"</span>,
                            <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"slider"</span>, <span class="st">"Number of observations:"</span>, <span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">50</span><span class="op">)</span>
                        <span class="op">)</span>
                    <span class="op">)</span>
            <span class="op">)</span>,

            <span class="co"># Second tab content</span>
            <span class="fu">tabItem</span><span class="op">(</span>tabName <span class="op">=</span> <span class="st">"widgets"</span>,
                    <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/builder.html">h2</a></span><span class="op">(</span><span class="st">"Widgets tab content"</span><span class="op">)</span>
            <span class="op">)</span>
        <span class="op">)</span>
    <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">122</span><span class="op">)</span>
    <span class="va">histdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span>

    <span class="va">output</span><span class="op">$</span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
        <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">histdata</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">slider</span><span class="op">)</span><span class="op">]</span>
        <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
    <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>shinydashboardPlus 包</p>
<div class="sourceCode" id="cb1885"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://rstudio.github.io/shinydashboard/">shinydashboard</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RinteRface/shinydashboardPlus">shinydashboardPlus</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>
  ui <span class="op">=</span> <span class="fu">dashboardPage</span><span class="op">(</span>
    <span class="fu">dashboardHeader</span><span class="op">(</span><span class="op">)</span>,
    <span class="fu">dashboardSidebar</span><span class="op">(</span><span class="op">)</span>,
    <span class="fu">dashboardBody</span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/graphics/box.html">box</a></span><span class="op">(</span>
        solidHeader <span class="op">=</span> <span class="cn">FALSE</span>,
        title <span class="op">=</span> <span class="st">"Status summary"</span>,
        background <span class="op">=</span> <span class="cn">NULL</span>,
        width <span class="op">=</span> <span class="fl">4</span>,
        status <span class="op">=</span> <span class="st">"danger"</span>,
        footer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html">fluidRow</a></span><span class="op">(</span>
          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span>
            width <span class="op">=</span> <span class="fl">6</span>,
            <span class="fu">descriptionBlock</span><span class="op">(</span>
              number <span class="op">=</span> <span class="st">"17%"</span>,
              numberColor <span class="op">=</span> <span class="st">"green"</span>,
              numberIcon <span class="op">=</span> <span class="st">"fa fa-caret-up"</span>,
              header <span class="op">=</span> <span class="st">"$35,210.43"</span>,
              text <span class="op">=</span> <span class="st">"TOTAL REVENUE"</span>,
              rightBorder <span class="op">=</span> <span class="cn">TRUE</span>,
              marginBottom <span class="op">=</span> <span class="cn">FALSE</span>
            <span class="op">)</span>
          <span class="op">)</span>,
          <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html">column</a></span><span class="op">(</span>
            width <span class="op">=</span> <span class="fl">6</span>,
            <span class="fu">descriptionBlock</span><span class="op">(</span>
              number <span class="op">=</span> <span class="st">"18%"</span>,
              numberColor <span class="op">=</span> <span class="st">"red"</span>,
              numberIcon <span class="op">=</span> <span class="st">"fa fa-caret-down"</span>,
              header <span class="op">=</span> <span class="st">"1200"</span>,
              text <span class="op">=</span> <span class="st">"GOAL COMPLETION"</span>,
              rightBorder <span class="op">=</span> <span class="cn">FALSE</span>,
              marginBottom <span class="op">=</span> <span class="cn">FALSE</span>
            <span class="op">)</span>
          <span class="op">)</span>
        <span class="op">)</span>
      <span class="op">)</span>
    <span class="op">)</span>,
    title <span class="op">=</span> <span class="st">"Description Blocks"</span>
  <span class="op">)</span>,
  server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span> <span class="op">}</span>
<span class="op">)</span></code></pre></div>
<p>shinymaterial 包</p>
<div class="sourceCode" id="cb1886"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ericrayanderson.github.io/shinymaterial/">shinymaterial</a></span><span class="op">)</span>

<span class="co"># https://ericrayanderson.github.io/shinymaterial/</span>
<span class="co"># https://github.com/ericrayanderson/shinymaterial</span>

<span class="co"># Wrap shinymaterial apps in material_page</span>
<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">material_page</span><span class="op">(</span>
  title <span class="op">=</span> <span class="st">"用户画像"</span>,
  nav_bar_fixed <span class="op">=</span> <span class="cn">TRUE</span>,
  <span class="co"># 每个 sidebar 内容</span>
  <span class="fu">material_side_nav</span><span class="op">(</span>
    fixed <span class="op">=</span> <span class="cn">TRUE</span>,
    <span class="co"># Place side-nav tabs within side-nav</span>
    <span class="fu">material_side_nav_tabs</span><span class="op">(</span>
      side_nav_tabs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span>
        <span class="st">"数据汇总"</span> <span class="op">=</span> <span class="st">"tab_1"</span>,
        <span class="st">"趋势信息"</span> <span class="op">=</span> <span class="st">"tab_2"</span>
      <span class="op">)</span>,
      icons <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"cast"</span>, <span class="st">"insert_chart"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>,
  <span class="co"># 每个 tab 页面的内容</span>
  <span class="fu">material_side_nav_tab_content</span><span class="op">(</span>
    side_nav_tab_id <span class="op">=</span> <span class="st">"tab_1"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">h2</span><span class="op">(</span><span class="st">"第一个tab页"</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="fu">material_side_nav_tab_content</span><span class="op">(</span>
    side_nav_tab_id <span class="op">=</span> <span class="st">"tab_2"</span>,
    <span class="va">tags</span><span class="op">$</span><span class="fu">h2</span><span class="op">(</span><span class="st">"第二个tab页"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>

<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></code></pre></div>
<p>miniUI 包</p>
<div class="sourceCode" id="cb1887"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/">shiny</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">miniUI</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/leaflet/">leaflet</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniPage.html">miniPage</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniTitleBar.html">gadgetTitleBar</a></span><span class="op">(</span><span class="st">"Shiny gadget example"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniTabstripPanel.html">miniTabstripPanel</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniTabstripPanel.html">miniTabPanel</a></span><span class="op">(</span><span class="st">"Parameters"</span>, icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"sliders"</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniContentPanel.html">miniContentPanel</a></span><span class="op">(</span>
                   <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/sliderInput.html">sliderInput</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"Year"</span>, <span class="fl">1978</span>, <span class="fl">2010</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">2010</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
                 <span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniTabstripPanel.html">miniTabPanel</a></span><span class="op">(</span><span class="st">"Visualize"</span>, icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"area-chart"</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniContentPanel.html">miniContentPanel</a></span><span class="op">(</span>
                   <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/plotOutput.html">plotOutput</a></span><span class="op">(</span><span class="st">"cars"</span>, height <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span>
                 <span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniTabstripPanel.html">miniTabPanel</a></span><span class="op">(</span><span class="st">"Map"</span>, icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"map-o"</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniContentPanel.html">miniContentPanel</a></span><span class="op">(</span>padding <span class="op">=</span> <span class="fl">0</span>,
                                  <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-shiny.html">leafletOutput</a></span><span class="op">(</span><span class="st">"map"</span>, height <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span>
                 <span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniButtonBlock.html">miniButtonBlock</a></span><span class="op">(</span>
                   <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html">actionButton</a></span><span class="op">(</span><span class="st">"resetMap"</span>, <span class="st">"Reset"</span><span class="op">)</span>
                 <span class="op">)</span>
    <span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniTabstripPanel.html">miniTabPanel</a></span><span class="op">(</span><span class="st">"Data"</span>, icon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/icon.html">icon</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>,
                 <span class="fu"><a href="https://rdrr.io/pkg/miniUI/man/miniContentPanel.html">miniContentPanel</a></span><span class="op">(</span>
                   <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">dataTableOutput</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
                 <span class="op">)</span>
    <span class="op">)</span>,
    selected <span class="op">=</span> <span class="st">"Map"</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">output</span><span class="op">$</span><span class="va">cars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderPlot.html">renderPlot</a></span><span class="op">(</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">speed</span>, <span class="va">dist</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-shiny.html">renderLeaflet</a></span><span class="op">(</span><span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">resetMap</span><span class="op">)</span>

    <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/leaflet.html">leaflet</a></span><span class="op">(</span><span class="va">quakes</span>, height <span class="op">=</span> <span class="st">"100%"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addTiles</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/leaflet/man/leaflet-imports.html">%&gt;%</a></span>
      <span class="fu"><a href="https://rdrr.io/pkg/leaflet/man/map-layers.html">addMarkers</a></span><span class="op">(</span>lng <span class="op">=</span> <span class="op">~</span><span class="va">long</span>, lat <span class="op">=</span> <span class="op">~</span><span class="va">lat</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="va">output</span><span class="op">$</span><span class="va">table</span> <span class="op">&lt;-</span> <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html">renderDataTable</a></span><span class="op">(</span><span class="op">{</span>
    <span class="va">diamonds</span>
  <span class="op">}</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">done</span>, <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/stopApp.html">stopApp</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-interactive-dash-app" class="section level2" number="20.9">
<h2>
<span class="header-section-number">20.9</span> 交互式数据报表 dash<a class="anchor" aria-label="anchor" href="#sec-interactive-dash-app"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb1888"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/plotly/dashR">dash</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/plotly/dash-html-components">dashHtmlComponents</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/plotly/dash-core-components">dashCoreComponents</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/plotly/dash-table">dashTable</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-session-shiny" class="section level2" number="20.10">
<h2>
<span class="header-section-number">20.10</span> 运行环境<a class="anchor" aria-label="anchor" href="#sec-session-shiny"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb1889"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.1.2 (2021-11-01)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.3 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] data.table_1.14.2 shiny_1.7.1      
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.7       knitr_1.37       xml2_1.3.3       magrittr_2.0.1  
##  [5] sysfonts_0.8.5   downlit_0.4.0    xtable_1.8-4     R6_2.5.1        
##  [9] rlang_0.4.12     fastmap_1.1.0    highr_0.9        stringr_1.4.0   
## [13] tools_4.1.2      xfun_0.29        png_0.1-7        jquerylib_0.1.4 
## [17] ellipsis_0.3.2   htmltools_0.5.2  yaml_2.2.1       digest_0.6.29   
## [21] lifecycle_1.0.1  bookdown_0.24    later_1.3.0      promises_1.2.0.1
## [25] sass_0.4.0       fs_1.5.2         curl_4.3.2       mime_0.12       
## [29] memoise_2.0.1    cachem_1.0.6     evaluate_0.14    rmarkdown_2.11  
## [33] stringi_1.7.6    compiler_4.1.2   bslib_0.3.1      jsonlite_1.7.2  
## [37] httpuv_1.6.5</code></pre>

</div>
</div>



<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-RJ-2021-004" class="csl-entry">
<div class="csl-left-margin">[29] </div>
<div class="csl-right-inline">P. Kasprzak, L. Mitchell, O. Kravchuk, and A. Timmins, <span>“<span class="nocase">Six Years of Shiny in Research - Collaborative Development of Web Tools in R</span>,”</span> <em><span>The R Journal</span></em>, vol. 12, no. 2, pp. 155–162, 2021, doi: <a href="https://doi.org/10.32614/RJ-2021-004">10.32614/RJ-2021-004</a>.</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chap-interactive-data-tables.html"><span class="header-section-number">19</span> 交互表格</a></div>
<div class="next"><a href="chap-statistical-foundations.html">介绍</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-interactive-shiny-app"><span class="header-section-number">20</span> 交互报表</a></li>
<li><a class="nav-link" href="#sec-dev-workflow"><span class="header-section-number">20.1</span> 开发流程</a></li>
<li><a class="nav-link" href="#sec-dev-tools"><span class="header-section-number">20.2</span> 开发工具</a></li>
<li><a class="nav-link" href="#sec-foundations"><span class="header-section-number">20.3</span> 基础知识</a></li>
<li>
<a class="nav-link" href="#sec-shiny-elements"><span class="header-section-number">20.4</span> 基础组件</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#subsec-bookmark"><span class="header-section-number">20.4.1</span> 书签</a></li>
<li><a class="nav-link" href="#subsec-shiny-tables"><span class="header-section-number">20.4.2</span> 表格</a></li>
</ul>
</li>
<li><a class="nav-link" href="#sec-advanced-topics"><span class="header-section-number">20.5</span> 高级主题</a></li>
<li><a class="nav-link" href="#sec-shiny-deployment"><span class="header-section-number">20.6</span> 部署应用</a></li>
<li><a class="nav-link" href="#sec-shiny-principles"><span class="header-section-number">20.7</span> 最佳实践</a></li>
<li><a class="nav-link" href="#sec-shiny-dashboard"><span class="header-section-number">20.8</span> 仪表盘</a></li>
<li><a class="nav-link" href="#sec-interactive-dash-app"><span class="header-section-number">20.9</span> 交互式数据报表 dash</a></li>
<li><a class="nav-link" href="#sec-session-shiny"><span class="header-section-number">20.10</span> 运行环境</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/masr/blob/devel/interactive-shiny-app.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/masr/edit/devel/interactive-shiny-app.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>现代应用统计与 R 语言</strong>: Modern Applied Statistics with R" was written by 黄湘云. It was last built on 2022-01-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
