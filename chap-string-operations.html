<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 4 章 字符串操作 | 现代应用统计与 R 语言</title>
<meta name="author" content="黄湘云">
<meta name="description" content="Handling Strings with R 和 R for Data Science 提供字符串入门介绍 ，Sara Stoudt 整理了 stringr 包与 Base R 正则表达式函数的对应表 https://stringr.tidyverse.org/articles/from-base.html stringr 基于 stringi 包字符串处理包， re2r 包基于...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="第 4 章 字符串操作 | 现代应用统计与 R 语言">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="Handling Strings with R 和 R for Data Science 提供字符串入门介绍 ，Sara Stoudt 整理了 stringr 包与 Base R 正则表达式函数的对应表 https://stringr.tidyverse.org/articles/from-base.html stringr 基于 stringi 包字符串处理包， re2r 包基于...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 4 章 字符串操作 | 现代应用统计与 R 语言">
<meta name="twitter:description" content="Handling Strings with R 和 R for Data Science 提供字符串入门介绍 ，Sara Stoudt 整理了 stringr 包与 Base R 正则表达式函数的对应表 https://stringr.tidyverse.org/articles/from-base.html stringr 基于 stringi 包字符串处理包， re2r 包基于...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs/header-attrs.js"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><script src="libs/proj4js/proj4.js"></script><link href="libs/highcharts/css/motion.css" rel="stylesheet">
<script src="libs/highcharts/highcharts.js"></script><script src="libs/highcharts/highcharts-3d.js"></script><script src="libs/highcharts/highcharts-more.js"></script><script src="libs/highcharts/modules/stock.js"></script><script src="libs/highcharts/modules/map.js"></script><script src="libs/highcharts/modules/annotations.js"></script><script src="libs/highcharts/modules/data.js"></script><script src="libs/highcharts/modules/drilldown.js"></script><script src="libs/highcharts/modules/item-series.js"></script><script src="libs/highcharts/modules/offline-exporting.js"></script><script src="libs/highcharts/modules/overlapping-datalabels.js"></script><script src="libs/highcharts/modules/exporting.js"></script><script src="libs/highcharts/modules/export-data.js"></script><script src="libs/highcharts/modules/funnel.js"></script><script src="libs/highcharts/modules/heatmap.js"></script><script src="libs/highcharts/modules/treemap.js"></script><script src="libs/highcharts/modules/sankey.js"></script><script src="libs/highcharts/modules/dependency-wheel.js"></script><script src="libs/highcharts/modules/organization.js"></script><script src="libs/highcharts/modules/solid-gauge.js"></script><script src="libs/highcharts/modules/streamgraph.js"></script><script src="libs/highcharts/modules/sunburst.js"></script><script src="libs/highcharts/modules/vector.js"></script><script src="libs/highcharts/modules/wordcloud.js"></script><script src="libs/highcharts/modules/xrange.js"></script><script src="libs/highcharts/modules/tilemap.js"></script><script src="libs/highcharts/modules/venn.js"></script><script src="libs/highcharts/modules/gantt.js"></script><script src="libs/highcharts/modules/timeline.js"></script><script src="libs/highcharts/modules/parallel-coordinates.js"></script><script src="libs/highcharts/modules/bullet.js"></script><script src="libs/highcharts/modules/coloraxis.js"></script><script src="libs/highcharts/modules/dumbbell.js"></script><script src="libs/highcharts/modules/lollipop.js"></script><script src="libs/highcharts/modules/series-label.js"></script><script src="libs/highcharts/plugins/motion.js"></script><script src="libs/highcharts/custom/reset.js"></script><script src="libs/highcharts/modules/boost.js"></script><script src="libs/highchart-binding/highchart.js"></script><link href="libs/dygraphs/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs/dygraph-combined.js"></script><script src="libs/dygraphs/shapes.js"></script><script src="libs/moment/moment.js"></script><script src="libs/moment-timezone/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding/dygraphs.js"></script><script src="libs/Dygraph.Plugins.Unzoom/unzoom.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/es6shim/es6shim.js"></script><script src="libs/es7shim/es7shim.js"></script><script src="libs/graphre/graphre.js"></script><script src="libs/nomnoml/nomnoml.js"></script><script src="libs/nomnoml-binding/nomnoml.js"></script><script src="libs/d3-bundle/d3-bundle.min.js"></script><script src="libs/d3-lasso/d3-lasso.min.js"></script><script src="libs/save-svg-as-png/save-svg-as-png.min.js"></script><link href="libs/ggiraphjs/ggiraphjs.min.css" rel="stylesheet">
<script src="libs/ggiraphjs/ggiraphjs.min.js"></script><script src="libs/girafe-binding/girafe.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><script src="libs/jszip/jszip.min.js"></script><script src="libs/pdfmake/pdfmake.js"></script><script src="libs/pdfmake/vfs_fonts.js"></script><link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script><link href="libs/dt-ext-rowgroup/css/rowGroup.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-rowgroup/js/dataTables.rowGroup.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/echarts-world/world.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Modern Applied Statistics with R">现代应用统计与 R 语言</a>:
        <small class="text-muted">Modern Applied Statistics with R</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="active" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">动态文档</li>
<li><a class="" href="chap-dynamic-documents.html">介绍</a></li>
<li><a class="" href="chap-document-elements.html"><span class="header-section-number">13</span> 文档元素</a></li>
<li><a class="" href="chap-portable-document.html"><span class="header-section-number">14</span> 便携式文档</a></li>
<li><a class="" href="chap-web-documents.html"><span class="header-section-number">15</span> 网页文档</a></li>
<li><a class="" href="chap-office-document.html"><span class="header-section-number">16</span> 办公文档</a></li>
<li><a class="" href="chap-reproducible-workflows.html"><span class="header-section-number">17</span> 工作流</a></li>
<li><a class="" href="chap-advanced-documents.html"><span class="header-section-number">18</span> 高级文档</a></li>
<li class="book-part">数据产品</li>
<li><a class="" href="chap-data-product.html">介绍</a></li>
<li><a class="" href="chap-interactive-data-tables.html"><span class="header-section-number">19</span> 交互表格</a></li>
<li><a class="" href="chap-interactive-shiny-app.html"><span class="header-section-number">20</span> 交互报表</a></li>
<li class="book-part">统计基础</li>
<li><a class="" href="chap-statistical-foundations.html">介绍</a></li>
<li><a class="" href="chap-sampling-distributions.html"><span class="header-section-number">21</span> 抽样分布</a></li>
<li><a class="" href="chap-parameter-estimators.html"><span class="header-section-number">22</span> 参数估计</a></li>
<li><a class="" href="chap-hypothesis-test.html"><span class="header-section-number">23</span> 假设检验</a></li>
<li><a class="" href="chap-power-Analysis.html"><span class="header-section-number">24</span> 功效分析</a></li>
<li><a class="" href="chap-experimental-design.html"><span class="header-section-number">25</span> 试验设计</a></li>
<li class="book-part">统计模型</li>
<li><a class="" href="chap-statistical-models.html">介绍</a></li>
<li><a class="" href="chap-linear-models.html"><span class="header-section-number">26</span> 线性模型</a></li>
<li><a class="" href="chap-generalized-linear-models.html"><span class="header-section-number">27</span> 广义线性模型</a></li>
<li><a class="" href="chap-bayesian-models.html"><span class="header-section-number">28</span> 贝叶斯模型</a></li>
<li class="book-part">数据建模</li>
<li><a class="" href="chap-data-modeling.html">介绍</a></li>
<li><a class="" href="chap-text-analysis.html"><span class="header-section-number">29</span> 文本分析</a></li>
<li><a class="" href="chap-survival-analysis.html"><span class="header-section-number">30</span> 生存分析</a></li>
<li><a class="" href="chap-time-series-analysis.html"><span class="header-section-number">31</span> 时序分析</a></li>
<li class="book-part">时空数据</li>
<li><a class="" href="chap-spatio-temporal-data.html">介绍</a></li>
<li><a class="" href="chap-spatial-analysis.html"><span class="header-section-number">32</span> 空间数据分析</a></li>
<li><a class="" href="chap-spatial-modeling.html"><span class="header-section-number">33</span> 空间数据建模</a></li>
<li><a class="" href="chap-spatial-viz.html"><span class="header-section-number">34</span> 空间数据可视化</a></li>
<li><a class="" href="chap-case-study.html"><span class="header-section-number">35</span> 案例研究</a></li>
<li><a class="" href="chap-data-explorer.html"><span class="header-section-number">36</span> 数据探索</a></li>
<li class="book-part">机器学习</li>
<li><a class="" href="chap-machine-learning.html">介绍</a></li>
<li><a class="" href="chap-gradient-boosting-machine.html"><span class="header-section-number">37</span> 梯度提升机</a></li>
<li><a class="" href="chap-numerical-optimization.html"><span class="header-section-number">38</span> 数值优化</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="chap-matrix-operations.html"><span class="header-section-number">B</span> 矩阵运算</a></li>
<li><a class="" href="chap-symbolic-computation.html"><span class="header-section-number">C</span> 符号计算</a></li>
<li><a class="" href="chap-mixed-programming.html"><span class="header-section-number">D</span> 混合编程</a></li>
<li><a class="" href="chap-object-oriented-programming.html"><span class="header-section-number">E</span> 面向对象编程</a></li>
<li><a class="" href="chap-file-operations.html"><span class="header-section-number">F</span> 文件操作</a></li>
<li><a class="" href="chap-other-softwares.html"><span class="header-section-number">G</span> 其它软件</a></li>
<li><a class="" href="chap-notations.html"><span class="header-section-number">H</span> 符号说明</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/masr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-string-operations" class="section level1" number="4">
<h1>
<span class="header-section-number">第 4 章</span> 字符串操作<a class="anchor" aria-label="anchor" href="#chap-string-operations"><i class="fas fa-link"></i></a>
</h1>
<p><a href="https://www.gastonsanchez.com/r4strings/">Handling Strings with R</a> 和 <a href="https://r4ds.had.co.nz/strings.html">R for Data Science</a> 提供字符串入门介绍 ，Sara Stoudt 整理了 stringr 包与 Base R 正则表达式函数的对应表 <a href="https://stringr.tidyverse.org/articles/from-base.html" class="uri">https://stringr.tidyverse.org/articles/from-base.html</a></p>
<p><a href="https://stringr.tidyverse.org/">stringr</a> 基于 <a href="https://github.com/gagolews/stringi">stringi</a> 包字符串处理包， <a href="https://github.com/qinwf/re2r/">re2r</a> 包基于 Google 开发的 C++ 库 <a href="https://github.com/google/re2">re2</a>，Google 编程之夏项目提供了一份 <a href="https://github.com/rstats-gsoc/gsoc2016/wiki/re2-regular-expressions">正则表达式性能综述</a>， <a href="https://github.com/markvanderloo/stringdist">stringdist</a> Approximate String Matching and String Distance Functions 近似字符串匹配和字符串距离计算函数 <span class="citation"><a href="#ref-stringdist2014" role="doc-biblioref">[12]</a></span></p>
<ul>
<li><a href="https://github.com/sfirke/janitor">janitor</a></li>
<li><a href="https://www.brodrigues.co/blog/2019-02-10-stringr_package/">Manipulating strings with the stringr package</a></li>
<li>
<a href="https://github.com/rorynolan/filesstrings">filesstrings</a> 基于 stringr 操作字符串</li>
<li>
<a href="https://github.com/rorynolan/strex">strex</a> 一些没有包含在 stringr 或者 stringi 中的字符串操作函数</li>
<li>
<a href="https://github.com/juliasilge/tidytext">tidytext</a> Text mining using dplyr, ggplot2, and other tidy tools</li>
</ul>
<p><a href="https://github.com/markvanderloo/stringdist">stringdist</a>
<a href="https://github.com/traversc/stringfish">stringfish</a>
<a href="https://github.com/hadley/stringb">stringb</a>
<a href="https://github.com/gagolews/stringi">stringi</a>
<a href="https://github.com/tidyverse/stringr">stringr</a></p>
<p>字符和字符串类型的数据值得单独拿出来讲，不仅因为内容多，而且比较难，应用范围最广，特别是面对文本类型的数据时，几乎是避不开的！R 的前身是 S，S 的前身是一些 Fortran 和 C 子程序，最早在贝尔实验室是用于文本分析领域，因此在 R 基础包中提供了丰富的字符串处理函数，你可以在R控制台中执行如下一行命令查看</p>
<div class="sourceCode" id="cb309"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/help.search.html">help.search</a></span><span class="op">(</span>keyword <span class="op">=</span> <span class="st">"character"</span>, package <span class="op">=</span> <span class="st">"base"</span><span class="op">)</span></code></pre></div>
<p>本章主要介绍 R 内置的字符串操作函数</p>
<div id="base-count" class="section level2" number="4.1">
<h2>
<span class="header-section-number">4.1</span> 字符数统计<a class="anchor" aria-label="anchor" href="#base-count"><i class="fas fa-link"></i></a>
</h2>
<p><code>nchar</code> 函数统计字符串向量中每个元素的字符个数，注意与函数<code>length</code> 的差别，它统计向量中元素的个数，即向量的长度。</p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"Hello"</span>, <span class="st">"world"</span>, <span class="st">"!"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 5 5 1</code></pre>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R.version.string</span></code></pre></div>
<pre><code>## [1] "R version 4.1.2 (2021-11-01)"</code></pre>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">R.version.string</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 28</code></pre>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/deparse.html">deparse</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "function (x, ...) "  "UseMethod(\"mean\")"</code></pre>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/deparse.html">deparse</a></span><span class="op">(</span><span class="fu">base</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 18 17</code></pre>
<p>一些特殊的情况</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb326"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pi</span></code></pre></div>
<pre><code>## [1] 3.141593</code></pre>
<div class="sourceCode" id="cb328"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb330"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2.718282</code></pre>
<div class="sourceCode" id="cb332"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb334"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
</div>
<div id="base-translations" class="section level2" number="4.2">
<h2>
<span class="header-section-number">4.2</span> 字符串翻译<a class="anchor" aria-label="anchor" href="#base-translations"><i class="fas fa-link"></i></a>
</h2>
<p><code>tolower</code> 将字符串或字符串向量中含有的大写字母全都转化为小写， <code>toupper</code> 函数正好与之相反.</p>
<div class="sourceCode" id="cb336"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"HELLO"</span>, <span class="st">"Hello, R"</span>, <span class="st">"hello"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "hello"    "hello, r" "hello"</code></pre>
<div class="sourceCode" id="cb338"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"HELLO"</span>, <span class="st">"Hello, R"</span>, <span class="st">"hello"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "HELLO"    "HELLO, R" "HELLO"</code></pre>
</div>
<div id="base-concatenate" class="section level2" number="4.3">
<h2>
<span class="header-section-number">4.3</span> 字符串连接<a class="anchor" aria-label="anchor" href="#base-concatenate"><i class="fas fa-link"></i></a>
</h2>
<p><code>paste</code> 函数设置参数 sep 作为连接符，设置参数 collapse 可以将字符串拼接后连成一个字符串</p>
<div class="sourceCode" id="cb340"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "AB"</code></pre>
<div class="sourceCode" id="cb342"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "A-1" "B-2" "C-3"</code></pre>
<div class="sourceCode" id="cb344"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, sep <span class="op">=</span> <span class="st">"-"</span>, collapse <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "A-1;B-2;C-3"</code></pre>
<p><code>paste0</code> 相当于 sep 设为空，没有连接符</p>
<div class="sourceCode" id="cb346"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "AB"</code></pre>
<div class="sourceCode" id="cb348"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "A1" "B2" "C3"</code></pre>
<div class="sourceCode" id="cb350"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, collapse <span class="op">=</span> <span class="st">";"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "A1;B2;C3"</code></pre>
</div>
<div id="base-strsplit" class="section level2" number="4.4">
<h2>
<span class="header-section-number">4.4</span> 字符串拆分<a class="anchor" aria-label="anchor" href="#base-strsplit"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb352"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">split</span>, fixed <span class="op">=</span> <span class="cn">FALSE</span>, perl <span class="op">=</span> <span class="cn">FALSE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><code>strsplit</code> 函数用于字符串拆分，参数 x 是被拆分的字符串向量，其每个元素都会被拆分，而参数 split 表示拆分的位置，可以用正则表达式来描述位置，拆分的结果是一个列表。</p>
<p>参数 fixed 默认设置 <code>fixed = FALSE</code> 表示正则表达式匹配，而 <code>fixed = TRUE</code> 表示正则表达式的精确匹配或者按文本字符的字面意思匹配，即按普通文本匹配。我们知道按普通文本匹配速度快。</p>
<p>当启用 <code>perl = TRUE</code> 时，由 <code>PCRE_use_JIT</code> 控制细节。<code>perl</code> 参数的设置与 Perl 软件版本有关，如果正则表达式很长，除了正确设置正则表达式，使用 <code>perl = TRUE</code> 可以提高运算速度</p>
<p>参数 useBytes 设置是否按照逐个字节地进行匹配，默认设置为 FALSE，即按照字符而不是字节进行匹配</p>
<div class="sourceCode" id="cb353"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span>as <span class="op">=</span> <span class="st">"asfef"</span>, qu <span class="op">=</span> <span class="st">"qwerty"</span>, <span class="st">"yuiop["</span>, <span class="st">"b"</span>, <span class="st">"stuff.blah.yech"</span><span class="op">)</span>
<span class="co"># 按字母 e 拆分字符串向量 x</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"e"</span><span class="op">)</span></code></pre></div>
<pre><code>## $as
## [1] "asf" "f"  
## 
## $qu
## [1] "qw"  "rty"
## 
## [[3]]
## [1] "yuiop["
## 
## [[4]]
## [1] "b"
## 
## [[5]]
## [1] "stuff.blah.y" "ch"</code></pre>
<p>参数 split 支持通过正则表达式的方式指明拆分位置</p>
<div class="sourceCode" id="cb355"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 默认将点号 . 看作一个正则表达式，它是一个元字符，匹配任意字符</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="st">"a.b.c"</span>, <span class="st">"."</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "" "" "" "" ""</code></pre>
<div class="sourceCode" id="cb357"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 这才是按点号拆分</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="st">"a.b.c"</span>, <span class="st">"."</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "a" "b" "c"</code></pre>
<div class="sourceCode" id="cb359"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 或者</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="st">"a.b.c"</span>, <span class="st">"[.]"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "a" "b" "c"</code></pre>
<div class="sourceCode" id="cb361"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 或者转义点号，去掉元字符的特殊意义</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="st">"a.b.c"</span>, <span class="st">"\\."</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "a" "b" "c"</code></pre>
<p>这里介绍一个将字符串逆序的函数 <code>str_rev</code></p>
<div class="sourceCode" id="cb363"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">str_rev</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
        <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="cn">NULL</span><span class="op">)</span>, <span class="va">rev</span><span class="op">)</span>, <span class="va">paste</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="fu">str_rev</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"abc"</span>, <span class="st">"Statistics"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "cba"        "scitsitatS"</code></pre>
<p>为了加深理解，再举几个例子</p>
<div class="sourceCode" id="cb365"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 最后一个空字符没有产生</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"a"</span>, <span class="st">""</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">"#"</span><span class="op">)</span>, split<span class="op">=</span><span class="st">"#"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] ""  "a"</code></pre>
<div class="sourceCode" id="cb367"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 空字符只有有定义的时候才会产生</span>
<span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">" "</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## character(0)</code></pre>
<div class="sourceCode" id="cb369"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="st">" "</span>, <span class="st">" "</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] ""</code></pre>
</div>
<div id="base-match" class="section level2" number="4.5">
<h2>
<span class="header-section-number">4.5</span> 字符串匹配<a class="anchor" aria-label="anchor" href="#base-match"><i class="fas fa-link"></i></a>
</h2>
<p><code>agrep</code> 和 <code>agrepl</code> 函数做近似（模糊）匹配 (Approximate Matching or Fuzzy Matching) ，对于匹配，考虑到参数 pattern 在参数 x 中匹配时，允许参数值x存在最小可能的插入、删除和替换，这种修改叫做Levenshtein 编辑距离，<code>max.distance</code> 控制其细节</p>
<div class="sourceCode" id="cb371"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">x</span>, max.distance <span class="op">=</span> <span class="fl">0.1</span>, costs <span class="op">=</span> <span class="cn">NULL</span>,
      ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, value <span class="op">=</span> <span class="cn">FALSE</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span>,
      useBytes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrepl</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">x</span>, max.distance <span class="op">=</span> <span class="fl">0.1</span>, costs <span class="op">=</span> <span class="cn">NULL</span>,
       ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><code>agrep</code> 函数返回 pattern 在 x 中匹配到的一个位置向量，<code>agrepl</code> 返回一个逻辑向量，这一点类似 <code>grep</code> 和 <code>grepl</code> 这对函数，下面举例子说明</p>
<div class="sourceCode" id="cb372"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"lasy"</span>, <span class="st">"1 lazy 2"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb374"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># sub = 0 表示匹配时不考虑替换</span>
<span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"lasy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">" 1 lazy 2"</span>, <span class="st">"1 lasy 2"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb376"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 默认设置下，匹配时区分大小写</span>
<span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"laysy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"1 lazy"</span>, <span class="st">"1"</span>, <span class="st">"1 LAZY"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb378"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 返回匹配到值，而不是位置下标，类似 grep(..., value = TRUE) 的返回值</span>
<span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"laysy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"1 lazy"</span>, <span class="st">"1"</span>, <span class="st">"1 LAZY"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">2</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "1 lazy"</code></pre>
<div class="sourceCode" id="cb380"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 不区分大小写</span>
<span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"laysy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"1 lazy"</span>, <span class="st">"1"</span>, <span class="st">"1 LAZY"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">2</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1 3</code></pre>
<div class="sourceCode" id="cb382"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html">startsWith</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">prefix</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/startsWith.html">endsWith</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">suffix</span><span class="op">)</span></code></pre></div>
<p><code>startsWith</code> 和 <code>endsWith</code> 函数用来匹配字符串的前缀和后缀，返回值是一个逻辑向量，参数 prefix 和 suffix 不要包含特殊的正则表达式字符，如点号<code>.</code>，举例子</p>
<div class="sourceCode" id="cb383"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 字符串向量</span>
<span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] ".GlobalEnv"        "package:stats"     "package:graphics" 
## [4] "package:grDevices" "package:utils"     "package:datasets" 
## [7] "package:methods"   "Autoloads"         "package:base"</code></pre>
<div class="sourceCode" id="cb385"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 匹配以 package: 开头的字符串</span>
<span class="fu"><a href="https://rdrr.io/r/base/startsWith.html">startsWith</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"package:"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb387"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 或者</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"^package:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/search.html">search</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE</code></pre>
<p>当前目录下，列出扩展名为 <code>.Rmd</code> 的文件</p>
<div class="sourceCode" id="cb389"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># list.files(path = ".", pattern = "\\.Rmd$")</span>
<span class="co"># 而不是 endsWith(list.files(), "\\.Rmd")</span>
<span class="fu"><a href="https://rdrr.io/r/base/startsWith.html">endsWith</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">".Rmd"</span><span class="op">)</span></code></pre></div>
<pre><code>##   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
##  [13]  TRUE  TRUE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE
##  [25]  TRUE FALSE  TRUE FALSE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE
##  [37] FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE
##  [49]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE FALSE FALSE  TRUE
##  [61]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE
##  [73] FALSE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [85]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [97]  TRUE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE  TRUE FALSE  TRUE
## [109]  TRUE  TRUE FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE
## [121]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
## [133]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb391"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 或者</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"\\.Rmd$"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE
##  [13]  TRUE  TRUE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE
##  [25]  TRUE FALSE  TRUE FALSE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE
##  [37] FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE FALSE  TRUE
##  [49]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE FALSE FALSE FALSE  TRUE
##  [61]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE
##  [73] FALSE FALSE  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
##  [85]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
##  [97]  TRUE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE  TRUE FALSE  TRUE
## [109]  TRUE  TRUE FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE
## [121]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE  TRUE  TRUE
## [133]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE</code></pre>
<p>部分匹配(Partial String Matching)</p>
<div class="sourceCode" id="cb393"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">table</span>, nomatch <span class="op">=</span> <span class="cn">NA_integer_</span>, incomparables <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>
<span class="va">x</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">table</span>
<span class="fu"><a href="https://rdrr.io/r/base/charmatch.html">charmatch</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">table</span>, nomatch <span class="op">=</span> <span class="cn">NA_integer_</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/pmatch.html">pmatch</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">table</span>, nomatch <span class="op">=</span> <span class="cn">NA_integer_</span>, duplicates.ok <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>这几个 <code>match</code> 函数的返回值都是一个向量，每个元素是参数x在参数table中第一次匹配到的位置，<code>charmatch</code> 与 <code>pmatch(x, table, nomatch = NA_integer_, duplicates.ok = TRUE)</code> 类似，所以 <code>pmatch</code> 在默认 <code>duplicates.ok = FALSE</code> 的情况下，若x在第二个参数table中有多次匹配就会返回 NA，因此，实际上 <code>pmatch</code> 只允许在第二个参数中匹配一次</p>
<div class="sourceCode" id="cb394"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"abc"</span>, <span class="st">"xx"</span>, <span class="st">"xxx"</span>, <span class="st">"xx"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb396"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span><span class="op">:</span><span class="fl">10</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">9</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb398"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># charmatch 就比较奇怪，规则太多</span>
<span class="fu"><a href="https://rdrr.io/r/base/charmatch.html">charmatch</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span><span class="op">)</span>                             <span class="co"># returns 1</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb400"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 多个精确匹配到，或者多个部分匹配到，则返回 0</span>
<span class="fu"><a href="https://rdrr.io/r/base/charmatch.html">charmatch</a></span><span class="op">(</span><span class="st">"m"</span>,   <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"mode"</span>, <span class="st">"quantile"</span><span class="op">)</span><span class="op">)</span> <span class="co"># returns 0</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb402"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># med 只在table参数值的第二个位置部分匹配到，所以返回2</span>
<span class="fu"><a href="https://rdrr.io/r/base/charmatch.html">charmatch</a></span><span class="op">(</span><span class="st">"med"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"mode"</span>, <span class="st">"quantile"</span><span class="op">)</span><span class="op">)</span> <span class="co"># returns 2</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb404"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/charmatch.html">charmatch</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"xx"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb406"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/charmatch.html">charmatch</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"xxa"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb408"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/charmatch.html">charmatch</a></span><span class="op">(</span><span class="st">"xx"</span>, <span class="st">"axx"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb410"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 注意比较与 charmatch 的不同</span>
<span class="fu"><a href="https://rdrr.io/r/base/pmatch.html">pmatch</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">""</span><span class="op">)</span>                             <span class="co"># returns NA</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb412"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/pmatch.html">pmatch</a></span><span class="op">(</span><span class="st">"m"</span>,   <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"mode"</span><span class="op">)</span><span class="op">)</span> <span class="co"># returns NA</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb414"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/pmatch.html">pmatch</a></span><span class="op">(</span><span class="st">"med"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"median"</span>, <span class="st">"mode"</span><span class="op">)</span><span class="op">)</span> <span class="co"># returns 2</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="base-search" class="section level2" number="4.6">
<h2>
<span class="header-section-number">4.6</span> 字符串查询<a class="anchor" aria-label="anchor" href="#base-search"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb416"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">x</span>,
  ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, perl <span class="op">=</span> <span class="cn">FALSE</span>, value <span class="op">=</span> <span class="cn">FALSE</span>,
  fixed <span class="op">=</span> <span class="cn">FALSE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span>, invert <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">x</span>,
  ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, perl <span class="op">=</span> <span class="cn">FALSE</span>,
  fixed <span class="op">=</span> <span class="cn">FALSE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
<p><code>grep</code> 和 <code>grepl</code> 是一对字符串查询函数，查看字符串向量 x 中是否包含正则表达式 pattern 描述的内容</p>
<ul>
<li>
<code>ignore.case</code>: <code>TRUE</code> 表示忽略大小写，<code>FALSE</code> 表示匹配的时候区分大小写</li>
<li>
<code>fixed = TRUE</code> 表示启用 literal regular expression 字面正则表达式，默认情况下<code>fixed = FALSE</code>
</li>
<li>
<code>grep</code> 函数返回匹配到的字符串向量x的元素的下标，如果 <code>value=TRUE</code> 则返回下标对应的值</li>
<li>
<code>grepl</code> 函数返回一个逻辑向量，检查字符串向量x中的每个元素是否匹配到，匹配到返回 <code>TRUE</code>，没有匹配到返回 <code>FALSE</code>
</li>
</ul>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 返回下标位置</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"[a-z]"</span>, <span class="va">letters</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## [26] 26</code></pre>
<div class="sourceCode" id="cb419"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 返回查询到的值</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"[a-z]"</span>, <span class="va">letters</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
## [20] "t" "u" "v" "w" "x" "y" "z"</code></pre>
<p>继续举例子</p>
<div class="sourceCode" id="cb421"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<div class="sourceCode" id="cb423"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb425"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"a"</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "apple"  "banana"</code></pre>
<div class="sourceCode" id="cb427"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"b"</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "banana"</code></pre>
<p>关于 <code>grepl</code> 函数的使用例子</p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"a"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE TRUE</code></pre>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apple"</span>, <span class="st">"banana"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"b"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE  TRUE</code></pre>
<div class="sidebar">
<p>R 语言是用字符串来表示正则表达式的，但是正则表达式不是字符串，字符串的构造类似算术表达式</p>
</div>
<p>在 R 里面分别表示 <code>a\\b</code> 和 <code>a\b</code></p>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"a\\\\b"</span>, <span class="st">"a\\b"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## a\\b
## a\b</code></pre>
<p>下面在 R 里面分别匹配字符串 <code>a\\b</code> 和 <code>a\b</code> 中的 <code>\\</code> 和 <code>\</code></p>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 匹配字符串中的一个反斜杠</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"a\\\\b"</span>, <span class="st">"a\\b"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\"</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a\\\\b" "a\\b"</code></pre>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"a\\\\b"</span>, <span class="st">"a\\b"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\\\"</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, fixed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a\\\\b" "a\\b"</code></pre>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 匹配字符串中的两个反斜杠</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"a\\\\b"</span>, <span class="st">"a\\b"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\\\"</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a\\\\b"</code></pre>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"a\\\\b"</span>, <span class="st">"a\\b"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\\\\\\\"</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, fixed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a\\\\b"</code></pre>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 匹配字符串中的两个反斜杠 \\</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"a\\\\b"</span>, pattern <span class="op">=</span> <span class="st">"\\\\\\\\"</span>, fixed <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"a\\\\b"</span>, pattern <span class="op">=</span> <span class="st">"\\\\\\\\"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"a\\\\b"</span>, pattern <span class="op">=</span> <span class="st">"\\\\"</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<!-- 此外，还有一个函数 `grepRaw` 用于匹配 Raw Vectors  -->
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">text</span>,
  ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, perl <span class="op">=</span> <span class="cn">FALSE</span>,
  fixed <span class="op">=</span> <span class="cn">FALSE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">text</span>,
  ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, perl <span class="op">=</span> <span class="cn">FALSE</span>,
  fixed <span class="op">=</span> <span class="cn">FALSE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexec</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">text</span>,
  ignore.case <span class="op">=</span> <span class="cn">FALSE</span>, perl <span class="op">=</span> <span class="cn">FALSE</span>,
  fixed <span class="op">=</span> <span class="cn">FALSE</span>, useBytes <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>       </code></pre></div>
<p>当启用 <code>perl=TRUE</code> 时， 函数 <code>regexpr</code> 和 <code>gregexpr</code> 支持 Python 环境下的命名捕获(named captures)，但是不支持长向量的输入。如果一个分组被命名了，如 <code>(?&lt;first&gt;[A-Z][a-z]+)</code> 那么匹配到的位置按命名返回。函数 <code>sub</code> 不支持命名反向引用 (Named backreferences)</p>
<p>函数 <code>regmatches</code> 用来提取函数<code>regexpr</code>, <code>gregexpr</code> 和 <code>regexec</code> 匹配到的子字符串</p>
<p><code>useBytes = FALSE</code> 匹配位置和长度默认是按照字符级别来的，如果 <code>useBytes = TRUE</code> 则是按照逐个字节的匹配结果</p>
<p>如果使用到了 <strong>命名捕获</strong> 则会返回更多的属性 “capture.start”，“capture.length” 和 “capture.names”，分别表示捕获的起始位置、捕获的长度和捕获的命名。</p>
<ul>
<li>
<code>regexpr</code> 函数返回一个整型向量，第一次匹配的初始位置，-1 表示没有匹配到，返回的属性 <code>match.length</code> 表示匹配的字符数量，是一个整型向量，向量长度是匹配的文本的长度，-1 表示没有匹配到</li>
</ul>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"Hellow, Adam!"</span>, <span class="st">"Hi, Adam!"</span>, <span class="st">"How are you, Adam."</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="st">"Adam"</span>, <span class="va">text</span><span class="op">)</span></code></pre></div>
<pre><code>## [1]  9  5 14
## attr(,"match.length")
## [1] 4 4 4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE</code></pre>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span>
  <span class="st">"The"</span>, <span class="st">"licenses"</span>, <span class="st">"for"</span>, <span class="st">"most"</span>, <span class="st">"software"</span>, <span class="st">"are"</span>,
  <span class="st">"designed"</span>, <span class="st">"to"</span>, <span class="st">"take"</span>, <span class="st">"away"</span>, <span class="st">"your"</span>, <span class="st">"freedom"</span>,
  <span class="st">"to"</span>, <span class="st">"share"</span>, <span class="st">"and"</span>, <span class="st">"change"</span>, <span class="st">"it."</span>,
  <span class="st">""</span>, <span class="st">"By"</span>, <span class="st">"contrast,"</span>, <span class="st">"the"</span>, <span class="st">"GNU"</span>, <span class="st">"General"</span>, <span class="st">"Public"</span>, <span class="st">"License"</span>,
  <span class="st">"is"</span>, <span class="st">"intended"</span>, <span class="st">"to"</span>, <span class="st">"guarantee"</span>, <span class="st">"your"</span>, <span class="st">"freedom"</span>, <span class="st">"to"</span>,
  <span class="st">"share"</span>, <span class="st">"and"</span>, <span class="st">"change"</span>, <span class="st">"free"</span>, <span class="st">"software"</span>, <span class="st">"--"</span>,
  <span class="st">"to"</span>, <span class="st">"make"</span>, <span class="st">"sure"</span>, <span class="st">"the"</span>, <span class="st">"software"</span>, <span class="st">"is"</span>,
  <span class="st">"free"</span>, <span class="st">"for"</span>, <span class="st">"all"</span>, <span class="st">"its"</span>, <span class="st">"users"</span>
<span class="op">)</span>
<span class="co"># gregexpr("en", txt)</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="st">"en"</span>, <span class="va">txt</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1] -1  4 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1  2 -1  4
## [26] -1  4 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
## attr(,"match.length")
##  [1] -1  2 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1  2 -1  2
## [26] -1  2 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 -1
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE</code></pre>
<ul>
<li>
<code>gregexpr</code> 函数返回一个列表，返回列表的长度与字符串向量的长度一样，列表中每个元素的形式与 <code>regexpr</code> 的返回值一样, except that the starting positions of every (disjoint) match are given.</li>
</ul>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="st">"Adam"</span>, <span class="va">text</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 9
## attr(,"match.length")
## [1] 4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## 
## [[2]]
## [1] 5
## attr(,"match.length")
## [1] 4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## 
## [[3]]
## [1] 14
## attr(,"match.length")
## [1] 4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE</code></pre>
<ul>
<li>
<code>regexec</code> 函数返回一个列表，类似函数<code>gregexpr</code>的返回结果，长度与字符串向量的长度一样，如果没有匹配到就返回 -1，匹配到了就返回一个匹配的初值位置的整型序列，所有子字符串与括号分组的正则表达式的子表达式对应，属性 “match.length” 是一个表示匹配的长度的向量，如果是 -1 表示没有匹配到。位置、长度和属性的解释与 <code>regexpr</code> 一致</li>
</ul>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexec</a></span><span class="op">(</span><span class="st">"Adam"</span>, <span class="va">text</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 9
## attr(,"match.length")
## [1] 4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## 
## [[2]]
## [1] 5
## attr(,"match.length")
## [1] 4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## 
## [[3]]
## [1] 14
## attr(,"match.length")
## [1] 4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE</code></pre>
<div class="sidebar">
<p>由于资源限制（特别是 PCRE）导致的匹配失败，会视为没有匹配，通常伴随一个警告</p>
</div>
<p>下面这个将链接分解的例子由 Luke Tierney 提供<a href="references.html#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a></p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"http://stat.umn.edu:80/xyz"</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexec</a></span><span class="op">(</span><span class="st">"^(([^:]+)://)?([^:/]+)(:([0-9]+))?(/.*)"</span>, <span class="va">x</span><span class="op">)</span>
<span class="va">m</span></code></pre></div>
<pre><code>## [[1]]
## [1]  1  1  1  8 20 21 23
## attr(,"match.length")
## [1] 26  7  4 12  3  2  4
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE</code></pre>
<p>这里 x 是一个字符串，所以函数 <code>regexec</code> 返回的列表长度为1，正则表达式 <code>^(([^:]+)://)?([^:/]+)(:([0-9]+))?(/.*)</code> 括号分组匹配到了7次，第一次匹配整个字符串，所以起始位置是1，而匹配长度是26，即整个字符串的长度，读者可以调用函数 <code>nchar(x)</code> 算一下，如果你愿意手动数一下也可以哈！余下不一一介绍，可以根据返回结果和图<a href="chap-string-operations.html#fig:regex101">4.1</a>一起看，最后还可以调用<code>regmatches</code>函数抽取匹配到的结果</p>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">m</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "http://stat.umn.edu:80/xyz" "http://"                   
## [3] "http"                       "stat.umn.edu"              
## [5] ":80"                        "80"                        
## [7] "/xyz"</code></pre>
<p>我们可以在 <a href="https://regex101.com/" class="uri">https://regex101.com/</a> 上测试表达式，如图<a href="chap-string-operations.html#fig:regex101">4.1</a>所示，表达式 <code>^(([^:]+)://)?([^:/]+)(:([0-9]+))?(/.*)</code> 包含7个组，每个组的匹配结果见图的右下角，这样我们不难理解，函数 <code>regmatches</code> 返回的第列表中，第3个位置是传输协议 protocol <code>http</code> ，第4个位置是主机 host <code>stat.umn.edu</code>， 第6个位置是端口 port <code>80</code> ，第7个位置是路径 path <code>/xyz</code>，所以函数 <code>regmatches</code> 的作用就是根据函数 <code>regexec</code> 匹配的结果抽取子字符串。</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:regex101"></span>
<a href="https://regex101.com/" target="_blank"><img src="screenshots/regexp-name-group.png" alt="正则表达式匹配结果" width="75%"></a>
<p class="caption">
图 4.1: 正则表达式匹配结果
</p>
</div>
<p>进一步，我们可以用 <code>regmatches</code> 函数抽取 URL 的部分内容，如前面提到的传输协议，主机等</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">URL_parts</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexec</a></span><span class="op">(</span><span class="st">"^(([^:]+)://)?([^:/]+)(:([0-9]+))?(/.*)"</span>, <span class="va">x</span><span class="op">)</span>
  <span class="va">parts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span>
    <span class="va">rbind</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">m</span><span class="op">)</span>, <span class="va">`[`</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">4L</span>, <span class="fl">6L</span>, <span class="fl">7L</span><span class="op">)</span><span class="op">)</span>
    <span class="co"># 3,4,6,7是索引位置</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">parts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"protocol"</span>, <span class="st">"host"</span>, <span class="st">"port"</span>, <span class="st">"path"</span><span class="op">)</span>
  <span class="va">parts</span>
<span class="op">}</span>
<span class="fu">URL_parts</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>##      protocol host           port path  
## [1,] "http"   "stat.umn.edu" "80" "/xyz"</code></pre>
<p>目前还没有 <code>gregexec</code> 函数，但是可以模拟一个，首先用 <code>gregexpr</code> 函数返回匹配的位置，<code>regmatches</code> 抽取相应的值，然后用 <code>regexec</code> 作用到每一个提取的值，做再一次匹配和值的抽取，实现了全部的匹配。另一个例子</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## There is no gregexec() yet, but one can emulate it by running</span>
<span class="co">## regexec() on the regmatches obtained via gregexpr().  E.g.:</span>
<span class="va">pattern</span> <span class="op">&lt;-</span> <span class="st">"([[:alpha:]]+)([[:digit:]]+)"</span>
<span class="va">s</span> <span class="op">&lt;-</span> <span class="st">"Test: A1 BC23 DEF456"</span>
<span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">s</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1]  7 10 15
## attr(,"match.length")
## [1] 2 4 6
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE</code></pre>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">s</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "A1"     "BC23"   "DEF456"</code></pre>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">s</span><span class="op">)</span><span class="op">)</span>,
  <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">e</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexec</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">e</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [[1]][[1]]
## [1] "A1" "A"  "1" 
## 
## [[1]][[2]]
## [1] "BC23" "BC"   "23"  
## 
## [[1]][[3]]
## [1] "DEF456" "DEF"    "456"</code></pre>
</div>
<div id="base-replacement" class="section level2" number="4.7">
<h2>
<span class="header-section-number">4.7</span> 字符串替换<a class="anchor" aria-label="anchor" href="#base-replacement"><i class="fas fa-link"></i></a>
</h2>
<p><code>chartr</code> 支持正则表达式的替换，<code>chartr</code> 是对应字符的替换操作</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"MiXeD cAsE 123"</span>
<span class="co"># 将字符 iXs 替换为 why</span>
<span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">"iXs"</span>, <span class="st">"why"</span>, <span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "MwheD cAyE 123"</code></pre>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 将字符串 a-cX 中的字符挨个对应地替换为 D-Fw</span>
<span class="fu"><a href="https://rdrr.io/r/base/chartr.html">chartr</a></span><span class="op">(</span><span class="st">"a-cX"</span>, <span class="st">"D-Fw"</span>, <span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "MiweD FAsE 123"</code></pre>
<p>两个 <code>*sub</code> 函数的区别：<code>sub</code> 替换第一次匹配到的结果，<code>gsub</code> 替换所有匹配的结果</p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">sub</a></span><span class="op">(</span><span class="st">" .*"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/extSoftVersion.html">extSoftVersion</a></span><span class="op">(</span><span class="op">)</span><span class="op">[</span><span class="st">"PCRE"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##    PCRE 
## "10.39"</code></pre>
<p>参数 replacement 的值是正则表达式，其包含反向引用的用法， <code>\\1</code> 即引用表达式 <code>([ab])</code></p>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span>  <span class="st">"([ab])"</span>, replacement <span class="op">=</span> <span class="st">"\\1_\\1_"</span>, x <span class="op">=</span> <span class="st">"abc and ABC"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a_a_b_b_c a_a_nd ABC"</code></pre>
</div>
<div id="base-extract" class="section level2" number="4.8">
<h2>
<span class="header-section-number">4.8</span> 字符串提取<a class="anchor" aria-label="anchor" href="#base-extract"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">start</span>, <span class="va">stop</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">text</span>, <span class="va">first</span>, last <span class="op">=</span> <span class="fl">1000000L</span><span class="op">)</span></code></pre></div>
<p><code>substr</code> 和 <code>substring</code> 函数通过位置进行字符串的拆分和提取，它们本身不使用正则表达式，结合其他正则表达式函数<code>regexpr</code>, <code>gregexpr</code> 和 <code>regexec</code>，可以很方便地从大量文本中提取所需的信息。作用类似之前提到的 <code>regmatches</code> 函数</p>
<p>参数设置基本相同</p>
<ul>
<li>x/text 是要拆分的字符串向量</li>
<li>start/first 截取的起始位置向量</li>
<li>stop/last 截取的终止位置向量</li>
</ul>
<p>返回值有差别</p>
<ul>
<li>
<code>substr</code> 返回的字串个数等于第一个参数 x 的长度</li>
<li>
<code>substring</code> 返回字串个数等于三个参数中最长向量长度，短向量循环使用。</li>
</ul>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"123456789"</span>
<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "234"</code></pre>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "234"     "45"      "2345678"</code></pre>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="st">"abcdef"</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "bcd"</code></pre>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="st">"abcdef"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a" "b" "c" "d" "e" "f"</code></pre>
<p>因为 x 的向量长度为1，所以 <code>substr</code> 获得的结果只有1个字串，即第2和第3个参数向量只用了第一个组合：起始位置2，终止位置4。而 <code>substring</code> 的语句三个参数中最长的向量为 <code>c(4,5,8)</code>，执行时按短向量循环使用的规则第一个参数事实上就是<code>c(x,x,x)</code>，第二个参数就成了<code>c(2,4,2)</code>，最终截取的字串起始位置组合为：2-4, 4-5和2-8。</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"123456789"</span>, <span class="st">"abcdefghijklmnopq"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "234" "de"</code></pre>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "234"     "de"      "2345678"</code></pre>
<p>更加高级的字符串抽取</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 从字符串中抽取固定模式的文本，替代 stringr::str_extract</span>
<span class="co"># 只抽取一个匹配的</span>
<span class="va">extract_str</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">pattern</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">text</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">text</span><span class="op">)</span><span class="op">)</span>
<span class="co"># 符合模式的全部抽取</span>
<span class="va">gextract_str</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">pattern</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">text</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">text</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>举例子，抽取连续的数字</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 两个例子</span>
<span class="fu">extract_str</span><span class="op">(</span>text <span class="op">=</span> <span class="st">"abd123da345das"</span>, pattern <span class="op">=</span> <span class="st">"(\\d+){3}"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "123"</code></pre>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">gextract_str</span><span class="op">(</span>text <span class="op">=</span> <span class="st">"abd123da345das"</span>, pattern <span class="op">=</span> <span class="st">"(\\d+){3}"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "123" "345"</code></pre>
<p>例子来自于 <a href="https://recology.info/2018/10/limiting-dependencies/" class="uri">https://recology.info/2018/10/limiting-dependencies/</a></p>
</div>
<div id="string-named-capture" class="section level2" number="4.9">
<h2>
<span class="header-section-number">4.9</span> 命名捕捉<a class="anchor" aria-label="anchor" href="#string-named-capture"><i class="fas fa-link"></i></a>
</h2>
<p>函数 <code>regexpr(..., perl = TRUE)</code> 和 <code>gregexpr(..., perl = TRUE)</code> 支持命名捕捉</p>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## named capture</span>
<span class="va">notables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"  Ben Franklin and Jefferson Davis"</span>,
              <span class="st">"\tMillard Fillmore"</span><span class="op">)</span>
<span class="co"># name groups 'first' and 'last'</span>
<span class="va">name.rex</span> <span class="op">&lt;-</span> <span class="st">"(?&lt;first&gt;[[:upper:]][[:lower:]]+) (?&lt;last&gt;[[:upper:]][[:lower:]]+)"</span>

<span class="op">(</span><span class="va">parsed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="va">name.rex</span>, <span class="va">notables</span>, perl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 3 2
## attr(,"match.length")
## [1] 12 16
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## attr(,"capture.start")
##      first last
## [1,]     3    7
## [2,]     2   10
## attr(,"capture.length")
##      first last
## [1,]     3    8
## [2,]     7    8
## attr(,"capture.names")
## [1] "first" "last"</code></pre>
<div class="sourceCode" id="cb498"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">parsed</span>, <span class="st">'capture.names'</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "first" "last"</code></pre>
<div class="sourceCode" id="cb500"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">notables</span>, <span class="va">parsed</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Ben Franklin"     "Millard Fillmore"</code></pre>
<p>希望返回一个 data.frame，列名是指定的 named group 名字</p>
<div class="sourceCode" id="cb502"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 有多个结果</span>
<span class="op">(</span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">name.rex</span>, <span class="va">notables</span>, perl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1]  3 20
## attr(,"match.length")
## [1] 12 15
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## attr(,"capture.start")
##      first last
## [1,]     3    7
## [2,]    20   30
## attr(,"capture.length")
##      first last
## [1,]     3    8
## [2,]     9    5
## attr(,"capture.names")
## [1] "first" "last" 
## 
## [[2]]
## [1] 2
## attr(,"match.length")
## [1] 16
## attr(,"index.type")
## [1] "chars"
## attr(,"useBytes")
## [1] TRUE
## attr(,"capture.start")
##      first last
## [1,]     2   10
## attr(,"capture.length")
##      first last
## [1,]     7    8
## attr(,"capture.names")
## [1] "first" "last"</code></pre>
<div class="sourceCode" id="cb504"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">notables</span>, <span class="va">idx</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "Ben Franklin"    "Jefferson Davis"
## 
## [[2]]
## [1] "Millard Fillmore"</code></pre>
<div class="sourceCode" id="cb506"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">idx</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">'capture.names'</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "first" "last"</code></pre>
<div class="sourceCode" id="cb508"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>notable <span class="op">=</span> <span class="va">notables</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
<span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/extract.html">extract</a></span><span class="op">(</span>
    <span class="va">notable</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"first"</span>, <span class="st">"last"</span><span class="op">)</span>, <span class="va">name.rex</span>, 
    remove <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<pre><code>##                              notable   first     last
## 1   Ben Franklin and Jefferson Davis     Ben Franklin
## 2                 \tMillard Fillmore Millard Fillmore</code></pre>
</div>
<div id="exact-match" class="section level2" number="4.10">
<h2>
<span class="header-section-number">4.10</span> 精确匹配<a class="anchor" aria-label="anchor" href="#exact-match"><i class="fas fa-link"></i></a>
</h2>
<p><code>fixed = TRUE</code></p>
</div>
<div id="fuzzy-match" class="section level2" number="4.11">
<h2>
<span class="header-section-number">4.11</span> 模糊匹配<a class="anchor" aria-label="anchor" href="#fuzzy-match"><i class="fas fa-link"></i></a>
</h2>
<p>近似字符串匹配 (Approximate String Matching) 也叫模糊匹配 (Fuzzy Matching)</p>
<p><code><a href="https://rdrr.io/r/base/agrep.html">agrep()</a></code> <code><a href="https://rdrr.io/r/base/agrep.html">agrepl()</a></code> <code><a href="https://rdrr.io/r/utils/aregexec.html">aregexec()</a></code> <code><a href="https://rdrr.io/r/utils/adist.html">adist()</a></code></p>
<div class="sourceCode" id="cb510"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"lasy"</span>, x <span class="op">=</span> <span class="st">"1 lazy 2"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb512"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"lasy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">" 1 lazy 2"</span>, <span class="st">"1 lasy 2"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>sub <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb514"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"laysy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"1 lazy"</span>, <span class="st">"1"</span>, <span class="st">"1 LAZY"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb516"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"laysy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"1 lazy"</span>, <span class="st">"1"</span>, <span class="st">"1 LAZY"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">2</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "1 lazy"</code></pre>
<div class="sourceCode" id="cb518"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrep</a></span><span class="op">(</span><span class="st">"laysy"</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"1 lazy"</span>, <span class="st">"1"</span>, <span class="st">"1 LAZY"</span><span class="op">)</span>, max <span class="op">=</span> <span class="fl">2</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1 3</code></pre>
<div class="sourceCode" id="cb520"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/agrep.html">agrepl</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"lasy"</span>, x <span class="op">=</span> <span class="st">"1 lazy 2"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb522"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Cf. the examples for agrep.</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"1 lazy"</span>, <span class="st">"1"</span>, <span class="st">"1 LAZY"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/aregexec.html">aregexec</a></span><span class="op">(</span><span class="st">"laysy"</span>, <span class="va">x</span>, max.distance <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 3
## attr(,"match.length")
## [1] 4
## 
## [[2]]
## [1] -1
## attr(,"match.length")
## [1] -1
## 
## [[3]]
## [1] -1
## attr(,"match.length")
## [1] -1</code></pre>
<div class="sourceCode" id="cb524"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/aregexec.html">aregexec</a></span><span class="op">(</span><span class="st">"(lay)(sy)"</span>, <span class="va">x</span>, max.distance <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 3 3 5
## attr(,"match.length")
## [1] 4 2 2
## 
## [[2]]
## [1] -1
## attr(,"match.length")
## [1] -1
## 
## [[3]]
## [1] -1
## attr(,"match.length")
## [1] -1</code></pre>
<div class="sourceCode" id="cb526"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/aregexec.html">aregexec</a></span><span class="op">(</span><span class="st">"(lay)(sy)"</span>, <span class="va">x</span>, max.distance <span class="op">=</span> <span class="fl">2</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 3 3 6
## attr(,"match.length")
## [1] 4 3 1
## 
## [[2]]
## [1] -1
## attr(,"match.length")
## [1] -1
## 
## [[3]]
## [1] 3 3 6
## attr(,"match.length")
## [1] 4 3 1</code></pre>
<div class="sourceCode" id="cb528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/aregexec.html">aregexec</a></span><span class="op">(</span><span class="st">"(lay)(sy)"</span>, <span class="va">x</span>, max.distance <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">m</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "lazy" "la"   "zy"  
## 
## [[2]]
## character(0)
## 
## [[3]]
## character(0)</code></pre>
<div class="sourceCode" id="cb530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Cf. https://en.wikipedia.org/wiki/Levenshtein_distance</span>
<span class="fu"><a href="https://rdrr.io/r/utils/adist.html">adist</a></span><span class="op">(</span><span class="st">"kitten"</span>, <span class="st">"sitting"</span><span class="op">)</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    3</code></pre>
<div class="sourceCode" id="cb532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## To see the transformation counts for the Levenshtein distance:</span>
<span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/adist.html">adist</a></span><span class="op">(</span><span class="st">"kitten"</span>, <span class="st">"sitting"</span>, counts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"counts"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## ins del sub 
##   1   0   2</code></pre>
<div class="sourceCode" id="cb534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## To see the transformation sequences:</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/adist.html">adist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"kitten"</span>, <span class="st">"sitting"</span><span class="op">)</span>, counts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"trafos"</span><span class="op">)</span></code></pre></div>
<pre><code>##      [,1]      [,2]     
## [1,] "MMMMMM"  "SMMMSMI"
## [2,] "SMMMSMD" "MMMMMMM"</code></pre>
<div class="sourceCode" id="cb536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Cf. the examples for agrep:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/adist.html">adist</a></span><span class="op">(</span><span class="st">"lasy"</span>, <span class="st">"1 lazy 2"</span><span class="op">)</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    5</code></pre>
<div class="sourceCode" id="cb538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## For a "partial approximate match" (as used for agrep):</span>
<span class="fu"><a href="https://rdrr.io/r/utils/adist.html">adist</a></span><span class="op">(</span><span class="st">"lasy"</span>, <span class="st">"1 lazy 2"</span>, partial <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<pre><code>##      [,1]
## [1,]    1</code></pre>
<p>案例</p>
<p><code><a href="https://rdrr.io/r/utils/help.search.html">help.search()</a></code></p>
</div>
<div id="replace" class="section level2" number="4.12">
<h2>
<span class="header-section-number">4.12</span> 高级的替换<a class="anchor" aria-label="anchor" href="#replace"><i class="fas fa-link"></i></a>
</h2>
<p>相比于 <code><a href="https://rdrr.io/r/base/sprintf.html">sprintf()</a></code> 格式化输出字符串的方式替换，它的优势在于提示性，或者说代码的可读性</p>
<div class="sourceCode" id="cb540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">glue_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">param</span>, <span class="va">text</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="st">'\\{[^}]*\\}'</span>, <span class="va">text</span><span class="op">)</span><span class="op">[[</span><span class="fl">1L</span><span class="op">]</span><span class="op">]</span>
  <span class="va">keys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">text</span>, <span class="va">idx</span>, <span class="va">idx</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">idx</span>, <span class="st">'match.length'</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1L</span><span class="op">)</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">key</span> <span class="kw">in</span> <span class="va">keys</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">text</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="va">key</span>, <span class="va">param</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'[{}]'</span>, <span class="st">''</span>, <span class="va">key</span><span class="op">)</span><span class="op">]</span><span class="op">]</span>, <span class="va">text</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="va">text</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu">glue_data</span><span class="op">(</span>
  param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>table <span class="op">=</span> <span class="st">'flights'</span>, origin <span class="op">=</span> <span class="st">'JFK'</span><span class="op">)</span>,
  text <span class="op">=</span> <span class="st">"
  select count(*) as n
  from {table}
  where origin = '{origin}'
  "</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##   select count(*) as n
##   from flights
##   where origin = 'JFK'
## </code></pre>
</div>
<div id="extract" class="section level2" number="4.13">
<h2>
<span class="header-section-number">4.13</span> 高级的提取<a class="anchor" aria-label="anchor" href="#extract"><i class="fas fa-link"></i></a>
</h2>
<p>从 text 中抽取给定模式 pattern 的字符串</p>
<div class="sourceCode" id="cb542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">str_extract</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">pattern</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">text</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">regexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">text</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>举个栗子，比如提取数字</p>
<div class="sourceCode" id="cb543"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shopping_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apples x4"</span>, <span class="st">"bag of flour"</span>, <span class="st">"bag of sugar"</span>, <span class="st">"milk x2"</span><span class="op">)</span>
<span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">shopping_list</span>, <span class="st">"\\d"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "4" NA  NA  "2"</code></pre>
<div class="sourceCode" id="cb545"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 注意二者的差别</span>
<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">shopping_list</span>, <span class="st">"\\d"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "4" "2"</code></pre>
<p>提取所有符合匹配模式的字符串</p>
<div class="sourceCode" id="cb547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">str_extract_all</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span>, <span class="va">pattern</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">text</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">pattern</span>, <span class="va">text</span>, <span class="va">...</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>举个栗子，提取其中的英文字母</p>
<div class="sourceCode" id="cb548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">shopping_list</span>, <span class="st">"[a-z]+"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "apples" "x"     
## 
## [[2]]
## [1] "bag"   "of"    "flour"
## 
## [[3]]
## [1] "bag"   "of"    "sugar"
## 
## [[4]]
## [1] "milk" "x"</code></pre>
<div class="sourceCode" id="cb550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract_all</a></span><span class="op">(</span><span class="va">shopping_list</span>, <span class="st">"[a-z]+"</span><span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## [1] "apples" "x"     
## 
## [[2]]
## [1] "bag"   "of"    "flour"
## 
## [[3]]
## [1] "bag"   "of"    "sugar"
## 
## [[4]]
## [1] "milk" "x"</code></pre>
</div>
<div id="other-string-op" class="section level2" number="4.14">
<h2>
<span class="header-section-number">4.14</span> 其它操作<a class="anchor" aria-label="anchor" href="#other-string-op"><i class="fas fa-link"></i></a>
</h2>
<div id="strwrap" class="section level3" number="4.14.1">
<h3>
<span class="header-section-number">4.14.1</span> strwrap<a class="anchor" aria-label="anchor" href="#strwrap"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op">(</span><span class="va">x</span>, width <span class="op">=</span> <span class="fl">0.9</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"width"</span><span class="op">)</span>, indent <span class="op">=</span> <span class="fl">0</span>,
        exdent <span class="op">=</span> <span class="fl">0</span>, prefix <span class="op">=</span> <span class="st">""</span>, simplify <span class="op">=</span> <span class="cn">TRUE</span>, initial <span class="op">=</span> <span class="va">prefix</span><span class="op">)</span></code></pre></div>
<p>该函数把一个字符串当成一个段落的文字（不管字符串中是否有换行符），按照段落的格式（缩进和长度）和断字方式进行分行，每一行是结果中的一个字符串。</p>
<div class="sourceCode" id="cb553"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 读取一段文本</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Rhome.html">R.home</a></span><span class="op">(</span><span class="st">"doc"</span><span class="op">)</span>, <span class="st">"THANKS"</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span>
<span class="co">## 将文本拆分为段落，且移除前三段</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"\n[ \t\n]*\n"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span>
<span class="co"># 每一段换两行</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">x</span>, collapse <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span>
<span class="co"># 每一行的宽度设定为60个字符</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op">(</span><span class="va">x</span>, width <span class="op">=</span> <span class="fl">60</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## J. D. Beasley, David J. Best, Richard Brent, Kevin Buhr,
## Michael A. Covington, Bill Cleveland, Robert Cleveland,, G.
## W. Cran, C. G. Ding, Ulrich Drepper, Paul Eggert, J. O.
## Evans, David M. Gay, H. Frick, G. W. Hill, Richard H.
## Jones, Eric Grosse, Shelby Haberman, Bruno Haible, John
## Hartigan, Andrew Harvey, Trevor Hastie, Min Long Lam,
## George Marsaglia, K. J. Martin, Gordon Matzigkeit, C. R.
## Mckenzie, Jean McRae, Cyrus Mehta, Fionn Murtagh, John C.
## Nash, Finbarr O'Sullivan, R. E. Odeh, William Patefield,
## Nitin Patel, Alan Richardson, D. E. Roberts, Patrick
## Royston, Russell Lenth, Ming-Jen Shyu, Richard C.
## Singleton, S. G. Springer, Supoj Sutanthavibul, Irma
## Terpenning, G. E. Thomas, Rob Tibshirani, Wai Wan Tsang,
## Berwin Turlach, Gary V. Vaughan, Michael Wichura, Jingbo
## Wang, M. A. Wong, and the Free Software Foundation (for
## autoconf code and utilities). See also files under
## src/extras.
## 
## Many more, too numerous to mention here, have contributed
## by sending bug reports and suggesting various improvements.
## 
## Simon Davies whilst at the University of Auckland wrote the
## original version of glm().
## 
## Julian Harris and Wing Kwong (Tiki) Wan whilst at the
## University of Auckland assisted Ross Ihaka with the
## original Macintosh port.
## 
## R was inspired by the S environment which has been
## principally developed by John Chambers, with substantial
## input from Douglas Bates, Rick Becker, Bill Cleveland,
## Trevor Hastie, Daryl Pregibon and Allan Wilks.
## 
## A special debt is owed to John Chambers who has graciously
## contributed advice and encouragement in the early days of R
## and later became a member of the core team.
## 
## Stefano Iacus (a former member of R Core) and Simon Urbanek
## developed the macOS port, including the R.app GUI,
## toolchains and packaging.
## 
## The Windows port was developed by Guido Masarotto (for a
## while a member of R Core) and Brian Ripley, then Duncan
## Murdoch (a former member of R Core) and currently by Jeroen
## Ooms (base) and Uwe Ligges (packages).
## 
## Tomas Kalibera's work has been sponsored by Jan Vitek and
## funded by his European Research Council grant "Evolving
## Language Ecosystems (ELE)".
## 
## Computing support (including hardware, hosting and
## infrastructure) has been provided/funded by the R
## Foundation, employers of R-Core members (notably WU Wien,
## ETH Zurich, U Oxford and U Iowa) and by Northeastern
## University and the University of Kent.
## 
## Distributions of R contain the recommended packages, whose
## authors/contributors are listed in their DESCRIPTION files.</code></pre>
<div class="sourceCode" id="cb555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 每一段的段首缩进5个字符</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op">(</span><span class="va">x</span>, width <span class="op">=</span> <span class="fl">60</span>, indent <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>##      J. D. Beasley, David J. Best, Richard Brent, Kevin
## Buhr, Michael A. Covington, Bill Cleveland, Robert
## Cleveland,, G. W. Cran, C. G. Ding, Ulrich Drepper, Paul
## Eggert, J. O. Evans, David M. Gay, H. Frick, G. W. Hill,
## Richard H. Jones, Eric Grosse, Shelby Haberman, Bruno
## Haible, John Hartigan, Andrew Harvey, Trevor Hastie, Min
## Long Lam, George Marsaglia, K. J. Martin, Gordon
## Matzigkeit, C. R. Mckenzie, Jean McRae, Cyrus Mehta, Fionn
## Murtagh, John C. Nash, Finbarr O'Sullivan, R. E. Odeh,
## William Patefield, Nitin Patel, Alan Richardson, D. E.
## Roberts, Patrick Royston, Russell Lenth, Ming-Jen Shyu,
## Richard C. Singleton, S. G. Springer, Supoj Sutanthavibul,
## Irma Terpenning, G. E. Thomas, Rob Tibshirani, Wai Wan
## Tsang, Berwin Turlach, Gary V. Vaughan, Michael Wichura,
## Jingbo Wang, M. A. Wong, and the Free Software Foundation
## (for autoconf code and utilities). See also files under
## src/extras.
## 
##      Many more, too numerous to mention here, have
## contributed by sending bug reports and suggesting various
## improvements.
## 
##      Simon Davies whilst at the University of Auckland
## wrote the original version of glm().
## 
##      Julian Harris and Wing Kwong (Tiki) Wan whilst at the
## University of Auckland assisted Ross Ihaka with the
## original Macintosh port.
## 
##      R was inspired by the S environment which has been
## principally developed by John Chambers, with substantial
## input from Douglas Bates, Rick Becker, Bill Cleveland,
## Trevor Hastie, Daryl Pregibon and Allan Wilks.
## 
##      A special debt is owed to John Chambers who has
## graciously contributed advice and encouragement in the
## early days of R and later became a member of the core team.
## 
##      Stefano Iacus (a former member of R Core) and Simon
## Urbanek developed the macOS port, including the R.app GUI,
## toolchains and packaging.
## 
##      The Windows port was developed by Guido Masarotto (for
## a while a member of R Core) and Brian Ripley, then Duncan
## Murdoch (a former member of R Core) and currently by Jeroen
## Ooms (base) and Uwe Ligges (packages).
## 
##      Tomas Kalibera's work has been sponsored by Jan Vitek
## and funded by his European Research Council grant "Evolving
## Language Ecosystems (ELE)".
## 
##      Computing support (including hardware, hosting and
## infrastructure) has been provided/funded by the R
## Foundation, employers of R-Core members (notably WU Wien,
## ETH Zurich, U Oxford and U Iowa) and by Northeastern
## University and the University of Kent.
## 
##      Distributions of R contain the recommended packages,
## whose authors/contributors are listed in their DESCRIPTION
## files.</code></pre>
<div class="sourceCode" id="cb557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 除了段首，每一段的余下诸行都缩进5个字符</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op">(</span><span class="va">x</span>, width <span class="op">=</span> <span class="fl">60</span>, exdent <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## J. D. Beasley, David J. Best, Richard Brent, Kevin Buhr,
##      Michael A. Covington, Bill Cleveland, Robert
##      Cleveland,, G. W. Cran, C. G. Ding, Ulrich Drepper,
##      Paul Eggert, J. O. Evans, David M. Gay, H. Frick, G.
##      W. Hill, Richard H. Jones, Eric Grosse, Shelby
##      Haberman, Bruno Haible, John Hartigan, Andrew Harvey,
##      Trevor Hastie, Min Long Lam, George Marsaglia, K. J.
##      Martin, Gordon Matzigkeit, C. R. Mckenzie, Jean McRae,
##      Cyrus Mehta, Fionn Murtagh, John C. Nash, Finbarr
##      O'Sullivan, R. E. Odeh, William Patefield, Nitin
##      Patel, Alan Richardson, D. E. Roberts, Patrick
##      Royston, Russell Lenth, Ming-Jen Shyu, Richard C.
##      Singleton, S. G. Springer, Supoj Sutanthavibul, Irma
##      Terpenning, G. E. Thomas, Rob Tibshirani, Wai Wan
##      Tsang, Berwin Turlach, Gary V. Vaughan, Michael
##      Wichura, Jingbo Wang, M. A. Wong, and the Free
##      Software Foundation (for autoconf code and utilities).
##      See also files under src/extras.
## 
## Many more, too numerous to mention here, have contributed
##      by sending bug reports and suggesting various
##      improvements.
## 
## Simon Davies whilst at the University of Auckland wrote the
##      original version of glm().
## 
## Julian Harris and Wing Kwong (Tiki) Wan whilst at the
##      University of Auckland assisted Ross Ihaka with the
##      original Macintosh port.
## 
## R was inspired by the S environment which has been
##      principally developed by John Chambers, with
##      substantial input from Douglas Bates, Rick Becker,
##      Bill Cleveland, Trevor Hastie, Daryl Pregibon and
##      Allan Wilks.
## 
## A special debt is owed to John Chambers who has graciously
##      contributed advice and encouragement in the early days
##      of R and later became a member of the core team.
## 
## Stefano Iacus (a former member of R Core) and Simon Urbanek
##      developed the macOS port, including the R.app GUI,
##      toolchains and packaging.
## 
## The Windows port was developed by Guido Masarotto (for a
##      while a member of R Core) and Brian Ripley, then
##      Duncan Murdoch (a former member of R Core) and
##      currently by Jeroen Ooms (base) and Uwe Ligges
##      (packages).
## 
## Tomas Kalibera's work has been sponsored by Jan Vitek and
##      funded by his European Research Council grant
##      "Evolving Language Ecosystems (ELE)".
## 
## Computing support (including hardware, hosting and
##      infrastructure) has been provided/funded by the R
##      Foundation, employers of R-Core members (notably WU
##      Wien, ETH Zurich, U Oxford and U Iowa) and by
##      Northeastern University and the University of Kent.
## 
## Distributions of R contain the recommended packages, whose
##      authors/contributors are listed in their DESCRIPTION
##      files.</code></pre>
<div class="sourceCode" id="cb559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 在输出的每一行前面添加前缀</span>
<span class="fu"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op">(</span><span class="va">x</span>, prefix <span class="op">=</span> <span class="st">"THANKS&gt; "</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## THANKS&gt; J. D. Beasley, David J. Best, Richard Brent, Kevin Buhr,
## THANKS&gt; Michael A. Covington, Bill Cleveland, Robert Cleveland,, G. W.
## THANKS&gt; Cran, C. G. Ding, Ulrich Drepper, Paul Eggert, J. O. Evans,
## THANKS&gt; David M. Gay, H. Frick, G. W. Hill, Richard H. Jones, Eric
## THANKS&gt; Grosse, Shelby Haberman, Bruno Haible, John Hartigan, Andrew
## THANKS&gt; Harvey, Trevor Hastie, Min Long Lam, George Marsaglia, K. J.
## THANKS&gt; Martin, Gordon Matzigkeit, C. R. Mckenzie, Jean McRae, Cyrus
## THANKS&gt; Mehta, Fionn Murtagh, John C. Nash, Finbarr O'Sullivan, R. E.
## THANKS&gt; Odeh, William Patefield, Nitin Patel, Alan Richardson, D. E.
## THANKS&gt; Roberts, Patrick Royston, Russell Lenth, Ming-Jen Shyu, Richard
## THANKS&gt; C. Singleton, S. G. Springer, Supoj Sutanthavibul, Irma
## THANKS&gt; Terpenning, G. E. Thomas, Rob Tibshirani, Wai Wan Tsang, Berwin
## THANKS&gt; Turlach, Gary V. Vaughan, Michael Wichura, Jingbo Wang, M. A.
## THANKS&gt; Wong, and the Free Software Foundation (for autoconf code and
## THANKS&gt; utilities). See also files under src/extras.
## THANKS&gt; 
## THANKS&gt; Many more, too numerous to mention here, have contributed by
## THANKS&gt; sending bug reports and suggesting various improvements.
## THANKS&gt; 
## THANKS&gt; Simon Davies whilst at the University of Auckland wrote the
## THANKS&gt; original version of glm().
## THANKS&gt; 
## THANKS&gt; Julian Harris and Wing Kwong (Tiki) Wan whilst at the
## THANKS&gt; University of Auckland assisted Ross Ihaka with the original
## THANKS&gt; Macintosh port.
## THANKS&gt; 
## THANKS&gt; R was inspired by the S environment which has been principally
## THANKS&gt; developed by John Chambers, with substantial input from Douglas
## THANKS&gt; Bates, Rick Becker, Bill Cleveland, Trevor Hastie, Daryl
## THANKS&gt; Pregibon and Allan Wilks.
## THANKS&gt; 
## THANKS&gt; A special debt is owed to John Chambers who has graciously
## THANKS&gt; contributed advice and encouragement in the early days of R and
## THANKS&gt; later became a member of the core team.
## THANKS&gt; 
## THANKS&gt; Stefano Iacus (a former member of R Core) and Simon Urbanek
## THANKS&gt; developed the macOS port, including the R.app GUI, toolchains
## THANKS&gt; and packaging.
## THANKS&gt; 
## THANKS&gt; The Windows port was developed by Guido Masarotto (for a while
## THANKS&gt; a member of R Core) and Brian Ripley, then Duncan Murdoch (a
## THANKS&gt; former member of R Core) and currently by Jeroen Ooms (base)
## THANKS&gt; and Uwe Ligges (packages).
## THANKS&gt; 
## THANKS&gt; Tomas Kalibera's work has been sponsored by Jan Vitek and
## THANKS&gt; funded by his European Research Council grant "Evolving
## THANKS&gt; Language Ecosystems (ELE)".
## THANKS&gt; 
## THANKS&gt; Computing support (including hardware, hosting and
## THANKS&gt; infrastructure) has been provided/funded by the R Foundation,
## THANKS&gt; employers of R-Core members (notably WU Wien, ETH Zurich, U
## THANKS&gt; Oxford and U Iowa) and by Northeastern University and the
## THANKS&gt; University of Kent.
## THANKS&gt; 
## THANKS&gt; Distributions of R contain the recommended packages, whose
## THANKS&gt; authors/contributors are listed in their DESCRIPTION files.</code></pre>
<p>再举一个烧脑的例子</p>
<div class="sourceCode" id="cb561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-sample.html">sample</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="co"># 从1-10个数字中有放回的随机抽取100个数</span>
  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="st">"aaaaaaaaaa"</span>, <span class="fl">1</span>, <span class="va">x</span><span class="op">)</span>
<span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span>
  <span class="fl">10</span><span class="op">:</span><span class="fl">40</span>,
  <span class="kw">function</span><span class="op">(</span><span class="va">m</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span>target <span class="op">=</span> <span class="va">m</span>, actual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strwrap.html">strwrap</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>##        [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]
## target   10   11   12   13   14   15   16   17   18    19    20    21    22
## actual   10   10   11   12   13   14   15   16   17    18    19    20    21
##        [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24] [,25]
## target    23    24    25    26    27    28    29    30    31    32    33    34
## actual    22    23    24    25    26    27    28    29    30    31    32    33
##        [,26] [,27] [,28] [,29] [,30] [,31]
## target    35    36    37    38    39    40
## actual    34    35    36    37    38    39</code></pre>
</div>
<div id="strtrim" class="section level3" number="4.14.2">
<h3>
<span class="header-section-number">4.14.2</span> strtrim<a class="anchor" aria-label="anchor" href="#strtrim"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strtrim.html">strtrim</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">width</span><span class="op">)</span></code></pre></div>
<p><code>strtrim</code> 函数将字符串x修剪到特定的显示宽度，返回的字符串向量的长度等于字符串向量 x 的长度，如果 width 的参数值（它是一个整型向量）的长度小于 x 的，就循环补齐。</p>
<div class="sourceCode" id="cb564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strtrim.html">strtrim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"abcdef"</span>, <span class="st">"abcdef"</span>, <span class="st">"abcdef"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "a"      "abcde"  "abcdef"</code></pre>
</div>
<div id="strrep" class="section level3" number="4.14.3">
<h3>
<span class="header-section-number">4.14.3</span> strrep<a class="anchor" aria-label="anchor" href="#strrep"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strrep.html">strrep</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">times</span><span class="op">)</span></code></pre></div>
<p>以给定的次数重复字符串向量中每个元素的个数，并连接字符串的各个副本</p>
<div class="sourceCode" id="cb567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strrep.html">strrep</a></span><span class="op">(</span><span class="st">"ABC"</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ABCABC"</code></pre>
<div class="sourceCode" id="cb569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/strrep.html">strrep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, <span class="fl">1</span> <span class="op">:</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "A"   "BB"  "CCC"</code></pre>
<div class="sourceCode" id="cb571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 创建一个字符串向量，指定每个元素中空格的数量</span>
<span class="fu"><a href="https://rdrr.io/r/base/strrep.html">strrep</a></span><span class="op">(</span><span class="st">" "</span>, <span class="fl">1</span> <span class="op">:</span> <span class="fl">5</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] " "     "  "    "   "   "    "  "     "</code></pre>
</div>
<div id="trimws" class="section level3" number="4.14.4">
<h3>
<span class="header-section-number">4.14.4</span> trimws<a class="anchor" aria-label="anchor" href="#trimws"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">x</span>, which <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"both"</span>, <span class="st">"left"</span>, <span class="st">"right"</span><span class="op">)</span>, whitespace <span class="op">=</span> <span class="st">"[ \t\r\n]"</span><span class="op">)</span></code></pre></div>
<p><code>trimws</code> 函数用于移除字符串中的空格，这种空格可以来自制表符、回车符和换行符，位置可以位于字符串的开头或者结尾，<code>which</code> 参数指定空格的大致位置。举例如下</p>
<div class="sourceCode" id="cb574"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"  Some text. "</span>
<span class="va">x</span></code></pre></div>
<pre><code>## [1] "  Some text. "</code></pre>
<div class="sourceCode" id="cb576"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Some text."</code></pre>
<div class="sourceCode" id="cb578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"l"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Some text. "</code></pre>
<div class="sourceCode" id="cb580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/trimws.html">trimws</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"r"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "  Some text."</code></pre>
<div class="sourceCode" id="cb582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">shopping_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"apples x4"</span>, <span class="st">"bag of flour"</span>, <span class="st">"bag of sugar"</span>, <span class="st">"milk x2"</span><span class="op">)</span>

<span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">shopping_list</span>, pattern <span class="op">=</span> <span class="st">"\\d"</span>, replacement <span class="op">=</span> <span class="st">"aa"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "apples xaa"   "bag of flour" "bag of sugar" "milk xaa"</code></pre>
<div class="sourceCode" id="cb584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># https://github.com/hadley/stringb/issues/5</span>
<span class="co"># x is vector</span>
<span class="va">str_replace</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">pattern</span>, <span class="va">fun</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span><span class="va">pattern</span>, text <span class="op">=</span> <span class="va">x</span>, perl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">matches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">loc</span><span class="op">)</span>
  <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">matches</span>, <span class="va">fun</span>, <span class="va">...</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">loc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">out</span>
  <span class="va">x</span>
<span class="op">}</span>


<span class="va">loc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gregexpr</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"\\d"</span>, text <span class="op">=</span> <span class="va">shopping_list</span>, perl <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">matches</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">shopping_list</span>, <span class="va">loc</span><span class="op">)</span>

<span class="va">matches</span>

<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">matches</span>, <span class="va">transform</span>, <span class="st">"aa"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/regmatches.html">regmatches</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">shopping_list</span>, <span class="va">loc</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">out</span>


<span class="va">shopping_list</span>


<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">shopping_list</span>, pattern <span class="op">=</span> <span class="st">"\\\\d"</span>, replace <span class="op">=</span> <span class="st">"aa"</span><span class="op">)</span></code></pre></div>
</div>
<div id="tolower" class="section level3" number="4.14.5">
<h3>
<span class="header-section-number">4.14.5</span> tolower<a class="anchor" aria-label="anchor" href="#tolower"><i class="fas fa-link"></i></a>
</h3>
<p>tolower 和 toupper 是一对，将大写转小写，小写转大写</p>
<div class="sourceCode" id="cb585"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">simpleCap</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html">tolower</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/tstrsplit.html">strsplit</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">" "</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">s</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substring</a></span><span class="op">(</span><span class="va">s</span>, <span class="fl">2</span><span class="op">)</span>,
    sep <span class="op">=</span> <span class="st">""</span>, collapse <span class="op">=</span> <span class="st">" "</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="co"># 参考文献条目里需要将每个英文单词的首字母大写</span>
<span class="fu">simpleCap</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"THE USE OF MULTIPLE MEASUREMENTS IN TAXONOMIC PROBLEMS"</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "The Use Of Multiple Measurements In Taxonomic Problems"</code></pre>
</div>
</div>
<div id="encode-string" class="section level2" number="4.15">
<h2>
<span class="header-section-number">4.15</span> 字符串加密<a class="anchor" aria-label="anchor" href="#encode-string"><i class="fas fa-link"></i></a>
</h2>
<p>字符串编码加密， <strong>openssl</strong> 包提供了 sha1 函数 <a href="references.html#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></p>
<div class="sourceCode" id="cb587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jeroen/openssl">openssl</a></span><span class="op">)</span>
<span class="va">encode_mobile</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">phone_number</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"*"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/openssl/man/hash.html">sha1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/openssl/man/hash.html">sha1</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rawConversion.html">charToRaw</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">phone_number</span>, <span class="st">"$1$mobile$"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>
<span class="co"># 随意模拟两个手机号</span>
<span class="va">mobile_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"18601013453"</span>, <span class="st">"13811674545"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">mobile_vec</span>, <span class="va">encode_mobile</span><span class="op">)</span></code></pre></div>
<pre><code>##                                 18601013453 
## "*B1D46D1D62C7280137F0E14249EE500865247B7B" 
##                                 13811674545 
## "*0554DA6E403491F58F1567DF2EDEB19186B77173"</code></pre>
</div>
<div id="performance" class="section level2" number="4.16">
<h2>
<span class="header-section-number">4.16</span> 处理性能<a class="anchor" aria-label="anchor" href="#performance"><i class="fas fa-link"></i></a>
</h2>
<p>当你对一个很长的字符串进行大量的正则表达式匹配的时候，你需要考虑性能问题了，这时候该考虑启用合适的选项，一般来讲， PCRE 比默认的正则表达式引擎快，<code>fixed=TRUE</code> 可以继续加快匹配速度，特别是当每个模式只匹配少量次数时。</p>
<p>连接字符串，<code>paste/c/bfile/bracket</code> 函数性能比较
<a href="https://wch.github.io/string_builder/index.html" class="uri">https://wch.github.io/string_builder/index.html</a></p>
<p>R 内置的默认正则表达式匹配方式是基于 PCRE 的匹配，<code>options</code> 控制 PCRE 默认的三个选项 <code>PCRE_limit_recursion=NA</code> 、<code>PCRE_study=10</code> 和 <code>PCRE_use_JIT=TRUE</code>，当前系统环境下 PCRE 的支持情况</p>
<div class="sourceCode" id="cb589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/pcre_config.html">pcre_config</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>##              UTF-8 Unicode properties                JIT              stack 
##               TRUE               TRUE               TRUE              FALSE</code></pre>
<p>查看R环境的 PCRE 配置</p>
<div class="sourceCode" id="cb591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"PCRE_limit_recursion"</span>, <span class="st">"PCRE_study"</span>, <span class="st">"PCRE_use_JIT"</span><span class="op">)</span>, <span class="va">getOption</span><span class="op">)</span></code></pre></div>
<pre><code>## PCRE_limit_recursion           PCRE_study         PCRE_use_JIT 
##                   NA                FALSE                 TRUE</code></pre>
</div>
<div id="web-crawler" class="section level2" number="4.17">
<h2>
<span class="header-section-number">4.17</span> 网络爬虫<a class="anchor" aria-label="anchor" href="#web-crawler"><i class="fas fa-link"></i></a>
</h2>
<p>用 R 语言写爬虫 <a href="https://github.com/jeroen/curl">curl</a>、<a href="https://github.com/r-lib/httr">httr</a>、 <a href="https://github.com/r-lib/xml2">xml2</a>、<a href="https://CRAN.R-project.org/package=XML">XML</a> 和 <a href="https://github.com/tidyverse/rvest">rvest</a> 解析网页<a href="references.html#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a></p>
<div class="sourceCode" id="cb593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 查看 libcurl 库的版本</span>
<span class="fu"><a href="https://rdrr.io/r/base/libcurlVersion.html">libcurlVersion</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "7.68.0"
## attr(,"ssl_version")
## [1] "OpenSSL/1.1.1f"
## attr(,"libssh_version")
## [1] "libssh/0.9.3/openssl/zlib"
## attr(,"protocols")
##  [1] "dict"   "file"   "ftp"    "ftps"   "gopher" "http"   "https"  "imap"  
##  [9] "imaps"  "ldap"   "ldaps"  "pop3"   "pop3s"  "rtmp"   "rtsp"   "scp"   
## [17] "sftp"   "smb"    "smbs"   "smtp"   "smtps"  "telnet" "tftp"</code></pre>
<p>于主编利用 <a href="https://github.com/RobertMyles/tidyRSS">tidyRSS</a> 包 抓取解析博客站点的订阅信息，并将此设置为定时任务，创建自动更新内容的博客聚合网站 <a href="https://dailyr.netlify.com/">Daily R</a></p>
<p>抓取地震台信息</p>
<p><a href="https://d.cosx.org/d/420739">一个爬网页的练习：看看 R 邮件列表中最热门的讨论是什么</a></p>
</div>
<div id="text-mining" class="section level2" number="4.18">
<h2>
<span class="header-section-number">4.18</span> 文本挖掘<a class="anchor" aria-label="anchor" href="#text-mining"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://masalmon.eu/2019/02/11/trump-schedule/">How did Axios rectangle Trump’s PDF schedule? A try with R</a> 使用 pdftools 和 magick 处理表格，这两个 R 包分别依赖 Poppler C++ 和 ImageMagick++，在 Ubuntu 上安装 pdftools 和 magick 包</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb595-1"><a href="chap-string-operations.html#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt-get install libpoppler-cpp-dev libmagick++-dev</span></code></pre></div>
<div class="sourceCode" id="cb596"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/timeDate/man/base-c.html">c</a></span><span class="op">(</span><span class="st">"pdftools"</span>, <span class="st">"magick"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>除了 pdftools 包外，PDF 文档中表格抽取工具还有 <a href="https://github.com/ropensci/tabulizer">tabulizer</a>。扫描版 PDF 文档需要OCR识别技术支持的 tesseract 包</p>
</div>
<div id="string-session-info" class="section level2" number="4.19">
<h2>
<span class="header-section-number">4.19</span> 运行环境<a class="anchor" aria-label="anchor" href="#string-session-info"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">xfun</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xfun/man/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.1.2 (2021-11-01)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.3 LTS
## 
## Locale:
##   LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##   LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##   LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##   LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##   LC_ADDRESS=C               LC_TELEPHONE=C            
##   LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## Package version:
##   askpass_1.1      assertthat_0.2.1 base64enc_0.1.3  bookdown_0.24   
##   brio_1.1.3       bslib_0.3.1      cachem_1.0.6     cli_3.1.0       
##   compiler_4.1.2   cpp11_0.4.2      crayon_1.4.2     curl_4.3.2      
##   DBI_1.1.2        desc_1.4.0       digest_0.6.29    downlit_0.4.0   
##   dplyr_1.0.7      ellipsis_0.3.2   evaluate_0.14    fansi_0.5.0     
##   fastmap_1.1.0    fs_1.5.2         generics_0.1.1   glue_1.6.0      
##   graphics_4.1.2   grDevices_4.1.2  highr_0.9        htmltools_0.5.2 
##   jquerylib_0.1.4  jsonlite_1.7.2   knitr_1.37       lifecycle_1.0.1 
##   magrittr_2.0.1   memoise_2.0.1    methods_4.1.2    openssl_1.4.6   
##   pillar_1.6.4     pkgconfig_2.0.3  purrr_0.3.4      R6_2.5.1        
##   rappdirs_0.3.3   rlang_0.4.12     rmarkdown_2.11   rprojroot_2.0.2 
##   sass_0.4.0       stats_4.1.2      stringi_1.7.6    stringr_1.4.0   
##   sys_3.4          tibble_3.1.6     tidyr_1.1.4      tidyselect_1.1.1
##   tinytex_0.36     tools_4.1.2      utf8_1.2.2       utils_4.1.2     
##   vctrs_0.3.8      xfun_0.29        xml2_1.3.3       yaml_2.2.1</code></pre>

</div>
</div>
<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-stringdist2014" class="csl-entry">
<div class="csl-left-margin">[12] </div>
<div class="csl-right-inline">M. P. J. van der Loo, <span>“The stringdist package for approximate string matching,”</span> <em>The <span>R</span> <span>J</span>ournal</em>, vol. 6, pp. 111–122, 2014,Available: <a href="https://CRAN.R-project.org/package=stringdist">https://CRAN.R-project.org/package=stringdist</a>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></div>
<div class="next"><a href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-string-operations"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="nav-link" href="#base-count"><span class="header-section-number">4.1</span> 字符数统计</a></li>
<li><a class="nav-link" href="#base-translations"><span class="header-section-number">4.2</span> 字符串翻译</a></li>
<li><a class="nav-link" href="#base-concatenate"><span class="header-section-number">4.3</span> 字符串连接</a></li>
<li><a class="nav-link" href="#base-strsplit"><span class="header-section-number">4.4</span> 字符串拆分</a></li>
<li><a class="nav-link" href="#base-match"><span class="header-section-number">4.5</span> 字符串匹配</a></li>
<li><a class="nav-link" href="#base-search"><span class="header-section-number">4.6</span> 字符串查询</a></li>
<li><a class="nav-link" href="#base-replacement"><span class="header-section-number">4.7</span> 字符串替换</a></li>
<li><a class="nav-link" href="#base-extract"><span class="header-section-number">4.8</span> 字符串提取</a></li>
<li><a class="nav-link" href="#string-named-capture"><span class="header-section-number">4.9</span> 命名捕捉</a></li>
<li><a class="nav-link" href="#exact-match"><span class="header-section-number">4.10</span> 精确匹配</a></li>
<li><a class="nav-link" href="#fuzzy-match"><span class="header-section-number">4.11</span> 模糊匹配</a></li>
<li><a class="nav-link" href="#replace"><span class="header-section-number">4.12</span> 高级的替换</a></li>
<li><a class="nav-link" href="#extract"><span class="header-section-number">4.13</span> 高级的提取</a></li>
<li>
<a class="nav-link" href="#other-string-op"><span class="header-section-number">4.14</span> 其它操作</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#strwrap"><span class="header-section-number">4.14.1</span> strwrap</a></li>
<li><a class="nav-link" href="#strtrim"><span class="header-section-number">4.14.2</span> strtrim</a></li>
<li><a class="nav-link" href="#strrep"><span class="header-section-number">4.14.3</span> strrep</a></li>
<li><a class="nav-link" href="#trimws"><span class="header-section-number">4.14.4</span> trimws</a></li>
<li><a class="nav-link" href="#tolower"><span class="header-section-number">4.14.5</span> tolower</a></li>
</ul>
</li>
<li><a class="nav-link" href="#encode-string"><span class="header-section-number">4.15</span> 字符串加密</a></li>
<li><a class="nav-link" href="#performance"><span class="header-section-number">4.16</span> 处理性能</a></li>
<li><a class="nav-link" href="#web-crawler"><span class="header-section-number">4.17</span> 网络爬虫</a></li>
<li><a class="nav-link" href="#text-mining"><span class="header-section-number">4.18</span> 文本挖掘</a></li>
<li><a class="nav-link" href="#string-session-info"><span class="header-section-number">4.19</span> 运行环境</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/masr/blob/devel/string-operations.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/masr/edit/devel/string-operations.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>现代应用统计与 R 语言</strong>: Modern Applied Statistics with R" was written by 黄湘云. It was last built on 2022-01-03.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
