<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>第 38 章 数值优化 | 现代应用统计与 R 语言</title>
<meta name="author" content="黄湘云">
<meta name="description" content="R 语言提供了相当多的优化求解器，比较完整的概览见优化视图。 本章介绍一些常用的优化算法及其R实现，涵盖线性规划、整数规划、二次规划、非线性规划等。 商业优化求解器的能力都覆盖非线性规划（NLP），线性（LP）、二次（QP）和锥规划（SOCP），混合整数线性规划（MILP），多目标优化，最小二乘和方程求解。此外，还有很多文档介绍， LINGO提供用户手册， Matlab 优化工具箱 提供...">
<meta name="generator" content="bookdown 0.24 with bs4_book()">
<meta property="og:title" content="第 38 章 数值优化 | 现代应用统计与 R 语言">
<meta property="og:type" content="book">
<meta property="og:image" content="/images/cover.png">
<meta property="og:description" content="R 语言提供了相当多的优化求解器，比较完整的概览见优化视图。 本章介绍一些常用的优化算法及其R实现，涵盖线性规划、整数规划、二次规划、非线性规划等。 商业优化求解器的能力都覆盖非线性规划（NLP），线性（LP）、二次（QP）和锥规划（SOCP），混合整数线性规划（MILP），多目标优化，最小二乘和方程求解。此外，还有很多文档介绍， LINGO提供用户手册， Matlab 优化工具箱 提供...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第 38 章 数值优化 | 现代应用统计与 R 语言">
<meta name="twitter:description" content="R 语言提供了相当多的优化求解器，比较完整的概览见优化视图。 本章介绍一些常用的优化算法及其R实现，涵盖线性规划、整数规划、二次规划、非线性规划等。 商业优化求解器的能力都覆盖非线性规划（NLP），线性（LP）、二次（QP）和锥规划（SOCP），混合整数线性规划（MILP），多目标优化，最小二乘和方程求解。此外，还有很多文档介绍， LINGO提供用户手册， Matlab 优化工具箱 提供...">
<meta name="twitter:image" content="/images/cover.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs/header-attrs.js"></script><script src="libs/jquery/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap/bootstrap.bundle.min.js"></script><script src="libs/bs3compat/transition.js"></script><script src="libs/bs3compat/tabs.js"></script><script src="libs/bs3compat/bs3compat.js"></script><link href="libs/bs4_book/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book/bs4_book.js"></script><script src="libs/htmlwidgets/htmlwidgets.js"></script><script src="libs/plotly-binding/plotly.js"></script><script src="libs/typedarray/typedarray.min.js"></script><link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet">
<script src="libs/crosstalk/js/crosstalk.min.js"></script><link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet">
<script src="libs/plotly-main/plotly-latest.min.js"></script><script src="libs/proj4js/proj4.js"></script><link href="libs/highcharts/css/motion.css" rel="stylesheet">
<script src="libs/highcharts/highcharts.js"></script><script src="libs/highcharts/highcharts-3d.js"></script><script src="libs/highcharts/highcharts-more.js"></script><script src="libs/highcharts/modules/stock.js"></script><script src="libs/highcharts/modules/map.js"></script><script src="libs/highcharts/modules/annotations.js"></script><script src="libs/highcharts/modules/data.js"></script><script src="libs/highcharts/modules/drilldown.js"></script><script src="libs/highcharts/modules/item-series.js"></script><script src="libs/highcharts/modules/offline-exporting.js"></script><script src="libs/highcharts/modules/overlapping-datalabels.js"></script><script src="libs/highcharts/modules/exporting.js"></script><script src="libs/highcharts/modules/export-data.js"></script><script src="libs/highcharts/modules/funnel.js"></script><script src="libs/highcharts/modules/heatmap.js"></script><script src="libs/highcharts/modules/treemap.js"></script><script src="libs/highcharts/modules/sankey.js"></script><script src="libs/highcharts/modules/dependency-wheel.js"></script><script src="libs/highcharts/modules/organization.js"></script><script src="libs/highcharts/modules/solid-gauge.js"></script><script src="libs/highcharts/modules/streamgraph.js"></script><script src="libs/highcharts/modules/sunburst.js"></script><script src="libs/highcharts/modules/vector.js"></script><script src="libs/highcharts/modules/wordcloud.js"></script><script src="libs/highcharts/modules/xrange.js"></script><script src="libs/highcharts/modules/tilemap.js"></script><script src="libs/highcharts/modules/venn.js"></script><script src="libs/highcharts/modules/gantt.js"></script><script src="libs/highcharts/modules/timeline.js"></script><script src="libs/highcharts/modules/parallel-coordinates.js"></script><script src="libs/highcharts/modules/bullet.js"></script><script src="libs/highcharts/modules/coloraxis.js"></script><script src="libs/highcharts/modules/dumbbell.js"></script><script src="libs/highcharts/modules/lollipop.js"></script><script src="libs/highcharts/modules/series-label.js"></script><script src="libs/highcharts/plugins/motion.js"></script><script src="libs/highcharts/custom/reset.js"></script><script src="libs/highcharts/modules/boost.js"></script><script src="libs/highchart-binding/highchart.js"></script><script src="libs/plotly-locale-zh-CN/zh-cn.js"></script><script src="libs/mathjax/cdn.js"></script><link href="libs/dygraphs/dygraph.css" rel="stylesheet">
<script src="libs/dygraphs/dygraph-combined.js"></script><script src="libs/dygraphs/shapes.js"></script><script src="libs/moment/moment.js"></script><script src="libs/moment-timezone/moment-timezone-with-data.js"></script><script src="libs/moment-fquarter/moment-fquarter.min.js"></script><script src="libs/dygraphs-binding/dygraphs.js"></script><script src="libs/Dygraph.Plugins.Unzoom/unzoom.js"></script><script src="libs/echarts4r/echarts-en.min.js"></script><script src="libs/echarts4r/ecStat.min.js"></script><script src="libs/echarts4r/dataTool.min.js"></script><script src="libs/echarts4r-binding/echarts4r.js"></script><script src="libs/d3/d3.min.js"></script><script src="libs/forceNetwork-binding/forceNetwork.js"></script><link href="libs/vis/vis-network.min.css" rel="stylesheet">
<script src="libs/vis/vis-network.min.js"></script><script src="libs/visNetwork-binding/visNetwork.js"></script><script src="libs/FileSaver/FileSaver.min.js"></script><script src="libs/Blob/Blob.js"></script><script src="libs/canvas-toBlob/canvas-toBlob.js"></script><script src="libs/html2canvas/html2canvas.js"></script><script src="libs/jspdf/jspdf.debug.js"></script><link href="libs/jquery-sparkline/jquery.sparkline.css" rel="stylesheet">
<script src="libs/jquery-sparkline/jquery.sparkline.js"></script><script src="libs/sparkline-binding/sparkline.js"></script><script src="libs/r2d3-render/r2d3-render.js"></script><script src="libs/webcomponents/webcomponents.js"></script><script src="libs/r2d3-binding/r2d3.js"></script><script src="libs/d3v6/d3.min.js"></script><script src="libs/es6shim/es6shim.js"></script><script src="libs/es7shim/es7shim.js"></script><script src="libs/graphre/graphre.js"></script><script src="libs/nomnoml/nomnoml.js"></script><script src="libs/nomnoml-binding/nomnoml.js"></script><script src="libs/d3-bundle/d3-bundle.min.js"></script><script src="libs/d3-lasso/d3-lasso.min.js"></script><script src="libs/save-svg-as-png/save-svg-as-png.min.js"></script><link href="libs/ggiraphjs/ggiraphjs.min.css" rel="stylesheet">
<script src="libs/ggiraphjs/ggiraphjs.min.js"></script><script src="libs/girafe-binding/girafe.js"></script><link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="libs/datatables-binding/datatables.js"></script><link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script><script src="libs/jszip/jszip.min.js"></script><script src="libs/pdfmake/pdfmake.js"></script><script src="libs/pdfmake/vfs_fonts.js"></script><link href="libs/dt-ext-buttons/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-buttons/js/dataTables.buttons.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.flash.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.html5.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.colVis.min.js"></script><script src="libs/dt-ext-buttons/js/buttons.print.min.js"></script><link href="libs/dt-ext-rowgroup/css/rowGroup.dataTables.min.css" rel="stylesheet">
<script src="libs/dt-ext-rowgroup/js/dataTables.rowGroup.min.js"></script><script src="libs/kePrint/kePrint.js"></script><link href="libs/lightable/lightable.css" rel="stylesheet">
<script src="libs/echarts-world/world.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-54GQKWF7VP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-54GQKWF7VP');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Modern Applied Statistics with R">现代应用统计与 R 语言</a>:
        <small class="text-muted">Modern Applied Statistics with R</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">欢迎</a></li>
<li><a class="" href="chap-preface.html"><span class="header-section-number">1</span> 前言</a></li>
<li class="book-part">数据整理</li>
<li><a class="" href="chap-data-wrangling.html">介绍</a></li>
<li><a class="" href="chap-data-structure.html"><span class="header-section-number">2</span> 数据结构</a></li>
<li><a class="" href="chap-data-transportation.html"><span class="header-section-number">3</span> 数据搬运</a></li>
<li><a class="" href="chap-string-operations.html"><span class="header-section-number">4</span> 字符串操作</a></li>
<li><a class="" href="chap-regular-expressions.html"><span class="header-section-number">5</span> 正则表达式</a></li>
<li><a class="" href="chap-data-manipulation.html"><span class="header-section-number">6</span> 数据操作</a></li>
<li><a class="" href="chap-advanced-manipulation.html"><span class="header-section-number">7</span> 高级数据操作</a></li>
<li><a class="" href="chap-parallel-manipulation.html"><span class="header-section-number">8</span> 并行化操作</a></li>
<li><a class="" href="chap-dplyr-manipulation.html"><span class="header-section-number">9</span> 净土化操作</a></li>
<li class="book-part">统计图形</li>
<li><a class="" href="chap-statistical-graphics.html">介绍</a></li>
<li><a class="" href="chap-graphics-foundations.html"><span class="header-section-number">10</span> 图形基础</a></li>
<li><a class="" href="chap-data-visualization.html"><span class="header-section-number">11</span> 数据可视化</a></li>
<li><a class="" href="chap-interactive-web-graphics.html"><span class="header-section-number">12</span> 交互图形</a></li>
<li class="book-part">动态文档</li>
<li><a class="" href="chap-dynamic-documents.html">介绍</a></li>
<li><a class="" href="chap-document-elements.html"><span class="header-section-number">13</span> 文档元素</a></li>
<li><a class="" href="chap-portable-document.html"><span class="header-section-number">14</span> 便携式文档</a></li>
<li><a class="" href="chap-web-documents.html"><span class="header-section-number">15</span> 网页文档</a></li>
<li><a class="" href="chap-office-document.html"><span class="header-section-number">16</span> 办公文档</a></li>
<li><a class="" href="chap-reproducible-workflows.html"><span class="header-section-number">17</span> 工作流</a></li>
<li><a class="" href="chap-advanced-documents.html"><span class="header-section-number">18</span> 高级文档</a></li>
<li class="book-part">数据产品</li>
<li><a class="" href="chap-data-product.html">介绍</a></li>
<li><a class="" href="chap-interactive-data-tables.html"><span class="header-section-number">19</span> 交互表格</a></li>
<li><a class="" href="chap-interactive-shiny-app.html"><span class="header-section-number">20</span> 交互报表</a></li>
<li class="book-part">统计基础</li>
<li><a class="" href="chap-statistical-foundations.html">介绍</a></li>
<li><a class="" href="chap-sampling-distributions.html"><span class="header-section-number">21</span> 抽样分布</a></li>
<li><a class="" href="chap-parameter-estimators.html"><span class="header-section-number">22</span> 参数估计</a></li>
<li><a class="" href="chap-hypothesis-test.html"><span class="header-section-number">23</span> 假设检验</a></li>
<li><a class="" href="chap-power-Analysis.html"><span class="header-section-number">24</span> 功效分析</a></li>
<li><a class="" href="chap-experimental-design.html"><span class="header-section-number">25</span> 试验设计</a></li>
<li class="book-part">统计模型</li>
<li><a class="" href="chap-statistical-models.html">介绍</a></li>
<li><a class="" href="chap-linear-models.html"><span class="header-section-number">26</span> 线性模型</a></li>
<li><a class="" href="chap-generalized-linear-models.html"><span class="header-section-number">27</span> 广义线性模型</a></li>
<li><a class="" href="chap-bayesian-models.html"><span class="header-section-number">28</span> 贝叶斯模型</a></li>
<li class="book-part">数据建模</li>
<li><a class="" href="chap-data-modeling.html">介绍</a></li>
<li><a class="" href="chap-text-analysis.html"><span class="header-section-number">29</span> 文本分析</a></li>
<li><a class="" href="chap-survival-analysis.html"><span class="header-section-number">30</span> 生存分析</a></li>
<li><a class="" href="chap-time-series-analysis.html"><span class="header-section-number">31</span> 时序分析</a></li>
<li class="book-part">时空数据</li>
<li><a class="" href="chap-spatio-temporal-data.html">介绍</a></li>
<li><a class="" href="chap-spatial-analysis.html"><span class="header-section-number">32</span> 空间数据分析</a></li>
<li><a class="" href="chap-spatial-modeling.html"><span class="header-section-number">33</span> 空间数据建模</a></li>
<li><a class="" href="chap-spatial-viz.html"><span class="header-section-number">34</span> 空间数据可视化</a></li>
<li><a class="" href="chap-case-study.html"><span class="header-section-number">35</span> 案例研究</a></li>
<li><a class="" href="chap-data-explorer.html"><span class="header-section-number">36</span> 数据探索</a></li>
<li class="book-part">机器学习</li>
<li><a class="" href="chap-machine-learning.html">介绍</a></li>
<li><a class="" href="chap-gradient-boosting-machine.html"><span class="header-section-number">37</span> 梯度提升机</a></li>
<li><a class="active" href="chap-numerical-optimization.html"><span class="header-section-number">38</span> 数值优化</a></li>
<li class="book-part">附录</li>
<li><a class="" href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></li>
<li><a class="" href="chap-matrix-operations.html"><span class="header-section-number">B</span> 矩阵运算</a></li>
<li><a class="" href="chap-symbolic-computation.html"><span class="header-section-number">C</span> 符号计算</a></li>
<li><a class="" href="chap-mixed-programming.html"><span class="header-section-number">D</span> 混合编程</a></li>
<li><a class="" href="chap-object-oriented-programming.html"><span class="header-section-number">E</span> 面向对象编程</a></li>
<li><a class="" href="chap-file-operations.html"><span class="header-section-number">F</span> 文件操作</a></li>
<li><a class="" href="chap-other-softwares.html"><span class="header-section-number">G</span> 其它软件</a></li>
<li><a class="" href="chap-notations.html"><span class="header-section-number">H</span> 符号说明</a></li>
<li><a class="" href="references.html">参考文献</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/XiangyunHuang/masr">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chap-numerical-optimization" class="section level1" number="38">
<h1>
<span class="header-section-number">第 38 章</span> 数值优化<a class="anchor" aria-label="anchor" href="#chap-numerical-optimization"><i class="fas fa-link"></i></a>
</h1>
<!-- 
Optimization Packages for R
https://github.com/r-opt 
数值优化 经典教材 [@Nocedal2006]
https://www.csie.ntu.edu.tw/~r97002/temp/num_optimization.pdf
-->
<p>R 语言提供了相当多的优化求解器，比较完整的概览见<a href="https://CRAN.R-project.org/view=Optimization">优化视图</a>。 本章介绍一些常用的优化算法及其R实现，涵盖线性规划、整数规划、二次规划、非线性规划等。</p>
<p>商业优化求解器的能力都覆盖非线性规划（NLP），线性（LP）、二次（QP）和锥规划（SOCP），混合整数线性规划（MILP），多目标优化，最小二乘和方程求解。此外，还有很多文档介绍，
<a href="https://www.lindo.com/">LINGO</a>提供<a href="https://www.lindo.com/downloads/PDF/LINGO.pdf">用户手册</a>，
<a href="https://ww2.mathworks.cn/products/optimization.html">Matlab 优化工具箱</a> 提供 <a href="https://ww2.mathworks.cn/help/releases/R2021a/pdf_doc/optim/optim.pdf">Optimization 工具箱使用指南</a>，
<a href="https://github.com/MOSEK">MOSEK</a> (<a href="https://www.mosek.com/" class="uri">https://www.mosek.com/</a>) 提供 <a href="https://docs.mosek.com/modeling-cookbook/index.html">MOSEK 建模食谱</a>，<a href="https://www.localsolver.com/">LocalSolver</a> 提供<a href="https://www.localsolver.com/docs/last/index.html">基本使用手册</a>，
<a href="https://www.gurobi.com/">Gurobi</a> 提供 <a href="https://www.gurobi.com/documentation/9.1/refman/index.html">Gurobi 参考手册</a>，<a href="https://www.ibm.com/cn-zh/products/ilog-cplex-optimization-studio">CPLEX Optimization Studio</a>。</p>
<p>开源社区有不少工具，也能求解常见的优化问题，如 Julia 的 <a href="https://github.com/jump-dev">JuMP</a> (<a href="https://jump.dev/" class="uri">https://jump.dev/</a>)，Octave (<a href="https://www.gnu.org/software/octave/" class="uri">https://www.gnu.org/software/octave/</a>) 内置的优化函数，Python 模块 <a href="https://github.com/scipy/scipy">SciPy</a> 提供 <a href="https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html">Optimization 优化求解器</a>，<a href="https://github.com/cvxopt/cvxopt">cvxopt</a> 凸优化求解器，主要基于内点法，提供 Julia、Python、Matlab 接口，算法介绍见
<a href="http://www.seas.ucla.edu/~vandenbe/publications/coneprog.pdf">锥优化</a>
<a href="http://www.seas.ucla.edu/~vandenbe/publications/mlbook.pdf">机器学习优化</a>。
课程见 <a href="https://github.com/epfml/OptML_course">Optimization for Machine Learning</a>，书籍见<a href="https://stanford.edu/~boyd/cvxbook/">Convex Optimization</a>，相关综述见<a href="https://arxiv.org/pdf/1405.4980.pdf">Convex Optimization: Algorithms and Complexity</a>。</p>
<p>Berwin A. Turlach 开发的 <a href="https://CRAN.R-project.org/package=quadprog">quadprog</a> 主要用于求解二次规划问题。<a href="https://web.stanford.edu/~anqif/">Anqi Fu</a> 开发的 <a href="https://github.com/anqif/CVXR">CVXR</a> 可解很多凸优化问题 <span class="citation"><a href="#ref-CVXR2020" role="doc-biblioref">[96]</a></span>，详见网站 <a href="https://cvxr.rbind.io/" class="uri">https://cvxr.rbind.io/</a>，<a href="https://www.ucl.ac.uk/~uctpjyy/nloptr.html">Jelmer Ypma</a> 开发的 <a href="https://github.com/jyypma/nloptr">nloptr</a> 可解无约束和有约束的非线性规划问题 <span class="citation"><a href="#ref-nloptr" role="doc-biblioref">[97]</a></span>，<a href="https://github.com/mbinois/GPareto">GPareto</a> 求解多目标优化问题，帕雷托前沿优化和估计<span class="citation"><a href="#ref-GPareto2019" role="doc-biblioref">[98]</a></span>。<a href="https://github.com/igraph/igraph/">igraph</a> 可以用来解决最短路径、最大网络流、最小生成树等图优化相关的问题。 <a href="https://palomar.home.ece.ust.hk/MAFS6010R_lectures/Rsession_solvers.html" class="uri">https://palomar.home.ece.ust.hk/MAFS6010R_lectures/Rsession_solvers.html</a> 提供了一般的求解器介绍。ROI 包力图统一各个求解器的调用接口，打造一个优化算法的基础设施平台。<span class="citation"><a href="#ref-ROI2020" role="doc-biblioref">[99]</a></span> 详细介绍了目前优化算法发展情况及 R 社区提供的优化能力。<a href="https://github.com/luca-scr/GA">GA</a> 包实现了遗传算法，支持连续和离散的空间搜索，可以并行 <span class="citation"><a href="#ref-GA2013" role="doc-biblioref">[100]</a>, <a href="#ref-GA2017" role="doc-biblioref">[101]</a></span>，是求解 TSP 问题的重要方法。NMOF 包实现了差分进化、遗传算法、粒子群算法、模拟退火算法等启发式优化算法，还提供网格搜索和贪婪搜索工具，<span class="citation"><a href="#ref-NMOF2019" role="doc-biblioref">[102]</a></span> 提供了详细的介绍。<span class="citation"><a href="#ref-Nash2014" role="doc-biblioref">[103]</a></span> 总结了 R 语言环境下最优化问题的最佳实践。<a href="https://github.com/coatless/rcppensmallen">RcppEnsmallen</a> 数值优化
通用标准的优化方法，前沿最新的优化方法，包含小批量/全批量梯度下降技术、无梯度优化器，约束优化技术。<a href="https://github.com/yixuan/RcppNumerical">RcppNumerical</a> 无约束数值优化，一维/多维数值积分。</p>
<p>谷歌开源的运筹优化工具 <a href="https://github.com/google/or-tools">or-tools</a> 提供了约束优化、线性优化、混合整数优化、装箱和背包算法、TSP（Traveling Salesman Problem）、VRP（Vehicle Routing Problem）、图算法（最短路径、最小成本流、最大流等）等算法和求解器。「运筹OR帷幄」社区开源的 <a href="https://github.com/Operations-Research-Science/Ebook-Linear_Programming">线性规划</a> 一书值得一看。</p>
<div class="sourceCode" id="cb2527"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 加载 ROI 时不要自动加载插件</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>ROI_LOAD_PLUGINS <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/lpSolve">lpSolve</a></span><span class="op">)</span>    <span class="co"># 线性规划求解器</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://roi.r-forge.r-project.org/">ROI</a></span><span class="op">)</span>        <span class="co"># 优化工具箱</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://roi.r-forge.r-project.org/">ROI.plugin.alabama</a></span><span class="op">)</span>  <span class="co"># 注册 alabama 求解器</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://roi.r-forge.r-project.org/">ROI.plugin.nloptr</a></span><span class="op">)</span>   <span class="co"># 注册 nloptr 求解器</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://roi.r-forge.r-project.org/">ROI.plugin.lpsolve</a></span><span class="op">)</span>  <span class="co"># 注册 lpsolve 求解器</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://roi.r-forge.r-project.org/">ROI.plugin.quadprog</a></span><span class="op">)</span> <span class="co"># 注册 quadprog 求解器</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span>    <span class="co"># 图形绘制</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kernlab</span><span class="op">)</span>    <span class="co"># 优化问题和机器学习的关系</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rootSolve</span><span class="op">)</span>       <span class="co"># 非线性方程</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.html">BB</a></span><span class="op">)</span>              <span class="co"># 非线性方程组</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/">deSolve</a></span><span class="op">)</span>         <span class="co"># ODE 常微分方程</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scatterplot3d</span><span class="op">)</span>   <span class="co"># 三维曲线图</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">shape</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ReacTran</span><span class="op">)</span>        <span class="co"># PDE 偏微分方程</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pbs-software/pbs-ddesolve">PBSddesolve</a></span><span class="op">)</span>     <span class="co"># DAE 延迟微分方程</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/">nlme</a></span><span class="op">)</span>            <span class="co"># 混合效应模型</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.cran.r-project.org">nlmeODE</a></span><span class="op">)</span>         <span class="co"># ODE 应用于混合效应模型</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/acguidoum/Sim.DiffProc">Sim.DiffProc</a></span><span class="op">)</span>    <span class="co"># SDE 随机微分方程</span>

<span class="co"># library(nlmixr)          # Population ODE modeling</span></code></pre></div>
<p>表 <a href="chap-numerical-optimization.html#tab:roi-plugin-html">38.1</a> 对目前的优化器按优化问题做了分类</p>
<div class="inline-table"><table style="NAborder-bottom: 0;" class="table table-sm">
<caption>
<span id="tab:roi-plugin-html">表 38.1: </span>ROI 插件按优化问题分类
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Linear
</th>
<th style="text-align:left;">
Quadratic
</th>
<th style="text-align:left;">
Conic
</th>
<th style="text-align:left;">
Functional
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Box
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
optimx
</td>
</tr>
<tr>
<td style="text-align:left;">
Linear
</td>
<td style="text-align:left;">
<span class="math inline">\(\mathrm{clp}^\star\)</span>, <span class="math inline">\(\mathrm{cbc}^{\star+}\)</span>, <span class="math inline">\(\mathrm{glpk}^{\star+}\)</span>, <span class="math inline">\(\mathrm{lpsolve}^{\star+}\)</span>, <span class="math inline">\(\mathrm{msbinlp}^{\star+}\)</span>, <span class="math inline">\(\mathrm{symphony}^{\star+}\)</span>
</td>
<td style="text-align:left;">
ipop, <span class="math inline">\(\mathrm{quadprog}^{\star}\)</span>, qpoases
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Quadratic
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<span class="math inline">\(\mathrm{cplex}^{+}\)</span>, <span class="math inline">\(\mathrm{gurobi}^{\star+}\)</span>, <span class="math inline">\(\mathrm{mosek}^{\star+}\)</span>, <span class="math inline">\(\mathrm{neos}^{+}\)</span>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Conic
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
<span class="math inline">\(\mathrm{ecos}^{\star+}\)</span>, <span class="math inline">\(\mathrm{scs}^{\star}\)</span>
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Functional
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
alabama, deoptim, nlminb, nloptr
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="padding: 0; " colspan="100%">
<sup>*</sup> 求解器受限于凸优化问题
</td>
</tr>
<tr>
<td style="padding: 0; " colspan="100%">
<sup>+</sup> 求解器可以处理整型约束
</td>
</tr>
</tfoot>
</table></div>
<div id="sec-linear-programming" class="section level2" number="38.1">
<h2>
<span class="header-section-number">38.1</span> 线性规划<a class="anchor" aria-label="anchor" href="#sec-linear-programming"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://cran.r-project.org/package=clpAPI">clpAPI</a> 线性规划求解器。<a href="https://www.gnu.org/software/glpk/">glpk</a> 的两个 R 接口 – <a href="https://cran.r-project.org/package=glpkAPI">glpkAPI</a> 和
<a href="https://CRAN.R-project.org/package=Rglpk">Rglpk</a> 提供线性规划和混合整数规划的求解能力。<a href="http://lpsolve.sourceforge.net/">lp_solve</a> 的两个 R 接口 –
<a href="https://cran.r-project.org/package=lpSolveAPI">lpSolveAPI</a> 和 <a href="https://github.com/gaborcsardi/lpSolve">lpSolve</a> 也提供类似的能力。<a href="https://github.com/dirkschumacher/ompr">ompr</a> 求解混合整数线性规划问题。</p>
<p>举个例子，如下</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \quad -6x_1 -5x_2 \\
    s.t.\left\{ 
    \begin{array}{l}
    x_1  + 4x_2 \leq 16\\
    6x_1 + 4x_2 \leq 28\\
    2x_1 - 5x_2 \leq 6
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<p>写成矩阵形式</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
\min_x \quad
  \begin{bmatrix}
  -6  \\
  -5
  \end{bmatrix}
  ^{T} x \\
s.t.\left\{ 
 \begin{array}{l}
  \begin{bmatrix}
  1 &amp; 4  \\
  6 &amp; 4  \\
  2 &amp; -5 
  \end{bmatrix}
  x \leq
  \begin{bmatrix}
   16 \\
   28 \\
   6
  \end{bmatrix}
 \end{array} \right.
\end{array} 
\end{equation*}\]</span></p>
<p>对应成 R 代码如下</p>
<div class="sourceCode" id="cb2528"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># lpSolve 添加约束条件</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gaborcsardi/lpSolve">lpSolve</a></span><span class="op">)</span>
<span class="co"># 目标</span>
<span class="va">f.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>
<span class="co"># 约束</span>
<span class="va">f.con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="op">-</span><span class="fl">5</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># 方向</span>
<span class="va">f.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;="</span>, <span class="st">"&lt;="</span>, <span class="st">"&lt;="</span><span class="op">)</span>
<span class="co"># 右手边</span>
<span class="va">f.rhs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">28</span>, <span class="fl">6</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lpSolve/man/lp.html">lp</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="va">f.obj</span>, <span class="va">f.con</span>, <span class="va">f.dir</span>, <span class="va">f.rhs</span><span class="op">)</span>
<span class="va">res</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] -31.4</code></pre>
<div class="sourceCode" id="cb2530"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 2.4 3.4</code></pre>
</div>
<div id="sec-integer-programming" class="section level2" number="38.2">
<h2>
<span class="header-section-number">38.2</span> 整数规划<a class="anchor" aria-label="anchor" href="#sec-integer-programming"><i class="fas fa-link"></i></a>
</h2>
<div id="common-integer-programming" class="section level3" number="38.2.1">
<h3>
<span class="header-section-number">38.2.1</span> 一般整数规划<a class="anchor" aria-label="anchor" href="#common-integer-programming"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \max_x \quad 0.2x_1 + 0.6x_2 \\
    s.t.\left\{ 
    \begin{array}{l}
    5x_1  + 3x_2 \leq 250\\
    -3x_1 + 2x_2 \leq 4\\
    x_1,x_2 \geq 0, \quad x_1,x_2 \in \mathbb{Z}
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2532"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标</span>
<span class="va">f.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span><span class="op">)</span>
<span class="co"># 约束</span>
<span class="va">f.con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># 方向</span>
<span class="va">f.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;="</span>, <span class="st">"&lt;="</span><span class="op">)</span>
<span class="co"># 右手边</span>
<span class="va">f.rhs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">4</span><span class="op">)</span>
<span class="co"># 限制两个变量都是整数</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lpSolve/man/lp.html">lp</a></span><span class="op">(</span><span class="st">"max"</span>, <span class="va">f.obj</span>, <span class="va">f.con</span>, <span class="va">f.dir</span>, <span class="va">f.rhs</span>, int.vec<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>
<span class="va">res</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 29.2</code></pre>
<div class="sourceCode" id="cb2534"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 26 40</code></pre>
</div>
<div id="binary-integer-programming" class="section level3" number="38.2.2">
<h3>
<span class="header-section-number">38.2.2</span> 0-1 整数规划<a class="anchor" aria-label="anchor" href="#binary-integer-programming"><i class="fas fa-link"></i></a>
</h3>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \max_x \quad 0.2x_1 + 0.6x_2 \\
    s.t.\left\{ 
    \begin{array}{l}
    5x_1  + 3x_2 \leq 250\\
    -3x_1 + 2x_2 \leq 4\\
    x_1,x_2 \in \{0,1\}
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2536"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标</span>
<span class="va">f.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.6</span><span class="op">)</span>
<span class="co"># 约束</span>
<span class="va">f.con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># 方向</span>
<span class="va">f.dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;="</span>, <span class="st">"&lt;="</span><span class="op">)</span>
<span class="co"># 右手边</span>
<span class="va">f.rhs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">4</span><span class="op">)</span>
<span class="co"># 限制两个变量都是0-1整数</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lpSolve/man/lp.html">lp</a></span><span class="op">(</span><span class="st">"max"</span>, <span class="va">f.obj</span>, <span class="va">f.con</span>, <span class="va">f.dir</span>, <span class="va">f.rhs</span>, int.vec<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, all.bin <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">res</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 0.8</code></pre>
<div class="sourceCode" id="cb2538"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 1 1</code></pre>
</div>
<div id="mixed-integer-programming" class="section level3" number="38.2.3">
<h3>
<span class="header-section-number">38.2.3</span> 混合整数规划<a class="anchor" aria-label="anchor" href="#mixed-integer-programming"><i class="fas fa-link"></i></a>
</h3>
<p>一部分变量要求是整数</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \max_x \quad 3x_1 + 7x_2 - 12x_3 \\
    s.t.\left\{ 
    \begin{array}{l}
    5x_1 + 7x_2 + 2x_3 \leq 61\\
    3x_1 + 2x_2 - 9x_3 \leq 35\\
    x_1 + 3x_2 + x_3 \leq 31\\
    x_1,x_2 \geq 0, \quad x_2, x_3 \in \mathbb{Z}, \quad x_3 \in [-10, 10]
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<p>矩阵形式如下</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
\min_x \quad
  \begin{bmatrix}
  3  \\
  7  \\
  -12
  \end{bmatrix}
  ^{T} x \\
s.t.\left\{ 
 \begin{array}{l}
  \begin{bmatrix}
  5 &amp; 7 &amp; 2 \\
  3 &amp; 2 &amp; -9\\
  1 &amp; 3 &amp; 1
  \end{bmatrix}
  x \leq
  \begin{bmatrix}
   61 \\
   35 \\
   31
  \end{bmatrix}
 \end{array} \right.
\end{array} 
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2540"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/L_objective.html">L_objective</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="op">-</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span>,
  <span class="co"># 指定变量类型：第1个变量是连续值，第2、3个变量是整数</span>
  types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"I"</span>, <span class="st">"I"</span><span class="op">)</span>,
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/L_constraint.html">L_constraint</a></span><span class="op">(</span>
    L <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
      <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">2</span>,
      <span class="fl">3</span>, <span class="fl">2</span>, <span class="op">-</span><span class="fl">9</span>,
      <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">1</span>
    <span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;="</span>, <span class="st">"&lt;="</span>, <span class="st">"&lt;="</span><span class="op">)</span>,
    rhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">61</span>, <span class="fl">35</span>, <span class="fl">31</span><span class="op">)</span>
  <span class="op">)</span>,
  <span class="co"># 添加约束：第3个变量的下、上界分别是 -10 和 10</span>
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>li <span class="op">=</span> <span class="fl">3</span>, ui <span class="op">=</span> <span class="fl">3</span>, lb <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, ub <span class="op">=</span> <span class="fl">10</span>, nobj <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="va">op</span></code></pre></div>
<pre><code>## ROI Optimization Problem:
## 
## Maximize a linear objective function of length 3 with
## - 1 continuous objective variable,
## - 2 integer objective variables,
## 
## subject to
## - 3 constraints of type linear.
## - 1 lower and 1 upper non-standard variable bound.</code></pre>
<div class="sourceCode" id="cb2542"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"lpsolve"</span><span class="op">)</span>
<span class="va">res</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1]  0.3333333  8.0000000 -2.0000000</code></pre>
<div class="sourceCode" id="cb2544"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">res</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 81</code></pre>
</div>
</div>
<div id="sec-quadratic-programming" class="section level2" number="38.3">
<h2>
<span class="header-section-number">38.3</span> 二次规划<a class="anchor" aria-label="anchor" href="#sec-quadratic-programming"><i class="fas fa-link"></i></a>
</h2>
<div id="sec-strictly-convex-quadratic-program" class="section level3" number="38.3.1">
<h3>
<span class="header-section-number">38.3.1</span> 凸二次规划<a class="anchor" aria-label="anchor" href="#sec-strictly-convex-quadratic-program"><i class="fas fa-link"></i></a>
</h3>
<p>在 R 中使用 <strong>quadprog</strong> <span class="citation"><a href="#ref-quadprog2019" role="doc-biblioref">[104]</a></span> 包求解二次规划<a href="references.html#fn79" class="footnote-ref" id="fnref79"><sup>79</sup></a>，<strong>quadprogXT</strong> 包用来求解带绝对值约束的二次规划，<strong>pracma</strong> <span class="citation"><a href="#ref-pracma2021" role="doc-biblioref">[105]</a></span>包提供 <code>quadprog()</code> 函数就是对 <strong>quadprog</strong> 包的 <code><a href="https://rdrr.io/pkg/quadprog/man/solve.QP.html">solve.QP()</a></code> 进行封装，调用风格更像 Matlab。<strong>quadprog</strong> 包实现了 Goldfarb and Idnani (1982, 1983) 提出的对偶方法，主要用来求解带线性约束的严格凸二次规划问题。quadprog 求解的二次型的形式如下：</p>
<p><span class="math display">\[\min_b - d^{\top}b +\frac{1}{2}b^{\top}Db , \quad A^{\top}b \geq b_{0}\]</span></p>
<div class="sourceCode" id="cb2546"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">solve.QP</span><span class="op">(</span><span class="va">Dmat</span>, <span class="va">dvec</span>, <span class="va">Amat</span>, <span class="va">bvec</span>, meq <span class="op">=</span> <span class="fl">0</span>, factorized <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>参数 <code>Dmat</code>、<code>dvec</code>、<code>Amat</code>、<code>bvec</code> 分别对应二次规划问题中的 <span class="math inline">\(D,d,A,b_{0}\)</span>。下面举个二次规划的具体例子</p>
<p><span class="math display">\[
D = \begin{bmatrix}2 &amp; -1\\
-1 &amp; 2
\end{bmatrix}, \quad
d = (-3,2), \quad
A = \begin{bmatrix}1 &amp; 1\\
-1 &amp; 1 \\
0  &amp; -1
\end{bmatrix}, \quad
b_{0} = (2,-2,-3)
\]</span>
即目标函数 <span class="math display">\[Q(x,y) = x^2 + y^2 -xy+3x-2y+4\]</span>
它的可行域如图<a href="chap-numerical-optimization.html#fig:feasible-region">38.1</a>所示</p>
<div class="sourceCode" id="cb2547"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>,
  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">5.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3.5</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"n"</span>,
  xlab <span class="op">=</span> <span class="st">"x"</span>, ylab <span class="op">=</span> <span class="st">"y"</span>, main <span class="op">=</span> <span class="st">"Feasible Region"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">TRUE</span>, lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"gray"</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:feasible-region"></span>
<img src="numerical-optimization_files/figure-html/feasible-region-1.png" alt="可行域" width="432"><p class="caption">
图 38.1: 可行域
</p>
</div>
<p>调用 <strong>quadprog</strong> 包的 <code><a href="https://rdrr.io/pkg/quadprog/man/solve.QP.html">solve.QP()</a></code> 函数求解此二次规划问题</p>
<div class="sourceCode" id="cb2548"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">quadprog</span><span class="op">)</span>
<span class="va">Dmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">dvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">bvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span>
<span class="va">Amat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span>
<span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/quadprog/man/solve.QP.html">solve.QP</a></span><span class="op">(</span>Dmat <span class="op">=</span> <span class="va">Dmat</span>, dvec <span class="op">=</span> <span class="va">dvec</span>, Amat <span class="op">=</span> <span class="va">Amat</span>, bvec <span class="op">=</span> <span class="va">bvec</span><span class="op">)</span>
<span class="va">sol</span></code></pre></div>
<pre><code>## $solution
## [1] 0.1666667 1.8333333
## 
## $value
## [1] -0.08333333
## 
## $unconstrained.solution
## [1] -1.3333333  0.3333333
## 
## $iterations
## [1] 2 0
## 
## $Lagrangian
## [1] 1.5 0.0 0.0
## 
## $iact
## [1] 1</code></pre>
<p>ROI 默认的二次规划的标准形式为 <span class="math inline">\(\frac{1}{2}x^{\top}Qx + a^{\top}x\)</span>，在传递参数值的时候注意和上面的区别。</p>
<div class="sourceCode" id="cb2550"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://roi.r-forge.r-project.org/">ROI</a></span><span class="op">)</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/Q_objective.html">Q_objective</a></span><span class="op">(</span>Q <span class="op">=</span> <span class="va">Dmat</span>, L <span class="op">=</span> <span class="op">-</span><span class="va">dvec</span><span class="op">)</span>,
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/L_constraint.html">L_constraint</a></span><span class="op">(</span><span class="va">A</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="st">"&gt;="</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">bvec</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># 默认求最小</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.slsqp"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] -0.08333333</code></pre>
<div class="sourceCode" id="cb2552"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 0.1666667 1.8333333</code></pre>
<p>对变量 <span class="math inline">\(x\)</span> 添加整型约束，原二次规划即变成混合整数二次规划 （Mixed Integer Quadratic Programming，简称 MIQP）</p>
<div class="sourceCode" id="cb2554"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目前开源的求解器都不能处理 MIQP 问题</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/Q_objective.html">Q_objective</a></span><span class="op">(</span>Q <span class="op">=</span> <span class="va">Dmat</span>, L <span class="op">=</span> <span class="op">-</span><span class="va">dvec</span><span class="op">)</span>,
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/L_constraint.html">L_constraint</a></span><span class="op">(</span><span class="va">A</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="st">"&gt;="</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">bvec</span><span class="op">)</span>,
  types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"C"</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># 默认求最小</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.slsqp"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">objval</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<p>在可行域上画出等高线，标记目标解的位置，图中红点表示无约束下的解，黄点表示线性约束下的解</p>
<div class="sourceCode" id="cb2555"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">qp_sol</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">solution</span> <span class="co"># 二次规划的解</span>
<span class="va">uc_sol</span> <span class="op">&lt;-</span> <span class="va">sol</span><span class="op">$</span><span class="va">unconstrained.solution</span> <span class="co"># 无约束情况下的解</span>
<span class="co"># 画图</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">5.5</span>, length.out <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">3.5</span>, length.out <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>
<span class="co"># 二次规划的目标函数</span>
<span class="va">grid</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">grid</span>, <span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">y</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">y</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html">levelplot</a></span><span class="op">(</span><span class="va">z</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>, <span class="va">grid</span>,
  cuts <span class="op">=</span> <span class="fl">40</span>,
  panel <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.levelplot.html">panel.levelplot</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">panel.polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,
      border <span class="op">=</span> <span class="cn">TRUE</span>,
      lwd <span class="op">=</span> <span class="fl">2</span>, col <span class="op">=</span> <span class="st">"transparent"</span>
    <span class="op">)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/llines.html">panel.points</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">uc_sol</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">qp_sol</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
      <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">uc_sol</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">qp_sol</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
      lwd <span class="op">=</span> <span class="fl">5</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"yellow"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">19</span>
    <span class="op">)</span>
  <span class="op">}</span>,
  colorkey <span class="op">=</span> <span class="cn">TRUE</span>,
  col.regions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:quadprog"></span>
<img src="numerical-optimization_files/figure-html/quadprog-1.png" alt="无约束和有约束条件下的解" width="432"><p class="caption">
图 38.2: 无约束和有约束条件下的解
</p>
</div>
</div>
<div id="subsec-semidefinite-optimization" class="section level3" number="38.3.2">
<h3>
<span class="header-section-number">38.3.2</span> 半正定二次优化<a class="anchor" aria-label="anchor" href="#subsec-semidefinite-optimization"><i class="fas fa-link"></i></a>
</h3>
<p>kernlab 提供基于核的机器学习方法，可用于分类、回归、聚类、异常检测、分位回归、降维等场景，包含支撑向量机、谱聚类、核PCA、高斯过程和二次规划求解器，将优化方法用于机器学习，展示二者的关系。</p>
<p>R 包 kernlab 的函数 <code><a href="https://rdrr.io/pkg/kernlab/man/ipop.html">ipop()</a></code> 实现内点法可以求解半正定的二次规划问题，对应到上面的例子，就是要求 <span class="math inline">\(A \geq 0\)</span>，而 R 包 quadprog 只能求解正定的二次规划问题，即要求 <span class="math inline">\(A &gt; 0\)</span>。</p>
<p>以二分类问题为例，采用 SMO (Sequential Minimization Optimization) 求解器，将 SVM 的二次优化问题分解。</p>
<div class="sourceCode" id="cb2556"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kernlab</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">120</span><span class="op">)</span>, <span class="fl">60</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">120</span>, mean <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fl">60</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">60</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">svp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/kernlab/man/ksvm.html">ksvm</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, type <span class="op">=</span> <span class="st">"C-svc"</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/sf/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">svp</span>, data <span class="op">=</span> <span class="va">x</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:toy-binary"></span>
<img src="numerical-optimization_files/figure-html/toy-binary-1.png" alt="二分类问题" width="528"><p class="caption">
图 38.3: 二分类问题
</p>
</div>
</div>
</div>
<div id="sec-nonlinear-programming" class="section level2" number="38.4">
<h2>
<span class="header-section-number">38.4</span> 非线性规划<a class="anchor" aria-label="anchor" href="#sec-nonlinear-programming"><i class="fas fa-link"></i></a>
</h2>
<p>开源的非线性优化求解器，推荐使用 nloptr，它支持全局优化，同时推荐 ROI，它有统一的接口函数。</p>
<div id="sec-one-dimensional-optimization" class="section level3" number="38.4.1">
<h3>
<span class="header-section-number">38.4.1</span> 一元非线性优化<a class="anchor" aria-label="anchor" href="#sec-one-dimensional-optimization"><i class="fas fa-link"></i></a>
</h3>
<p>下面考虑一个稍微复杂的一元函数优化问题，求复合函数的极值</p>
<p><span class="math display">\[
g(x) = \int_{0}^{x} -\sqrt{t}\exp(-t^2) \mathrm{dt}, \quad f(y) = \int_{0}^{y} g(s) \exp(-s) \mathrm{ds}
\]</span></p>
<div class="sourceCode" id="cb2557"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">g</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html">integrate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span>
    <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">t</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="op">}</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">value</span>
<span class="op">}</span>

<span class="va">f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html">integrate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize</a></span><span class="op">(</span><span class="va">g</span>, <span class="st">"x"</span><span class="op">)</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">s</span><span class="op">)</span>
  <span class="op">}</span>, lower <span class="op">=</span> <span class="fl">0</span>, upper <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">$</span><span class="va">value</span>
<span class="op">}</span>

<span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/model-method-optimize.html">optimize</a></span><span class="op">(</span><span class="va">f</span>, interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span><span class="op">)</span>, maximum <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code>## $minimum
## [1] 66.84459
## 
## $objective
## [1] -0.3201572</code></pre>
<div class="rmdtip">
<p>计算积分的时候，输入了一系列 s 值，参数是向量，而函数 g 只支持输入参数是单个值，<code>g(c(1,2))</code> 会报错，因此上面对函数 <code>g()</code> 用了向量化函数 <code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code> 操作。</p>
<div class="sourceCode" id="cb2559"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">g</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -0.453392</code></pre>
<p>类似地，同时计算多个目标函数 <code>f(y)</code> 的值，也需要<code><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize()</a></code> 实现向量化操作。</p>
<div class="sourceCode" id="cb2561"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html">Vectorize</a></span><span class="op">(</span><span class="va">f</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -0.1103310 -0.2373865</code></pre>
</div>
</div>
<div id="sec-nonlinear-unconstrained-optimization" class="section level3" number="38.4.2">
<h3>
<span class="header-section-number">38.4.2</span> 多元非线性无约束优化<a class="anchor" aria-label="anchor" href="#sec-nonlinear-unconstrained-optimization"><i class="fas fa-link"></i></a>
</h3>
<!-- ?nlm -->
<p>下面这些用来测试优化算法的函数来自<a href="https://en.wikipedia.org/wiki/Test_functions_for_optimization">维基百科</a></p>
<div id="himmelblau" class="section level4" number="38.4.2.1">
<h4>
<span class="header-section-number">38.4.2.1</span> Himmelblau 函数<a class="anchor" aria-label="anchor" href="#himmelblau"><i class="fas fa-link"></i></a>
</h4>
<p>Himmelblau 函数是一个多摸函数，常用于比较优化算法的优劣。</p>
<p><span class="math display">\[f(x_1,x_2) = (x_1^2 + x_2 -11)^2 + (x_1 + x_2^2 -7)^2\]</span>
它在四个位置取得一样的极小值，分别是 <span class="math inline">\(f(-3.7793, -3.2832) = 0\)</span>，<span class="math inline">\(f(-2.8051, 3.1313) = 0\)</span>，<span class="math inline">\(f(3, 2) = 0\)</span>，<span class="math inline">\(f(3.5844, -1.8481) = 0\)</span>。函数图像见图 <a href="chap-numerical-optimization.html#fig:himmelblau">38.4</a>。</p>
<div class="sourceCode" id="cb2563"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标函数</span>
<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
   <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">11</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">7</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span>
<span class="co"># 减少三维图形的边空</span>
<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/lattice.options.html">lattice.options</a></span><span class="op">(</span>
  layout.widths <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    left.padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">.6</span>, units <span class="op">=</span> <span class="st">"inches"</span><span class="op">)</span>,
    right.padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span>, units <span class="op">=</span> <span class="st">"inches"</span><span class="op">)</span>
  <span class="op">)</span>,
  layout.heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    bottom.padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">.8</span>, units <span class="op">=</span> <span class="st">"inches"</span><span class="op">)</span>,
    top.padding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">1.0</span>, units <span class="op">=</span> <span class="st">"inches"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="op">-</span><span class="fl">240</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:himmelblau"></span>
<img src="numerical-optimization_files/figure-html/himmelblau-1.png" alt="Himmelblau 函数图像" width="528"><p class="caption">
图 38.4: Himmelblau 函数图像
</p>
</div>
<div class="sourceCode" id="cb2564"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 梯度函数</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">fn</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> 
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="fl">1</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">fn</span>, gr <span class="op">=</span> <span class="va">gr</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span></code></pre></div>
<pre><code>## $par
## [1] -2.805118  3.131313
## 
## $value
## [1] 2.069971e-27
## 
## $counts
## function gradient 
##       42       15 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
</div>
<div id="peaks" class="section level4" number="38.4.2.2">
<h4>
<span class="header-section-number">38.4.2.2</span> Peaks 函数<a class="anchor" aria-label="anchor" href="#peaks"><i class="fas fa-link"></i></a>
</h4>
<p>测试函数</p>
<p><span class="math display">\[
f(x,y) = 3*(1-x)*\mathrm{e}^{-x^2 - (y+1)^2} - 10*(\frac{x}{5} - x^3 - y^5)*\mathrm{e}^{-x^2-y^2} - \frac{1}{3}*\mathrm{e}^{-(x+1)^2-y^2}
\]</span></p>
<div class="sourceCode" id="cb2566"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">peaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fl">3</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="va">exp</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="op">(</span><span class="va">y</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">5</span> <span class="op">-</span> <span class="va">x</span><span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="va">y</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span><span class="op">*</span><span class="va">exp</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">-</span><span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">*</span><span class="va">exp</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">-</span><span class="va">y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2567"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">D</a></span><span class="op">(</span><span class="va">peaks</span>, <span class="st">"x"</span><span class="op">)</span></code></pre></div>
<pre><code>## -(3 * (1 - x) * (exp^(-x^2 - (y + 1)^2) * (log(exp) * (2 * x))) + 
##     3 * exp^(-x^2 - (y + 1)^2) + (10 * (1/5 - 3 * x^2) * exp^(-x^2 - 
##     y^2) - 10 * (x/5 - x^3 - y^5) * (exp^(-x^2 - y^2) * (log(exp) * 
##     (2 * x)))) - 1/3 * (exp^(-(x + 1)^2 - y^2) * (log(exp) * 
##     (2 * (x + 1)))))</code></pre>
<div class="sourceCode" id="cb2569"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">D</a></span><span class="op">(</span><span class="va">peaks</span>, <span class="st">"y"</span><span class="op">)</span></code></pre></div>
<pre><code>## -(3 * (1 - x) * (exp^(-x^2 - (y + 1)^2) * (log(exp) * (2 * (y + 
##     1)))) - (10 * (x/5 - x^3 - y^5) * (exp^(-x^2 - y^2) * (log(exp) * 
##     (2 * y))) + 10 * (5 * y^4) * exp^(-x^2 - y^2)) - 1/3 * (exp^(-(x + 
##     1)^2 - y^2) * (log(exp) * (2 * y))))</code></pre>
<div class="sourceCode" id="cb2571"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Deriv</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/Deriv/man/Simplify.html">Simplify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">D</a></span><span class="op">(</span><span class="va">peaks</span>, <span class="st">"x"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## -(10 * ((0.2 - 3 * x^2)/exp^(x^2 + y^2)) + 3/exp^((1 + y)^2 + 
##     x^2) + log(exp) * (x * (6 * ((1 - x)/exp^((1 + y)^2 + x^2)) - 
##     20 * ((x * (0.2 - x^2) - y^5)/exp^(x^2 + y^2))) - 0.666666666666667 * 
##     ((1 + x)/exp^((1 + x)^2 + y^2))))</code></pre>
<div class="sourceCode" id="cb2573"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/Deriv/man/Simplify.html">Simplify</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/deriv.html">D</a></span><span class="op">(</span><span class="va">peaks</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## -((6 * ((1 - x) * (1 + y)/exp^((1 + y)^2 + x^2)) - 0.666666666666667 * 
##     (y/exp^((1 + x)^2 + y^2))) * log(exp) - y * (20 * (log(exp) * 
##     (x * (0.2 - x^2) - y^5)/exp^(x^2 + y^2)) + 50 * (y^3/exp^(x^2 + 
##     y^2))))</code></pre>
<div class="sourceCode" id="cb2575"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span>
    <span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fl">5</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">5</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span>
    <span class="fl">1</span> <span class="op">/</span> <span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># 梯度函数</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">fn</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="fl">1</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">fn</span>, gr <span class="op">=</span> <span class="va">gr</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span></code></pre></div>
<pre><code>## $par
## [1] -1.3473958  0.2045192
## 
## $value
## [1] -3.049849
## 
## $counts
## function gradient 
##       28       10 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<p>在 <span class="math inline">\((-1.3473958, 0.2045192)\)</span> 处取得极小值</p>
<div class="sourceCode" id="cb2577"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://lattice.r-forge.r-project.org/">lattice</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="op">-</span><span class="fl">240</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:peaks"></span>
<img src="numerical-optimization_files/figure-html/peaks-1.png" alt="Peaks 多峰图像" width="528"><p class="caption">
图 38.5: Peaks 多峰图像
</p>
</div>
<p>函数来自 Octave 内置的 <code>peaks()</code> 函数，它有很多的局部极大值和极小值，可在 <a href="https://octave-online.net/">Octave Online</a> 上输入命令 <code>help peaks</code> 查看其帮助文档。</p>
</div>
<div id="rosenbrock" class="section level4" number="38.4.2.3">
<h4>
<span class="header-section-number">38.4.2.3</span> Rosenbrock 函数<a class="anchor" aria-label="anchor" href="#rosenbrock"><i class="fas fa-link"></i></a>
</h4>
<p><a href="https://en.wikipedia.org/wiki/Rosenbrock_function">香蕉函数</a> 定义如下：</p>
<p><span class="math display">\[f(x_1,x_2) = 100 (x_2 -x_1^2)^2 + (1 - x_1)^2\]</span></p>
<div class="sourceCode" id="cb2578"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="op">(</span><span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">2.5</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:rosenbrock"></span>
<img src="numerical-optimization_files/figure-html/rosenbrock-1.png" alt="香蕉函数图像" width="528"><p class="caption">
图 38.6: 香蕉函数图像
</p>
</div>
<div class="sourceCode" id="cb2579"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html">rasterFromXYZ</a></span><span class="op">(</span><span class="va">df</span>, crs <span class="op">=</span> <span class="fu"><a href="http://rgdal.r-forge.r-project.org/reference/CRS-class.html">CRS</a></span><span class="op">(</span><span class="st">"+proj=longlat +datum=WGS84"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">rasterVis</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/vectorplot.html">vectorplot</a></span><span class="op">(</span><span class="va">r</span>, par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/rasterTheme.html">RdBuTheme</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2580"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 梯度函数</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">fn</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> 
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span>par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="fl">1</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">fn</span>, gr <span class="op">=</span> <span class="va">gr</span>, method <span class="op">=</span> <span class="st">"BFGS"</span><span class="op">)</span></code></pre></div>
<pre><code>## $par
## [1] 1 1
## 
## $value
## [1] 9.595012e-18
## 
## $counts
## function gradient 
##      110       43 
## 
## $convergence
## [1] 0
## 
## $message
## NULL</code></pre>
<div class="sourceCode" id="cb2582"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span><span class="va">fn</span>, n <span class="op">=</span> <span class="fl">2L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="op">-</span><span class="fl">3</span>, ud <span class="op">=</span> <span class="fl">3</span>, nobj <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.lbfgs"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 1.364878e-17</code></pre>
<div class="sourceCode" id="cb2584"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 1 1</code></pre>
</div>
<div id="ackley" class="section level4" number="38.4.2.4">
<h4>
<span class="header-section-number">38.4.2.4</span> Ackley 函数<a class="anchor" aria-label="anchor" href="#ackley"><i class="fas fa-link"></i></a>
</h4>
<p>Ackley 函数是一个非凸函数，有大量局部极小值点，获取全局极小值点是一个比较有挑战的事。它的 <span class="math inline">\(n\)</span> 维形式如下：
<span class="math display">\[f(\mathbf{x}) = - a \mathrm{e}^{-b\sqrt{\frac{1}{n}\sum_{i=1}^{n}x_{i}^{2}}} - \mathrm{e}^{\frac{1}{n}\sum_{i=1}^{n}\cos(cx_i)} + a + \mathrm{e}\]</span>
其中，<span class="math inline">\(a = 20, b = 0.2, c = 2\pi\)</span>，对 <span class="math inline">\(\forall i = 1,2,\cdots, n\)</span>，<span class="math inline">\(x_i \in [-10, 10]\)</span>，<span class="math inline">\(f(\mathbf{x})\)</span> 在 <span class="math inline">\(\mathbf{x}^{\star} = (0,0,\cdot,0)\)</span> 取得全局最小值 <span class="math inline">\(f(\mathbf{x}^{\star}) = 0\)</span>，二维图像如图 <a href="chap-numerical-optimization.html#fig:ackley">38.7</a>。</p>
<div class="sourceCode" id="cb2586"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">a</span> <span class="op">=</span> <span class="fl">20</span>, <span class="va">b</span> <span class="op">=</span> <span class="fl">0.2</span>, <span class="va">c</span> <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">mean1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="va">mean2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">c</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="op">-</span><span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">b</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">mean1</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">mean2</span><span class="op">)</span> <span class="op">+</span> <span class="va">a</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ackley"></span>
<img src="numerical-optimization_files/figure-html/ackley-1.png" alt="二维 Ackley 函数图像" width="528"><p class="caption">
图 38.7: 二维 Ackley 函数图像
</p>
</div>
<!-- 
rgl 包、TikZ 的 pgfplots 也可以绘制类似的三维图形，加上自带的 persp 共计4-5种三维图形的绘制方法
-->
<p>以 10 维的 Ackley 函数为例，先试一下普通的局部优化算法 — Nelder–Mead 算法，选择初值 <span class="math inline">\((2,2,\cdots,2)\)</span> ，看下效果，再与全局优化算法比较。</p>
<div class="sourceCode" id="cb2587"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span><span class="va">fn</span>, n <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, ud <span class="op">=</span> <span class="fl">10</span>, nobj <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.neldermead"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>##  [1] 2 2 2 2 2 2 2 2 2 2</code></pre>
<div class="sourceCode" id="cb2589"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 6.593599</code></pre>
<p>可以说完全没有优化效果，已经陷入局部极小值。根据<a href="https://nlopt.readthedocs.io/en/latest/NLopt_Algorithms/#global-optimization">nloptr 全局优化算法</a>的介绍，这里采用 directL 算法，因为是全局优化，不用选择初值。</p>
<div class="sourceCode" id="cb2591"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 调全局优化器</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.directL"</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<div class="sourceCode" id="cb2593"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 4.440892e-16</code></pre>
<div class="sourceCode" id="cb2595"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 6.593599</code></pre>
<div class="sourceCode" id="cb2597"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 6.593599</code></pre>
</div>
<div id="radistrigin" class="section level4" number="38.4.2.5">
<h4>
<span class="header-section-number">38.4.2.5</span> Radistrigin 函数<a class="anchor" aria-label="anchor" href="#radistrigin"><i class="fas fa-link"></i></a>
</h4>
<p>这里，还有另外一个例子，Radistrigin 函数也是多摸函数</p>
<p><span class="math display">\[f(\mathbf{x})= \sum_{i=1}^{n}\big(x_i^2 - 10 \cos(2\pi x_i) + 10\big)\]</span></p>
<div class="sourceCode" id="cb2599"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">10</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, length.out <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">65</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:radistrigin"></span>
<img src="numerical-optimization_files/figure-html/radistrigin-1.png" alt="Radistrigin 函数" width="528"><p class="caption">
图 38.8: Radistrigin 函数
</p>
</div>
<p>设置 10 维 的优化</p>
<div class="sourceCode" id="cb2600"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span><span class="va">fn</span>, n <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="op">-</span><span class="fl">50</span>, ud <span class="op">=</span> <span class="fl">50</span>, nobj <span class="op">=</span> <span class="fl">10L</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>调全局优化器求解非凸优化问题</p>
<div class="sourceCode" id="cb2601"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.directL"</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>##  [1] 0 0 0 0 0 0 0 0 0 0</code></pre>
<div class="sourceCode" id="cb2603"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
</div>
<div id="schaffer" class="section level4" number="38.4.2.6">
<h4>
<span class="header-section-number">38.4.2.6</span> Schaffer 函数<a class="anchor" aria-label="anchor" href="#schaffer"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[
f(x_1,x_2) = 0.5 + \frac{\sin^2(x_1^2 - x_2^2) - 0.5}{ [1 + 0.001(x_1^2 + x_2^2)]^2}
\]</span>
在 <span class="math inline">\(\mathbf{x}^\star = (0,0)\)</span> 处取得全局最小值 <span class="math inline">\(f(\mathbf{x}^\star) = 0\)</span></p>
<div class="sourceCode" id="cb2605"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fl">0.5</span> <span class="op">+</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">0.001</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span>, length <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span>, length <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:schaffer-01"></span>
<img src="numerical-optimization_files/figure-html/schaffer-01-1.png" alt="Schaffer 函数" width="528"><p class="caption">
图 38.9: Schaffer 函数
</p>
</div>
<div class="sourceCode" id="cb2606"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:schaffer-02"></span>
<img src="numerical-optimization_files/figure-html/schaffer-02-1.png" alt="Schaffer 函数" width="528"><p class="caption">
图 38.10: Schaffer 函数
</p>
</div>
</div>
<div id="holder" class="section level4" number="38.4.2.7">
<h4>
<span class="header-section-number">38.4.2.7</span> Hölder 函数<a class="anchor" aria-label="anchor" href="#holder"><i class="fas fa-link"></i></a>
</h4>
<p>Hölder 桌面函数</p>
<p><span class="math display">\[
f(x_1,x_2) = - | \sin(x_1)\cos(x_2)\exp\big(| 1 - \frac{\sqrt{x_1^2 + x_2^2}}{\pi}|\big) |
\]</span></p>
<p>在 <span class="math inline">\((8.05502, 9.66459)\)</span>、<span class="math inline">\((-8.05502, 9.66459)\)</span>、<span class="math inline">\((8.05502, -9.66459)\)</span>、<span class="math inline">\((-8.05502, -9.66459)\)</span> 同时取得最小值 <span class="math inline">\(-19.2085\)</span>。</p>

<div class="sourceCode" id="cb2607"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">pi</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">60</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:holder"></span>
<img src="numerical-optimization_files/figure-html/holder-1.png" alt="Hölder 函数" width="528"><p class="caption">
图 38.11: Hölder 函数
</p>
</div>
</div>
<div id="trid" class="section level4" number="38.4.2.8">
<h4>
<span class="header-section-number">38.4.2.8</span> Trid 函数<a class="anchor" aria-label="anchor" href="#trid"><i class="fas fa-link"></i></a>
</h4>
<!-- 碗状函数 -->
<p><span class="math inline">\(n \geq 2\)</span> 维 Trid 函数</p>
<p><span class="math display">\[
f(x) = \sum_{i=1}^{n}(x_i - 1)^2 - \sum_{i=2}^{n}x_i x_{i-1}
\]</span>
<span class="math inline">\(\forall i = 1,2,\cdots, n\)</span>，<span class="math inline">\(f(x)\)</span> 在 <span class="math inline">\(x_i = i(n+1-i)\)</span> 处取得全局极小值 <span class="math inline">\(f(\mathbf{x}^\star)=-n(n+4)(n-1)/6\)</span>，取值区间 <span class="math inline">\(x \in [-n^2, n^2], \forall i = 1,2,\cdots,n\)</span></p>
<div class="sourceCode" id="cb2608"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span>, length <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="op">-</span><span class="fl">60</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:trid"></span>
<img src="numerical-optimization_files/figure-html/trid-1.png" alt="Trid 函数" width="528"><p class="caption">
图 38.12: Trid 函数
</p>
</div>
</div>
<div id="super-complex-function" class="section level4" number="38.4.2.9">
<h4>
<span class="header-section-number">38.4.2.9</span> 超级复杂函数<a class="anchor" aria-label="anchor" href="#super-complex-function"><i class="fas fa-link"></i></a>
</h4>
<p>有如下复杂的目标函数</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \quad \cos(x_1)\cos(x_2) - \sum_{i=1}^{5}\Big( (-1)^i \cdot i \cdot 2 \cdot \exp\big(-500 \cdot ( (x_1 - i \cdot 2)^2 + (x_2 - i\cdot 2)^2 ) \big) \Big) \\
    s.t. \quad -50 \leq x_1, x_2 \leq 50
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2609"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span>, <span class="va">m</span><span class="op">)</span> <span class="op">{</span>
  <span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="va">i</span> <span class="op">*</span> <span class="va">i</span> <span class="op">*</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">500</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">i</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">i</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="va">subfun</span>, i <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, MoreArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>m <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>目标函数的图像见图 <a href="chap-numerical-optimization.html#fig:super-function">38.13</a>，搜索区域 <span class="math inline">\([-50, 50] \times [-50, 50]\)</span> 内几乎没有变化的梯度，给寻优过程带来很大困难。</p>
<div class="sourceCode" id="cb2610"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span>, length.out <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, <span class="fl">50</span>, length.out <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">65</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:super-function"></span>
<img src="numerical-optimization_files/figure-html/super-function-1.png" alt="函数图像" width="528"><p class="caption">
图 38.13: 函数图像
</p>
</div>
<p>将区域 <span class="math inline">\([0, 12] \times [0, 12]\)</span> 的图像绘制出来，不难发现，有不少局部陷阱。</p>
<div class="sourceCode" id="cb2611"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>,
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12</span>, length.out <span class="op">=</span> <span class="fl">201</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">fn</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/plotmath.html">italic</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span> <span class="op">~</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_group_order.html">group</a></span><span class="op">(</span><span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">65</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:zoom-super-function"></span>
<img src="numerical-optimization_files/figure-html/zoom-super-function-1.png" alt="局部放大函数图像" width="528"><p class="caption">
图 38.14: 局部放大函数图像
</p>
</div>
<p>最优解在 <span class="math inline">\((7.999982, 7.999982)\)</span> 取得，目标函数值为 -7.978832。</p>
<div class="sourceCode" id="cb2612"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">7.999982</span>, <span class="fl">7.999982</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -7.978832</code></pre>
<p>面对如此复杂的函数，调用全局优化器</p>
<div class="sourceCode" id="cb2614"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span><span class="va">fn</span>, n <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="op">-</span><span class="fl">50</span>, ud <span class="op">=</span> <span class="fl">50</span>, nobj <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.directL"</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1]   0.00000 -21.99115</code></pre>
<div class="sourceCode" id="cb2616"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] -1</code></pre>
<p>实际上，还是陷入局部最优解。</p>
<pre><code>SETS:
P/1..5/;
Endsets
Min=@cos(x1) * @cos(x2) - @Sum(P(j): (-1)^j * j * 2 * @exp(-500 * ((x1 - j * 2)^2 + (x2 - j * 2)^2)));
@Bnd(-50, x1, 50);
@Bnd(-50, x2, 50);</code></pre>
<p>Lingo 18.0 启用全局优化求解器后，在 <span class="math inline">\((x_1 = 7.999982, x_2 = 7.999982)\)</span> 取得最小值 -7.978832。而默认未启用全局优化求解器的情况下，在 <span class="math inline">\((x_1 = 18.84956, x_2 = -40.84070)\)</span> 取得局部极小值 -1.000000。</p>
</div>
</div>
<div id="sec-nonlinear-constrained-optimization" class="section level3" number="38.4.3">
<h3>
<span class="header-section-number">38.4.3</span> 多元非线性约束优化<a class="anchor" aria-label="anchor" href="#sec-nonlinear-constrained-optimization"><i class="fas fa-link"></i></a>
</h3>
<p>R 自带的函数 <code><a href="https://rdrr.io/r/stats/nlminb.html">nlminb()</a></code> 可求解无约束、箱式约束优化问题，<code><a href="https://rdrr.io/r/stats/constrOptim.html">constrOptim()</a></code> 还可求解线性不等式约束优化，其中包括带线性约束的二次规划。<code><a href="https://rdrr.io/r/stats/optim.html">optim()</a></code> 提供一大类优化算法，且包含随机优化算法—模拟退火算法，可求解无约束、箱式约束优化问题。</p>
<div id="box-constrained-optimization" class="section level4" number="38.4.3.1">
<h4>
<span class="header-section-number">38.4.3.1</span> 普通箱式约束<a class="anchor" aria-label="anchor" href="#box-constrained-optimization"><i class="fas fa-link"></i></a>
</h4>
<p>有如下箱式约束优化问题，目标函数和<a href="https://en.wikipedia.org/wiki/Rosenbrock_function">香蕉函数</a>有些相似。</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \quad (x_1 - 1)^2 + 4\sum_{i =1}^{n -1}(x_{i+1} -x_i^2)^2  \\
    s.t. \quad 2 \leq x_1,x_2,\cdots,x_n \leq 4
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2619"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><span class="math inline">\(n\)</span> 维目标函数是非线性的，给定初值 <span class="math inline">\((3, 3, \cdots, 3)\)</span>，下面求解 25 维的箱式约束，</p>
<div class="sourceCode" id="cb2620"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/nlminb.html">nlminb</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">25</span><span class="op">)</span>, objective <span class="op">=</span> <span class="va">fn</span>, lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">25</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## $par
##  [1] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
##  [9] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
## [17] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.109093
## [25] 4.000000
## 
## $objective
## [1] 368.1059
## 
## $convergence
## [1] 0
## 
## $iterations
## [1] 6
## 
## $evaluations
## function gradient 
##       10      177 
## 
## $message
## [1] "relative convergence (4)"</code></pre>
<p><code><a href="https://rdrr.io/r/stats/nlminb.html">nlminb()</a></code> 出于历史兼容性的原因尚且存在，最优解的第24个分量没有在可行域的边界上。使用 <code><a href="https://rdrr.io/r/stats/constrOptim.html">constrOptim()</a></code> 函数求解，默认求极小，需将箱式或线性不等式约束写成矩阵形式，即 <span class="math inline">\(Ax \geq b\)</span> 的形式，参数 ui 是 <span class="math inline">\(k \times n\)</span> 的约束矩阵 <span class="math inline">\(A\)</span>，ci 是右侧 <span class="math inline">\(k\)</span> 维约束向量 <span class="math inline">\(b\)</span>。以上面的优化问题为例，将箱式约束 <span class="math inline">\(2 \leq x_1,x_2 \leq 4\)</span> 转化为矩阵形式，约束矩阵和向量分别为：</p>
<p><span class="math display">\[
A = \begin{bmatrix}
1  &amp; 0  \\
0  &amp; 1 \\
-1 &amp; 0 \\
0  &amp; -1
\end{bmatrix}, \quad
b = (2, 2, -4, -4)
\]</span></p>
<div class="sourceCode" id="cb2622"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/constrOptim.html">constrOptim</a></span><span class="op">(</span>
  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">25</span><span class="op">)</span>, <span class="co"># 初始值</span>
  f <span class="op">=</span> <span class="va">fn</span>, <span class="co"># 目标函数</span>
  method <span class="op">=</span> <span class="st">"Nelder-Mead"</span>, <span class="co"># 没有提供梯度，则必须用 Nelder-Mead 方法</span>
  ui <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## $par
##  [1] 2.006142 2.002260 2.003971 2.003967 2.004143 2.004255 2.001178 2.002990
##  [9] 2.003883 2.006029 2.017345 2.009236 2.000949 2.007793 2.025831 2.007896
## [17] 2.004514 2.004381 2.008771 2.015695 2.005803 2.009127 2.017988 2.257782
## [25] 3.999846
## 
## $value
## [1] 378.4208
## 
## $counts
## function gradient 
##    12048       NA 
## 
## $convergence
## [1] 1
## 
## $message
## NULL
## 
## $outer.iterations
## [1] 25
## 
## $barrier.value
## [1] -0.003278963</code></pre>
<p>从求解的结果来看，convergence = 1 意味着迭代次数到达默认的极限 maxit = 500，结合 <code><a href="https://rdrr.io/r/stats/nlminb.html">nlminb()</a></code> 函数的求解结果来看，实际上还没有收敛。如果没有提供梯度，则必须用 Nelder-Mead 方法，下面增加迭代次数到 1000。</p>
<div class="sourceCode" id="cb2624"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/constrOptim.html">constrOptim</a></span><span class="op">(</span>
  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">25</span><span class="op">)</span>, <span class="co"># 初始值</span>
  f <span class="op">=</span> <span class="va">fn</span>, <span class="co"># 目标函数</span>
  method <span class="op">=</span> <span class="st">"Nelder-Mead"</span>, 
  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,
  ui <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## $par
##  [1] 2.000081 2.000142 2.001919 2.000584 2.000007 2.000003 2.001097 2.001600
##  [9] 2.000207 2.000042 2.000250 2.000295 2.000580 2.002165 2.000453 2.000932
## [17] 2.000456 2.000363 2.000418 2.000474 2.009483 2.001156 2.003173 2.241046
## [25] 3.990754
## 
## $value
## [1] 370.8601
## 
## $counts
## function gradient 
##    18036       NA 
## 
## $convergence
## [1] 1
## 
## $message
## NULL
## 
## $outer.iterations
## [1] 19
## 
## $barrier.value
## [1] -0.003366467</code></pre>
<p>还是没有收敛，可见 Nelder-Mead 方法在这个优化问题上收敛速度比较慢。下面考虑调用基于梯度的优化算法 — BFGS 方法。</p>
<div class="sourceCode" id="cb2626"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 输入 n 维向量，输出 n 维向量</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">+</span><span class="fl">8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
  <span class="op">-</span><span class="fl">16</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="va">n</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/stats/constrOptim.html">constrOptim</a></span><span class="op">(</span>
  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">25</span><span class="op">)</span>, <span class="co"># 初始值</span>
  f <span class="op">=</span> <span class="va">fn</span>, <span class="co"># 目标函数</span>
  grad <span class="op">=</span> <span class="va">gr</span>,
  method <span class="op">=</span> <span class="st">"BFGS"</span>, 
  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxit <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span>,
  ui <span class="op">=</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
  ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## $par
##  [1] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
##  [9] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
## [17] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000001
## [25] 3.000000
## 
## $value
## [1] 373
## 
## $counts
## function gradient 
##     3721      464 
## 
## $convergence
## [1] 0
## 
## $message
## NULL
## 
## $outer.iterations
## [1] 3
## 
## $barrier.value
## [1] -0.003327104</code></pre>
<p>相比于 Nelder-Mead 方法，目标值 373 更大，可见已陷入局部最优解，下面通过 ROI 包，分别调用求解器 L-BFGS 和 directL，发现前者同样陷入局部最优解，而后者可以获得与 <code><a href="https://rdrr.io/r/stats/nlminb.html">nlminb()</a></code> 函数一致的结果。</p>
<div class="sourceCode" id="cb2628"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 调用改进的 BFGS 算法</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span><span class="va">fn</span>, n <span class="op">=</span> <span class="fl">25L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="fl">2</span>, ud <span class="op">=</span> <span class="fl">4</span>, nobj <span class="op">=</span> <span class="fl">25L</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.lbfgs"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">25</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 373</code></pre>
<div class="sourceCode" id="cb2630"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>##  [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3</code></pre>
<div class="sourceCode" id="cb2632"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 调全局优化算法</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.directL"</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 368.106</code></pre>
<div class="sourceCode" id="cb2634"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>##  [1] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
##  [9] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
## [17] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.109093
## [25] 4.000000</code></pre>
<p>下面再与函数 <code><a href="https://rdrr.io/r/stats/optim.html">optim()</a></code> 提供的 L-BFGS-B 算法比较</p>
<div class="sourceCode" id="cb2636"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span>
  par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">25</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">fn</span>, gr <span class="op">=</span> <span class="cn">NULL</span>, method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,
  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">25</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">25</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## $par
##  [1] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
##  [9] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000
## [17] 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.000000 2.109093
## [25] 4.000000
## 
## $value
## [1] 368.1059
## 
## $counts
## function gradient 
##        6        6 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: REL_REDUCTION_OF_F &lt;= FACTR*EPSMCH"</code></pre>
<p>值得注意的是，当提供梯度信息的时候，虽然求解速度提升了，但是最优解变差了。</p>
<div class="sourceCode" id="cb2638"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/optim.html">optim</a></span><span class="op">(</span>
  par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">25</span><span class="op">)</span>, fn <span class="op">=</span> <span class="va">fn</span>, gr <span class="op">=</span> <span class="va">gr</span>, method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,
  lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">25</span><span class="op">)</span>, upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">25</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## $par
##  [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3
## 
## $value
## [1] 373
## 
## $counts
## function gradient 
##        2        2 
## 
## $convergence
## [1] 0
## 
## $message
## [1] "CONVERGENCE: NORM OF PROJECTED GRADIENT &lt;= PGTOL"</code></pre>
</div>
<div id="nonlinear-strictly-inequality-constraints" class="section level4" number="38.4.3.2">
<h4>
<span class="header-section-number">38.4.3.2</span> 非线性严格不等式约束<a class="anchor" aria-label="anchor" href="#nonlinear-strictly-inequality-constraints"><i class="fas fa-link"></i></a>
</h4>
<p>第一个例子，目标函数是非线性的，约束条件也是非线性的，非线性不等式约束不包含等号。</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \quad (x_1 + 3x_2 + x_3)^2 + 4(x_1 - x_2)^2 \\
    s.t.\left\{ 
    \begin{array}{l}
     x_1 + x_2 + x_3 = 1 \\
     6 x_2 + 4 x_3 - x_1^3 &gt; 3 \\
     x_1, x_2, x_3 &gt; 0
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2640"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标函数</span>
<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="co"># 目标函数的梯度</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">8</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="co"># 对 x[1] 求偏导</span>
    <span class="fl">6</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">8</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="co"># 对 x[2] 求偏导</span>
    <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="co"># 对 x[3] 求偏导</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="co"># 等式约束</span>
<span class="va">heq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span> 
<span class="op">}</span>
<span class="co"># 等式约束的雅可比矩阵</span>
<span class="co"># 这里只有一个等式约束，所以雅可比矩阵行数为 1</span>
<span class="va">heq.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># 不等式约束</span>
<span class="co"># 要求必须是严格不等式，不能带等号，方向是 x &gt; 0 </span>
<span class="va">hin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">6</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">-</span> <span class="fl">3</span>, <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># 不等式约束的雅可比矩阵</span>
<span class="co"># 其实是有 4 个不等式约束，3 个目标变量约束，雅可比矩阵行数是 4</span>
<span class="va">hin.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">4</span>,
    <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>,
    <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>,
    <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>
  <span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>调用 <strong>alabama</strong> 包的求解器</p>
<div class="sourceCode" id="cb2641"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>
<span class="co"># 初始值</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="co"># 求目标函数的极小值</span>
<span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">alabama</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/alabama/man/constrOptim.nl.html">constrOptim.nl</a></span><span class="op">(</span>
  par <span class="op">=</span> <span class="va">p0</span>,
  <span class="co"># 目标函数</span>
  fn <span class="op">=</span> <span class="va">fn</span>,
  gr <span class="op">=</span> <span class="va">gr</span>,
  <span class="co"># 等式约束</span>
  heq <span class="op">=</span> <span class="va">heq</span>,
  heq.jac <span class="op">=</span> <span class="va">heq.jac</span>,
  <span class="co"># 不等式约束</span>
  hin <span class="op">=</span> <span class="va">hin</span>,
  hin.jac <span class="op">=</span> <span class="va">hin.jac</span>,
  <span class="co"># 不显示迭代过程</span>
  control.outer <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">ans</span></code></pre></div>
<pre><code>## $par
## [1] 7.390292e-04 4.497160e-12 9.992610e-01
## 
## $value
## [1] 1.000002
## 
## $counts
## function gradient 
##     1230      163 
## 
## $convergence
## [1] 0
## 
## $message
## NULL
## 
## $hessian
##           [,1]      [,2]      [,3]
## [1,] 120517098 120517087 120517091
## [2,] 120517087 120517115 120517095
## [3,] 120517091 120517095 120517091
## 
## $outer.iterations
## [1] 13
## 
## $lambda
## [1] 4.481599
## 
## $sigma
## [1] 120517089
## 
## $barrier.value
## [1] 0.003472071
## 
## $K
## [1] 4.269112e-08</code></pre>
<p>ans 是 <code>constrOptim.nl()</code> 返回的一个 list， convergence = 0 表示迭代成功收敛，value 表示目标函数在迭代终止时的取直，par 表示满足约束条件，成功收敛的情况下，目标函数的参数值，counts 表示迭代过程中目标函数及其梯度计算的次数。</p>
<div class="sourceCode" id="cb2643"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 不提供梯度函数，照样可以求解</span>
<span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu">alabama</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/alabama/man/constrOptim.nl.html">constrOptim.nl</a></span><span class="op">(</span>par <span class="op">=</span> <span class="va">p0</span>, fn <span class="op">=</span> <span class="va">fn</span>, heq <span class="op">=</span> <span class="va">heq</span>, hin <span class="op">=</span> <span class="va">hin</span><span class="op">)</span></code></pre></div>
<div class="rmdtip">
<p>等式和不等式约束的雅可比矩阵必须以 matrix 数据类型存储，而不能以 vector 类型存储。要注意和后面 ROI 包的调用形式区别。</p>
</div>
<p>实际上，可以用 ROI 调用 alabama 求解器的方式，这种方式可以简化目标函数梯度和约束条件的表示</p>
<div class="sourceCode" id="cb2644"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标函数</span>
<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="co"># 目标函数的梯度</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">8</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
    <span class="fl">6</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">8</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
    <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="va">heq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="op">}</span>
<span class="va">heq.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">hin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fl">6</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span>
<span class="op">}</span>
<span class="va">hin.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
   <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>通过 ROI 调用 alabama 求解器</p>
<div class="sourceCode" id="cb2645"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2020</span><span class="op">)</span>
<span class="co"># 初始值</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span>
<span class="co"># 定义目标规划</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span>F <span class="op">=</span> <span class="va">fn</span>, n <span class="op">=</span> <span class="fl">3L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>, <span class="co"># 4 个目标变量</span>
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_constraint.html">F_constraint</a></span><span class="op">(</span>
    F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq <span class="op">=</span> <span class="va">heq</span>, hin <span class="op">=</span> <span class="va">hin</span><span class="op">)</span>,
    dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"=="</span>, <span class="st">"&gt;"</span><span class="op">)</span>,
    rhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,
    <span class="co"># 等式和不等式约束的雅可比</span>
    J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq.jac <span class="op">=</span> <span class="va">heq.jac</span>, hin.jac <span class="op">=</span> <span class="va">hin.jac</span><span class="op">)</span>
  <span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="fl">0</span>, ud <span class="op">=</span> <span class="op">+</span><span class="cn">Inf</span>, nobj <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># 求最小</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"alabama"</span>, start <span class="op">=</span> <span class="va">p0</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 1.674812e-06 9.994336e-08 9.999982e-01</code></pre>
<div class="sourceCode" id="cb2647"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="nonlinear-and-box-constrained" class="section level4" number="38.4.3.3">
<h4>
<span class="header-section-number">38.4.3.3</span> 非线性和箱式约束<a class="anchor" aria-label="anchor" href="#nonlinear-and-box-constrained"><i class="fas fa-link"></i></a>
</h4>
<p>与上面的例子不同，下面这个例子的不等式约束包含等号，还有箱式约束，优化问题来源于<a href="https://coin-or.github.io/Ipopt/INTERFACES.html">Ipopt 官网</a>，提供的初始值为 <span class="math inline">\(x_0 = (1,5,5,1)\)</span>，最优解为 <span class="math inline">\(x_{\star} = (1.00000000,4.74299963,3.82114998,1.37940829)\)</span>。优化问题的具体内容如下：</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \quad x_1 x_4 (x_1 + x_2 + x_3) + x_3 \\
    s.t.\left\{ 
    \begin{array}{l}
     x_1^2 + x_2^2 + x_3^2 + x_4^2 = 40 \\
     x_1 x_2 x_3 x_4 \geq 25 \\
     1 \leq x_1, x_2, x_3, x_4 \leq 5
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<p>考虑用 ROI 调 nloptr 实现，看结果是否和例子一致，nloptr 支持不等式约束包含等号，支持箱式约束。</p>
<div class="sourceCode" id="cb2649"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 一个 4 维的目标函数</span>
<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="op">}</span>
<span class="co"># 目标函数的梯度</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,
    <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="co"># 等式约束</span>
<span class="va">heq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># 等式约束的雅可比</span>
<span class="va">heq.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># 不等式约束</span>
<span class="va">hin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># 不等式约束的雅可比</span>
<span class="va">hin.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># 定义目标规划</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span>F <span class="op">=</span> <span class="va">fn</span>, n <span class="op">=</span> <span class="fl">4L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>, <span class="co"># 4 个目标变量</span>
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_constraint.html">F_constraint</a></span><span class="op">(</span>
    F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq <span class="op">=</span> <span class="va">heq</span>, hin <span class="op">=</span> <span class="va">hin</span><span class="op">)</span>,
    dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"=="</span>, <span class="st">"&gt;="</span><span class="op">)</span>,
    rhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">25</span><span class="op">)</span>,
    <span class="co"># 等式和不等式约束的雅可比</span>
    J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq.jac <span class="op">=</span> <span class="va">heq.jac</span>, hin.jac <span class="op">=</span> <span class="va">hin.jac</span><span class="op">)</span>
  <span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="fl">1</span>, ud <span class="op">=</span> <span class="fl">5</span>, nobj <span class="op">=</span> <span class="fl">4L</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># 求最小</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2650"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标函数初始值</span>
<span class="fu">fn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 16</code></pre>
<div class="sourceCode" id="cb2652"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标函数最优值</span>
<span class="fu">fn</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1.00000000</span>, <span class="fl">4.74299963</span>, <span class="fl">3.82114998</span>, <span class="fl">1.37940829</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 17.01402</code></pre>
<p>求解一般的非线性约束问题，求解器 nloptr.mma / nloptr.cobyla 仅支持非线性不等式约束，不支持等式约束，而 nlminb 只支持等式约束，因此，下面分别调用 nloptr.auglag、nloptr.slsqp 和 nloptr.isres 来求解上述优化问题。</p>
<div class="sourceCode" id="cb2654"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.auglag"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 1.000000 4.743025 3.821117 1.379413</code></pre>
<div class="sourceCode" id="cb2656"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 17.01402</code></pre>
<div class="sourceCode" id="cb2658"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.slsqp"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 1.000000 4.742996 3.821155 1.379408</code></pre>
<div class="sourceCode" id="cb2660"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 17.01402</code></pre>
<div class="sourceCode" id="cb2662"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.isres"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 1.363399 4.661930 3.898435 1.100249</code></pre>
<div class="sourceCode" id="cb2664"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 18.78486</code></pre>
<p>可以看出，nloptr 提供的优化能力可以覆盖<a href="https://github.com/coin-or/Ipopt">Ipopt 求解器</a>，推荐使用 nloptr.slsqp 求解器。</p>
</div>
<div id="nonlinear-mixed-integer-constrained" class="section level4" number="38.4.3.4">
<h4>
<span class="header-section-number">38.4.3.4</span> 非线性混合整数约束<a class="anchor" aria-label="anchor" href="#nonlinear-mixed-integer-constrained"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \max_x \quad 1.5(x_1 - \sin(x_1 - x_2))^2 + 0.5x_2^2 + x_3^2 - x_1 x_2 - 2x_1 + x_2 x_3 \\
    s.t.\left\{ 
    \begin{array}{l}
     -20 &lt; x_1 &lt; 20 \\
     -20 &lt; x_2 &lt; 20 \\
     -10 &lt; x_3 &lt; 10 \\
     x_1, x_2 \in \mathbb{R}, \quad x_3 \in \mathbb{Z}
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2666"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fl">1.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>
  <span class="op">-</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>
<span class="op">}</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">2</span>,
    <span class="fl">3</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,
    <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>目前 ROI 还解不了</p>
<div class="sourceCode" id="cb2667"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 初始值</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2.1</span>, <span class="fl">5.1</span>, <span class="fl">5</span><span class="op">)</span>
<span class="co"># 定义目标规划</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span>F <span class="op">=</span> <span class="va">fn</span>, n <span class="op">=</span> <span class="fl">3L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>, <span class="co"># 3 个目标变量</span>
  types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"C"</span>, <span class="st">"I"</span><span class="op">)</span>, <span class="co"># 目标变量的类型</span>
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>lb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="op">-</span><span class="fl">20</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span>, ub <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">10</span><span class="op">)</span>, nobj <span class="op">=</span> <span class="fl">3L</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># 求最小</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"auto"</span>, start <span class="op">=</span> <span class="va">p0</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<p>目标函数在 <span class="math inline">\((4.49712, 9.147501, -4)\)</span> 取得最小值 -86.72165</p>
<div class="sourceCode" id="cb2668"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">4.49712</span>, <span class="fl">9.147501</span>, <span class="op">-</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -86.72165</code></pre>
</div>
<div id="complex-object-function" class="section level4" number="38.4.3.5">
<h4>
<span class="header-section-number">38.4.3.5</span> 含复杂目标函数<a class="anchor" aria-label="anchor" href="#complex-object-function"><i class="fas fa-link"></i></a>
</h4>
<p>下面这个目标函数比较复杂，约束条件也是非线性的</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \max_x \quad \frac{(\sin(2\pi x_1))^3 \sin(2\pi x_2)}{x_1^3 (x_1 + x_2)} \\
    s.t.\left\{ 
    \begin{array}{l}
     x_1^2 - x_2 + 1 \leq 0 \\
     1 - x_1 + (x_2 - 4)^2 \geq 0 \\
     0 \leq x_1, x_2 \leq 10
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2670"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 目标函数</span>
<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="co"># 目标函数的梯度</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">fn</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">hin</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span>,
    <span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">4</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="va">hin.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="op">-</span><span class="fl">1</span>,
    <span class="op">-</span><span class="fl">1</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
  <span class="op">)</span>,
  ncol <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="co"># 初始值</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>
<span class="co"># 定义目标规划</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span>F <span class="op">=</span> <span class="va">fn</span>, n <span class="op">=</span> <span class="fl">2L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>, <span class="co"># 2 个目标变量</span>
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_constraint.html">F_constraint</a></span><span class="op">(</span>
    F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>hin <span class="op">=</span> <span class="va">hin</span><span class="op">)</span>,
    dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"&lt;="</span>, <span class="st">"&lt;="</span><span class="op">)</span>,
    rhs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
    <span class="co"># 不等式约束的雅可比</span>
    J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>hin.jac <span class="op">=</span> <span class="va">hin.jac</span><span class="op">)</span>
  <span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="fl">0</span>, ud <span class="op">=</span> <span class="fl">10</span>, nobj <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># 求最大</span>
<span class="op">)</span>
<span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.isres"</span>, start <span class="op">=</span> <span class="va">p0</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 1.227972 4.245367</code></pre>
<div class="sourceCode" id="cb2672"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] 0.09582504</code></pre>
<p>下面再给一个来自 <a href="https://octave.org/doc/v6.2.0/Nonlinear-Programming.html">Octave 优化文档</a> 的示例，该优化问题包含多个非线性的等式约束。</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \quad \mathrm{e}^{\prod_{i=1}^{5} x_i} - \frac{1}{2}(x_1^3 + x_2^3 + 1)^2 \\
    s.t.\left\{ 
    \begin{array}{l}
     \sum_{i=1}^{5}x_i^2 - 10 = 0 \\
     x_2 x_3 - 5x_4 x_5 = 0 \\
     x_1^3 + x_2^3 + 1 = 0
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2674"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 一个 5 维的目标函数</span>
<span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="op">}</span>
<span class="co"># 目标函数的梯度</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html">prod</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="co"># 等式约束</span>
<span class="va">heq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span>,
    <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">-</span> <span class="fl">5</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,
    <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">3</span> <span class="op">+</span> <span class="fl">1</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="co"># 等式约束的雅可比</span>
<span class="va">heq.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>,
    <span class="fl">0</span>, <span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="op">-</span><span class="fl">5</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span>, <span class="op">-</span><span class="fl">5</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,
    <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">3</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,
    ncol <span class="op">=</span> <span class="fl">5</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb2675"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 定义目标规划</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span>F <span class="op">=</span> <span class="va">fn</span>, n <span class="op">=</span> <span class="fl">5L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>, <span class="co"># 5 个目标变量</span>
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_constraint.html">F_constraint</a></span><span class="op">(</span>
    F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq <span class="op">=</span> <span class="va">heq</span><span class="op">)</span>,
    dir <span class="op">=</span> <span class="st">"=="</span>,
    rhs <span class="op">=</span> <span class="fl">0</span>,
    <span class="co"># 等式的雅可比</span>
    J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq.jac <span class="op">=</span> <span class="va">heq.jac</span><span class="op">)</span>
  <span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ud <span class="op">=</span> <span class="cn">Inf</span>, nobj <span class="op">=</span> <span class="fl">5L</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># 求最小</span>
<span class="op">)</span></code></pre></div>
<p>调用 SQP（序列二次规划） 求解器</p>
<div class="sourceCode" id="cb2676"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.slsqp"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.8</span>, <span class="fl">1.7</span>, <span class="fl">1.9</span>, <span class="op">-</span><span class="fl">0.8</span>,<span class="op">-</span><span class="fl">0.8</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] -1.7171435  1.5957096  1.8272458 -0.7636431 -0.7636431</code></pre>
<p>计算结果和 Octave 的示例一致。</p>
</div>
<div id="complex-constrained-function" class="section level4" number="38.4.3.6">
<h4>
<span class="header-section-number">38.4.3.6</span> 含复杂约束条件<a class="anchor" aria-label="anchor" href="#complex-constrained-function"><i class="fas fa-link"></i></a>
</h4>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \quad \exp(\sin(50\cdot x)) + \sin(60\cdot \exp(y)) + \sin(70\cdot\sin(x)) \\
         \qquad + \sin(\sin(80\cdot y)) - \sin(10\cdot (x +y)) + \frac{(x^2 + y^2)^{\sin(y)}}{4} \\
    s.t. \quad \left\{ 
    \begin{array}{l}
     x - \big((\cos(y))^x - x\big)^y = 0 \\
    -50 \leq x_1,x_2 \leq 50
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<p>Lingo 代码如下：</p>
<pre><code>Min = @exp(@sin(50 * x)) + @sin(60 * @exp(y)) + @sin(70 * @sin(x)) 
      + @sin(@sin(80 * y)) - @sin(10 * (x + y)) + (x^2 + y^2)^@sin(y) / 4;

x - (( @cos(y) )^x - x)^y = 0;

@bnd(-50, x, 50);
@bnd(-50, y, 50);</code></pre>
<p>启用全局优化求解器，求解 14 分钟，在 <span class="math inline">\((0.08256372, 24.56510)\)</span> 取得极小值 -2.863497。不启用全局优化器就没法解，Lingo 会报错，找不到最优解，勉强找到一个可行解 <span class="math inline">\((0.06082750, 44.12793)\)</span>，目标值为 -1.29816。</p>
<div class="sourceCode" id="cb2679"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">50</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">60</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">70</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">80</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span>
    <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span>
<span class="op">}</span>
<span class="va">gr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">fn</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">heq</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="op">(</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">)</span><span class="op">^</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>
<span class="op">}</span>
<span class="va">heq.jac</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
  <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/grad.html">grad</a></span><span class="op">(</span><span class="va">heq</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.06082750</span>, <span class="fl">44.12793</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -1.29816</code></pre>
<div class="sourceCode" id="cb2681"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1.966877</code></pre>
<div class="sourceCode" id="cb2683"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">heq</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.06082750</span>, <span class="fl">44.12793</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 1.923673e-08</code></pre>
<div class="sourceCode" id="cb2685"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">heq</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb2687"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 定义目标规划</span>
<span class="va">op</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/OP.html">OP</a></span><span class="op">(</span>
  objective <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_objective.html">F_objective</a></span><span class="op">(</span>F <span class="op">=</span> <span class="va">fn</span>, n <span class="op">=</span> <span class="fl">2L</span>, G <span class="op">=</span> <span class="va">gr</span><span class="op">)</span>, <span class="co"># 2 个目标变量</span>
  constraints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/F_constraint.html">F_constraint</a></span><span class="op">(</span>
    F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq <span class="op">=</span> <span class="va">heq</span><span class="op">)</span>,
    dir <span class="op">=</span> <span class="st">"=="</span>,
    rhs <span class="op">=</span> <span class="fl">0</span>,
    J <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>heq.jac <span class="op">=</span> <span class="va">heq.jac</span><span class="op">)</span>
  <span class="op">)</span>,
  bounds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/V_bound.html">V_bound</a></span><span class="op">(</span>ld <span class="op">=</span> <span class="op">-</span><span class="fl">50</span>, ud <span class="op">=</span> <span class="fl">50</span>, nobj <span class="op">=</span> <span class="fl">2L</span><span class="op">)</span>,
  maximum <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># 求最小</span>
<span class="op">)</span></code></pre></div>
<p>nloptr.auglag 无法求解此优化问题</p>
<div class="sourceCode" id="cb2688"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.auglag"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<p>调 nloptr.isres 求解器，每次执行都会得到不同的局部最优解</p>
<div class="sourceCode" id="cb2689"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ROI/man/ROI_solve.html">ROI_solve</a></span><span class="op">(</span><span class="va">op</span>, solver <span class="op">=</span> <span class="st">"nloptr.isres"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>
<span class="va">nlp</span><span class="op">$</span><span class="va">solution</span></code></pre></div>
<pre><code>## [1] 22.59200 42.32116</code></pre>
<div class="sourceCode" id="cb2691"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nlp</span><span class="op">$</span><span class="va">objval</span></code></pre></div>
<pre><code>## [1] -3.126909</code></pre>
<p>比如下面三组</p>
<div class="sourceCode" id="cb2693"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">40.95941</span>, <span class="fl">41.52914</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -1.025926</code></pre>
<div class="sourceCode" id="cb2695"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">heq</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">40.95941</span>, <span class="fl">41.52914</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NaN</code></pre>
<div class="sourceCode" id="cb2697"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">21.88091</span>, <span class="fl">28.96994</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -1.467513</code></pre>
<div class="sourceCode" id="cb2699"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">heq</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">21.88091</span>, <span class="fl">28.96994</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] NaN</code></pre>
<div class="sourceCode" id="cb2701"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fn</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">49.921967437</span>, <span class="fl">4.8499336803</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -3.466596</code></pre>
<div class="sourceCode" id="cb2703"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">heq</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">49.921967437</span>, <span class="fl">4.8499336803</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -8.515447e+208</code></pre>
</div>
</div>
</div>
<div id="sec-nonlinear-equations" class="section level2" number="38.5">
<h2>
<span class="header-section-number">38.5</span> 非线性方程<a class="anchor" aria-label="anchor" href="#sec-nonlinear-equations"><i class="fas fa-link"></i></a>
</h2>
<div id="subsec-equation" class="section level3" number="38.5.1">
<h3>
<span class="header-section-number">38.5.1</span> 一元非线性方程<a class="anchor" aria-label="anchor" href="#subsec-equation"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://blog.hamaluik.ca/posts/solving-equations-using-the-newton-raphson-method/">牛顿-拉弗森方法</a></p>
<div class="sourceCode" id="cb2705"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rootSolve</span><span class="op">)</span></code></pre></div>
</div>
<div id="subsec-equations" class="section level3" number="38.5.2">
<h3>
<span class="header-section-number">38.5.2</span> 非线性方程组<a class="anchor" aria-label="anchor" href="#subsec-equations"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2706"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.jhsph.edu/agingandhealth/People/Faculty_personal_pages/Varadhan.html">BB</a></span><span class="op">)</span></code></pre></div>
<p>二项混合泊松分布的参数最大似然估计</p>
<div class="sourceCode" id="cb2707"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">poissmix.loglik</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Log-likelihood for a binary Poisson mixture distribution</span>
  <span class="va">i</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/dimensions.html">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span>
  
  <span class="va">loglik</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/math.html">log</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">^</span><span class="va">i</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">p</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">p</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">^</span><span class="va">i</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Special.html">lgamma</a></span><span class="op">(</span><span class="va">i</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">loglik</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># Data from Hasselblad (JASA 1969)</span>
<span class="co"># 介绍实际应用场景</span>
<span class="va">poissmix.dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>death <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">9</span>, 
                           freq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">162</span>, <span class="fl">267</span>, <span class="fl">271</span>, <span class="fl">185</span>, <span class="fl">111</span>, <span class="fl">61</span>, <span class="fl">27</span>, <span class="fl">8</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">lo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span> <span class="co"># lower limits for parameters</span>
<span class="va">hi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">Inf</span>, <span class="cn">Inf</span><span class="op">)</span> <span class="co"># upper limits for parameters</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span> 
<span class="co"># a randomly generated vector of length 3</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">162</span>, <span class="fl">267</span>, <span class="fl">271</span>, <span class="fl">185</span>, <span class="fl">111</span>, <span class="fl">61</span>, <span class="fl">27</span>, <span class="fl">8</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span>

<span class="va">ans1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BB/man/spg.html">spg</a></span><span class="op">(</span>
  par <span class="op">=</span> <span class="va">p0</span>, fn <span class="op">=</span> <span class="va">poissmix.loglik</span>, y <span class="op">=</span> <span class="va">y</span>, lower <span class="op">=</span> <span class="va">lo</span>, upper <span class="op">=</span> <span class="va">hi</span>,
  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maximize <span class="op">=</span> <span class="cn">TRUE</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">ans2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BB/man/BBoptim.html">BBoptim</a></span><span class="op">(</span>
  par <span class="op">=</span> <span class="va">p0</span>, fn <span class="op">=</span> <span class="va">poissmix.loglik</span>, y <span class="op">=</span> <span class="va">y</span>,
  lower <span class="op">=</span> <span class="va">lo</span>, upper <span class="op">=</span> <span class="va">hi</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maximize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## iter:  0  f-value:  -2136.431  pgrad:  236.9752 
## iter:  10  f-value:  -1995.89  pgrad:  2.961353 
## iter:  20  f-value:  -2041.139  pgrad:  2.57697 
## iter:  30  f-value:  -1989.974  pgrad:  0.4742151 
## iter:  40  f-value:  -1989.949  pgrad:  0.2614752 
## iter:  50  f-value:  -1989.946  pgrad:  0.01959506 
## iter:  60  f-value:  -1989.946  pgrad:  0.002494289 
##   Successful convergence.</code></pre>
<div class="sourceCode" id="cb2709"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ans2</span></code></pre></div>
<pre><code>## $par
## [1] 0.3598829 1.2560906 2.6634011
## 
## $value
## [1] -1989.946
## 
## $gradient
## [1] 0.0001000444
## 
## $fn.reduction
## [1] -146.4848
## 
## $iter
## [1] 68
## 
## $feval
## [1] 170
## 
## $convergence
## [1] 0
## 
## $message
## [1] "Successful convergence"
## 
## $cpar
## method      M 
##      2     50</code></pre>
<p>计算最大似然处的黑塞矩阵以及参数的标准差</p>
<div class="sourceCode" id="cb2711"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hess</span> <span class="op">&lt;-</span> <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/numDeriv/man/hessian.html">hessian</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ans2</span><span class="op">$</span><span class="va">par</span>, func <span class="op">=</span> <span class="va">poissmix.loglik</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>
<span class="co"># Note that we have to supplied data vector 'y'</span>
<span class="va">hess</span></code></pre></div>
<pre><code>##           [,1]      [,2]      [,3]
## [1,] -907.1105  270.2287  341.2543
## [2,]  270.2287 -113.4794  -61.6819
## [3,]  341.2543  -61.6819 -192.7822</code></pre>
<div class="sourceCode" id="cb2713"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">se</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="op">-</span><span class="va">hess</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">se</span></code></pre></div>
<pre><code>## [1] 0.1946836 0.3500308 0.2504769</code></pre>
<p>从不同初始值出发尝试寻找全局最大值，实际找的是一系列局部最大值</p>
<div class="sourceCode" id="cb2715"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 3 randomly generated starting values</span>
<span class="va">p0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">3</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">ans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BB/man/multiStart.html">multiStart</a></span><span class="op">(</span>
  par <span class="op">=</span> <span class="va">p0</span>, fn <span class="op">=</span> <span class="va">poissmix.loglik</span>, action <span class="op">=</span> <span class="st">"optimize"</span>,
  y <span class="op">=</span> <span class="va">y</span>, lower <span class="op">=</span> <span class="va">lo</span>, upper <span class="op">=</span> <span class="va">hi</span>, control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maximize <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## Parameter set :  1 ... 
## iter:  0  f-value:  -2076.377  pgrad:  266.5811 
## iter:  10  f-value:  -1991.788  pgrad:  3.394882 
## iter:  20  f-value:  -1990.932  pgrad:  8.266675 
## iter:  30  f-value:  -1989.958  pgrad:  0.2441652 
## iter:  40  f-value:  -1989.946  pgrad:  0.001411991 
##   Successful convergence.
## Parameter set :  2 ... 
## iter:  0  f-value:  -3999.343  pgrad:  6.350898 
## iter:  10  f-value:  -2015.457  pgrad:  2.400803 
##   Successful convergence.
## Parameter set :  3 ... 
## iter:  0  f-value:  -2526.385  pgrad:  3.959104 
## iter:  10  f-value:  -1997.785  pgrad:  4.651176 
## iter:  20  f-value:  -2041.124  pgrad:  130.6335 
## iter:  30  f-value:  -1989.979  pgrad:  0.4133676 
## iter:  40  f-value:  -1989.953  pgrad:  0.2001525 
## iter:  50  f-value:  -1989.946  pgrad:  0.02953584 
##   Successful convergence.
## Parameter set :  4 ... 
## iter:  0  f-value:  -4036.966  pgrad:  7.725057 
## iter:  10  f-value:  -1993.146  pgrad:  3.356279 
## iter:  20  f-value:  -1992.445  pgrad:  3.162911 
## iter:  30  f-value:  -1999.964  pgrad:  3.124857 
## iter:  40  f-value:  -1990.201  pgrad:  0.9762675 
## iter:  50  f-value:  -1989.962  pgrad:  0.3950169 
## iter:  60  f-value:  -1989.946  pgrad:  0.0507498 
## iter:  70  f-value:  -1989.946  pgrad:  0.0001978151 
##   Successful convergence.
## Parameter set :  5 ... 
## iter:  0  f-value:  -2048.809  pgrad:  2.862445 
## iter:  10  f-value:  -1992.344  pgrad:  2.68979 
## iter:  20  f-value:  -1990.604  pgrad:  7.2791 
## iter:  30  f-value:  -1989.978  pgrad:  0.3772993 
## iter:  40  f-value:  -1989.946  pgrad:  0.004172307 
## iter:  50  f-value:  -1989.946  pgrad:  0.004260983 
##   Successful convergence.
## Parameter set :  6 ... 
## iter:  0  f-value:  -4777.283  pgrad:  7.596832 
## iter:  10  f-value:  -1991.838  pgrad:  11.02078 
## iter:  20  f-value:  -1990.272  pgrad:  0.5307333 
## iter:  30  f-value:  -1989.963  pgrad:  2.230793 
## iter:  40  f-value:  -1989.946  pgrad:  0.008421921 
## iter:  50  f-value:  -1989.946  pgrad:  0.0001841727 
##   Successful convergence.
## Parameter set :  7 ... 
## iter:  0  f-value:  -2019.928  pgrad:  3.485709 
## iter:  10  f-value:  -1990.626  pgrad:  1.833378 
## iter:  20  f-value:  -1989.999  pgrad:  1.098717 
## iter:  30  f-value:  -1989.947  pgrad:  0.3092782 
## iter:  40  f-value:  -1989.946  pgrad:  0.007039489 
##   Successful convergence.
## Parameter set :  8 ... 
## iter:  0  f-value:  -2764.625  pgrad:  4.891128 
## iter:  10  f-value:  -2001.398  pgrad:  2.273737e-06 
##   Successful convergence.
## Parameter set :  9 ... 
## iter:  0  f-value:  -2167.165  pgrad:  195.5499 
## iter:  10  f-value:  -2001.54  pgrad:  2.194864 
## iter:  20  f-value:  -2000.825  pgrad:  0.6559458 
## iter:  30  f-value:  -1992.777  pgrad:  7.064828 
## iter:  40  f-value:  -1991.747  pgrad:  3.357115 
## iter:  50  f-value:  -1989.983  pgrad:  2.772795 
## iter:  60  f-value:  -1989.946  pgrad:  0.03392643 
## iter:  70  f-value:  -1989.946  pgrad:  0.0003728928 
##   Successful convergence.
## Parameter set :  10 ... 
## iter:  0  f-value:  -2100.94  pgrad:  317.5313 
## iter:  10  f-value:  -1991.327  pgrad:  2.7843 
## iter:  20  f-value:  -1990.415  pgrad:  1.435174 
## iter:  30  f-value:  -1990.046  pgrad:  3.248585 
## iter:  40  f-value:  -1989.946  pgrad:  0.06813025 
## iter:  50  f-value:  -1989.946  pgrad:  0.001450644 
##   Successful convergence.</code></pre>
<div class="sourceCode" id="cb2717"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># selecting only converged solutions</span>
<span class="va">pmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">ans</span><span class="op">$</span><span class="va">fvalue</span><span class="op">[</span><span class="va">ans</span><span class="op">$</span><span class="va">conv</span><span class="op">]</span>, <span class="va">ans</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="va">ans</span><span class="op">$</span><span class="va">conv</span>, <span class="op">]</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">pmat</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="cn">NULL</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"fvalue"</span>, <span class="st">"parameter 1"</span>, <span class="st">"parameter 2"</span>, <span class="st">"parameter 3"</span><span class="op">)</span><span class="op">)</span>
<span class="va">pmat</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">pmat</span><span class="op">)</span>, <span class="op">]</span></code></pre></div>
<pre><code>##         fvalue parameter 1 parameter 2 parameter 3
## [1,] -1989.946      0.6401      2.6634      1.2561
## [2,] -1997.263      0.4922      2.4559      1.8567
## [3,] -1989.946      0.3599      1.2561      2.6634
## [4,] -2000.039      0.7931      2.0681      2.4778
## [5,] -1989.946      0.3599      1.2560      2.6634</code></pre>
<p>用一个具体的参数估计问题，求极大似然点，混合正态分布
隐函数方程组
求解非线性方程组 <span class="citation"><a href="#ref-BB2019" role="doc-biblioref">[106]</a></span></p>
</div>
</div>
<div id="sec-multi-objective-optimization" class="section level2" number="38.6">
<h2>
<span class="header-section-number">38.6</span> 多目标规划<a class="anchor" aria-label="anchor" href="#sec-multi-objective-optimization"><i class="fas fa-link"></i></a>
</h2>
<p>多目标规划的基本想法是将多目标问题转化为单目标问题，常见方法有理想点法、线性加权法、非劣解集法、极大极小法。理想点法是先在给定约束条件下分别求解单个目标的最优值，构造新的单目标函数。线性加权法是给每个目标函数赋予权重系数，各个权重系数之和等于1。非劣解集法是先求解其中一个单目标函数的最优值，然后将其设为等式约束，将其最优值从最小值开始递增，然后求解另一个目标函数的最小值。极大极小法是采用标准的简面体爬山法和通用全局优化法求解多目标优化问题。</p>
<p>R 环境中，<a href="https://github.com/mbinois/GPareto">GPareto</a> 主要用来求解多目标规划问题。<a href="https://bookdown.org/gerhard_krennrich/doe_and_optimization/">试验设计和过程优化与R语言</a> 的 <a href="https://bookdown.org/gerhard_krennrich/doe_and_optimization/optimization.html#constrained-optimization">约束优化</a> 章节，<a href="https://www.stat.umn.edu/geyer/3701/notes/optimize.html">优化和解方程</a>。另外，《Search Methodologies: Introductory Tutorials in Optimization and Decision Support Techniques》<span class="citation"><a href="#ref-Deb2005" role="doc-biblioref">[107]</a></span> 多目标优化方法</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
  \min_x \left\{
      \begin{array}{l}  
        f_1(x) = 0.5x_1 + 0.6x_2 + 0.7 \exp(\frac{x_1 + x_3}{10}) \\
        f_2(x) = (x_1 - 2x_2)^2 + (2x_2 - 3x_3)^2 + (5x_3 -x_1)^2
      \end{array} \right. \\
    s.t. \quad x_1 \in [10, 80], x_2 \in [20, 90], x_3 \in [15, 100]
\end{array}
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2719"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DiceKriging</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">emoa</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">GPareto</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">DiceDesign</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2720"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Ternary</span><span class="op">)</span>
<span class="fu">TernaryPlot</span><span class="op">(</span>
  atip <span class="op">=</span> <span class="st">"Top"</span>, btip <span class="op">=</span> <span class="st">"Bottom"</span>, ctip <span class="op">=</span> <span class="st">"Right"</span>, 
  axis.col <span class="op">=</span> <span class="st">"red"</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu">HorizontalGrid</span><span class="op">(</span>grid.lines <span class="op">=</span> <span class="fl">2</span>, grid.col <span class="op">=</span> <span class="st">"blue"</span>, grid.lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="sec-classic-optimization" class="section level2" number="38.7">
<h2>
<span class="header-section-number">38.7</span> 经典优化问题<a class="anchor" aria-label="anchor" href="#sec-classic-optimization"><i class="fas fa-link"></i></a>
</h2>
<p>旅行商问题、背包问题、指派问题、选址问题、网络流量问题</p>
<p>规划快递员送餐的路线：从快递员出发地到各个取餐地，再到顾客家里，如何规划路线使得每个顾客下单到拿到餐的时间间隔小于 50 分钟，完成送餐，快递员的总时间最少？</p>
</div>
<div id="sec-regression-optimization" class="section level2" number="38.8">
<h2>
<span class="header-section-number">38.8</span> 回归与优化<a class="anchor" aria-label="anchor" href="#sec-regression-optimization"><i class="fas fa-link"></i></a>
</h2>
<p>简单线性回归</p>
<p><a href="https://cran.r-project.org/package=nlsr">nlsr</a></p>
<p>是否能给大家提供一些思路？</p>
<p>Lasso <span class="citation"><a href="#ref-lasso1996" role="doc-biblioref">[108]</a></span></p>
<p>Least Angle Regression <span class="citation"><a href="#ref-lar2004" role="doc-biblioref">[109]</a></span></p>
<p>为了解决Lasso的有偏估计问题，自适应 Lasso、松弛 Lasso
SCAD (Smoothly Clipped Absolute Deviation)<span class="citation"><a href="#ref-scad2008" role="doc-biblioref">[110]</a></span>
MCP (Minimax Concave Penalty)<span class="citation"><a href="#ref-mcp2010" role="doc-biblioref">[111]</a></span></p>
<p>由于缺少高效的求解算法，Lasso 在高维小样本特征选择研究中没有广泛流行，最小角回归(Least Angle Regression, LAR)算法 <span class="citation"><a href="#ref-lar2004" role="doc-biblioref">[109]</a></span> 的出现有力促进了Lasso在高维小样本数据中的应用</p>
<p><a href="https://github.com/ryantibs/best-subset/">bestsubset</a> 最优子集回归</p>
<p>经典的普通最小二乘、广义最小二乘、岭回归、逐步回归、Lasso 回归、最优子集回归都可转化为优化问题，一般形式如下</p>
<p><span class="math display">\[
\underbrace{\hat{\theta}_{\lambda_n}}_{\text{待估参数}} \in \arg \min_{\theta \in \Omega} \left\{ \underbrace{\mathcal{L}(\theta;Z_{1}^{n})}_{\text{损失函数}} + \lambda_n \underbrace{\mathcal{R}(\theta)}_{\text{正则化项}} \right\}.
\]</span></p>
<p>下面尝试以 nloptr 包的优化器来展示求解过程，并与 Base R、<strong>glmnet</strong> 和 <strong>MASS</strong> 实现的回归模型比较。</p>
<!-- 向量用小写，矩阵用大写 -->
<p><span class="math display">\[
\arg \min_{\beta,\lambda} ~~ \frac{1}{2} || \mathbf{y} - \mathbf{X} \beta ||_2^2 +  \lambda ||\beta||_1
\]</span>
其中，<span class="math inline">\(X \in \mathbb{R}^{m\times n}\)</span>， <span class="math inline">\(y \in \mathbb{R}^m\)</span>，<span class="math inline">\(\beta \in \mathbb{R}^n\)</span>， <span class="math inline">\(0 &lt; \lambda \in \mathbb{R}\)</span></p>
<!-- 
广义最小二乘拟合 nlme::gls  预测 nlme::predict.gls
用广义最小二乘拟合线性模型 MASS::lm.gls  
用广义最小二乘拟合趋势面 spatial::surf.gls
-->
<p><span class="math display">\[y = X\beta + \epsilon\]</span></p>
<p><span class="math inline">\(\hat{\beta} = (X^{\top}X)^{-1}X^{\top}y, \quad \hat{Y} = X(X^{\top}X)^{-1}X^{\top}y\)</span></p>
<div class="sourceCode" id="cb2721"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">50</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="fl">0</span><span class="op">)</span>
<span class="co"># y 的估计</span>
<span class="co"># 教科书版</span>
<span class="va">fit_base</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">x</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">y</span>
<span class="op">}</span>
<span class="co"># 先向量计算，然后矩阵计算</span>
<span class="va">fit_vector</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">%*%</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">x</span><span class="op">)</span> <span class="op">%*%</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/transpose.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="co"># X'X 是对称的，防止求逆</span>
<span class="va">fit_inv</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">x</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>QR 分解 <span class="math inline">\(X_{n\times p} = Q_{n\times p} R_{p\times p}\)</span>，<span class="math inline">\(n &gt; p\)</span>，<span class="math inline">\(Q^{\top}Q = I\)</span>，<span class="math inline">\(R\)</span> 是上三角矩阵，<span class="math inline">\(\hat{Y} = X(X^{\top}X)^{-1}X^{\top}y = QQ^{\top}y\)</span></p>
<div class="sourceCode" id="cb2722"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_qr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">decomp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/qr-methods.html">qr</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/qr.html">qr.qy</a></span><span class="op">(</span><span class="va">decomp</span>, <span class="fu"><a href="https://rdrr.io/r/base/qr.html">qr.qty</a></span><span class="op">(</span><span class="va">decomp</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lmfit.html">lm.fit</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></code></pre></div>
<p>若 <span class="math inline">\(A = X^{\top}X\)</span> 是正定矩阵，则 <span class="math inline">\(A = LL^{\top}\)</span>，<span class="math inline">\(L\)</span> 是下三角矩阵</p>
<div class="sourceCode" id="cb2723"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit_chol</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">decomp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/chol.html">chol</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>
  <span class="va">lxy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/backsolve.html">backsolve</a></span><span class="op">(</span><span class="va">decomp</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matrix-products.html">crossprod</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, transpose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
  <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/backsolve.html">backsolve</a></span><span class="op">(</span><span class="va">decomp</span>, <span class="va">lxy</span><span class="op">)</span>
  <span class="va">x</span> <span class="op">%*%</span> <span class="va">b</span>
<span class="op">}</span></code></pre></div>
<div class="sourceCode" id="cb2724"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Using C/C++</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">RcppEigen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppEigen/man/fastLm.html">fastLmPure</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">## QR</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">RcppEigen</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppEigen/man/fastLm.html">fastLmPure</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">## Cholesky</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">RcppArmadillo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppArmadillo/man/fastLm.html">fastLmPure</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="co">## QR</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span><span class="op">(</span><span class="fu">RcppArmadillo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RcppArmadillo/man/fastLm.html">fastLmPure</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, method <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co">## Cholesky</span></code></pre></div>
</div>
<div id="sec-log-likelihood" class="section level2" number="38.9">
<h2>
<span class="header-section-number">38.9</span> 对数似然<a class="anchor" aria-label="anchor" href="#sec-log-likelihood"><i class="fas fa-link"></i></a>
</h2>
<p>随机变量 X 服从参数为 <span class="math inline">\(\lambda &gt; 0\)</span> 的指数分布，密度函数 <span class="math inline">\(p(x)\)</span> 为</p>
<p><span class="math display">\[\begin{equation*}
\begin{array}{l}
 p(x) = \left\{ 
    \begin{array}{l}
    \lambda\mathrm{e}^{-\lambda x},  x \geq 0\\
    0, \quad x &lt; 0
    \end{array} \right.
\end{array}
\end{equation*}\]</span></p>
<p>其中，<span class="math inline">\(\lambda &gt; 0\)</span>，下面给定一系列模拟样本观察值 <span class="math inline">\(x_1, x_2, \cdots, x_n\)</span>，估计参数 <span class="math inline">\(\lambda\)</span>。对数似然函数 <span class="math inline">\(\ell(\lambda) = \log \prod_{i=1}^{n} f(x_i) = n \log \lambda - \lambda \sum_{i=1}^{n}x_i\)</span>。解此方程即可得到 <span class="math inline">\(\lambda\)</span> 的极大似然估计 <span class="math inline">\(\lambda_{mle} = \frac{1}{\bar{X}}\)</span>，极大值 <span class="math inline">\(\ell(\lambda_{mle}) = - n(1 + \log \bar{X})\)</span>。</p>
<p>根据上述样本，计算样本均值 <span class="math inline">\((\mu - 1.5*\sigma/\sqrt{n}, \mu + 1.5*\sigma/\sqrt{n})\)</span> 和方差 <span class="math inline">\((0.8\sigma, 1.5\sigma)\)</span>。
已知正态分布 <span class="math inline">\(f(x) = \frac{1}{\sqrt{2\pi}\sigma}\mathrm{e}^{- \frac{(x - \mu)^2}{2\sigma^2}}\)</span> 的对数似然形式 <span class="math inline">\(\ell(\mu,\sigma^2) = \log \prod_{i=1}^{n} f(x_i) = \sum_{i=1}^{n}\log f(x_i)\)</span>。正态分布的密度函数的对数可用 <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(..., log = TRUE)</a></code> 计算。</p>
<p>生成服从指数分布的样本，计算样本的均值和方差，依据均值和方差构造区间，然后将区间网格化，在此网格上绘制正态分布的对数似然函数。绕那么大一个圈子，其实就是绘制正态分布的对数似然函数。</p>
<div class="sourceCode" id="cb2725"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">)</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">20</span> <span class="co"># 随机数的个数</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html">rexp</a></span><span class="op">(</span><span class="va">n</span>, rate <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># 服从指数分布的随机数</span>
<span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">40</span> <span class="co"># 网格数</span>

<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,
  length.out <span class="op">=</span> <span class="va">m</span>
<span class="op">)</span>
<span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.8</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">1.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">m</span><span class="op">)</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mu</span>, y <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span>
<span class="co"># 正态分布的对数似然</span>
<span class="va">loglik</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">b</span>, <span class="va">x0</span><span class="op">)</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">dnorm</a></span><span class="op">(</span><span class="va">x0</span>, <span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">df</span><span class="op">$</span><span class="va">fnxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span>, <span class="va">loglik</span>, x0 <span class="op">=</span> <span class="va">x</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/cloud.html">wireframe</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">df</span>, <span class="va">fnxy</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>,
  shade <span class="op">=</span> <span class="cn">TRUE</span>, drape <span class="op">=</span> <span class="cn">FALSE</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span>, 
  ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span>, 
  zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="op">-</span><span class="fu">loglik</span><span class="op">(</span><span class="va">mu</span>, <span class="va">sigma</span><span class="op">)</span><span class="op">)</span>, rot <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>,
  scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>arrows <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,
  par.settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>axis.line <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"transparent"</span><span class="op">)</span><span class="op">)</span>,
  screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fl">120</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">70</span>, y <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:log-likelihood"></span>
<img src="numerical-optimization_files/figure-html/log-likelihood-1.png" alt="正态分布参数的负对数似然函数" width="528"><p class="caption">
图 38.15: 正态分布参数的负对数似然函数
</p>
</div>
<!-- 添加极大值点，除指数分布外，还有正态、二项、泊松分布观察其似然曲面的特点，都是单峰，有唯一极值点，再考虑正态混合模型的似然曲面 -->
</div>
<div id="sec-non-linear-tseries" class="section level2" number="38.10">
<h2>
<span class="header-section-number">38.10</span> 微分方程<a class="anchor" aria-label="anchor" href="#sec-non-linear-tseries"><i class="fas fa-link"></i></a>
</h2>
<!-- 介绍洛伦兹方程、人口模型、寿险精算模型、混沌 -->
<p><a href="https://blog.hamaluik.ca/posts/solving-systems-of-partial-differential-equations/">ode45 求解偏微分方程</a></p>
<p><strong>pracma</strong> 实现了 ode23, ode23s, ode45 等几个自适应的 Runge-Kutta 求解器，<strong>deSolve</strong> 包求解 ODE（常微分方程）, DAE（微分代数方程）, DDE（延迟微分方程，包含刚性和非刚性方程）和 PDE（偏微分方程），<strong>bvpSolve</strong>包求解 DAE/ODE 方程的边值问题。<strong>ReacTran</strong> <span class="citation"><a href="#ref-ReacTran2012" role="doc-biblioref">[112]</a></span> 可将偏微分方程转为常微分方程组，解决反应运输问题，在笛卡尔、极坐标、圆柱形和球形网格上离散偏微分方程。 <a href="https://github.com/LLNL/sundials">sundials</a> 提供一系列非线性方程、常微分方程、微分代数方程求解器，Satyaprakash Nayak 开发了相应的 <a href="https://github.com/sn248/sundialr"><strong>sundialr</strong></a> 包。</p>
<div id="subsec-ordinary-differential-equations" class="section level3" number="38.10.1">
<h3>
<span class="header-section-number">38.10.1</span> 常微分方程<a class="anchor" aria-label="anchor" href="#subsec-ordinary-differential-equations"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://en.wikipedia.org/wiki/Lorenz_system">洛伦兹系统</a>是一个常微分方程组，系统参数的默认值为 <span class="math inline">\((\sigma = 10, \rho = 28, \beta = 8/3)\)</span>，初值为 <span class="math inline">\((-13, -14, 47)\)</span>。</p>
<p><span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    \frac{\partial x}{\partial t} = \sigma (y - x) \\
    \frac{\partial y}{\partial t} = x(\rho -z) - y \\
    \frac{\partial x}{\partial t} = xy - \beta z
  \end{array} \right.
\end{equation*}\]</span></p>
<div class="sourceCode" id="cb2726"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/">deSolve</a></span><span class="op">)</span>
<span class="co"># 参数</span>
<span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="op">-</span><span class="fl">8</span> <span class="op">/</span> <span class="fl">3</span>, b <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, c <span class="op">=</span> <span class="fl">28</span><span class="op">)</span>
<span class="co"># 初值</span>
<span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span>, Y <span class="op">=</span> <span class="fl">1</span>, Z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co"># 时间间隔</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="co"># 定义方程组</span>
<span class="va">lorenz_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">state</span>, <span class="va">parameters</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/as.data.frame.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">parameters</span><span class="op">)</span><span class="op">)</span>, <span class="op">{</span>
    <span class="va">dX</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">X</span> <span class="op">+</span> <span class="va">Y</span> <span class="op">*</span> <span class="va">Z</span>
    <span class="va">dY</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">*</span> <span class="op">(</span><span class="va">Y</span> <span class="op">-</span> <span class="va">Z</span><span class="op">)</span>
    <span class="va">dZ</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">X</span> <span class="op">*</span> <span class="va">Y</span> <span class="op">+</span> <span class="va">c</span> <span class="op">*</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Z</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">dX</span>, <span class="va">dY</span>, <span class="va">dZ</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span>
  y <span class="op">=</span> <span class="va">state</span>, times <span class="op">=</span> <span class="va">times</span>,
  func <span class="op">=</span> <span class="va">lorenz_fun</span>, parms <span class="op">=</span> <span class="va">pars</span>
<span class="op">)</span></code></pre></div>
<p>调用 <strong>scatterplot3d</strong> 绘制三维曲线图，如图<a href="chap-numerical-optimization.html#fig:ode-lorenz">38.16</a> 所示</p>
<div class="sourceCode" id="cb2727"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">scatterplot3d</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/scatterplot3d/man/scatterplot3d.html">scatterplot3d</a></span><span class="op">(</span>
  x <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"X"</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"Y"</span><span class="op">]</span>, z <span class="op">=</span> <span class="va">out</span><span class="op">[</span>, <span class="st">"Z"</span><span class="op">]</span>,
  col.axis <span class="op">=</span> <span class="st">"black"</span>, type <span class="op">=</span> <span class="st">"l"</span>, color <span class="op">=</span> <span class="st">"gray"</span>,
  xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, zlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span>,
  col.grid <span class="op">=</span> <span class="st">"gray"</span>, main <span class="op">=</span> <span class="st">"Lorenz"</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:ode-lorenz"></span>
<img src="numerical-optimization_files/figure-html/ode-lorenz-1.png" alt="洛伦兹曲线" width="528"><p class="caption">
图 38.16: 洛伦兹曲线
</p>
</div>
</div>
<div id="subsec-partial-differential-equations" class="section level3" number="38.10.2">
<h3>
<span class="header-section-number">38.10.2</span> 偏微分方程<a class="anchor" aria-label="anchor" href="#subsec-partial-differential-equations"><i class="fas fa-link"></i></a>
</h3>
<p>ReacTran 的几个关键函数介绍</p>
<p>一维热传导方程</p>
<p><span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    \frac{\partial y}{\partial t} = D \frac{\partial^2 y}{\partial x^2}
  \end{array} \right.
\end{equation*}\]</span></p>
<p>参数 <span class="math inline">\(D = 0.01\)</span>，边界条件 <span class="math inline">\(y_{t,x=0} = 0, y_{t, x = 1} = 1\)</span>，初始条件 <span class="math inline">\(y_{t=0,x} = \sin(\pi x)\)</span>。</p>
<div class="sourceCode" id="cb2728"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ReacTran</span><span class="op">)</span>

<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">xgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/setup.grid.1D.html">setup.grid.1D</a></span><span class="op">(</span>x.up <span class="op">=</span> <span class="fl">0</span>, x.down <span class="op">=</span> <span class="fl">1</span>, N <span class="op">=</span> <span class="va">N</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">x.mid</span>
<span class="va">D.coeff</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>
<span class="va">Diffusion</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">Y</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">tran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/tran.1D.html">tran.1D</a></span><span class="op">(</span>
    C <span class="op">=</span> <span class="va">Y</span>, C.up <span class="op">=</span> <span class="fl">0</span>, C.down <span class="op">=</span> <span class="fl">1</span>,
    D <span class="op">=</span> <span class="va">D.coeff</span>, dx <span class="op">=</span> <span class="va">xgrid</span>
  <span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    dY <span class="op">=</span> <span class="va">tran</span><span class="op">$</span><span class="va">dC</span>, 
    flux.up <span class="op">=</span> <span class="va">tran</span><span class="op">$</span><span class="va">flux.up</span>,
    flux.down <span class="op">=</span> <span class="va">tran</span><span class="op">$</span><span class="va">flux.down</span>
  <span class="op">)</span>
<span class="op">}</span>
<span class="va">yini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">5</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>
<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.1D.html">ode.1D</a></span><span class="op">(</span>
  y <span class="op">=</span> <span class="va">yini</span>, times <span class="op">=</span> <span class="va">times</span>, func <span class="op">=</span> <span class="va">Diffusion</span>,
  parms <span class="op">=</span> <span class="cn">NULL</span>, dimens <span class="op">=</span> <span class="va">N</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2729"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/image.html">image</a></span><span class="op">(</span><span class="va">out</span>,
  grid <span class="op">=</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">x.mid</span>, xlab <span class="op">=</span> <span class="st">"times"</span>,
  ylab <span class="op">=</span> <span class="st">"Distance"</span>, main <span class="op">=</span> <span class="st">"PDE"</span>, add.contour <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:pde-1d"></span>
<img src="numerical-optimization_files/figure-html/pde-1d-1.png" alt="一维热传导方程的数值解热力图" width="528"><p class="caption">
图 38.17: 一维热传导方程的数值解热力图
</p>
</div>
<p>二维拉普拉斯方程</p>
<p><span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    \frac{\partial^2 u}{\partial^2 x} + \frac{\partial^2 u}{\partial y^2} = 0
  \end{array} \right.
\end{equation*}\]</span></p>
<p>边界条件</p>
<p><span class="math display">\[\begin{equation*}
\left\{ 
  \begin{array}{l}
    u_{x=0,y} = u_{x=1,y} = 0 \\
    \frac{\partial u_{x, y=0}}{\partial y} = 0 \\
    \frac{\partial u_{x,y=1}}{\partial y} = \pi\sinh(\pi)\sin(\pi x)
  \end{array} \right.
\end{equation*}\]</span></p>
<p>它有解析解</p>
<p><span class="math display">\[
u(x,y) = \sin(\pi x)\cosh(\pi y)
\]</span></p>
<p>其中 <span class="math inline">\(x \in [0,1], y\in [0,1]\)</span></p>
<div class="sourceCode" id="cb2730"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Hyperbolic.html">cosh</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="va">y</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">101</span><span class="op">)</span>
<span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html">outer</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">fn</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2731"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/image.html">image</a></span><span class="op">(</span><span class="va">z</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/contour.html">contour</a></span><span class="op">(</span><span class="va">z</span>, method <span class="op">=</span> <span class="st">"flattest"</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:laplace-eq-image"></span>
<img src="numerical-optimization_files/figure-html/laplace-eq-image-1.png" alt="解析解的二维图像" width="528"><p class="caption">
图 38.18: 解析解的二维图像
</p>
</div>
<div class="sourceCode" id="cb2732"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/persp.html">persp</a></span><span class="op">(</span><span class="va">z</span>, 
  theta <span class="op">=</span> <span class="fl">30</span>, phi <span class="op">=</span> <span class="fl">20</span>, 
  r <span class="op">=</span> <span class="fl">50</span>, d <span class="op">=</span> <span class="fl">0.1</span>, expand <span class="op">=</span> <span class="fl">0.5</span>, ltheta <span class="op">=</span> <span class="fl">90</span>, lphi <span class="op">=</span> <span class="fl">180</span>,
  shade <span class="op">=</span> <span class="fl">0.1</span>, ticktype <span class="op">=</span> <span class="st">"detailed"</span>, nticks <span class="op">=</span> <span class="fl">5</span>, box <span class="op">=</span> <span class="cn">TRUE</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shape/man/drapecol.html">drapecol</a></span><span class="op">(</span><span class="va">z</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">terrain.colors</a></span><span class="op">(</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span>,
  border <span class="op">=</span> <span class="st">"transparent"</span>,
  xlab <span class="op">=</span> <span class="st">"X"</span>, ylab <span class="op">=</span> <span class="st">"Y"</span>, zlab <span class="op">=</span> <span class="st">"Z"</span>, 
  main <span class="op">=</span> <span class="st">""</span>
<span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:laplace-eq-persp"></span>
<img src="numerical-optimization_files/figure-html/laplace-eq-persp-1.png" alt="解析解的三维透视图像" width="528"><p class="caption">
图 38.19: 解析解的三维透视图像
</p>
</div>
<p>求解 PDE</p>
<div class="sourceCode" id="cb2733"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dx</span> <span class="op">&lt;-</span> <span class="fl">0.2</span>
<span class="va">xgrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/setup.grid.1D.html">setup.grid.1D</a></span><span class="op">(</span><span class="op">-</span><span class="fl">100</span>, <span class="fl">100</span>, dx.1 <span class="op">=</span> <span class="va">dx</span><span class="op">)</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">x.mid</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="va">xgrid</span><span class="op">$</span><span class="va">N</span>

<span class="va">uini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span> <span class="op">*</span> <span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">vini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">N</span><span class="op">)</span>
<span class="va">yini</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">uini</span>, <span class="va">vini</span><span class="op">)</span>
<span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">50</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="va">wave</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">u1</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">]</span>
  <span class="va">u2</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span><span class="op">)</span><span class="op">]</span>
  <span class="va">du1</span> <span class="op">&lt;-</span> <span class="va">u2</span>
  <span class="va">du2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ReacTran/man/tran.1D.html">tran.1D</a></span><span class="op">(</span>C <span class="op">=</span> <span class="va">u1</span>, C.up <span class="op">=</span> <span class="fl">0</span>, C.down <span class="op">=</span> <span class="fl">0</span>, D <span class="op">=</span> <span class="fl">1</span>, dx <span class="op">=</span> <span class="va">xgrid</span><span class="op">)</span><span class="op">$</span><span class="va">dC</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="va">du1</span>, <span class="va">du2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.1D.html">ode.1D</a></span><span class="op">(</span>
  func <span class="op">=</span> <span class="va">wave</span>, y <span class="op">=</span> <span class="va">yini</span>, times <span class="op">=</span> <span class="va">times</span>, parms <span class="op">=</span> <span class="cn">NULL</span>,
  nspec <span class="op">=</span> <span class="fl">2</span>, method <span class="op">=</span> <span class="st">"ode45"</span>, dimens <span class="op">=</span> <span class="va">N</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/c.html">c</a></span><span class="op">(</span><span class="st">"u"</span>, <span class="st">"v"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="subsec-delay-differential-equations" class="section level3" number="38.10.3">
<h3>
<span class="header-section-number">38.10.3</span> 延迟微分方程<a class="anchor" aria-label="anchor" href="#subsec-delay-differential-equations"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb2734"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/pbs-software/pbs-ddesolve">PBSddesolve</a></span><span class="op">)</span>    <span class="co"># DAE 延迟微分方程</span></code></pre></div>
<p><a href="https://github.com/pbs-software/pbs-ddesolve"><strong>PBSddesolve</strong></a> <span class="citation"><a href="#ref-PBSddesolve" role="doc-biblioref">[113]</a></span>
<strong>PBSmodelling</strong>
<strong>PBSmapping</strong></p>
<p><strong>nlmeODE</strong> 通过微分方程整合用于混合效应模型的 odesolve 和 nlme 包。</p>
</div>
<div id="subsec-stochastic-differential-equations" class="section level3" number="38.10.4">
<h3>
<span class="header-section-number">38.10.4</span> 随机微分方程<a class="anchor" aria-label="anchor" href="#subsec-stochastic-differential-equations"><i class="fas fa-link"></i></a>
</h3>
<p><a href="https://github.com/acguidoum/Sim.DiffProc">Sim.DiffProc</a></p>
<p><a href="https://uploads.cosx.org/2008/12/stochastic-differential-equation-with-r.pdf">随机微分方程入门：基于 R 语言的模拟和推断</a></p>
<div class="sourceCode" id="cb2735"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/acguidoum/Sim.DiffProc">Sim.DiffProc</a></span><span class="op">)</span></code></pre></div>
<p>种群 ODE 建模，</p>
<p><a href="https://github.com/nlmixrdevelopment/nlmixr">nlmixr</a> 借助 <a href="https://github.com/nlmixrdevelopment/RxODE/">RxODE</a> 求解基于常微分方程的非线性混合效应模型</p>
</div>
</div>
<div id="sec-numerical-optimization-session" class="section level2" number="38.11">
<h2>
<span class="header-section-number">38.11</span> 运行环境<a class="anchor" aria-label="anchor" href="#sec-numerical-optimization-session"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb2736"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## R version 4.1.1 (2021-08-10)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Ubuntu 20.04.3 LTS
## 
## Matrix products: default
## BLAS:   /usr/lib/x86_64-linux-gnu/blas/libblas.so.3.9.0
## LAPACK: /usr/lib/x86_64-linux-gnu/lapack/liblapack.so.3.9.0
## 
## locale:
##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] Deriv_4.1.3               quadprog_1.5-8           
##  [3] kableExtra_1.3.4          tibble_3.1.5             
##  [5] Sim.DiffProc_4.8          nlmeODE_1.1              
##  [7] nlme_3.1-153              PBSddesolve_1.12.6       
##  [9] ReacTran_1.4.3.1          shape_1.4.6              
## [11] scatterplot3d_0.3-41      deSolve_1.30             
## [13] BB_2019.10-1              rootSolve_1.8.2.3        
## [15] kernlab_0.9-29            lattice_0.20-45          
## [17] ROI.plugin.quadprog_1.0-0 ROI.plugin.lpsolve_1.0-1 
## [19] ROI.plugin.nloptr_1.0-0   ROI.plugin.alabama_1.0-0 
## [21] ROI_1.0-0                 lpSolve_5.6.15           
## 
## loaded via a namespace (and not attached):
##  [1] svglite_2.0.0           digest_0.6.28           utf8_1.2.2             
##  [4] slam_0.1-48             R6_2.5.1                alabama_2015.3-1       
##  [7] evaluate_0.14           highr_0.9               httr_1.4.2             
## [10] pillar_1.6.3            rlang_0.4.11            curl_4.3.2             
## [13] rstudioapi_0.13         nloptr_1.2.2.2          jquerylib_0.1.4        
## [16] rmarkdown_2.11          webshot_0.5.2           stringr_1.4.0          
## [19] munsell_0.5.0           compiler_4.1.1          numDeriv_2016.8-1.1    
## [22] xfun_0.26               systemfonts_1.0.3       pkgconfig_2.0.3        
## [25] htmltools_0.5.2         downlit_0.2.1           bookdown_0.24          
## [28] viridisLite_0.4.0       fansi_0.5.0             crayon_1.4.1           
## [31] MASS_7.3-54             grid_4.1.1              jsonlite_1.7.2         
## [34] lifecycle_1.0.1         registry_0.5-1          magrittr_2.0.1         
## [37] scales_1.1.1            stringi_1.7.5           fs_1.5.0               
## [40] xml2_1.3.2              bslib_0.3.1             ellipsis_0.3.2         
## [43] vctrs_0.3.8             lpSolveAPI_5.5.2.0-17.7 tools_4.1.1            
## [46] glue_1.4.2              parallel_4.1.1          fastmap_1.1.0          
## [49] yaml_2.2.1              colorspace_2.0-2        rvest_1.0.2            
## [52] knitr_1.36              sass_0.4.0</code></pre>

</div>
</div>



<h3>参考文献</h3>
<div id="refs" class="references csl-bib-body">
<div id="ref-CVXR2020" class="csl-entry">
<div class="csl-left-margin">[96] </div>
<div class="csl-right-inline">A. Fu, B. Narasimhan, and S. Boyd, <span>“<span>CVXR</span>: An <span>R</span> package for disciplined convex optimization,”</span> <em>Journal of Statistical Software</em>, vol. 94, no. 14, pp. 1–34, 2020, doi: <a href="https://doi.org/10.18637/jss.v094.i14">10.18637/jss.v094.i14</a>.</div>
</div>
<div id="ref-nloptr" class="csl-entry">
<div class="csl-left-margin">[97] </div>
<div class="csl-right-inline">J. Ypma, <em><span>R</span> interface to <span>NLopt</span></em>. 2020.Available: <a href="https://github.com/jyypma/nloptr">https://github.com/jyypma/nloptr</a>
</div>
</div>
<div id="ref-GPareto2019" class="csl-entry">
<div class="csl-left-margin">[98] </div>
<div class="csl-right-inline">M. Binois and V. Picheny, <span>“<span>GPareto</span>: An <span>R</span> package for gaussian-process-based multi-objective optimization and analysis,”</span> <em>Journal of Statistical Software</em>, vol. 89, no. 8, pp. 1–30, 2019, doi: <a href="https://doi.org/10.18637/jss.v089.i08">10.18637/jss.v089.i08</a>.</div>
</div>
<div id="ref-ROI2020" class="csl-entry">
<div class="csl-left-margin">[99] </div>
<div class="csl-right-inline">S. Theußl, F. Schwendinger, and K. Hornik, <span>“<span>ROI</span>: An extensible <span>R</span> optimization infrastructure,”</span> <em>Journal of Statistical Software</em>, vol. 94, no. 15, pp. 1–64, 2020, doi: <a href="https://doi.org/10.18637/jss.v094.i15">10.18637/jss.v094.i15</a>.</div>
</div>
<div id="ref-GA2013" class="csl-entry">
<div class="csl-left-margin">[100] </div>
<div class="csl-right-inline">L. Scrucca, <span>“<span>GA</span>: A package for genetic algorithms in <span>R</span>,”</span> <em>Journal of Statistical Software</em>, vol. 53, no. 4, pp. 1–37, 2013,Available: <a href="https://www.jstatsoft.org/v53/i04/">https://www.jstatsoft.org/v53/i04/</a>
</div>
</div>
<div id="ref-GA2017" class="csl-entry">
<div class="csl-left-margin">[101] </div>
<div class="csl-right-inline">L. Scrucca, <span>“On some extensions to <span>GA</span> package: Hybrid optimisation, parallelisation and islands evolution,”</span> <em>The R Journal</em>, vol. 9, no. 1, pp. 187–206, 2017,Available: <a href="https://journal.r-project.org/archive/2017/RJ-2017-008/">https://journal.r-project.org/archive/2017/RJ-2017-008/</a>
</div>
</div>
<div id="ref-NMOF2019" class="csl-entry">
<div class="csl-left-margin">[102] </div>
<div class="csl-right-inline">M. Gilli, D. Maringer, and E. Schumann, <em>Numerical methods and optimization in finance</em>, Second. Waltham, MA, USA: Elsevier/Academic Press, 2019.Available: <a href="http://www.enricoschumann.net/NMOF/">http://www.enricoschumann.net/NMOF/</a>
</div>
</div>
<div id="ref-Nash2014" class="csl-entry">
<div class="csl-left-margin">[103] </div>
<div class="csl-right-inline">J. C. Nash, <span>“On best practice optimization methods in r,”</span> <em>Journal of Statistical Software</em>, vol. 60, no. 2, pp. 1–14, 2014, doi: <a href="https://doi.org/10.18637/jss.v060.i02">10.18637/jss.v060.i02</a>.</div>
</div>
<div id="ref-quadprog2019" class="csl-entry">
<div class="csl-left-margin">[104] </div>
<div class="csl-right-inline">B. A. Turlach, <em><span class="nocase">quadprog</span>: Functions to solve quadratic programming problems.</em> 2019.Available: <a href="https://CRAN.R-project.org/package=quadprog">https://CRAN.R-project.org/package=quadprog</a>
</div>
</div>
<div id="ref-pracma2021" class="csl-entry">
<div class="csl-left-margin">[105] </div>
<div class="csl-right-inline">H. W. Borchers, <em>Pracma: Practical numerical math functions</em>. 2021.Available: <a href="https://CRAN.R-project.org/package=pracma">https://CRAN.R-project.org/package=pracma</a>
</div>
</div>
<div id="ref-BB2019" class="csl-entry">
<div class="csl-left-margin">[106] </div>
<div class="csl-right-inline">R. Varadhan and P. Gilbert, <span>“<span>BB</span>: An <span>R</span> package for solving a large system of nonlinear equations and for optimizing a high-dimensional nonlinear objective function,”</span> <em>Journal of Statistical Software</em>, vol. 32, no. 4, pp. 1–26, 2009,Available: <a href="https://www.jstatsoft.org/v32/i04/">https://www.jstatsoft.org/v32/i04/</a>
</div>
</div>
<div id="ref-Deb2005" class="csl-entry">
<div class="csl-left-margin">[107] </div>
<div class="csl-right-inline">K. Deb, <span>“Multi-objective optimization,”</span> in <em>Search methodologies: Introductory tutorials in optimization and decision support techniques</em>, E. K. Burke and G. Kendall, Eds. Boston, MA: Springer US, 2005, pp. 273–316. doi: <a href="https://doi.org/10.1007/0-387-28356-0_10">10.1007/0-387-28356-0_10</a>.</div>
</div>
<div id="ref-lasso1996" class="csl-entry">
<div class="csl-left-margin">[108] </div>
<div class="csl-right-inline">R. Tibshirani, <span>“Regression shrinkage and selection via the <span>Lasso</span>,”</span> <em>Journal of the Royal Statistical Society. Series B (Methodological)</em>, vol. 58, no. 1, pp. 267–288, 1996,Available: <a href="http://www.jstor.org/stable/2346178">http://www.jstor.org/stable/2346178</a>
</div>
</div>
<div id="ref-lar2004" class="csl-entry">
<div class="csl-left-margin">[109] </div>
<div class="csl-right-inline">B. Efron, T. Hastie, I. Johnstone, and R. Tibshirani, <span>“<span class="nocase">Least angle regression</span>,”</span> <em>The Annals of Statistics</em>, vol. 32, no. 2, pp. 407–499, 2004, doi: <a href="https://doi.org/10.1214/009053604000000067">10.1214/009053604000000067</a>.</div>
</div>
<div id="ref-scad2008" class="csl-entry">
<div class="csl-left-margin">[110] </div>
<div class="csl-right-inline">Y. Kim, H. Choi, and H.-S. Oh, <span>“Smoothly clipped absolute deviation on high dimensions,”</span> <em>Journal of the American Statistical Association</em>, vol. 103, no. 484, pp. 1665–1673, 2008, doi: <a href="https://doi.org/10.1198/016214508000001066">10.1198/016214508000001066</a>.</div>
</div>
<div id="ref-mcp2010" class="csl-entry">
<div class="csl-left-margin">[111] </div>
<div class="csl-right-inline">C.-H. Zhang, <span>“Nearly unbiased variable selection under minimax concave penalty,”</span> <em>The Annals of Statistics</em>, vol. 38, no. 2, pp. 894–942, 2010, doi: <a href="https://doi.org/10.1214/09-AOS729">10.1214/09-AOS729</a>.</div>
</div>
<div id="ref-ReacTran2012" class="csl-entry">
<div class="csl-left-margin">[112] </div>
<div class="csl-right-inline">K. Soetaert and F. Meysman, <span>“Reactive transport in aquatic ecosystems: Rapid model prototyping in the open source software <span>R</span>,”</span> <em>Environmental Modelling &amp; Software</em>, vol. 32, pp. 49–60, 2012.</div>
</div>
<div id="ref-PBSddesolve" class="csl-entry">
<div class="csl-left-margin">[113] </div>
<div class="csl-right-inline">A. Couture-Beil, J. T. Schnute, R. Haigh, S. N. Wood, and B. J. Cairns, <em><span>PBSddesolve</span>: Solver for delay differential equations</em>. 2019.Available: <a href="https://CRAN.R-project.org/package=PBSddesolve">https://CRAN.R-project.org/package=PBSddesolve</a>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="chap-gradient-boosting-machine.html"><span class="header-section-number">37</span> 梯度提升机</a></div>
<div class="next"><a href="chap-linux-command-bash.html"><span class="header-section-number">A</span> 命令行操作</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chap-numerical-optimization"><span class="header-section-number">38</span> 数值优化</a></li>
<li><a class="nav-link" href="#sec-linear-programming"><span class="header-section-number">38.1</span> 线性规划</a></li>
<li>
<a class="nav-link" href="#sec-integer-programming"><span class="header-section-number">38.2</span> 整数规划</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#common-integer-programming"><span class="header-section-number">38.2.1</span> 一般整数规划</a></li>
<li><a class="nav-link" href="#binary-integer-programming"><span class="header-section-number">38.2.2</span> 0-1 整数规划</a></li>
<li><a class="nav-link" href="#mixed-integer-programming"><span class="header-section-number">38.2.3</span> 混合整数规划</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sec-quadratic-programming"><span class="header-section-number">38.3</span> 二次规划</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sec-strictly-convex-quadratic-program"><span class="header-section-number">38.3.1</span> 凸二次规划</a></li>
<li><a class="nav-link" href="#subsec-semidefinite-optimization"><span class="header-section-number">38.3.2</span> 半正定二次优化</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sec-nonlinear-programming"><span class="header-section-number">38.4</span> 非线性规划</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sec-one-dimensional-optimization"><span class="header-section-number">38.4.1</span> 一元非线性优化</a></li>
<li><a class="nav-link" href="#sec-nonlinear-unconstrained-optimization"><span class="header-section-number">38.4.2</span> 多元非线性无约束优化</a></li>
<li><a class="nav-link" href="#sec-nonlinear-constrained-optimization"><span class="header-section-number">38.4.3</span> 多元非线性约束优化</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#sec-nonlinear-equations"><span class="header-section-number">38.5</span> 非线性方程</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#subsec-equation"><span class="header-section-number">38.5.1</span> 一元非线性方程</a></li>
<li><a class="nav-link" href="#subsec-equations"><span class="header-section-number">38.5.2</span> 非线性方程组</a></li>
</ul>
</li>
<li><a class="nav-link" href="#sec-multi-objective-optimization"><span class="header-section-number">38.6</span> 多目标规划</a></li>
<li><a class="nav-link" href="#sec-classic-optimization"><span class="header-section-number">38.7</span> 经典优化问题</a></li>
<li><a class="nav-link" href="#sec-regression-optimization"><span class="header-section-number">38.8</span> 回归与优化</a></li>
<li><a class="nav-link" href="#sec-log-likelihood"><span class="header-section-number">38.9</span> 对数似然</a></li>
<li>
<a class="nav-link" href="#sec-non-linear-tseries"><span class="header-section-number">38.10</span> 微分方程</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#subsec-ordinary-differential-equations"><span class="header-section-number">38.10.1</span> 常微分方程</a></li>
<li><a class="nav-link" href="#subsec-partial-differential-equations"><span class="header-section-number">38.10.2</span> 偏微分方程</a></li>
<li><a class="nav-link" href="#subsec-delay-differential-equations"><span class="header-section-number">38.10.3</span> 延迟微分方程</a></li>
<li><a class="nav-link" href="#subsec-stochastic-differential-equations"><span class="header-section-number">38.10.4</span> 随机微分方程</a></li>
</ul>
</li>
<li><a class="nav-link" href="#sec-numerical-optimization-session"><span class="header-section-number">38.11</span> 运行环境</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/XiangyunHuang/masr/blob/devel/numerical-optimization.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/XiangyunHuang/masr/edit/devel/numerical-optimization.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>现代应用统计与 R 语言</strong>: Modern Applied Statistics with R" was written by 黄湘云. It was last built on 2021-12-02.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
